try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="06c96d83-2a4d-4b61-9d0d-839181b06a8b",e._sentryDebugIdIdentifier="sentry-dbid-06c96d83-2a4d-4b61-9d0d-839181b06a8b")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51775],{57320:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/storage/files",function(){return a(62485)}])},62485:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var s=a(80263),l=a(31092),r=a(96040),n=a(53239),i=a(22891),d=a(37873),c=a(44168),o=a(10723),u=a(53931),m=a(78960),x=a(11164),y=a(65802),h=a(85039),b=a(6436),f=a(51537),p=a(21162),j=a(99779),k=a(78039),g=a(44725),T=a(64758),B=a(62230),w=a(29556),v=a(62941),N=a(80100),_=a(78511);let z=(0,n.createContext)(null),C=e=>{let{scrollContainerProps:t,containerProps:a,data:l,children:r,overscan:i=5,estimateSize:d,getItemKey:c,...o}=e,u=(0,n.useRef)(null),m=(0,n.useCallback)((e,t)=>c?c(e,t):t,[c]),x=(0,n.useCallback)(e=>{let t=l[e];return t?m(t,e):e},[l,m]),y=(0,v.Te)({count:l.length,getScrollElement:()=>u.current,overscan:i,estimateSize:d,getItemKey:x}),h=y.getVirtualItems(),b=y.getTotalSize(),f=h.length>0?h[0].start:0,p=h.length>0?b-h[h.length-1].end:0,j=(0,n.useMemo)(()=>({virtualizer:y,virtualItems:h,data:l,paddingTop:f,paddingBottom:p,getRowKey:m}),[y,h,l,f,p,m]),k=(0,n.useMemo)(()=>({...a,className:(0,N.cn)("overflow-visible",null==a?void 0:a.className)}),[a]),{className:g,...T}=null!=t?t:{};return(0,s.jsx)("div",{ref:u,className:(0,N.cn)("h-full overflow-auto",g),...T,"data-sentry-component":"VirtualizedTable","data-sentry-source-file":"VirtualizedTable.tsx",children:(0,s.jsx)(z.Provider,{value:j,"data-sentry-element":"VirtualizedTableContext.Provider","data-sentry-source-file":"VirtualizedTable.tsx",children:(0,s.jsx)(_.XI,{containerProps:k,...o,"data-sentry-element":"Table","data-sentry-source-file":"VirtualizedTable.tsx",children:r})})})},S=e=>{let{emptyContent:t,leadingContent:a,trailingContent:l,children:r,paddingColSpan:d=1,paddingCellClassName:c,...o}=e,{virtualizer:u,virtualItems:m,data:x,paddingTop:y,paddingBottom:h,getRowKey:b}=(()=>{let e=(0,n.useContext)(z);if(!e)throw Error("VirtualizedTable components must be used within a VirtualizedTable");return e})(),f=u.measureElement;return(0,s.jsxs)(_.BF,{...o,"data-sentry-element":"TableBody","data-sentry-component":"VirtualizedTableBody","data-sentry-source-file":"VirtualizedTable.tsx",children:[a,0===x.length?null!=t?t:null:(0,s.jsxs)(s.Fragment,{children:[y>0&&(0,s.jsx)(_.Hj,{"aria-hidden":"true",style:{height:y},children:(0,s.jsx)(P,{colSpan:d,className:(0,N.cn)("p-0",c)})}),m.map(e=>{var t;let a=x[e.index];if(void 0===a)return null;let s=r(a,e.index);if(!(0,n.isValidElement)(s))return s;let l=null!=(t=s.key)?t:b(a,e.index),d=s.ref,c=null!=d?(0,i.Px)(f,d):f;return(0,n.cloneElement)(s,{key:l,ref:c,"data-index":e.index})}),h>0&&(0,s.jsx)(_.Hj,{"aria-hidden":"true",style:{height:h},children:(0,s.jsx)(P,{colSpan:d,className:(0,N.cn)("p-0",c)})})]}),l]})},A=_.A0,I=(0,n.forwardRef)((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(_.nd,{ref:t,className:(0,N.cn)("sticky top-0 z-10 bg-200",a),...l})});I.displayName="VirtualizedTableHead";let H=_.Hj,P=_.nA;var V=a(48510),E=a(76196),R=a(3701),D=a(21650);let L=e=>{let{mode:t,hasBuckets:a=!0}=e,l="standard"===t?_.A0:A,r="standard"===t?_.Hj:H,n="standard"===t?_.nd:I,i="sticky top-0 z-10 bg-200";return(0,s.jsx)(l,{"data-sentry-element":"BucketTableHeader","data-sentry-component":"BucketTableHeader","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsxs)(r,{"data-sentry-element":"BucketTableRow","data-sentry-source-file":"BucketTable.tsx",children:[a&&(0,s.jsx)(n,{className:"".concat(i," w-2 pr-1"),children:(0,s.jsx)("span",{className:"sr-only",children:"Icon"})}),(0,s.jsx)(n,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"Name"}),(0,s.jsx)(n,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"Policies"}),(0,s.jsx)(n,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"File size limit"}),(0,s.jsx)(n,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"Allowed MIME types"}),(0,s.jsx)(n,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("span",{className:"sr-only",children:"Actions"})})]})})},F=e=>{let{mode:t,filterString:a}=e,l="standard"===t?_.Hj:H,r="standard"===t?_.nA:P;return(0,s.jsx)(l,{className:"[&>td]:hover:bg-inherit","data-sentry-element":"BucketTableRow","data-sentry-component":"BucketTableEmptyState","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsxs)(r,{colSpan:5,"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["Your search for “",a,"” did not return any results"]})]})})},M=e=>{let{mode:t,bucket:a,projectRef:l,formattedGlobalUploadLimit:r,getPolicyCount:n}=e,i="standard"===t?_.Hj:H,d="standard"===t?_.nA:P,c=(0,R.useRouter)(),o=(e,t)=>{let a="/project/".concat(l,"/storage/files/buckets/").concat(encodeURIComponent(e));t.metaKey||t.ctrlKey?window.open(a,"_blank"):c.push(a)};return(0,s.jsxs)(i,{"data-bucket-id":a.id,className:"relative cursor-pointer h-16 group inset-focus",onClick:e=>o(a.id,e),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(a.id,e))},tabIndex:0,"data-sentry-element":"BucketTableRow","data-sentry-component":"BucketTableRow","data-sentry-source-file":"BucketTable.tsx",children:[(0,s.jsx)(d,{className:"w-2 pr-1","data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)(V.fW,{"aria-label":"bucket icon",size:16,className:"text-foreground-muted","data-sentry-element":"BucketIcon","data-sentry-source-file":"BucketTable.tsx"})}),(0,s.jsx)(d,{className:"flex-1","data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,s.jsx)("p",{className:"whitespace-nowrap max-w-[512px] truncate",children:a.id}),a.public&&(0,s.jsx)(D.E,{variant:"warning",children:"Public"})]})}),(0,s.jsx)(d,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("p",{className:"text-foreground-light",children:n(a.id)})}),(0,s.jsx)(d,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("p",{className:"whitespace-nowrap ".concat(a.file_size_limit?"text-foreground-light":"text-foreground-muted"),children:a.file_size_limit?(0,b.z3)(a.file_size_limit):"Unset (".concat(r,")")})}),(0,s.jsx)(d,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("p",{className:a.allowed_mime_types?"text-foreground-light":"text-foreground-muted",children:a.allowed_mime_types?a.allowed_mime_types.join(", "):"Any"})}),(0,s.jsxs)(d,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:[(0,s.jsx)("div",{className:"flex justify-end items-center h-full",children:(0,s.jsx)(E.A,{"aria-hidden":!0,size:14,className:"text-foreground-muted/60","data-sentry-element":"ChevronRight","data-sentry-source-file":"BucketTable.tsx"})}),(0,s.jsx)("button",{tabIndex:-1,className:"sr-only",children:"Go to bucket details"})]})]},a.id)},U=e=>e.buckets.length>50?(0,s.jsx)(q,{...e,"data-sentry-element":"BucketsTableVirtualized","data-sentry-component":"BucketsTable","data-sentry-source-file":"BucketsTable.tsx"}):(0,s.jsx)(K,{...e,"data-sentry-element":"BucketsTableUnvirtualized","data-sentry-component":"BucketsTable","data-sentry-source-file":"BucketsTable.tsx"}),K=e=>{let{buckets:t,projectRef:a,filterString:l,formattedGlobalUploadLimit:r,getPolicyCount:n}=e,i=0===t.length&&l.length>0;return(0,s.jsxs)(_.XI,{containerProps:{containerClassName:"h-full overflow-auto",className:"overflow-visible"},"data-sentry-element":"Table","data-sentry-component":"BucketsTableUnvirtualized","data-sentry-source-file":"BucketsTable.tsx",children:[(0,s.jsx)(L,{mode:"standard",hasBuckets:t.length>0,"data-sentry-element":"BucketTableHeader","data-sentry-source-file":"BucketsTable.tsx"}),(0,s.jsx)(_.BF,{"data-sentry-element":"TableBody","data-sentry-source-file":"BucketsTable.tsx",children:i?(0,s.jsx)(F,{mode:"standard",filterString:l}):t.map(e=>(0,s.jsx)(M,{mode:"standard",bucket:e,projectRef:a,formattedGlobalUploadLimit:r,getPolicyCount:n},e.id))})]})},q=e=>{let{buckets:t,projectRef:a,filterString:l,formattedGlobalUploadLimit:r,getPolicyCount:n}=e,i=0===t.length&&l.length>0;return(0,s.jsxs)(C,{data:t,estimateSize:()=>59,getItemKey:e=>e.id,"data-sentry-element":"VirtualizedTable","data-sentry-component":"BucketsTableVirtualized","data-sentry-source-file":"BucketsTable.tsx",children:[(0,s.jsx)(L,{mode:"virtualized",hasBuckets:t.length>0,"data-sentry-element":"BucketTableHeader","data-sentry-source-file":"BucketsTable.tsx"}),(0,s.jsx)(S,{paddingColSpan:5,emptyContent:i?(0,s.jsx)(F,{mode:"virtualized",filterString:l}):void 0,"data-sentry-element":"VirtualizedTableBody","data-sentry-source-file":"BucketsTable.tsx",children:e=>(0,s.jsx)(M,{mode:"virtualized",bucket:e,projectRef:a,formattedGlobalUploadLimit:r,getPolicyCount:n},e.id)})]})},G=()=>{var e;let{ref:t}=(0,i.g)(),a=(0,f.$)(),[v,N]=(0,n.useState)(""),{data:_}=(0,m.Ij)({projectRef:t},{enabled:h.pe}),{data:z=[],error:C,isError:S,isLoading:A,isSuccess:I}=(0,x.p)({projectRef:t}),{getPolicyCount:H,isLoading:P}=(0,y.L)(z),V=(0,b.z3)(null!=(e=null==_?void 0:_.fileSizeLimit)?e:0),E=z.filter(e=>!("type"in e)||"STANDARD"===e.type).filter(e=>0===v.length||e.id.toLowerCase().includes(v.toLowerCase())),R=0===z.filter(e=>!("type"in e)||"STANDARD"===e.type).length,D=S&&C.message.includes("Project has no active API keys"),L=(0,n.useMemo)(()=>"alphabetical"===a.sortBucket?E.sort((e,t)=>e.id.toLowerCase().trim().localeCompare(t.id.toLowerCase().trim())):E.sort((e,t)=>new Date(t.created_at)>new Date(e.created_at)?1:-1),[E,a.sortBucket]);return(0,s.jsxs)(d.gu,{isFullWidth:!0,className:"h-full gap-y-4","data-sentry-element":"ScaffoldSection","data-sentry-component":"FilesBuckets","data-sentry-source-file":"index.tsx",children:[(A||P)&&(0,s.jsx)(u.yV,{}),S&&(0,s.jsx)(s.Fragment,{children:D?(0,s.jsx)(g.Z,{type:"warning",title:"Project has no active API keys enabled",children:(0,s.jsxs)("p",{className:"!leading-normal text-sm",children:["The Dashboard relies on having active API keys on the project to function. If you'd like to use Storage through the Dashboard, create a set of API keys"," ",(0,s.jsx)(o.g,{href:"/project/".concat(t,"/settings/api-keys/new"),children:"here"}),"."]})}):(0,s.jsx)(c.A,{error:C,subject:"Failed to retrieve buckets"})}),I&&(0,s.jsx)(s.Fragment,{children:R?(0,s.jsx)(w.Z,{bucketType:"files"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-grow justify-between gap-x-2 items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(T.p,{size:"tiny",className:"flex-grow lg:flex-grow-0 w-52",placeholder:"Search for a bucket",value:v,onChange:e=>N(e.target.value),icon:(0,s.jsx)(l.A,{size:12})}),(0,s.jsxs)(p.rI,{children:[(0,s.jsx)(p.ty,{asChild:!0,children:(0,s.jsxs)(j.$,{tabIndex:0,type:"default",icon:(0,s.jsx)(r.A,{}),children:["Sorted by ","alphabetical"===a.sortBucket?"name":"created at"]})}),(0,s.jsx)(p.SQ,{align:"start",className:"w-40",children:(0,s.jsxs)(p.Hr,{value:a.sortBucket,onValueChange:e=>a.setSortBucket(e),children:[(0,s.jsx)(p.Ht,{value:"alphabetical",children:"Sort by name"}),(0,s.jsx)(p.Ht,{value:"created_at",children:"Sort by created at"})]})})]})]}),(0,s.jsx)(B.c,{buttonType:"primary",buttonClassName:"w-fit"})]}),(0,s.jsx)(k.Zp,{children:(0,s.jsx)(U,{buckets:L,projectRef:null!=t?t:"_",filterString:v,formattedGlobalUploadLimit:V,getPolicyCount:H})})]})})]})};var X=a(10508),Y=a(87829),W=a(27843);let Z=()=>(0,s.jsx)(G,{"data-sentry-element":"FilesBuckets","data-sentry-component":"StorageFilesPage","data-sentry-source-file":"index.tsx"});Z.getLayout=e=>(0,s.jsx)(X.A,{children:(0,s.jsx)(W.A,{title:"Storage",children:(0,s.jsx)(Y.D,{children:e})})});let O=Z},62550:(e,t,a)=>{"use strict";a.d(t,{j:()=>o});var s=a(67850),l=a(78510),r=a(24523),n=a(9620),i=a(85039),d=a(30399);async function c(e,t,a){let{projectRef:s,connectionString:n,schema:i}=e;if(!s)throw Error("projectRef is required");let d=new Headers(a);n&&d.set("x-connection-encrypted",n);let{data:c,error:o}=await (0,r.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":n,"x-pg-application-name":l.r},path:{ref:s},query:{included_schemas:i||"",excluded_schemas:""}},headers:d,signal:t});return o&&(0,r.H4)(o),c}let o=function(e){let{projectRef:t,connectionString:a,schema:l}=e,{enabled:r=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:u}=(0,n.YA)(),m=(null==u?void 0:u.status)===i.BU.ACTIVE_HEALTHY;return(0,s.I)({queryKey:d.S.list(t,l),queryFn:e=>{let{signal:s}=e;return c({projectRef:t,connectionString:a,schema:l},s)},enabled:r&&void 0!==t&&m,...o})}},65802:(e,t,a)=>{"use strict";a.d(t,{L:()=>i});var s=a(53239),l=a(39691),r=a(62550),n=a(9620);let i=e=>{let{data:t}=(0,n.YA)(),{data:a=[],isLoading:i}=(0,r.j)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,schema:"storage"}),d=(0,s.useMemo)(()=>{let t=a.filter(e=>"objects"===e.table);return(0,l._S)(e,t).reduce((e,t)=>(e[t.name]=t.policies.length,e),{})},[e,a]);return{getPolicyCount:e=>d[e]||0,isLoading:i,policyCountMap:d}}},96040:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(86848).A)("ArrowDownNarrowWide",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h4",key:"6d7r33"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h10",key:"1438ji"}]])}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,62941,33736,76984,72391,35035,40545,596,10508,48340,75187,29471,8750,27843,27924,17150,90636,46593,38792],()=>e(e.s=57320)),_N_E=e.O()}]);