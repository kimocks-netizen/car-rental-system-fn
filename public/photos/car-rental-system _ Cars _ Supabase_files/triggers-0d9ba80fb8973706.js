try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6e2ee295-ac1b-45cf-8f2a-d3e22feaa8fb",e._sentryDebugIdIdentifier="sentry-dbid-6e2ee295-ac1b-45cf-8f2a-d3e22feaa8fb")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94253],{14354:(e,t,a)=>{"use strict";a.d(t,{KP:()=>d,Nu:()=>c,d8:()=>i,l3:()=>o});var s=a(80263),r=a(79279);a(53239);var n=a(80100);let l=(0,r.F)(["pt-12 last:pb-12 gap-6"],{variants:{orientation:{horizontal:"grid @3xl:grid-cols-[1fr_2fr] @3xl:gap-12",vertical:"flex flex-col"}},defaultVariants:{orientation:"vertical"}}),i=e=>{let{className:t,orientation:a="vertical",children:r,...i}=e;return(0,s.jsx)("div",{"data-slot":"page-section","data-orientation":a,className:(0,n.cn)(l({orientation:a}),t),...i,"data-sentry-component":"PageSectionRoot","data-sentry-source-file":"index.tsx",children:r})};i.displayName="PageSectionRoot";let o=e=>{let{className:t,children:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"page-section-summary",className:(0,n.cn)("flex flex-col gap-1",t),...r,"data-sentry-component":"PageSectionSummary","data-sentry-source-file":"index.tsx",children:a})};o.displayName="PageSectionSummary";let c=e=>{let{className:t,children:a,...r}=e;return(0,s.jsx)("h2",{"data-slot":"page-section-title",className:(0,n.cn)("heading-section",t),...r,"data-sentry-component":"PageSectionTitle","data-sentry-source-file":"index.tsx",children:a})};c.displayName="PageSectionTitle";let d=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"page-section-content",className:(0,n.cn)(t),...a,"data-sentry-component":"PageSectionContent","data-sentry-source-file":"index.tsx"})};d.displayName="PageSectionContent"},15359:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var s=a(80263),r=a(86510),n=a(23729),l=a(52555),i=a.n(l),o=a(99779);let c=e=>{let{title:t="",size:a="medium",children:l,ctaButtonLabel:c="",infoButtonLabel:d="",infoButtonUrl:u="",onClickCta:h=()=>{},loading:m=!1,disabled:x=!1,disabledMessage:g="",ctaUrl:f}=e,p=c&&h||u&&d;return(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center","data-sentry-component":"ProductEmptyState","data-sentry-source-file":"ProductEmptyState.tsx",children:(0,s.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,s.jsx)("div",{className:"flex flex-col",children:(0,s.jsxs)("div",{className:"".concat("medium"===a?"w-80":"w-[400px]"," space-y-4"),children:[(0,s.jsx)("h5",{className:"text-foreground",children:t}),(0,s.jsx)("div",{className:"flex flex-col space-y-2 text-foreground-light",children:l}),p&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[c&&f?(0,s.jsx)(o.$,{asChild:!0,type:"primary",children:(0,s.jsx)(i(),{href:f,children:c})}):c&&h?(0,s.jsx)(n.G,{type:"primary",onClick:h,loading:m,disabled:m||x,tooltip:{content:{side:"bottom",text:x&&g.length>0?g:void 0}},children:c}):null,u&&d?(0,s.jsx)(o.$,{type:"default",icon:(0,s.jsx)(r.A,{strokeWidth:1.5}),children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",href:u,children:d})}):null]})]})})})})}},16716:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>e9});var s=a(80263),r=a(72112),n=a(31092),l=a(90376),i=a(66959);let o=(0,a(86848).A)("SquareFunction",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]]);var c=a(34873),d=a(23850),u=a(53239),h=a(73969),m=a(41200),x=a(35693),g=a(9620),f=a(94335);let p=e=>{let{trigger:t,visible:a,setVisible:r,onDelete:n,isLoading:l}=e,{data:i}=(0,g.YA)(),{name:o,schema:c}=null!=t?t:{};async function d(){return i?t?void n({projectRef:i.ref,connectionString:i.connectionString,trigger:t}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,s.jsx)(f.A,{variant:"warning",visible:a,onCancel:()=>r(""),onConfirm:d,title:"Delete this trigger",loading:l,confirmLabel:"Delete trigger ".concat(o),confirmPlaceholder:"Type in name of trigger",confirmString:null!=o?o:"",text:(0,s.jsxs)(s.Fragment,{children:["This will delete your trigger called"," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:o})," of schema"," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:c})]}),alert:{title:"You cannot recover this trigger once deleted."},"data-sentry-element":"TextConfirmModal","data-sentry-component":"DeleteTrigger","data-sentry-source-file":"DeleteTrigger.tsx"})};var j=a(32981),y=a(69988),v=a(87494),b=a(10663);let N=e=>{let{icon:t,text:a}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2","data-sentry-component":"FormBoxEmpty","data-sentry-source-file":"FormBoxEmpty.tsx",children:[(0,s.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,s.jsx)("p",{className:"text-foreground-light",children:a})]})};var S=a(87167),w=a(72391),A=a(51355),C=a(80210),T=a(59356),E=a(87518);async function _(e){let{originalTrigger:t,projectRef:a,connectionString:s,payload:r}=e,{sql:n}=w.A.triggers.update(t,r),{result:l}=await (0,T.E)({projectRef:a,connectionString:s,sql:n,queryKey:["trigger","update",t.id]});return l}let k=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,A.jE)();return(0,C.n)({mutationFn:e=>_(e),async onSuccess(t,a,r){let{projectRef:n}=a;await s.invalidateQueries({queryKey:E.U.list(n)}),await (null==e?void 0:e(t,a,r))},async onError(e,a,s){void 0===t?h.oR.error("Failed to update database trigger: ".concat(e.message)):t(e,a,s)},...a})};var F=a(49810),R=a(73036),D=a(63335),I=a(65346),P=a(65887),L=a(27371),z=a(66329),M=a(75878),W=a(48156),O=a(80100),q=a(99779),V=a(68421),Y=a(44053),B=a(76888),H=a(22891),$=a(76803),G=a.n($),U=a(86727),K=a.n(U),Q=a(52555),Z=a.n(Q),J=a(80814),X=a(79861),ee=a(15359),et=a(57125),ea=a(97167),es=a(21874),er=a(62284),en=a(76174);let el=e=>{let{visible:t,onChange:a,setVisible:r}=e,{data:n}=(0,g.YA)(),{data:l=[]}=(0,es.e)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),i=l.filter(e=>"trigger"===e.return_type),o=i.length>=1,c=G()(K()(i,"schema"),"schema"),d=e=>{let s=i.find(t=>t.id===e);s&&a(s),r(!t)};return(0,s.jsx)(X.Ay,{size:"large",header:"Pick a function",visible:t,onCancel:()=>r(!t),className:"hooks-sidepanel","data-sentry-element":"SidePanel","data-sentry-component":"ChooseFunctionForm","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)("div",{className:"py-6",children:o?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(ei,{}),c.map(e=>(0,s.jsx)(ec,{schema:e,functions:i.filter(t=>t.schema==e),selectFunction:d},e))]}):(0,s.jsx)(eo,{})})})},ei=()=>{let{ref:e}=(0,H.g)();return(0,s.jsx)("div",{className:"px-6","data-sentry-component":"NoticeBox","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)(et.A,{icon:(0,s.jsx)(er.A,{size:"20",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,s.jsx)(q.$,{asChild:!0,type:"default",children:(0,s.jsx)(Z(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})}),"data-sentry-element":"InformationBox","data-sentry-source-file":"ChooseFunctionForm.tsx"})})},eo=()=>{let e=(0,J.useRouter)(),{ref:t}=e.query;return(0,s.jsx)(ee.A,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},"data-sentry-element":"ProductEmptyState","data-sentry-component":"NoFunctionsState","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},ec=e=>{let{schema:t,functions:a,selectFunction:r}=e;return(0,s.jsxs)("div",{className:"space-y-4","data-sentry-component":"SchemaFunctionGroup","data-sentry-source-file":"ChooseFunctionForm.tsx",children:[(0,s.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,s.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,s.jsx)("h5",{children:t})]}),(0,s.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:a.map(e=>(0,s.jsx)(ed,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:r},e.id))})]})},ed=e=>{let{id:t,completeStatement:a,name:r,onClick:n}=e,[l,i]=(0,u.useState)(!1);return(0,s.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>n(t),"data-sentry-component":"Function","data-sentry-source-file":"ChooseFunctionForm.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(y.A,{strokeWidth:2,size:14,"data-sentry-element":"Terminal","data-sentry-source-file":"ChooseFunctionForm.tsx"})}),(0,s.jsx)("p",{className:"mb-0 text-sm",children:r})]}),(0,s.jsx)(q.$,{type:"text",onClick:e=>{e.stopPropagation(),i(!l)},icon:(0,s.jsx)(en.A,{className:l?"rotate-180 transform":"rotate-0 transform"}),"data-sentry-element":"Button","data-sentry-source-file":"ChooseFunctionForm.tsx",children:l?"Hide definition":"View definition"})]}),(0,s.jsx)(B.e,{show:l,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0","data-sentry-element":"Transition","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,s.jsx)(ea.A,{defaultValue:a,readOnly:!0,contextmenu:!1,"data-sentry-element":"SqlEditor","data-sentry-source-file":"ChooseFunctionForm.tsx"})})})]})},eu=[{value:"INSERT",label:"Insert",description:"Any insert operation on the table"},{value:"UPDATE",label:"Update",description:"Any update operation of any column on the table"},{value:"DELETE",label:"Delete",description:"Any delete operation of a record"}],eh=[{value:"BEFORE",label:"Before the event",description:"Trigger fires before the operation is attempted"},{value:"AFTER",label:"After the event",description:"Trigger fires before the operation has completed"}],em=[{value:"ROW",label:"Row",description:"Fires once for each processed row"},{value:"STATEMENT",label:"Statement",description:"Fires once for each statement"}],ex=[{value:"ORIGIN",label:"Origin",description:"This is the default behaviour"},{value:"REPLICA",label:"Replica",description:'Will only fire if the session is in "replica" mode'},{value:"ALWAYS",label:"Always",description:"Will fire regardless of the replication role"},{value:"DISABLED",label:"Disabled",description:"Will not fire"}],eg="create-trigger",ef=b.Ik({name:b.Yj().min(1,"Please provide a name for your trigger").regex(/^\S+$/,"Name should not contain spaces or whitespaces"),schema:b.Yj(),table:b.Yj(),activation:b.k5(["BEFORE","AFTER","INSTEAD OF"]),enabled_mode:b.k5(["ORIGIN","REPLICA","ALWAYS","DISABLED"]),orientation:b.k5(["ROW","STATEMENT"]),function_name:b.Yj().min(1,"Please select a database function for your trigger to call"),function_schema:b.Yj(),events:b.YO(b.Yj()).min(1,"Please select at least one event"),tableId:b.Yj().optional()}),ep={name:"",schema:"",table:"",activation:"AFTER",orientation:"ROW",function_name:"",function_schema:"",enabled_mode:"ORIGIN",events:[]},ej=e=>{let{selectedTrigger:t,isDuplicatingTrigger:a,open:r,onClose:n}=e,{data:l}=(0,g.YA)(),[i,o]=(0,u.useState)(!1),{mutate:c,isPending:d}=(0,S.Y)({onSuccess:()=>{h.oR.success("Successfully created trigger"),n()},onError:e=>{h.oR.error("Failed to create trigger: ".concat(e.message))}}),{mutate:m,isPending:x}=k({onSuccess:()=>{h.oR.success("Successfully updated trigger"),n()},onError:e=>{h.oR.error("Failed to update trigger: ".concat(e.message))}}),{data:f=[],isSuccess:p}=(0,F.LW)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),{data:b,isSuccess:w}=(0,D.Uu)(),A=p&&w,C=f.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!b.find(t=>t.name===e.schema)),T=!a&&!!t,E=(0,v.mN)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,j.u)(ef),defaultValues:ep}),{function_name:_,function_schema:V}=E.watch(),{confirmOnClose:B,modalProps:H}=(0,R.$)({checkIsDirty:()=>E.formState.isDirty,onClose:n}),$=async e=>{if(!l)return console.error("Project is required");let{tableId:a,...s}=e;T?m({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,originalTrigger:t,payload:{name:s.name,enabled_mode:s.enabled_mode}}):c({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,payload:s})};return(0,u.useEffect)(()=>{if(r&&A)if(E.clearErrors(),a&&t){let e=C.find(e=>e.name===t.table);E.reset({...t,tableId:null==e?void 0:e.id.toString(),table:null==e?void 0:e.name,schema:null==e?void 0:e.schema})}else T?E.reset(t):C.length>0&&E.reset({...ep,tableId:C[0].id.toString(),table:C[0].name,schema:C[0].schema})},[r,A]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.cj,{open:r,onOpenChange:B,"data-sentry-element":"Sheet","data-sentry-source-file":"TriggerSheet.tsx",children:(0,s.jsxs)(I.h,{size:"lg",className:"flex flex-col gap-0","data-sentry-element":"SheetContent","data-sentry-source-file":"TriggerSheet.tsx",children:[(0,s.jsx)(I.Fm,{"data-sentry-element":"SheetHeader","data-sentry-source-file":"TriggerSheet.tsx",children:(0,s.jsx)(I.qp,{"data-sentry-element":"SheetTitle","data-sentry-source-file":"TriggerSheet.tsx",children:a?"Duplicate trigger":T?"Edit database trigger: ".concat(t.name):"Create a new database trigger"})}),(0,s.jsx)(P.lV,{...E,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"TriggerSheet.tsx",children:(0,s.jsxs)("form",{id:eg,className:"flex-1 flex flex-col gap-y-6 overflow-auto py-6",onSubmit:E.handleSubmit($),children:[(0,s.jsx)(P.zB,{name:"name",control:E.control,render:e=>{let{field:t}=e;return(0,s.jsx)(Y.M,{className:"px-5",layout:"horizontal",label:"Name of trigger",description:"Do not use spaces/whitespace.",children:(0,s.jsx)(P.MJ,{children:(0,s.jsx)(L.p,{...t,placeholder:"Name of trigger"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"TriggerSheet.tsx"}),T?(0,s.jsx)(P.zB,{name:"enabled_mode",control:E.control,render:e=>{var t;let{field:a}=e;return(0,s.jsx)(Y.M,{className:"px-5",layout:"horizontal",label:"Enabled mode",description:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:(0,s.jsx)(P.MJ,{children:(0,s.jsxs)(z.l6,{defaultValue:a.value,onValueChange:a.onChange,children:[(0,s.jsx)(z.bq,{className:"col-span-8",children:null==(t=ex.find(e=>e.value===a.value))?void 0:t.label}),(0,s.jsx)(z.gC,{children:ex.map(e=>(0,s.jsxs)(z.eb,{value:e.value,children:[(0,s.jsx)("p",{className:"text-foreground",children:e.label}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.value))})]})})})}}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.w,{}),(0,s.jsx)(P.zB,{name:"tableId",control:E.control,render:e=>{let{field:t}=e;return(0,s.jsx)(Y.M,{className:"px-5",layout:"horizontal",label:"Table",description:"Trigger will watch for changes on this table",children:(0,s.jsx)(P.MJ,{children:(0,s.jsxs)(z.l6,{defaultValue:t.value,onValueChange:e=>{t.onChange(e);let a=C.find(t=>t.id.toString()===e);a&&(E.setValue("table",a.name,{shouldDirty:!0}),E.setValue("schema",a.schema,{shouldDirty:!0}))},children:[(0,s.jsx)(z.bq,{className:"col-span-8",children:(0,s.jsx)(z.yv,{})}),(0,s.jsx)(z.gC,{children:C.map(e=>(0,s.jsxs)(z.eb,{value:e.id.toString(),children:[(0,s.jsxs)("span",{className:"text-foreground-light",children:[e.schema,"."]}),(0,s.jsx)("span",{className:"text-foreground",children:e.name})]},e.id))})]})})})}}),(0,s.jsx)(P.zB,{name:"events",control:E.control,render:()=>(0,s.jsx)(Y.M,{className:"px-5",layout:"horizontal",label:"Events",description:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",children:eu.map(e=>(0,s.jsx)(P.zB,{control:E.control,name:"events",render:t=>{var a;let{field:r}=t;return(0,s.jsx)(Y.M,{hideMessage:!0,layout:"flex",label:e.label,description:e.description,children:(0,s.jsx)(P.MJ,{children:(0,s.jsx)(W.S,{className:"translate-y-[2px]",checked:null==(a=r.value)?void 0:a.includes(e.value),onCheckedChange:t=>{var a;return t?r.onChange([...r.value,e.value]):r.onChange(null==(a=r.value)?void 0:a.filter(t=>t!==e.value))}})})})}},e.value))})}),(0,s.jsx)(P.zB,{name:"activation",control:E.control,render:e=>{var t;let{field:a}=e;return(0,s.jsx)(Y.M,{className:"px-5",layout:"horizontal",label:"Trigger type",description:"Determines when your trigger fires",children:(0,s.jsx)(P.MJ,{children:(0,s.jsxs)(z.l6,{defaultValue:a.value,onValueChange:a.onChange,children:[(0,s.jsx)(z.bq,{className:"col-span-8",children:null==(t=eh.find(e=>e.value===a.value))?void 0:t.label}),(0,s.jsx)(z.gC,{children:eh.map(e=>(0,s.jsxs)(z.eb,{value:e.value,children:[(0,s.jsx)("p",{className:"text-foreground",children:e.label}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.value))})]})})})}}),(0,s.jsx)(P.zB,{name:"orientation",control:E.control,render:e=>{var t;let{field:a}=e;return(0,s.jsx)(Y.M,{className:"px-5",layout:"horizontal",label:"Orientation",description:"Identifies whether the trigger fires once for each processed row or once for each statement",children:(0,s.jsx)(P.MJ,{children:(0,s.jsxs)(z.l6,{defaultValue:a.value,onValueChange:a.onChange,children:[(0,s.jsx)(z.bq,{className:"col-span-8",children:null==(t=em.find(e=>e.value===a.value))?void 0:t.label}),(0,s.jsx)(z.gC,{children:em.map(e=>(0,s.jsxs)(z.eb,{value:e.value,children:[(0,s.jsx)("p",{className:"text-foreground",children:e.label}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.value))})]})})})}}),(0,s.jsx)(M.w,{}),(0,s.jsx)(P.zB,{name:"function_name",control:E.control,render:()=>(0,s.jsx)(Y.M,{layout:"vertical",className:"px-5",children:(0,s.jsx)(P.MJ,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-sm",children:"Function to trigger"}),0===_.length?(0,s.jsx)("button",{type:"button",className:(0,O.cn)("relative w-full rounded border border-default","bg-surface-200 px-5 py-1 shadow-sm transition-all","hover:border-strong hover:bg-overlay-hover"),onClick:()=>o(!0),children:(0,s.jsx)(N,{icon:(0,s.jsx)(y.A,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})}):(0,s.jsxs)("div",{className:(0,O.cn)("relative w-full flex items-center justify-between","space-x-3 px-5 py-4 border border-default","rounded shadow-sm transition-shadow"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,s.jsx)(y.A,{size:"18",strokeWidth:2,width:14})}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-sm text-foreground-light",children:V}),".",(0,s.jsx)("span",{className:"text-sm text-foreground",children:_})]})]}),(0,s.jsx)(q.$,{type:"default",onClick:()=>o(!0),children:"Change function"})]})]})})})})]})]})}),(0,s.jsxs)(I.XW,{className:"shrink-0","data-sentry-element":"SheetFooter","data-sentry-source-file":"TriggerSheet.tsx",children:[(0,s.jsx)(q.$,{type:"default",htmlType:"reset",disabled:d||x,onClick:B,"data-sentry-element":"Button","data-sentry-source-file":"TriggerSheet.tsx",children:"Cancel"}),(0,s.jsxs)(q.$,{form:eg,htmlType:"submit",loading:d||x,"data-sentry-element":"Button","data-sentry-source-file":"TriggerSheet.tsx",children:[T?"Save":"Create"," trigger"]})]}),(0,s.jsx)(ey,{...H,"data-sentry-element":"CloseConfirmationModal","data-sentry-source-file":"TriggerSheet.tsx"})]})}),(0,s.jsx)(el,{visible:i,setVisible:o,onChange:e=>{E.setValue("function_name",e.name),E.setValue("function_schema",e.schema)},"data-sentry-element":"ChooseFunctionForm","data-sentry-source-file":"TriggerSheet.tsx"})]})},ey=e=>{let{visible:t,onClose:a,onCancel:r}=e;return(0,s.jsx)(V.A,{visible:t,title:"Discard changes",confirmLabel:"Discard",onCancel:r,onConfirm:a,"data-sentry-element":"ConfirmationModal","data-sentry-component":"CloseConfirmationModal","data-sentry-source-file":"TriggerSheet.tsx",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})};var ev=a(69498),eb=a(44168),eN=a(23729),eS=a(84438),ew=a(53931),eA=a(78993),eC=a(42130),eT=a(80090),eE=a(46087),e_=a(57384),ek=a(95448),eF=a(89144),eR=a(18664),eD=a(80421),eI=a(72432),eP=a(78039),eL=a(78511),ez=a(86926),eM=a.n(ez),eW=a(14506),eO=a.n(eW),eq=a(23892),eV=a(68152),eY=a(77444),eB=a(74415),eH=a(3225),e$=a(9753),eG=a(33922),eU=a(21650),eK=a(21162);let eQ=e=>{let t=e.events.join(" OR "),a=e.function_args.length>0?"(".concat(e.function_args.join(", "),")"):"()",s='\nDROP TRIGGER IF EXISTS "'.concat(e.name,'" ON "').concat(e.schema,'"."').concat(e.table,'";\n\nCREATE TRIGGER "').concat(e.name,'"\n').concat(e.activation," ").concat(t,'\nON "').concat(e.schema,'"."').concat(e.table,'"\nFOR EACH ').concat(e.orientation,"\n");return e.condition&&(s+="WHEN (".concat(e.condition,")\n")),(s+='EXECUTE FUNCTION "'.concat(e.function_schema,'"."').concat(e.function_name,'"').concat(a,";")).trim()},eZ=e=>{let{schema:t,filterString:a,isLocked:n,editTrigger:l,duplicateTrigger:i,deleteTrigger:o}=e,{ref:c}=(0,H.g)(),{data:d}=(0,g.YA)(),u=(0,ek.xd)(),{openSidebar:h}=(0,eR.rM)(),{can:m}=(0,eT.Qp)(r.aG.TENANT_SQL_ADMIN_WRITE,"triggers"),{data:x}=(0,eC.oR)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),f=(null!=x?x:[]).filter(e=>eM()(e.name.toLowerCase(),a.toLowerCase())||e.function_name&&eM()(e.function_name.toLowerCase(),a.toLowerCase())),p=eO()(f.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase());return 0===p.length&&0===a.length?(0,s.jsx)(eL.Hj,{children:(0,s.jsxs)(eL.nA,{colSpan:7,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No triggers created yet"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no triggers found in the schema "',t,'"']})]})},t):0===p.length&&a.length>0?(0,s.jsx)(eL.Hj,{children:(0,s.jsxs)(eL.nA,{colSpan:7,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',a,'" did not return any results']})]})},t):(0,s.jsx)(s.Fragment,{children:p.map(e=>(0,s.jsxs)(eL.Hj,{children:[(0,s.jsx)(eL.nA,{className:"space-x-2",children:(0,s.jsx)(q.$,{type:"text",onClick:()=>l(e),title:e.name,className:"text-link-table-cell text-left text-sm min-w-0 p-0 hover:bg-transparent font-medium max-w-48 title",children:e.name})}),(0,s.jsx)(eL.nA,{className:"break-all",children:e.table_id?(0,s.jsx)(Z(),{href:"/project/".concat(c,"/editor/").concat(e.table_id),className:"text-link-table-cell block max-w-40 text-foreground-light",children:e.table}):(0,s.jsx)("p",{title:e.table,className:"truncate",children:e.table})}),(0,s.jsx)(eL.nA,{className:"space-x-2",children:e.function_name?(0,s.jsx)(Z(),{href:"/project/".concat(c,"/database/functions?search=").concat(e.function_name,"&schema=").concat(e.function_schema),className:"text-link-table-cell block max-w-40 text-foreground-light",children:e.function_name}):(0,s.jsx)("p",{className:"truncate text-foreground-light",children:"-"})}),(0,s.jsx)(eL.nA,{children:(0,s.jsx)("div",{className:"flex gap-2 flex-wrap",children:e.events.map(t=>(0,s.jsx)(eU.E,{children:"".concat(e.activation," ").concat(t)},t))})}),(0,s.jsx)(eL.nA,{className:"space-x-2",children:(0,s.jsx)("p",{title:e.orientation,className:"truncate",children:e.orientation})}),(0,s.jsx)(eL.nA,{children:(0,s.jsx)("div",{className:"flex items-center justify-center",children:"DISABLED"!==e.enabled_mode?(0,s.jsx)(eq.A,{strokeWidth:2,className:"text-brand"}):(0,s.jsx)(eV.A,{strokeWidth:2})})}),(0,s.jsx)(eL.nA,{className:"text-right",children:!n&&(0,s.jsx)("div",{className:"flex items-center justify-end",children:m?(0,s.jsxs)(eK.rI,{children:[(0,s.jsx)(eK.ty,{asChild:!0,children:(0,s.jsx)(q.$,{"aria-label":"More options",type:"default",className:"px-1",icon:(0,s.jsx)(eY.A,{})})}),(0,s.jsxs)(eK.SQ,{side:"bottom",align:"end",className:"w-52",children:[(0,s.jsxs)(eK._2,{className:"space-x-2",onClick:()=>{eQ(e),l(e)},children:[(0,s.jsx)(eB.A,{size:14}),(0,s.jsx)("p",{children:"Edit trigger"})]}),(0,s.jsxs)(eK._2,{className:"space-x-2",onClick:()=>{let t=eQ(e);h(ev.c.AI_ASSISTANT),u.newChat({name:"Update trigger ".concat(e.name),initialInput:"Update this trigger which exists on the ".concat(e.schema,".").concat(e.table," table to..."),suggestions:{title:"I can help you make a change to this trigger, here are a few example prompts to get you started:",prompts:[{label:"Rename Trigger",description:"Rename this trigger to ..."},{label:"Change Events",description:"Change the events this trigger responds to ..."},{label:"Modify Timing",description:"Modify this trigger to run after instead of before ..."}]},sqlSnippets:[t]})},children:[(0,s.jsx)(eH.A,{size:14}),(0,s.jsx)("p",{children:"Edit with Assistant"})]}),(0,s.jsxs)(eK._2,{className:"space-x-2",onClick:()=>i(e),children:[(0,s.jsx)(e$.A,{size:14}),(0,s.jsx)("p",{children:"Duplicate trigger"})]}),(0,s.jsx)(eK.mB,{}),(0,s.jsxs)(eK._2,{className:"space-x-2",onClick:()=>o(e),children:[(0,s.jsx)(eG.A,{stroke:"red",size:14}),(0,s.jsx)("p",{children:"Delete trigger"})]})]})]}):(0,s.jsx)(eN.G,{disabled:!0,type:"default",className:"px-1",icon:(0,s.jsx)(eY.A,{}),tooltip:{content:{side:"bottom",text:"You need additional permissions to update triggers"}}})})})]},e.id))})},eJ=()=>{let[e,t]=(0,u.useState)(),a=(0,u.useRef)(null),{data:f}=(0,g.YA)(),j=(0,ek.xd)(),{openSidebar:y}=(0,eR.rM)(),{selectedSchema:v,setSelectedSchema:b}=(0,e_.k)(),[N,S]=(0,d.ZA)("search",d.tU.withDefault("").withOptions({history:"replace",clearOnDefault:!0})),w=(0,m.h)(),{templates:A,setValue:C,setTemplates:T,setInitialPrompt:E}=(0,eF.ab)(),{data:_}=(0,D.Uu)(),{isSchemaLocked:k}=(0,D.BQ)({schema:v}),{data:R=[]}=(0,F.LW)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString}),I=R.filter(e=>!_.find(t=>t.name===e.schema)).length>0,{data:P,error:L,isLoading:z,isError:M}=(0,eC.oR)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString}),{can:W}=(0,eT.Qp)(r.aG.TENANT_SQL_ADMIN_WRITE,"triggers"),[O,q]=(0,d.ZA)("new",d.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),{setValue:V,value:Y}=(0,eE.s)({urlKey:"edit",select:e=>e?null==P?void 0:P.find(t=>t.id.toString()===e):void 0,enabled:!!P,onError:()=>h.oR.error("Trigger not found")}),{setValue:B,value:H}=(0,eE.s)({urlKey:"duplicate",select:e=>{if(!e)return;let t=null==P?void 0:P.find(t=>t.id.toString()===e);return t?{...t,name:"".concat(t.name,"_duplicate")}:void 0},enabled:!!P,onError:()=>h.oR.error("Trigger not found")}),{setValue:$,value:G}=(0,eE.s)({urlKey:"delete",select:e=>e?null==P?void 0:P.find(t=>t.id.toString()===e):void 0,enabled:!!P,onError:(e,t)=>(0,eE.$)(a,t,"Database Trigger not found")}),{mutate:U,isPending:K}=(0,eA.R)({onSuccess:(e,t)=>{h.oR.success("Successfully removed ".concat(t.trigger.name)),$(null)},onError:()=>{a.current=null}});if(z)return(0,s.jsx)(ew.yV,{});if(M)return(0,s.jsx)(eb.A,{error:L,subject:"Failed to retrieve database triggers"});let Q=P.filter(e=>e.schema===v);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2 flex-wrap",children:[(0,s.jsx)(eS.A,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:v,onSelectSchema:b,"data-sentry-element":"SchemaSelector","data-sentry-source-file":"TriggersList.tsx"}),(0,s.jsx)(eD.A,{placeholder:"Search for a trigger",size:"tiny",icon:(0,s.jsx)(n.A,{size:"14"}),value:N,className:"w-full lg:w-52",onChange:e=>S(e.target.value),"data-sentry-element":"Input","data-sentry-source-file":"TriggersList.tsx"})]}),!k&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eN.G,{disabled:!I||!W,icon:(0,s.jsx)(l.A,{}),onClick:()=>void(B(null),w?(E("Create a new database trigger that..."),C("create trigger trigger_name\nafter insert or update or delete on table_name\nfor each row\nexecute function function_name();"),A.length>0&&T([]),y(ev.c.EDITOR_PANEL)):(t(void 0),q(!0))),className:"flex-grow",tooltip:{content:{side:"bottom",text:I?W?void 0:"You need additional permissions to create triggers":"Create a table first before creating triggers"}},children:"New trigger"}),I&&(0,s.jsx)(eN.G,{type:"default",disabled:!I||!W,className:"px-1 pointer-events-auto",icon:(0,s.jsx)(eI.M,{size:16}),onClick:()=>{y(ev.c.AI_ASSISTANT),j.newChat({name:"Create new trigger",initialInput:"Create a new trigger for the schema ".concat(v," that does ..."),suggestions:{title:"I can help you create a new trigger, here are a few example prompts to get you started:",prompts:[{label:"Log Changes",description:"Create a trigger that logs changes to the users table"},{label:"Update Timestamp",description:"Create a trigger that updates updated_at timestamp"},{label:"Validate Email",description:"Create a trigger that validates email format before insert"}]}})},tooltip:{content:{side:"bottom",text:W?"Create with Supabase Assistant":"You need additional permissions to create triggers"}}})]})]}),k&&(0,s.jsx)(x.i,{schema:v,entity:"triggers"}),k||0!==(null!=Q?Q:[]).length?(0,s.jsx)("div",{className:"w-full overflow-hidden overflow-x-auto",children:(0,s.jsx)(eP.Zp,{children:(0,s.jsxs)(eL.XI,{children:[(0,s.jsx)(eL.A0,{children:(0,s.jsxs)(eL.Hj,{children:[(0,s.jsx)(eL.nd,{children:"Name"},"name"),(0,s.jsx)(eL.nd,{children:"Table"},"table"),(0,s.jsx)(eL.nd,{children:"Function"},"function"),(0,s.jsx)(eL.nd,{children:"Events"},"events"),(0,s.jsx)(eL.nd,{children:"Orientation"},"orientation"),(0,s.jsx)(eL.nd,{className:"w-20",children:"Enabled"},"enabled"),(0,s.jsx)(eL.nd,{className:"w-1/12"},"buttons")]})}),(0,s.jsx)(eL.BF,{children:(0,s.jsx)(eZ,{schema:v,filterString:N,isLocked:k,editTrigger:e=>{B(null),w?(C(eQ(e)),T([]),y(ev.c.EDITOR_PANEL)):V(e.id.toString())},duplicateTrigger:e=>{w?(C(eQ({...e,name:"".concat(e.name,"_duplicate")})),T([]),y(ev.c.EDITOR_PANEL)):B(e.id.toString())},deleteTrigger:e=>{$(e.id.toString())}})})]})})}):(0,s.jsxs)(eP.Zp,{className:"grid grid-cols-1 @xl:grid-cols-3 bg divide-x @container",children:[(0,s.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(i.A,{strokeWidth:1.5,size:16,className:"text-foreground-light"}),(0,s.jsx)("h3",{className:"heading-default",children:"Create realtime experiences"})]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm flex-1",children:"Keep your application in sync by automatically updating when data changes"})]}),(0,s.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(o,{strokeWidth:1.5,size:16,className:"text-foreground-light"}),(0,s.jsx)("h3",{className:"heading-default",children:"Trigger an edge function"})]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm flex-1",children:"Automatically invoke edge functions when database events occur"})]}),(0,s.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(c.A,{strokeWidth:1.5,size:16,className:"text-foreground-light"}),(0,s.jsx)("h3",{className:"heading-default",children:"Validate data"})]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm flex-1",children:"Ensure data meets your requirements before it is inserted into the database"})]})]})]}),(0,s.jsx)(ej,{selectedTrigger:e,open:O,onClose:()=>{q(!1)},isDuplicatingTrigger:!1,"data-sentry-element":"TriggerSheet","data-sentry-source-file":"TriggersList.tsx"}),(0,s.jsx)(ej,{selectedTrigger:Y||H,open:!!Y||!!H,onClose:()=>{V(null),B(null)},isDuplicatingTrigger:!!H,"data-sentry-element":"TriggerSheet","data-sentry-source-file":"TriggersList.tsx"}),(0,s.jsx)(p,{trigger:G,visible:!!G,setVisible:$,onDelete:e=>{a.current=e.trigger.id.toString(),U(e)},isLoading:K,"data-sentry-element":"DeleteTrigger","data-sentry-source-file":"TriggersList.tsx"})]})};var eX=a(68296),e0=a(10508),e1=a(41273),e2=a(39624),e3=a(85039),e5=a(45218),e8=a(30688),e6=a(14354);let e7=()=>{let{can:e,isSuccess:t}=(0,eT.Qp)(r.aG.TENANT_SQL_ADMIN_READ,"triggers");return t&&!e?(0,s.jsx)(e2.A,{isFullPage:!0,resourceText:"view database triggers"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e8.zY,{size:"large","data-sentry-element":"PageHeader","data-sentry-source-file":"triggers.tsx",children:(0,s.jsxs)(e8.Ys,{"data-sentry-element":"PageHeaderMeta","data-sentry-source-file":"triggers.tsx",children:[(0,s.jsxs)(e8.tq,{"data-sentry-element":"PageHeaderSummary","data-sentry-source-file":"triggers.tsx",children:[(0,s.jsx)(e8.RR,{"data-sentry-element":"PageHeaderTitle","data-sentry-source-file":"triggers.tsx",children:"Database Triggers"}),(0,s.jsx)(e8.NV,{"data-sentry-element":"PageHeaderDescription","data-sentry-source-file":"triggers.tsx",children:"Execute a set of actions automatically on specified table events"})]}),(0,s.jsx)(e8.vT,{"data-sentry-element":"PageHeaderAside","data-sentry-source-file":"triggers.tsx",children:(0,s.jsx)(e1.A,{href:"".concat(e3.aq,"/guides/database/postgres/triggers"),"data-sentry-element":"DocsButton","data-sentry-source-file":"triggers.tsx"})})]})}),(0,s.jsx)(e5.L,{size:"large","data-sentry-element":"PageContainer","data-sentry-source-file":"triggers.tsx",children:(0,s.jsx)(e6.d8,{"data-sentry-element":"PageSection","data-sentry-source-file":"triggers.tsx",children:(0,s.jsx)(e6.KP,{"data-sentry-element":"PageSectionContent","data-sentry-source-file":"triggers.tsx",children:(0,s.jsx)(eJ,{"data-sentry-element":"TriggersList","data-sentry-source-file":"triggers.tsx"})})})})]})};e7.getLayout=e=>(0,s.jsx)(e0.A,{children:(0,s.jsx)(eX.A,{title:"Database",children:e})});let e9=e7},21874:(e,t,a)=>{"use strict";a.d(t,{e:()=>c});var s=a(72391),r=a(67850),n=a(32510),l=a(59356);let i=s.A.functions.list();async function o(e,t,a){let{projectRef:s,connectionString:r}=e,n=new Headers(a),{result:o}=await (0,l.E)({projectRef:s,connectionString:r,sql:i.sql,queryKey:["database-functions"]},t,n);return o}let c=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.I)({queryKey:n.c.databaseFunctions(t),queryFn:e=>{let{signal:s}=e;return o({projectRef:t,connectionString:a},s)},enabled:s&&void 0!==t,...l})}},22730:(e,t,a)=>{"use strict";a.d(t,{z:()=>d});var s=a(78510),r=a(67850),n=a(24523),l=a(9620),i=a(85039),o=a(87727);async function c(e,t,a){let{projectRef:r,connectionString:l}=e;if(!r)throw Error("projectRef is required");let i=new Headers(a);l&&i.set("x-connection-encrypted",l);let{data:o,error:c}=await (0,n.Jt)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":l,"x-pg-application-name":s.r},path:{ref:r}},headers:i,signal:t});return c&&(0,n.H4)(c),o}let d=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:d}=(0,l.YA)(),u=(null==d?void 0:d.status)===i.BU.ACTIVE_HEALTHY;return(0,r.I)({queryKey:o.I.list(t),queryFn:e=>{let{signal:s}=e;return c({projectRef:t,connectionString:a},s)},enabled:s&&void 0!==t&&u,...n})}},35693:(e,t,a)=>{"use strict";a.d(t,{i:()=>d});var s=a(80263),r=a(53239),n=a(95137),l=a(99779),i=a(63335),o=a(44725);let c=e=>{let{onClose:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"ProtectedSchemaWarning.tsx",children:(0,s.jsx)(n.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"ProtectedSchemaWarning.tsx",children:"Schemas managed by Supabase"})}),(0,s.jsx)(n.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"ProtectedSchemaWarning.tsx"}),(0,s.jsxs)(n.OO,{className:"space-y-2 prose","data-sentry-element":"DialogSection","data-sentry-source-file":"ProtectedSchemaWarning.tsx",children:[(0,s.jsx)("p",{className:"text-sm",children:"The following schemas are managed by Supabase and are currently protected from write access through the dashboard."}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:i.$O.map(e=>(0,s.jsx)("code",{className:"text-xs",children:e},e))}),(0,s.jsx)("p",{className:"text-sm !mt-4",children:"These schemas are critical to the functionality of your Supabase project and hence we highly recommend not altering them."}),(0,s.jsx)("p",{className:"text-sm",children:"You can, however, still interact with those schemas through the SQL Editor although we advise you only do so if you know what you are doing."})]}),(0,s.jsx)(n.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"ProtectedSchemaWarning.tsx",children:(0,s.jsx)("div",{className:"flex items-center justify-end space-x-2",children:(0,s.jsx)(l.$,{type:"default",onClick:t,"data-sentry-element":"Button","data-sentry-source-file":"ProtectedSchemaWarning.tsx",children:"Understood"})})})]})},d=e=>{let{size:t="md",schema:a,entity:d}=e,[u,h]=(0,r.useState)(!1),{isSchemaLocked:m,reason:x,fdwType:g}=(0,i.BQ)({schema:a});return m?(0,s.jsx)(o.Z,{showIcon:"sm"!==t,type:"note",title:"sm"===t?"Viewing protected schema":"Viewing ".concat(d," from a protected schema"),className:"[&_p]:!m-0","data-sentry-element":"Admonition","data-sentry-component":"ProtectedSchemaWarning","data-sentry-source-file":"ProtectedSchemaWarning.tsx",children:"fdw"===x&&"iceberg"===g?(0,s.jsxs)("p",{children:["The ",(0,s.jsx)("code",{className:"text-code-inline",children:a})," schema is used by Supabase to connect to analytics buckets and is read-only through the dashboard."]}):"fdw"===x&&"s3_vectors"===g?(0,s.jsxs)("p",{children:["The ",(0,s.jsx)("code",{className:"text-xs",children:a})," schema is used by Supabase to connect to vector buckets and is read-only through the dashboard."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"mb-2",children:["The ",(0,s.jsx)("code",{className:"text-code-inline",children:a})," schema is managed by Supabase and is read-only through the dashboard."]}),(0,s.jsxs)(n.lG,{open:u,onOpenChange:h,children:[(0,s.jsx)(n.zM,{asChild:!0,children:(0,s.jsx)(l.$,{type:"default",size:"tiny",onClick:()=>h(!0),children:"Learn more"})}),(0,s.jsx)(n.Cf,{children:(0,s.jsx)(c,{onClose:()=>h(!1)})})]})]})}):null}},39624:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(80263),r=a(12123);let n=e=>{let{resourceText:t,isFullPage:a=!1}=e,n=()=>(0,s.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(r.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,s.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return a?(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)("div",{className:"w-[550px]",children:(0,s.jsx)(n,{})})}):(0,s.jsx)(n,{})}},42130:(e,t,a)=>{"use strict";a.d(t,{fl:()=>o,oR:()=>c});var s=a(78510),r=a(67850),n=a(24523),l=a(87518);async function i(e,t){let{projectRef:a,connectionString:r}=e;if(!a)throw Error("projectRef is required");let l=new Headers;r&&l.set("x-connection-encrypted",r);let{data:i,error:o}=await (0,n.Jt)("/platform/pg-meta/{ref}/triggers",{params:{header:{"x-connection-encrypted":r,"x-pg-application-name":s.r},path:{ref:a},query:void 0},headers:l,signal:t});return o&&(0,n.H4)(o),i}let o=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.I)({queryKey:l.U.list(t),queryFn:e=>{let{signal:s}=e;return i({projectRef:t,connectionString:a},s)},select:e=>e.filter(e=>"supabase_functions"===e.function_schema&&("net"!==e.schema||0===e.function_args.length)),enabled:s&&void 0!==t,...n})},c=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.I)({queryKey:l.U.list(t),queryFn:e=>{let{signal:s}=e;return i({projectRef:t,connectionString:a},s)},enabled:s&&void 0!==t,...n})}},46087:(e,t,a)=>{"use strict";a.d(t,{$:()=>i,s:()=>l});var s=a(53239),r=a(23850),n=a(73969);function l(e){let{enabled:t,urlKey:a,select:n,onError:l}=e,[i,o]=(0,r.ZA)(a,r.tU.withOptions({history:"push",clearOnDefault:!0})),c=(0,s.useMemo)(()=>i?n(i):void 0,[i,n]);return(0,s.useEffect)(()=>{t&&i&&!c&&(l(Error("not found"),i),o(null))},[t,l,i,o,c]),{value:c,setValue:o}}let i=(e,t,a)=>{t!==e.current?n.oR.error(a):e.current=null}},48729:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/triggers",function(){return a(16716)}])},55315:(e,t,a)=>{var s=a(71057);e.exports=function(e,t){return s(t,function(t){return e[t]})}},56748:(e,t,a)=>{"use strict";a.d(t,{Y:()=>s});let s={list:e=>["projects",e,"fdws"]}},57125:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var s=a(80263),r=a(98103),n=a(61113),l=a(86510),i=a(52555),o=a.n(i),c=a(53239),d=a(99779);let u=(0,c.forwardRef)((e,t)=>{let{icon:a,title:i,description:u,url:h,urlLabel:m="Read more",defaultVisibility:x=!1,hideCollapse:g=!1,button:f,className:p="",block:j=!1}=e,[y,v]=(0,c.useState)(x);return(0,s.jsx)("div",{ref:t,role:"alert",className:"".concat(j?"block w-full":"","\n      block w-full rounded-md border bg-surface-300/25 py-3 ").concat(p),children:(0,s.jsxs)("div",{className:"flex flex-col px-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex w-full space-x-3 items-center",children:[a&&(0,s.jsx)("span",{className:"text-foreground-lighter",children:a}),(0,s.jsx)("div",{className:"flex-grow",children:(0,s.jsx)("h5",{className:"text-foreground",children:i})})]}),u&&!g?(0,s.jsx)("div",{className:"cursor-pointer text-foreground-lighter",onClick:()=>v(!y),children:y?(0,s.jsx)(r.A,{size:14,strokeWidth:1.5}):(0,s.jsx)(n.A,{size:14,strokeWidth:1.5})}):null]}),(u||h||f)&&(0,s.jsxs)("div",{className:"flex flex-col space-y-3 overflow-hidden transition-all ".concat(y?"mt-3":""),style:{maxHeight:500*!!y},children:[(0,s.jsx)("div",{className:"text-foreground-light text-sm",children:u}),h&&(0,s.jsx)("div",{children:(0,s.jsx)(d.$,{asChild:!0,type:"default",icon:(0,s.jsx)(l.A,{}),children:(0,s.jsx)(o(),{href:h,target:"_blank",rel:"noreferrer",children:m})})}),f&&(0,s.jsx)("div",{children:f})]})]})})});u.displayName="InformationBox";let h=u},57384:(e,t,a)=>{"use strict";a.d(t,{k:()=>l});var s=a(23850),r=a(53239),n=a(22891);let l=()=>{var e;let{ref:t}=(0,n.g)(),a=t&&t.length>0&&window.localStorage.getItem(n.rS.LAST_SELECTED_SCHEMA(t))||"public",[l,i]=(e=(0,r.useMemo)(()=>a,[t]),(0,s.ZA)("schema",s.tU.withDefault(e).withOptions({clearOnDefault:!1})));return(0,r.useEffect)(()=>{t&&t.length>0&&window.localStorage.setItem(n.rS.LAST_SELECTED_SCHEMA(t),l)},[l,t]),{selectedSchema:l,setSelectedSchema:i}}},61741:(e,t,a)=>{var s=a(55315),r=a(24967);e.exports=function(e){return null==e?[]:s(e,r(e))}},68296:(e,t,a)=>{"use strict";a.d(t,{A:()=>g});var s=a(80263),r=a(80814),n=a(91958),l=a(93873),i=a(22730),o=a(78937),c=a(2657),d=a(9620),u=a(9497),h=a(29471),m=a(54278);let x=()=>{let{data:e}=(0,d.YA)(),t=(0,r.useRouter)().pathname.split("/")[4],{data:a}=(0,i.z)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:u}=(0,o.Q)({projectRef:null==e?void 0:e.ref}),h=void 0!==(null!=a?a:[]).find(e=>"pg_net"===e.name),x=(null==u?void 0:u.selected_addons.find(e=>"pitr"===e.type))!==void 0,g=(0,n.p4)(),{databaseReplication:f,databaseRoles:p,integrationsWrappers:j}=(0,c.x)(["database:replication","database:roles","integrations:wrappers"]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.l,{page:t,menu:(0,m.k)(e,{pgNetExtensionExists:h,pitrEnabled:x,columnLevelPrivileges:g,showPgReplicate:f,showRoles:p,showWrappers:j}),"data-sentry-element":"ProductMenu","data-sentry-source-file":"DatabaseLayout.tsx"})})},g=(0,u.r)(e=>{let{children:t}=e;return(0,s.jsx)(h.k,{product:"Database",productMenu:(0,s.jsx)(x,{}),isBlocking:!1,"data-sentry-element":"ProjectLayout","data-sentry-component":"DatabaseLayout","data-sentry-source-file":"DatabaseLayout.tsx",children:t})})},73036:(e,t,a)=>{"use strict";a.d(t,{$:()=>n});var s=a(53239),r=a(74065);let n=e=>{let{checkIsDirty:t,onClose:a}=e,[n,l]=(0,s.useState)(!1),i=(0,r.A)(t),o=(0,r.A)(a),c=(0,s.useCallback)(()=>{i.current()?l(!0):o.current()},[]),d=(0,s.useCallback)(()=>{l(!1),o.current()},[]),u=(0,s.useCallback)(()=>{l(!1)},[]),h=(0,s.useMemo)(()=>({visible:n,onClose:d,onCancel:u}),[n,d,u]);return(0,s.useMemo)(()=>({confirmOnClose:c,modalProps:h}),[c,h])}},78993:(e,t,a)=>{"use strict";a.d(t,{R:()=>d});var s=a(72391),r=a(51355),n=a(80210),l=a(59356),i=a(73969),o=a(87518);async function c(e){let{trigger:t,projectRef:a,connectionString:r}=e,{sql:n}=s.A.triggers.remove(t),{result:i}=await (0,l.E)({projectRef:a,connectionString:r,sql:n,queryKey:["trigger","delete",t.id]});return i}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,r.jE)();return(0,n.n)({mutationFn:e=>c(e),async onSuccess(t,a,r){let{projectRef:n}=a;await s.invalidateQueries({queryKey:o.U.list(n)}),await (null==e?void 0:e(t,a,r))},async onError(e,a,s){void 0===t?i.oR.error("Failed to delete database trigger: ".concat(e.message)):t(e,a,s)},...a})}},84438:(e,t,a)=>{"use strict";a.d(t,{A:()=>j});var s=a(80263),r=a(72112),n=a(32157),l=a(23892),i=a(90376),o=a(53239),c=a(32775),d=a(80090),u=a(9620),h=a(99779),m=a(73640),x=a(20033),g=a(61548),f=a(29244),p=a(97757);let j=e=>{let{className:t,disabled:a=!1,size:j="tiny",showError:y=!0,selectedSchemaName:v,supportSelectAll:b=!1,excludedSchemas:N=[],onSelectSchema:S,onSelectCreateSchema:w,portal:A=!0,align:C="start"}=e,[T,E]=(0,o.useState)(!1),{can:_}=(0,d.Qp)(r.aG.TENANT_SQL_ADMIN_WRITE,"schemas"),{data:k}=(0,u.YA)(),{data:F,isLoading:R,isSuccess:D,isError:I,error:P,refetch:L}=(0,c.w$)({projectRef:null==k?void 0:k.ref,connectionString:null==k?void 0:k.connectionString}),z=(F||[]).filter(e=>!N.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,s.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[R&&(0,s.jsx)(h.$,{type:"default",className:"w-full [&>span]:w-full",size:j,disabled:!0,children:(0,s.jsx)(m.E,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),y&&I&&(0,s.jsxs)(x.Fc,{variant:"warning",className:"!px-3 !py-3",children:[(0,s.jsx)(x.XL,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,s.jsxs)(x.TN,{className:"text-xs mb-2 break-words",children:["Error: ",null==P?void 0:P.message]}),(0,s.jsx)(h.$,{type:"default",size:"tiny",onClick:()=>L(),children:"Reload schemas"})]}),D&&(0,s.jsxs)(g.AM,{open:T,onOpenChange:E,modal:!1,children:[(0,s.jsx)(g.Wv,{asChild:!0,children:(0,s.jsx)(h.$,{size:j,disabled:a,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,s.jsx)(n.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:v?(0,s.jsxs)("div",{className:"w-full flex gap-1",children:[(0,s.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,s.jsx)("p",{className:"text-foreground",children:"*"===v?"All schemas":v})]}):(0,s.jsx)("div",{className:"w-full flex gap-1",children:(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema..."})})})}),(0,s.jsx)(g.hl,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:C,portal:A,sameWidthAsTrigger:!0,children:(0,s.jsxs)(f.uB,{children:[(0,s.jsx)(f.G7,{placeholder:"Find schema..."}),(0,s.jsxs)(f.oI,{children:[(0,s.jsx)(f.xL,{children:"No schemas found"}),(0,s.jsx)(f.L$,{children:(0,s.jsxs)(p.FK,{className:(z||[]).length>7?"h-[210px]":"",children:[b&&(0,s.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{S("*"),E(!1)},onClick:()=>{S("*"),E(!1)},children:[(0,s.jsx)("span",{children:"All schemas"}),"*"===v&&(0,s.jsx)(l.A,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==z?void 0:z.map(e=>(0,s.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{S(e.name),E(!1)},onClick:()=>{S(e.name),E(!1)},children:[(0,s.jsx)("span",{children:e.name}),v===e.name&&(0,s.jsx)(l.A,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==w&&_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.fx,{}),(0,s.jsx)(f.L$,{children:(0,s.jsxs)(f.h_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{w(),E(!1)},onClick:()=>{w(),E(!1)},children:[(0,s.jsx)(i.A,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},86926:(e,t,a)=>{var s=a(35902),r=a(89527),n=a(22442),l=a(80544),i=a(61741),o=Math.max;e.exports=function(e,t,a,c){e=r(e)?e:i(e),a=a&&!c?l(a):0;var d=e.length;return a<0&&(a=o(d+a,0)),n(e)?a<=d&&e.indexOf(t,a)>-1:!!d&&s(e,t,a)>-1}},87167:(e,t,a)=>{"use strict";a.d(t,{Y:()=>d});var s=a(72391),r=a(51355),n=a(80210),l=a(59356),i=a(73969),o=a(87518);async function c(e){let{projectRef:t,connectionString:a,payload:r}=e,{sql:n}=s.A.triggers.create(r),{result:i}=await (0,l.E)({projectRef:t,connectionString:a,sql:n,queryKey:["trigger","create"]});return i}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,r.jE)();return(0,n.n)({mutationFn:e=>c(e),async onSuccess(t,a,r){let{projectRef:n}=a;await s.invalidateQueries({queryKey:o.U.list(n)}),await (null==e?void 0:e(t,a,r))},async onError(e,a,s){void 0===t?i.oR.error("Failed to create database trigger: ".concat(e.message)):t(e,a,s)},...a})}},97167:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var s=a(80263),r=a(14360),n=a(83927),l=a.n(n),i=a(53239),o=a(48303),c=a(37383);let d=e=>{let{queryId:t,language:a="pgsql",defaultValue:n="",readOnly:d=!1,contextmenu:u=!0,onInputChange:h=l()}=e,m=(0,r.useMonaco)(),x=(0,i.useRef)();return(0,i.useEffect)(()=>{if(m){let e=m.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),a=(0,o.A)(t);return[{range:e.getFullModelRange(),text:a}]}});return()=>{e.dispose()}}},[m]),(0,i.useEffect)(()=>{if(x.current){var e;null==(e=x.current)||e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})}},[t]),(0,s.jsx)(r.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:a,defaultValue:n,path:t,loading:(0,s.jsx)(c.A,{}),options:{readOnly:d,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:u},onMount:(e,t)=>{x.current=e,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})},onChange:h,"data-sentry-element":"Editor","data-sentry-component":"SqlEditor","data-sentry-source-file":"SqlEditor.tsx"})}}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,26616,73659,76984,72391,35035,40545,596,10508,48340,75187,29471,91312,63335,90636,46593,38792],()=>e(e.s=48729)),_N_E=e.O()}]);