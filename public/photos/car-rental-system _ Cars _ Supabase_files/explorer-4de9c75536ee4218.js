try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8f50d005-d36a-4f7a-b96a-d65e83207161",e._sentryDebugIdIdentifier="sentry-dbid-8f50d005-d36a-4f7a-b96a-d65e83207161")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76377],{53148:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return s(90629)}])},90629:(e,t,s)=>{"use strict";s.r(t),s.d(t,{LogsExplorerPage:()=>ea,default:()=>en});var a=s(80263),n=s(14360),l=s(56404),r=s(53434),o=s.n(r),i=s(80814),d=s(53239),c=s(73969),u=s(22891),x=s(77727),m=s(75187),p=s(76174),y=s(68152),h=s(96776),f=s(86510),g=s(23892),j=s(9753),b=s(52555),v=s.n(b),P=s(68856),w=s(2657),_=s(85039),S=s(71228),A=s(21162),N=s(99779),L=s(30404),T=s(21650),C=s(79861),R=s(99287),k=s(38904),Q=s(34842);function E(e){let{name:t,desc:s}=e;return(0,a.jsxs)("div",{className:"grid gap-1","data-sentry-component":"DropdownMenuItemContent","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,a.jsx)("div",{className:"font-mono font-bold",children:t}),s&&(0,a.jsx)("div",{className:"text-foreground-light",children:s})]})}let q=e=>{let{field:t}=e,[s,n]=(0,d.useState)(!1);return(0,a.jsxs)(P.A.tr,{"data-sentry-element":"Table.tr","data-sentry-component":"Field","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,a.jsxs)(P.A.td,{className:"font-mono text-xs !p-2 cursor-pointer hover:text-foreground transition flex items-center space-x-2",onClick:()=>(0,k.l)(t.path,()=>{n(!0),setTimeout(()=>n(!1),3e3)}),"data-sentry-element":"Table.td","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,a.jsx)("span",{children:t.path}),s?(0,a.jsxs)(L.m_,{children:[(0,a.jsx)(L.k$,{children:(0,a.jsx)(g.A,{size:14,strokeWidth:3,className:"text-brand"})}),(0,a.jsx)(L.ZI,{side:"bottom",children:"Copied"})]}):(0,a.jsxs)(L.m_,{children:[(0,a.jsx)(L.k$,{children:(0,a.jsx)(j.A,{size:14,strokeWidth:1.5})}),(0,a.jsx)(L.ZI,{side:"bottom",children:"Copy value"})]})]}),(0,a.jsx)(P.A.td,{className:"font-mono text-xs !p-2","data-sentry-element":"Table.td","data-sentry-source-file":"LogsQueryPanel.tsx",children:t.type})]})},M=e=>{let{templates:t=[],defaultFrom:s,defaultTo:n,warnings:l,onSelectTemplate:r,onSelectSource:i,onDateChange:c}=e,[m,g]=(0,d.useState)(!1),{logsTemplates:j}=(0,w.x)(["logs:templates"]),{projectAuthAll:b,projectStorageAll:k,projectEdgeFunctionAll:M}=(0,w.x)(["project_auth:all","project_storage:all","project_edge_function:all"]),I=Object.entries(x.le).filter(e=>{let[t]=e;return"AUTH"===t?b:"STORAGE"===t?k:"FN_EDGE"===t?M:"PG_CRON"!==t}).map(e=>{let[,t]=e;return t}),[D,z]=(0,d.useState)(s&&n?{to:n,from:s,text:"".concat(o()(s).format("DD MMM, HH:mm")," - ").concat(o()(n).format("DD MMM, HH:mm")),isHelper:!1}:{to:x.Po[0].calcTo(),from:x.Po[0].calcFrom(),text:x.Po[0].text,isHelper:!0});return(0,a.jsx)("div",{className:"border-b bg-surface-100","data-sentry-component":"LogsQueryPanel","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,a.jsx)("div",{className:"flex w-full items-center justify-between px-4 md:px-5 py-2 overflow-x-scroll no-scrollbar",children:(0,a.jsxs)("div",{className:"flex w-full flex-row items-center justify-between gap-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(A.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,a.jsx)(A.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,a.jsx)(N.$,{type:"default",iconRight:(0,a.jsx)(p.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"LogsQueryPanel.tsx",children:"Insert source"})}),(0,a.jsx)(A.SQ,{side:"bottom",align:"start",className:"max-h-[390px] overflow-auto","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"LogsQueryPanel.tsx",children:I.sort((e,t)=>e.localeCompare(t)).map(e=>(0,a.jsx)(A._2,{onClick:()=>i(e),children:(0,a.jsx)(E,{name:e,desc:x.fy[e]})},e))})]}),u.pe&&j&&(0,a.jsxs)(A.rI,{children:[(0,a.jsx)(A.ty,{asChild:!0,children:(0,a.jsx)(N.$,{type:"default",iconRight:(0,a.jsx)(p.A,{}),children:"Templates"})}),(0,a.jsx)(A.SQ,{side:"bottom",align:"start",children:t.sort((e,t)=>e.label.localeCompare(t.label)).map(e=>(0,a.jsx)(A._2,{onClick:()=>r(e),children:(0,a.jsx)("p",{children:e.label})},e.label))})]}),(0,a.jsx)(Q.O,{value:D,onSubmit:e=>{z(e),c(e)},helpers:x.Po,"data-sentry-element":"LogsDatePicker","data-sentry-source-file":"LogsQueryPanel.tsx"}),(0,a.jsx)("div",{"data-testid":"log-explorer-warnings",className:"transition-all duration-300 h-full ".concat(l.length>0?"opacity-100":"invisible h-0 w-0 opacity-0"),children:(0,a.jsx)(L.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,a.jsxs)(L.k$,{className:"flex items-start","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,a.jsxs)(T.E,{variant:"warning","data-sentry-element":"Badge","data-sentry-source-file":"LogsQueryPanel.tsx",children:[l.length," ",l.length>1?"warnings":"warning"]}),(0,a.jsx)(L.ZI,{className:"p-0 divide-y max-w-xs",side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"LogsQueryPanel.tsx",children:l.map((e,t)=>(0,a.jsxs)("p",{className:"px-3 py-1.5 text-xs text-foreground-light text-left",children:[e.text," ",e.link&&(0,a.jsx)(v(),{href:e.link,children:e.linkText||"View"})]},t))})]})})})]}),(0,a.jsxs)(C.Ay,{size:"large",header:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,a.jsx)("h3",{children:"Field Reference"}),(0,a.jsx)(N.$,{type:"text",className:"px-1",onClick:()=>g(!1),icon:(0,a.jsx)(y.A,{})})]}),visible:m,cancelText:"Close",onCancel:()=>g(!1),hideFooter:!0,triggerElement:(0,a.jsx)(N.$,{type:"text",onClick:()=>g(!0),icon:(0,a.jsx)(h.A,{}),className:"px-2",children:(0,a.jsx)("span",{children:"Field Reference"})}),"data-sentry-element":"SidePanel","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,a.jsx)(C.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,a.jsx)("div",{className:"pt-4 pb-2 space-y-1",children:(0,a.jsxs)("p",{className:"text-sm",children:["The following table shows all the available paths that can be queried from each respective source. Do note that to access nested keys, you would need to perform the necessary"," ",(0,a.jsxs)(v(),{href:"".concat(_.aq,"/guides/platform/logs#unnesting-arrays"),target:"_blank",rel:"noreferrer",className:"text-brand","data-sentry-element":"Link","data-sentry-source-file":"LogsQueryPanel.tsx",children:["unnesting joins",(0,a.jsx)(f.A,{size:"14",className:"ml-1 inline -translate-y-[2px]",strokeWidth:1.5,"data-sentry-element":"ExternalLink","data-sentry-source-file":"LogsQueryPanel.tsx"})]})]})})}),(0,a.jsx)(C.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"LogsQueryPanel.tsx"}),(0,a.jsx)(R.A,{scrollable:!0,size:"small",type:"underlined",defaultActiveId:"edge_logs",listClassNames:"px-2","data-sentry-element":"Tabs","data-sentry-source-file":"LogsQueryPanel.tsx",children:S.go.schemas.map(e=>(0,a.jsx)(R.A.Panel,{id:e.reference,label:e.name,className:"px-4 pb-4",children:(0,a.jsx)(P.A,{head:[(0,a.jsx)(P.A.th,{className:"text-xs !p-2",children:"Path"},"path"),(0,a.jsx)(P.A.th,{className:"text-xs !p-2",children:"Type"},"type")],body:e.fields.sort((e,t)=>e.path-t.path).map(e=>(0,a.jsx)(q,{field:e},e.path))})},e.reference))})]})]})})})};var I=s(71438),D=s(27122),z=s(10508),F=s(93048),O=s(15040),H=s(76935),U=s(42659),$=s(82702),V=s(8579),Z=s(68224),G=s(88419),W=s(14988),B=s(14051),K=s(6436),X=s(34983),J=s(39260),Y=s(6217),ee=s(49151),et=s(80421),es=s(49510);let ea=()=>{(0,m.PJ)();let e=(0,n.useMonaco)(),t=(0,i.useRouter)(),{profile:s}=(0,X.xc)(),{ref:r,q:p,queryId:y}=(0,u.g)(),{logsShowMetadataIpTemplate:h}=(0,w.x)(["logs:show_metadata_ip_template"]),f=(0,d.useMemo)(()=>h?x.QT:x.QT.filter(e=>"Metadata IP"!==e.label),[h]),g=(0,d.useRef)(),[j]=(0,d.useState)((0,K.gZ)()),{timestampStart:b,timestampEnd:v,setTimeRange:P}=(0,G.B)(),{logsDefaultQuery:_}=(0,W.g)(["logs:default_query"]),S=u.pe?null!=_?_:"select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5":"select\n  timestamp, event_message, metadata\n  from edge_logs limit 5",[A,L]=(0,d.useState)(S),[T,C]=(0,d.useState)(!1),[R,k]=(0,d.useState)([]),[Q,E]=(0,d.useState)(null),[q,z]=(0,l.Mj)("project-content-".concat(r,"-recent-log-sql"),[]),{getEntitlementNumericValue:F}=(0,es.e)("log.retention_days"),ea=F(),{data:en}=(0,$.D)({projectRef:r,type:"log_sql"}),el=null==en?void 0:en.content.find(e=>e.id===y),{params:er,logData:eo,error:ei,isLoading:ed,changeQuery:ec,runQuery:eu}=(0,Z.A)(r,{iso_timestamp_start:b,iso_timestamp_end:v},!0),{mutate:ex,isPending:em}=(0,V.v)({onError:e=>{console.error(e),C(!1),y?c.oR.error("Failed to update query: ".concat(e.message)):c.oR.error("Failed to save query: ".concat(e.message))},onSuccess:(e,t)=>{C(!1),y?c.oR.success('Updated "'.concat(t.payload.name,'" log query')):c.oR.success('Saved "'.concat(t.payload.name,'" log query'))}}),ep=e=>{z([...q,{schema_version:"1",sql:"",content_id:"",...e}])},{showUpgradePrompt:ey,setShowUpgradePrompt:eh}=(0,B.g)(er.iso_timestamp_start),ef=e=>{let s="string"==typeof e&&e||A;ec(s),eu(),t.push({pathname:t.pathname,query:{...t.query,q:s}}),ep({sql:s})},eg=async(e,a)=>{let{setSubmitting:n}=a;if(!r)return console.error("Project ref is required");if(!s)return console.error("Profile is required");n(!0);let l=(0,K.gZ)();ex({projectRef:r,payload:{id:l,name:e.name,description:e.description||"",type:"log_sql",content:{content_id:j,sql:A,schema_version:"1",favorite:!1},owner_id:s.id,visibility:"user"}},{onSuccess:()=>t.push("/project/".concat(r,"/logs/explorer?queryId=").concat(l))})};return(0,d.useEffect)(()=>{p&&L(p)},[p]),(0,d.useEffect)(()=>{let e=[],t=b?o()(b):o()(),s=v?o()(v):o()();Math.abs(t.diff(s,"days"))>=x.VM&&e.push({text:"Querying large date ranges can be slow. Consider selecting a smaller date range."}),A&&!A.toLowerCase().includes("limit")&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),k(e)},[A,b,v]),(0,d.useEffect)(()=>{b&&(0,m.lK)(b,ea)&&eh(!ey)},[b,ea]),(0,a.jsxs)("div",{className:"w-full h-full mx-auto","data-sentry-component":"LogsExplorerPage","data-sentry-source-file":"index.tsx",children:[(0,a.jsxs)(J.HK,{className:"w-full h-full max-h-screen",direction:"vertical",autoSaveId:u.rS.LOG_EXPLORER_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"index.tsx",children:[(0,a.jsxs)(J.wV,{collapsible:!0,minSize:5,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(M,{defaultFrom:b||"",defaultTo:v||"",onDateChange:e=>{let{to:t,from:s}=e;(0,m.lK)(s,ea)?eh(!ey):P(s||"",t||"")},onSelectSource:t=>{if(g.current&&e){var s,a;let n=null==(s=g.current)?void 0:s.getModel(),l=g.current.getValue(),r=l.indexOf("from"),o=r<0?"".concat(l).concat(t):"".concat(l.substring(0,r+4)," ").concat(t," ").concat(l.substring(r+5));g.current.pushUndoStop(),g.current.executeEdits("insert-identifier",[{text:o,range:null!=(a=null==n?void 0:n.getFullModelRange())?a:new e.Range(1,1,1,1)}]),g.current.pushUndoStop(),g.current.focus()}},templates:f.filter(e=>"custom"===e.mode),onSelectTemplate:t=>{if(g.current&&e){var s,a;let n=null==(s=g.current)?void 0:s.getModel();g.current.pushUndoStop(),g.current.executeEdits("insert-identifier",[{text:t.searchString,range:null!=(a=null==n?void 0:n.getFullModelRange())?a:new e.Range(1,1,1,1)}]),g.current.pushUndoStop(),g.current.focus()}ep({sql:t.searchString})},warnings:R,"data-sentry-element":"LogsQueryPanel","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(U.A,{active:ed,"data-sentry-element":"ShimmerLine","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(O.A,{id:j,editorRef:g,language:"pgsql",defaultValue:A,onInputChange:e=>L(e||""),actions:{runQuery:{enabled:!0,callback:ef}},"data-sentry-element":"CodeEditor","data-sentry-source-file":"index.tsx"})]}),(0,a.jsx)(J.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(J.wV,{collapsible:!0,minSize:5,className:"overflow-auto","data-sentry-element":"ResizablePanel","data-sentry-source-file":"index.tsx",children:(0,a.jsxs)(H.A,{active:ed,"data-sentry-element":"LoadingOpacity","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(I.A,{isSaving:em,showHistogramToggle:!1,onRun:ef,onSave:function(){return r?y&&el?void ex({projectRef:r,payload:{...el,content:{...el.content,sql:A}}}):void C(!T):console.error("Project ref is required")},hasEditorValue:!!A,data:eo,error:ei,projectRef:r,onSelectedLogChange:E,selectedLog:Q,"data-sentry-element":"LogTable","data-sentry-source-file":"index.tsx"}),(0,a.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,a.jsx)(D.A,{show:ey,setShowUpgradePrompt:eh,"data-sentry-element":"UpgradePrompt","data-sentry-source-file":"index.tsx"})})]})})]}),(0,a.jsx)(Y.A,{size:"medium",onCancel:()=>C(!T),header:"Save log query",visible:T,hideFooter:!0,"data-sentry-element":"Modal","data-sentry-source-file":"index.tsx",children:(0,a.jsx)(ee.A,{initialValues:{name:"",desdcription:""},onSubmit:eg,"data-sentry-element":"Form","data-sentry-source-file":"index.tsx",children:()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Y.A.Content,{className:"space-y-6",children:[(0,a.jsx)(et.A,{layout:"horizontal",label:"Name",id:"name"}),(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(et.A.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]}),(0,a.jsx)(Y.A.Separator,{}),(0,a.jsxs)(Y.A.Content,{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(N.$,{size:"tiny",type:"default",onClick:()=>C(!T),children:"Cancel"}),(0,a.jsx)(N.$,{size:"tiny",loading:em,disabled:em,htmlType:"submit",children:"Save"})]})]})})})]})};ea.getLayout=e=>(0,a.jsx)(z.A,{children:(0,a.jsx)(F.A,{children:e})});let en=ea},99287:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(80263),n=s(46115),l=s(53239),r=s(7981);let o=e=>{var t,s,o;let{defaultActiveId:i,activeId:d,type:c="pills",size:u="tiny",block:x,onChange:m,onClick:p,scrollable:y,wrappable:h,addOnBefore:f,addOnAfter:g,listClassNames:j,baseClassNames:b,refs:v,children:P}=e,w=l.Children.toArray(P),[_,S]=(0,l.useState)(null!=(o=null!=d?d:i)?o:null==w||null==(s=w[0])||null==(t=s.props)?void 0:t.id);(0,l.useMemo)(()=>{d&&d!==_&&S(d)},[d]);let A=(0,r.A)("tabs");function N(e){null==p||p(e),e!==_&&(null==m||m(e),S(e))}let L=[A[c].list];return y&&L.push(A.scrollable),h&&L.push(A.wrappable),j&&L.push(j),(0,a.jsxs)(n.bL,{value:_,className:[A.base,b].join(" "),ref:null==v?void 0:v.base,"data-sentry-element":"TabsPrimitive.Root","data-sentry-component":"Tabs","data-sentry-source-file":"Tabs.tsx",children:[(0,a.jsxs)(n.B8,{className:L.join(" "),ref:null==v?void 0:v.list,"data-sentry-element":"TabsPrimitive.List","data-sentry-source-file":"Tabs.tsx",children:[f,w.map(e=>{let t=_===e.props.id,s=[A[c].base,A.size[u]];return t?s.push(A[c].active):s.push(A[c].inactive),x&&s.push(A.block),(0,a.jsxs)(n.l9,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),N(e.props.id))},onClick:()=>N(e.props.id),value:e.props.id,className:s.join(" "),children:[e.props.icon,(0,a.jsx)("span",{children:e.props.label}),e.props.iconRight]},"".concat(e.props.id,"-tab-button"))}),g]}),w]})};o.Panel=e=>{let{children:t,id:s,className:l}=e,o=(0,r.A)("tabs");return(0,a.jsx)(n.UC,{value:s,className:[o.content,l].join(" "),"data-sentry-element":"TabsPrimitive.Content","data-sentry-component":"Panel","data-sentry-source-file":"Tabs.tsx",children:t})};let i=o}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,2838,21436,57459,47876,87654,652,9711,85820,76984,72391,35035,40545,596,10508,48340,75187,29471,34842,93048,73061,90636,46593,38792],()=>e(e.s=53148)),_N_E=e.O()}]);