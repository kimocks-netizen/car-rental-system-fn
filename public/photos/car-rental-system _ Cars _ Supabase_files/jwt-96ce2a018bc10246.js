try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0e36ff27-f81c-4a2c-9957-1989a539bc64",e._sentryDebugIdIdentifier="sentry-dbid-0e36ff27-f81c-4a2c-9957-1989a539bc64")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70557],{11053:(e,t,s)=>{"use strict";s.d(t,{o:()=>l});var a=s(67850),n=s(24523),r=s(24735);async function i(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:r}=await (0,n.Jt)("/v1/projects/{ref}/config/auth/signing-keys/legacy",{params:{path:{ref:s}},signal:t});return r&&(0,n.H4)(r),a}let l=function(e){let{projectRef:t}=e,{enabled:s,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.H.legacy(t),queryFn:e=>{let{signal:s}=e;return i({projectRef:t},s)},enabled:s&&!!t,retry:!1,refetchOnWindowFocus:!1,...n})}},17812:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/settings/jwt",function(){return s(84156)}])},18563:(e,t,s)=>{"use strict";s.d(t,{L:()=>o});var a=s(67850),n=s(24523),r=s(85039),i=s(93284);async function l(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:r}=await (0,n.Jt)("/v1/projects/{ref}/api-keys/legacy",{params:{path:{ref:s}},signal:t});return r&&(0,n.H4)(r),a}let o=function(e){let{projectRef:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:i.f.status(t),queryFn:e=>{let{signal:s}=e;return l({projectRef:t},s)},enabled:r.pe&&s&&void 0!==t,...n})}},24735:(e,t,s)=>{"use strict";s.d(t,{H:()=>a});let a={list:e=>["projects",e,"jwt-signing-keys"],legacy:e=>["projects",e,"legacy-jwt-signing-key"]}},37631:(e,t,s)=>{"use strict";s.d(t,{$E:()=>u,kV:()=>d,op:()=>c});var a=s(67850),n=s(51355),r=s(24523),i=s(85039),l=s(53239),o=s(31907);async function d(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:n}=await (0,r.Jt)("/platform/auth/{ref}/config",{params:{path:{ref:s}},signal:t});return n&&(0,r.H4)(n),a}let c=function(e){let{projectRef:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:o.Z.authConfig(t),queryFn:e=>{let{signal:s}=e;return d({projectRef:t},s)},enabled:s&&i.pe&&void 0!==t,...n})},u=e=>{let{projectRef:t}=e,s=(0,n.jE)();return(0,l.useCallback)(()=>{t&&s.prefetchQuery({queryKey:o.Z.authConfig(t),queryFn:e=>{let{signal:s}=e;return d({projectRef:t},s)}})},[s,t])}},42459:(e,t,s)=>{"use strict";s.d(t,{c:()=>d});var a=s(80263),n=s(52555),r=s.n(n),i=s(80100),l=s(99779),o=s(44725);let d=e=>{let{urlBack:t,fullHeight:s=!0}=e;return(0,a.jsx)("div",{className:(0,i.cn)("w-full flex items-center justify-center",s&&"h-full"),"data-sentry-component":"UnknownInterface","data-sentry-source-file":"UnknownInterface.tsx",children:(0,a.jsx)(o.Z,{type:"note",className:"max-w-xl",title:"Looking for something?",description:"We couldn't find the page that you're looking for","data-sentry-element":"Admonition","data-sentry-source-file":"UnknownInterface.tsx",children:(0,a.jsx)(l.$,{asChild:!0,type:"default",className:"mt-2","data-sentry-element":"Button","data-sentry-source-file":"UnknownInterface.tsx",children:(0,a.jsx)(r(),{href:t,"data-sentry-element":"Link","data-sentry-source-file":"UnknownInterface.tsx",children:"Head back"})})})})}},43479:(e,t,s)=>{"use strict";s.d(t,{A:()=>p});var a=s(80263),n=s(80814),r=s(22891),i=s(93873),l=s(2657),o=s(84512),d=s(9620),c=s(9497),u=s(29471),h=s(25433);let p=(0,c.r)(e=>{let{title:t,children:s}=e,c=(0,n.useRouter)(),{ref:p}=(0,r.g)(),{data:g}=(0,d.YA)(),{data:y}=(0,o.s)(),x=c.pathname.includes("billing")?c.pathname.split("/")[5]:c.pathname.split("/")[4],{projectAuthAll:f,authenticationShowProviders:m,projectEdgeFunctionAll:j,projectStorageAll:v,billingInvoices:b,projectSettingsLegacyJwtKeys:w,projectSettingsLogDrains:k,billingAll:A}=(0,l.x)(["project_auth:all","authentication:show_providers","project_edge_function:all","project_storage:all","billing:invoices","project_settings:legacy_jwt_keys","project_settings:log_drains","billing:all"]),N=(0,h.M)(p,g,y,{auth:f,authProviders:m,edgeFunctions:j,storage:v,invoices:b,legacyJwtKeys:w,logDrains:k,billing:A});return(0,a.jsx)(u.k,{isBlocking:!1,title:t||"Settings",product:"Settings",productMenu:(0,a.jsx)(i.l,{page:x,menu:N}),"data-sentry-element":"ProjectLayout","data-sentry-component":"SettingsLayout","data-sentry-source-file":"SettingsLayout.tsx",children:s})})},49151:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(80263),n=s(53239),r=s(57459),i=s(7760);function l(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function o(e){let{validate:t,...s}=e,[o,d]=(0,n.useReducer)(l,null),c=(0,r.Wx)({validateOnBlur:!0,...s,validationSchema:s.validationSchema,initialValues:s.initialValues,onSubmit:s.onSubmit,validate:t||function(){return o}});return(0,a.jsx)("form",{id:s.id,name:s.name,onSubmit:c.handleSubmit,className:s.className,style:s.style,method:"POST","data-sentry-component":"Form","data-sentry-source-file":"Form.tsx",children:(0,a.jsx)(i.h,{values:c.values,errors:c.errors,formContextOnChange:c.handleChange,handleBlur:c.handleBlur,touched:c.touched,fieldLevelValidation:function(e,t){d({key:e,error:t})},"data-sentry-element":"FormContextProvider","data-sentry-source-file":"Form.tsx",children:s.children({errors:c.errors,touched:c.touched,isSubmitting:c.isSubmitting,isValidating:c.isValidating,submitCount:c.submitCount,initialValues:c.initialValues,values:c.values,handleReset:c.handleReset,resetForm:c.resetForm,setFieldValue:c.setFieldValue})})})}},50442:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(80263),n=s(8750),r=s(37873),i=s(22891),l=s(2657);let o=e=>{let{children:t}=e,{ref:s}=(0,i.g)(),{projectSettingsLegacyJwtKeys:o}=(0,l.x)(["project_settings:legacy_jwt_keys"]),d=[...o?[{label:"Legacy JWT Secret",href:"/project/".concat(s,"/settings/jwt"),id:"legacy-jwt-keys"}]:[],{label:"JWT Signing Keys",href:"/project/".concat(s,"/settings/jwt/signing-keys"),id:"signing-keys"}];return(0,a.jsx)(n.M,{title:"JWT Keys",subtitle:"Control the keys used to sign JSON Web Tokens for your project",navigationItems:d,"data-sentry-element":"PageLayout","data-sentry-component":"JWTKeysLayout","data-sentry-source-file":"JWTKeysLayout.tsx",children:(0,a.jsx)(r.eh,{className:"flex flex-col py-8 gap-8",bottomPadding:!0,"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"JWTKeysLayout.tsx",children:t})})}},50795:(e,t,s)=>{"use strict";s.d(t,{I:()=>r});var a=s(80263),n=s(99779);let r=e=>{let{form:t,hasChanges:s,handleReset:r,helper:i,disabled:l=!1,isSubmitting:o,submitText:d="Save"}=e,c=o||l||!s&&void 0!==s;return(0,a.jsxs)("div",{className:["flex w-full items-center gap-2",i?"justify-between":"justify-end"].join(" "),"data-sentry-component":"FormActions","data-sentry-source-file":"FormActions.tsx",children:[i&&(0,a.jsx)("span",{className:"text-sm text-foreground-lighter",children:i}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.$,{disabled:c,type:"default",htmlType:"reset",onClick:()=>r(),"data-sentry-element":"Button","data-sentry-source-file":"FormActions.tsx",children:"Cancel"}),(0,a.jsx)(n.$,{form:t,type:"primary",htmlType:"submit",disabled:c,loading:o,"data-sentry-element":"Button","data-sentry-source-file":"FormActions.tsx",children:d})]})]})}},60254:(e,t,s)=>{"use strict";s.d(t,{PA:()=>r,Uj:()=>n,Vi:()=>i,uD:()=>l});var a=s(73402);let n={in_use:"Current key",standby:"Standby key",previously_used:"Previous key",revoked:"Revoked"},r={standby:"bg-surface-300 bg-opacity-100 text-foreground border border-foreground-muted",in_use:"bg-brand-200 bg-opacity-100 text-brand-600 border-brand-500",previously_used:"bg-purple-300 dark:bg-purple-100 text-purple-1200 border-purple-800",revoked:"bg-destructive-200 bg-opacity-100 text-destructive-600 border-destructive-500"},i={[a.RZ.APIServicesConfigurationUpdateFailed]:"failed to update configuration for API services",[a.RZ.APIServicesRestartFailed]:"failed to restart API services",[a.RZ.DatabaseAdminAPIConfigurationUpdateFailed]:"failed to update configuration for database admin API",[a.RZ.PostgreSQLRestartFailed]:"failed to restart PostgreSQL service",[a.RZ.SupabaseAPIKeyUpdateFailed]:"failed to update Supabase API key",[a.RZ.APIGatewayUpdateFailed]:"failed to update API Gateway"},l={[a.Ks.RestartedAPIServices]:"restarted API services",[a.Ks.RestartedPostgreSQL]:"restarted PostgreSQL service",[a.Ks.Started]:"started updating",[a.Ks.UpdatedAPIServicesConfiguration]:"updated configuration for API services",[a.Ks.UpdatedDatabaseAdminAPIConfiguration]:"updated configuration for database admin API",[a.Ks.UpdatedAPIGatewayConfiguration]:"updated configuration for API Gateway"}},72715:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]])},76885:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(80263),n=s(53239),r=s(23157),i=s(15471),l=s(50298),o=s(7981),d=s(7760);let c=function(e){let{defaultValue:t,descriptionText:s,error:c,icon:u,inputRef:h,label:p,afterLabel:g,beforeLabel:y,labelOptional:x,layout:f,value:m,actions:j,size:v="medium",validation:b,id:w="",name:k="",...A}=e,N=(0,o.A)("inputNumber"),{formContextOnChange:S,values:T,errors:J,handleBlur:P,touched:I,fieldLevelValidation:C}=(0,d.x)();T&&!m&&(m=T[w||k]),c||(J&&!c&&(c=J[w||k]),c=I&&I[w||k]?c:void 0),(0,n.useEffect)(()=>{b&&C(w,b(m))},[]);let W=[N.base];return c&&W.push(N.variants.error),c||W.push(N.variants.standard),u&&W.push(N.with_icon),v&&W.push(N.size[v]),A.disabled&&W.push(N.disabled),(0,a.jsx)("div",{className:A.className,"data-sentry-component":"InputNumber","data-sentry-source-file":"InputNumber.tsx",children:(0,a.jsx)(r.H,{label:p,afterLabel:g,beforeLabel:y,labelOptional:x,layout:f,id:w,error:c,descriptionText:s,style:A.style,size:v,"data-sentry-element":"FormLayout","data-sentry-source-file":"InputNumber.tsx",children:(0,a.jsxs)("div",{className:N.container,children:[(0,a.jsx)("input",{"data-size":v,id:w,name:k,onChange:function(e){A.onChange&&A.onChange(e),S&&S(e),b&&C(w,b(e.target.value))},onBlur:function(e){P&&P(e),A.onBlur&&A.onBlur(e)},type:"number",ref:h,value:m,className:W.join(" "),...A}),u&&(0,a.jsx)(l.A,{size:v,icon:u}),c||j?(0,a.jsxs)("div",{className:N.actions_container,children:[c&&(0,a.jsx)(i.A,{size:v}),j&&j]}):null]})})})}},81672:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},84156:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eo});var a=s(80263),n=s(72112),r=s(73402),i=s(22891),l=s(23729),o=s(50795),d=s(64778),c=s(18563),u=s(37631),h=s(97492),p=s(51355),g=s(80210),y=s(24523),x=s(30659);async function f(e){let{projectRef:t,jwtSecret:s,changeTrackingId:a}=e,{data:n,error:r}=await (0,y.F6)("/platform/projects/{ref}/config/secrets",{params:{path:{ref:t}},body:{jwt_secret:s,change_tracking_id:a}});return r&&(0,y.H4)(r),n}let m=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,p.jE)();return(0,g.n)({mutationFn:e=>f(e),async onSuccess(t,s,n){let{projectRef:r}=s;await a.invalidateQueries({queryKey:x.n.jwtSecretUpdatingStatus(r)}),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){await (null==t?void 0:t(e,s,a))},...s})};var j=s(75544),v=s(94636),b=s(11053),w=s(80090),k=s(6436),A=s(12123),N=s(86510),S=s(73886),T=s(76174),J=s(81672),P=s(86848);let I=(0,P.A)("PenTool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);var C=s(63159);let W=(0,P.A)("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]),_=(0,P.A)("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),L=(0,P.A)("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);var F=s(60656),R=s(72715),E=s(93901),U=s(23169),K=s(52555),z=s.n(K),M=s(53239),q=s(73969),G=s(49151),O=s(99779),V=s(80421),Z=s(76885),Q=s(21162),$=s(6217),B=s(44725),D=s(94335),H=s(86692),X=s(25580),Y=s(60254);let ee=(0,H.Ik)({JWT_EXP:(0,H.ai)().max(604800,"Must be less than 604800").required("Must have a JWT expiry value")}),et=()=>{var e;let{ref:t}=(0,i.g)(),s=(0,i._P)("newJwtSecrets"),[p,g]=(0,M.useState)(""),[y,x]=(0,M.useState)(!1),[f,P]=(0,M.useState)(!1),[K,H]=(0,M.useState)(!1),{can:et}=(0,w.Qp)(n.aG.READ,"field.jwt_secret"),{can:es}=(0,w.Qp)(n.aG.INFRA_EXECUTE,"queue_job.projects.update_jwt"),{can:ea}=(0,w.Qp)(n.aG.UPDATE,"custom_config_gotrue"),{data:en}=(0,j.l)({projectRef:t}),{data:er,isError:ei}=(0,v.y)({projectRef:t}),{mutateAsync:el,isPending:eo}=m(),{canReadAPIKeys:ed}=(0,X.u)(),{data:ec}=(0,b.o)({projectRef:t},{enabled:ed}),{data:eu}=(0,c.L)({projectRef:t},{enabled:ed}),{data:eh,isLoading:ep}=(0,u.op)({projectRef:t}),{mutate:eg,isPending:ey}=(0,h.U)(),{Failed:ex,Updated:ef,Updating:em}=r.bh,ej=(null==en?void 0:en.jwtSecretUpdateStatus)===ex,ev=(null==en?void 0:en.jwtSecretUpdateStatus)===void 0||(null==en?void 0:en.jwtSecretUpdateStatus)===ef,eb=(null==en?void 0:en.jwtSecretUpdateStatus)===em,ew=Y.Vi[null==en?void 0:en.jwtSecretUpdateError],ek=Y.uD[null==en?void 0:en.jwtSecretUpdateProgress],eA={JWT_EXP:null!=(e=null==eh?void 0:eh.JWT_EXP)?e:3600},eN=async(e,s)=>{let{resetForm:a}=s;if(!t)return console.error("Project ref is required");eg({projectRef:t,config:e},{onError:e=>{q.oR.error("Failed to update JWT expiry: ".concat(null==e?void 0:e.message))},onSuccess:()=>{q.oR.success("Successfully updated JWT expiry"),a({values:e,initialValues:e})}})};async function eS(e,s){if(!t)return console.error("Project ref is required");let a=(0,k.gZ)();try{await el({projectRef:t,jwtSecret:e,changeTrackingId:a}),s(!1),(0,q.oR)("Successfully submitted JWT secret update request. Please wait while your project is updated.")}catch(e){q.oR.error("Failed to update JWT secret: ".concat(e.message))}}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(G.A,{id:"jwt-exp-form",initialValues:eA,onSubmit:eN,validationSchema:ee,"data-sentry-element":"Form","data-sentry-source-file":"jwt-settings.tsx",children:e=>{let{handleReset:n,values:r,initialValues:i}=e,c=JSON.stringify(r)!==JSON.stringify(i);return(0,a.jsx)(d.A,{footer:(0,a.jsx)("div",{className:"flex py-4 w-full",children:(0,a.jsx)(o.I,{form:"jwt-exp-form",isSubmitting:ey,hasChanges:c,handleReset:n,disabled:!ea,helper:ea?void 0:"You need additional permissions to update JWT settings"})}),children:(0,a.jsx)(d.A.Content,{className:"space-y-6 border-t border-panel-border-interior-light [[data-theme*=dark]_&]:border-panel-border-interior-dark",children:ei?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8 space-x-2",children:[(0,a.jsx)(A.A,{size:16,strokeWidth:1.5}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Failed to retrieve JWT settings"})]}):(0,a.jsxs)(a.Fragment,{children:[ec&&"revoked"!==ec.status&&(0,a.jsxs)(B.Z,{type:"warning",title:"Legacy JWT secret has been migrated to new JWT Signing Keys",children:[(0,a.jsxs)("p",{className:"!leading-normal",children:["Changing the legacy JWT secret can only be done by rotating to a standby key and then revoking it. It is used to"," ",(0,a.jsx)("em",{className:"text-foreground not-italic",children:"in_use"===ec.status?"sign and verify":"only verify"})," ","JSON Web Tokens by Supabase products."]}),eu&&eu.enabled&&(0,a.jsxs)("p",{className:"!leading-normal",children:[(0,a.jsxs)("em",{className:"text-warning not-italic",children:["This includes the ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," JWT based API keys."]})," ","Consider switching to publishable and secret API keys to disable them."]}),(0,a.jsx)(O.$,{type:"default",asChild:!0,icon:(0,a.jsx)(N.A,{className:"size-4"}),children:(0,a.jsx)(z(),{href:"/project/".concat(t,"/settings/api-keys"),children:"Go to API keys"})})]}),ec&&"revoked"===ec.status&&(0,a.jsx)(B.Z,{type:"note",title:"Your project has revoked the legacy JWT secret",description:"No new JSON Web Tokens are issued nor verified with it by Supabase products."}),(0,a.jsx)(V.A,{label:(null==ec?void 0:ec.status)==="revoked"?"Revoked legacy JWT secret":ec?"Legacy JWT secret (still used)":"Legacy JWT secret",readOnly:!0,copy:et&&ev,reveal:et&&ev,disabled:!0,value:et?ej?"JWT secret update failed":eb?"Updating JWT secret...":(null==er?void 0:er.jwt_secret)||"":"You need additional permissions to view the JWT secret",className:"input-mono",descriptionText:(null==ec?void 0:ec.status)==="revoked"?"No longer used to sign JWTs by Supabase Auth.":ec&&"in_use"!==ec.status?"Used only to verify JWTs.":"Used to sign and verify JWTs issued by Supabase Auth.",layout:"horizontal"}),(0,a.jsx)(Z.A,{id:"JWT_EXP",name:"JWT_EXP",size:"small",label:"Access token expiry time",descriptionText:"How long access tokens are valid for before a refresh token has to be used. Recommendation: 3600 (1 hour).",layout:"horizontal",actions:(0,a.jsx)("span",{className:"mr-3 text-foreground-lighter",children:"seconds"}),disabled:!ea||ep}),s&&!ec&&(0,a.jsxs)(a.Fragment,{children:[eb&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(S.A,{className:"animate-spin",size:14}),(0,a.jsxs)("p",{className:"text-sm",children:["Updating JWT secret: ",ek]})]}),ej&&(0,a.jsxs)(B.Z,{type:"warning",title:"Failed to update JWT secret",children:["Please try again. If the failures persist, please contact Supabase support with the following details: ",(0,a.jsx)("br",{}),"Change tracking ID: ",null==en?void 0:en.changeTrackingId," ",(0,a.jsx)("br",{}),"Error message: ",ew]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 border rounded-md bg p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h4",{className:"text-sm",children:"How to change your JWT secret?"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Instead of changing the legacy JWT secret use a combination of the JWT Signing Keys and API keys features. Consider these advantages:"}),(0,a.jsxs)("ul",{className:"text-sm text-foreground-light list-disc list-inside",children:[(0,a.jsx)("li",{children:"Zero-downtime, reversible change."}),(0,a.jsx)("li",{children:"Users remain signed in and bad actors out."}),(0,a.jsx)("li",{children:"Create multiple secret API keys that are immediately revocable and fully covered by audit logs."}),(0,a.jsx)("li",{children:"Private keys and shared secrets are no longer visible by organization members, so they can't leak."}),(0,a.jsx)("li",{children:"Maintain tighter alignment with SOC2 and other security compliance frameworks."}),(0,a.jsxs)("li",{children:["Improve app's performance by using public keys to verify JWTs instead of calling ",(0,a.jsx)("code",{children:"getUser()"}),"."]})]})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(O.$,{type:"default",icon:(0,a.jsx)(N.A,{className:"size-4"}),asChild:!0,children:(0,a.jsx)(z(),{href:"/project/".concat(t,"/settings/api-keys/new"),children:"Go to API Keys"})}),(0,a.jsx)(O.$,{type:"default",icon:(0,a.jsx)(N.A,{className:"size-4"}),asChild:!0,children:(0,a.jsx)(z(),{href:"/project/".concat(t,"/settings/jwt/signing-keys"),children:"Go to JWT Signing Keys"})}),(0,a.jsx)("div",{className:"grow"}),(0,a.jsxs)(Q.rI,{children:[(0,a.jsx)(Q.ty,{asChild:!0,children:(0,a.jsx)(l.G,{disabled:!es,type:"default",iconRight:(0,a.jsx)(T.A,{size:14}),loading:eb,tooltip:{content:{side:"bottom",text:es?void 0:"You need additional permissions to generate a new JWT secret"}},children:"Change legacy JWT secret"})}),(0,a.jsxs)(Q.SQ,{align:"end",side:"bottom",children:[(0,a.jsxs)(Q._2,{className:"space-x-2",onClick:()=>H(!0),children:[(0,a.jsx)(J.A,{size:16}),(0,a.jsx)("p",{children:"Generate a random secret"})]}),(0,a.jsx)(Q.mB,{}),(0,a.jsxs)(Q._2,{className:"space-x-2",onClick:()=>P(!0),children:[(0,a.jsx)(I,{size:16}),(0,a.jsx)("p",{children:"Create my own secret"})]})]})]})]})]})]}),!s&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"p-3 px-6 border rounded-md shadow-sm bg-studio",children:eb?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(S.A,{className:"animate-spin",size:14}),(0,a.jsxs)("p",{className:"text-sm",children:["Updating JWT secret: ",ek]})]}):(0,a.jsx)("div",{className:"w-full space-y-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Generate a new JWT secret"}),(0,a.jsx)("p",{className:"text-sm opacity-50",children:"A random secret will be created, or you can create your own."})]}),(0,a.jsx)("div",{className:"flex flex-col items-end",children:eb?(0,a.jsx)(O.$,{loading:!0,type:"secondary",children:"Updating JWT secret..."}):es?(0,a.jsxs)(Q.rI,{children:[(0,a.jsx)(Q.ty,{asChild:!0,children:(0,a.jsx)(O.$,{type:"default",iconRight:(0,a.jsx)(T.A,{size:14}),children:(0,a.jsx)("span",{children:"Generate a new secret"})})}),(0,a.jsxs)(Q.SQ,{align:"end",side:"bottom",children:[(0,a.jsxs)(Q._2,{className:"space-x-2",onClick:()=>H(!0),children:[(0,a.jsx)(J.A,{size:16}),(0,a.jsx)("p",{children:"Generate a random secret"})]}),(0,a.jsx)(Q.mB,{}),(0,a.jsxs)(Q._2,{className:"space-x-2",onClick:()=>P(!0),children:[(0,a.jsx)(I,{size:16}),(0,a.jsx)("p",{children:"Create my own secret"})]})]})]}):(0,a.jsx)(l.G,{disabled:!0,type:"default",iconRight:(0,a.jsx)(T.A,{size:14}),tooltip:{content:{side:"bottom",text:"You need additional permissions to generate a new JWT secret"}},children:"Generate a new secret"})})]})})}),ej?(0,a.jsxs)(B.Z,{type:"warning",title:"Failed to update JWT secret",children:["Please try again. If the failures persist, please contact Supabase support with the following details: ",(0,a.jsx)("br",{}),"Change tracking ID: ",null==en?void 0:en.changeTrackingId," ",(0,a.jsx)("br",{}),"Error message: ",ew]}):null]})]})})})}},null==eh?void 0:eh.JWT_EXP),(0,a.jsx)(D.A,{variant:"destructive",size:"large",visible:K,title:"Confirm legacy JWT secret change",confirmString:"I understand and wish to proceed",confirmLabel:p?"Apply custom secret":"Generate random secret",confirmPlaceholder:"",loading:eo,onCancel:()=>{H(!1),g("")},onConfirm:()=>eS(p||"ROLL",H),"data-sentry-element":"TextConfirmModal","data-sentry-source-file":"jwt-settings.tsx",children:(0,a.jsxs)("ul",{className:"space-y-4 text-sm",children:[(0,a.jsxs)("li",{className:"flex gap-2 bg border rounded-md p-4",children:[(0,a.jsx)(C.A,{size:24,className:"flex-shrink-0 text-brand","data-sentry-element":"Lightbulb","data-sentry-source-file":"jwt-settings.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{children:"Use new JWT Signing Keys and API Keys instead"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["Consider using a combination of the JWT Signing Keys and API Keys features to achieve the same effect."," ",(0,a.jsx)("em",{className:"text-brand not-italic",children:"Some or all of the warnings listed below might not apply when using these features"}),"."]})]})]}),(0,a.jsxs)("li",{className:"flex gap-2 px-4",children:[(0,a.jsx)(W,{size:24,className:"text-foreground-light flex-shrink-0","data-sentry-element":"CloudOff","data-sentry-source-file":"jwt-settings.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{children:"Your application will experience significant downtime"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["As new ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," keys will be created and the existing ones permanently destroyed, your application will stop functioning for the duration it takes you to swap them."," ",(0,a.jsx)("em",{className:"text-warning not-italic",children:"If you have a mobile, desktop, CLI or any offline-capable application the downtime may be more significant and dependent on app store reviews or user-initiated upgrades or downloads!"})]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"Currently active users will be forcefully signed out (inactive users will keep their sessions)."}),(0,a.jsx)("p",{className:"text-foreground-light",children:"All long-lived Storage pre-signed URLs will be permanently invalidated."})]})]}),(0,a.jsxs)("li",{className:"flex gap-2 px-4",children:[(0,a.jsx)(_,{size:24,className:"text-foreground-light flex-shrink-0","data-sentry-element":"Power","data-sentry-source-file":"jwt-settings.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{children:"Your project and database will be restarted"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["This process restarts your project, terminating existing connections to your database. You may see API or other unusual errors for"," ",(0,a.jsx)("em",{className:"text-warning not-italic",children:"up to 2 minutes"})," while the new secret is deployed."]})]})]}),(0,a.jsxs)("li",{className:"flex gap-2 px-4",children:[(0,a.jsx)(L,{size:24,className:"text-foreground-light flex-shrink-0","data-sentry-element":"Hourglass","data-sentry-source-file":"jwt-settings.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{children:"20-minute cooldown period"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"Should you need to revert or repeat this operation, it will take at least 20 minutes before you're able to do so again."})]})]}),(0,a.jsxs)("li",{className:"flex gap-2 px-4",children:[(0,a.jsx)(F.A,{size:24,className:"text-foreground-light flex-shrink-0","data-sentry-element":"TriangleAlert","data-sentry-source-file":"jwt-settings.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{children:"Irreversible change! This cannot be undone!"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["The old JWT secret will be permanently lost (unless you've saved it prior). Even if you use it again the ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," API keys"," ",(0,a.jsx)("em",{className:"text-warning not-italic",children:"will not be restorable"})," to their exact values."]})]})]})]})}),(0,a.jsx)($.A,{header:"Pick a new JWT secret",visible:f,size:"medium",variant:"danger",onCancel:()=>{P(!1),g("")},loading:eo,customFooter:(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(O.$,{type:"default",onClick:()=>{P(!1),g("")},children:"Cancel"}),(0,a.jsx)(O.$,{type:"primary",disabled:p.length<32||p.includes("@")||p.includes("$"),loading:eo,onClick:()=>{H(!0),P(!1)},children:"Proceed to final confirmation"})]}),"data-sentry-element":"Modal","data-sentry-source-file":"jwt-settings.tsx",children:(0,a.jsxs)($.A.Content,{className:"space-y-2","data-sentry-element":"Modal.Content","data-sentry-source-file":"jwt-settings.tsx",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Pick a new custom JWT secret. Make sure it is a strong combination of characters that cannot be guessed easily."}),(0,a.jsx)(V.A,{onChange:e=>g(e.target.value),value:p,icon:(0,a.jsx)(R.A,{}),type:y?"text":"password",className:"w-full text-left",label:"Custom JWT secret",descriptionText:"Minimally 32 characters long, '@' and '$' are not allowed.",actions:(0,a.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,a.jsx)(O.$,{type:"default",icon:y?(0,a.jsx)(E.A,{}):(0,a.jsx)(U.A,{}),onClick:()=>x(!y)})}),"data-sentry-element":"Input","data-sentry-source-file":"jwt-settings.tsx"})]})})]})};var es=s(10508),ea=s(50442),en=s(43479),er=s(42459),ei=s(2657);let el=()=>{let e=(0,p.jE)(),{ref:t}=(0,i.g)(),{projectSettingsLegacyJwtKeys:s}=(0,ei.x)(["project_settings:legacy_jwt_keys"]),{data:n}=(0,j.l)({projectRef:t},{enabled:s}),l=null==n?void 0:n.jwtSecretUpdateStatus,o=null==n?void 0:n.jwtSecretUpdateError,d=(0,M.useRef)(),{Failed:c,Updated:u,Updating:h}=r.bh,g=Y.Vi[o];return((0,M.useEffect)(()=>{if(d.current===h)switch(l){case u:e.invalidateQueries({queryKey:x.n.api(t)}),e.invalidateQueries({queryKey:x.n.settings(t)}),e.invalidateQueries({queryKey:x.n.postgrest(t)}),q.oR.success("Successfully updated JWT secret");break;case c:q.oR.error("JWT secret update failed: ".concat(g))}d.current=l},[l]),s)?(0,a.jsx)(ea.A,{"data-sentry-element":"JWTKeysLayout","data-sentry-component":"JWTKeysLegacyPage","data-sentry-source-file":"index.tsx",children:(0,a.jsx)(et,{"data-sentry-element":"JWTSettings","data-sentry-source-file":"index.tsx"})}):(0,a.jsx)(er.c,{urlBack:"/project/".concat(t,"/settings/jwt/signing-keys")})};el.getLayout=e=>(0,a.jsx)(es.A,{children:(0,a.jsx)(en.A,{children:e})});let eo=el}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,2838,21436,57459,86692,76984,72391,35035,40545,596,10508,48340,75187,29471,8750,50143,90636,46593,38792],()=>e(e.s=17812)),_N_E=e.O()}]);