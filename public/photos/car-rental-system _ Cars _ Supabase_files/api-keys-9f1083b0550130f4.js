try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ea7811ae-db76-4a88-9cee-acf1e761faa0",e._sentryDebugIdIdentifier="sentry-dbid-ea7811ae-db76-4a88-9cee-acf1e761faa0")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3495],{658:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var a=s(80263),n=s(26750),r=s(10508),i=s(43479),l=s(41803),o=s(72112),d=s(53239),c=s(73969),y=s(22891),u=s(25580),g=s(23729),p=s(51355),b=s(80210),f=s(24523),h=s(93284);async function x(e){if(!e.projectRef)throw Error("projectRef is required");let{data:t,error:s}=await (0,f.yJ)("/v1/projects/{ref}/api-keys/legacy",{params:{path:{ref:e.projectRef},query:{enabled:e.enabled}}});return s&&(0,f.H4)(s),t}let m=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,p.jE)();return(0,b.n)({mutationFn:e=>x(e),async onSuccess(t,s,n){let{projectRef:r}=s;await a.invalidateQueries({queryKey:h.f.status(r)}),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?c.oR.error("Failed to ".concat(s.enabled?"re-enable":"disable"," JWT-based API keys: ").concat(e.message)):t(e,s,a)},...s})};var j=s(18563),A=s(11053),v=s(53169),k=s(80090),T=s(84512),w=s(22806),_=s(94335),I=s(64778);let K=()=>{let{ref:e}=(0,y.g)(),{data:t}=(0,T.s)(),[s,n]=(0,d.useState)(!1),[r,i]=(0,d.useState)(!1),{canReadAPIKeys:l}=(0,u.u)(),{can:c,isSuccess:p}=(0,k.Qp)(o.aG.SECRETS_WRITE,"*"),{data:b,isSuccess:f}=(0,j.L)({projectRef:e},{enabled:l}),{data:h}=(0,A.o)({projectRef:e},{enabled:l}),{data:x=[],isSuccess:m}=(0,v.n)({slug:null==t?void 0:t.slug}),{enabled:_}=b||{};return f&&p&&m?(0,a.jsxs)("section",{"data-sentry-component":"ToggleLegacyApiKeysPanel","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsx)(I.A,{"data-sentry-element":"Panel","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:(0,a.jsx)(I.A.Content,{"data-sentry-element":"Panel.Content","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{className:"text-sm",children:_?"Disable legacy API keys":"Re-enabling legacy API keys"}),(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:_?"Make sure you are no longer using your legacy API keys before proceeding.":"We recommend you use the new API keys whenever possible, but re-enabling is an option."})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(g.G,{type:"default",onClick:(null==x?void 0:x.length)?()=>i(!0):()=>n(!0),disabled:!c||!_&&(null==h?void 0:h.status)==="revoked",tooltip:{content:{side:"bottom",text:c?_||(null==h?void 0:h.status)!=="revoked"?void 0:"The legacy JWT secret is revoked. Re-enabling is not possible until it is at least moved to previously used.":"You need additional permissions to enable or disable JWT-based API keys"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:b.enabled?"Disable JWT-based API keys":"Re-enable JWT-based API keys"})})]})})}),(0,a.jsx)(P,{visible:s,onClose:()=>n(!1),legacyAPIKeysStatusData:b,"data-sentry-element":"ToggleApiKeysModal","data-sentry-source-file":"ToggleLegacyApiKeys.tsx"}),(0,a.jsx)(w.Lt,{open:r,onOpenChange:e=>i(e),"data-sentry-element":"AlertDialog","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:(0,a.jsxs)(w.EO,{"data-sentry-element":"AlertDialogContent","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsxs)(w.wd,{"data-sentry-element":"AlertDialogHeader","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsx)(w.r7,{"data-sentry-element":"AlertDialogTitle","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Apps using Supabase may break"}),(0,a.jsx)(w.$v,{"data-sentry-element":"AlertDialogDescription","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Your project uses apps that integrate with Supabase. Disabling the legacy API keys is a brand new feature and the apps you're using may not have added support for this yet. It can cause them to stop functioning. Check before continuing."})]}),(0,a.jsxs)(w.ck,{"data-sentry-element":"AlertDialogFooter","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsx)(w.Zr,{"data-sentry-element":"AlertDialogCancel","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Cancel"}),(0,a.jsx)(w.Rx,{onClick:()=>n(!0),"data-sentry-element":"AlertDialogAction","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Proceed to disable API keys"})]})]})})]}):null},P=e=>{let{visible:t,onClose:s,legacyAPIKeysStatusData:n}=e,{ref:r}=(0,y.g)(),{enabled:i}=n||{},{mutate:l,isPending:o}=m();return(0,a.jsx)(_.A,{size:"medium",visible:t,onCancel:()=>s(),onConfirm:()=>{let e=!(null==n?void 0:n.enabled);l({projectRef:r,enabled:e},{onSuccess:()=>{c.oR.success(e?"Your anon and service_role keys have been re-enabled!":"Your anon and service_role keys have been disabled!"),s()}})},title:i?"Disable JWT-based keys":"Re-enable JWT-based keys",confirmString:i?"disable":"re-enable",confirmLabel:"Confirm to ".concat(i?"disable":"re-enable"," anon and service_role"),confirmPlaceholder:i?"disable":"re-enable",loading:o,variant:i?"destructive":"default",alert:i?{title:"Ensure legacy keys are no longer in use before disabling",description:(0,a.jsxs)("span",{className:"prose text-sm",children:["Disabling ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," keys while they are in use will cause downtime for your application. Ensure they are no longer in use before proceeding. If you have not created a publishable and at least one secret API key, some dashboard functionality may become unavailable.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-danger",children:["This disables API keys when used in the ",(0,a.jsx)("code",{children:"apikey"})," header. They remain valid as a JWT."]})]})}:{title:"Publishable and secret keys are preferred",description:(0,a.jsxs)("span",{className:"prose text-sm",children:["Re-enabling ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," keys may be appropriate in certain cases, but using a publishable and secret key is more secure. We recommend against re-enabling legacy API keys."]})},"data-sentry-element":"TextConfirmModal","data-sentry-component":"ToggleApiKeysModal","data-sentry-source-file":"ToggleLegacyApiKeys.tsx"})};var D=s(2657);let L=()=>{let{projectSettingsShowDisableLegacyApiKeys:e}=(0,D.x)(["project_settings:show_disable_legacy_api_keys"]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.K,{showTitle:!1,showNotice:!1,"data-sentry-element":"DisplayApiSettings","data-sentry-source-file":"index.tsx"}),e&&(0,a.jsx)(K,{})]})};L.getLayout=e=>(0,a.jsx)(r.A,{children:(0,a.jsx)(i.A,{children:(0,a.jsx)(n.A,{children:e})})});let E=L},11053:(e,t,s)=>{"use strict";s.d(t,{o:()=>l});var a=s(67850),n=s(24523),r=s(24735);async function i(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:r}=await (0,n.Jt)("/v1/projects/{ref}/config/auth/signing-keys/legacy",{params:{path:{ref:s}},signal:t});return r&&(0,n.H4)(r),a}let l=function(e){let{projectRef:t}=e,{enabled:s,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.H.legacy(t),queryFn:e=>{let{signal:s}=e;return i({projectRef:t},s)},enabled:s&&!!t,retry:!1,refetchOnWindowFocus:!1,...n})}},18563:(e,t,s)=>{"use strict";s.d(t,{L:()=>o});var a=s(67850),n=s(24523),r=s(85039),i=s(93284);async function l(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:r}=await (0,n.Jt)("/v1/projects/{ref}/api-keys/legacy",{params:{path:{ref:s}},signal:t});return r&&(0,n.H4)(r),a}let o=function(e){let{projectRef:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:i.f.status(t),queryFn:e=>{let{signal:s}=e;return l({projectRef:t},s)},enabled:r.pe&&s&&void 0!==t,...n})}},24735:(e,t,s)=>{"use strict";s.d(t,{H:()=>a});let a={list:e=>["projects",e,"jwt-signing-keys"],legacy:e=>["projects",e,"legacy-jwt-signing-key"]}},40884:(e,t,s)=>{"use strict";s.d(t,{R:()=>a});let a={oauthApps:e=>[e,"oauth-apps"],authorizedApps:e=>[e,"authorized-apps"]}},53169:(e,t,s)=>{"use strict";s.d(t,{n:()=>l});var a=s(67850),n=s(24523),r=s(40884);async function i(e,t){let{slug:s}=e;if(!s)throw Error("Organization slug is required");let{data:a,error:r}=await (0,n.Jt)("/platform/organizations/{slug}/oauth/apps",{params:{path:{slug:s},query:{type:"authorized"}}});return r&&(0,n.H4)(r),a}let l=function(e){let{slug:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.R.authorizedApps(t),queryFn:e=>{let{signal:s}=e;return i({slug:t},s)},enabled:s&&void 0!==t,...n})}},95059:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/settings/api-keys",function(){return s(658)}])}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,76984,72391,35035,40545,596,10508,48340,75187,29471,8750,72544,90636,46593,38792],()=>e(e.s=95059)),_N_E=e.O()}]);