try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c174b276-ee13-4a69-b1f9-1fd65a1b5617",e._sentryDebugIdIdentifier="sentry-dbid-c174b276-ee13-4a69-b1f9-1fd65a1b5617")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[57651],{1374:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]])},6740:(e,t,s)=>{"use strict";s.d(t,{G:()=>i,S:()=>r});var a=s(80263),n=s(53239);let l=(0,n.createContext)(null),i=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("usePoliciesData must be used within PoliciesDataProvider");return e},r=e=>{let{children:t,policies:s,isPoliciesLoading:i,isPoliciesError:r,policiesError:o,exposedSchemas:c}=e,d=(0,n.useMemo)(()=>{let e=new Map;for(let t of s){let s="".concat(t.schema,".").concat(t.table),a=e.get(s);a?a.push(t):e.set(s,[t])}for(let t of e.values())t.sort((e,t)=>e.name.localeCompare(t.name));return e},[s]),u=(0,n.useCallback)((e,t)=>{var s;return null!=(s=d.get("".concat(e,".").concat(t)))?s:[]},[d]),x=(0,n.useMemo)(()=>new Set(c),[c]),m=(0,n.useMemo)(()=>({getPoliciesForTable:u,isPoliciesLoading:i,isPoliciesError:r,policiesError:o,exposedSchemas:x}),[u,i,r,o,x]);return(0,a.jsx)(l.Provider,{value:m,"data-sentry-element":"PoliciesDataContext.Provider","data-sentry-component":"PoliciesDataProvider","data-sentry-source-file":"PoliciesDataContext.tsx",children:t})}},6981:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/auth/policies",function(){return s(30146)}])},13655:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("CirclePause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]])},13656:(e,t,s)=>{"use strict";s.d(t,{s:()=>ew});var a=s(80263),n=s(32981),l=s(72112),i=s(51355),r=s(84305),o=s.n(r),c=s(53239),d=s(87494),u=s(73969),x=s(10663),m=s(22891),h=s(23729),p=s(38313),f=s(30399),y=s(85663),g=s(80090),_=s(9620),j=s(73036),v=s(65887),N=s(65346),b=s(80100),w=s(48156),S=s(883),k=s(99779),C=s(11101),A=s(97757),q=s(68421),P=s(11743);let E=e=>{let{schema:t,selectedPolicy:s,formFields:n}=e,l=void 0!==s,{name:i,table:r,behavior:o,command:c,roles:d}=n;return(0,a.jsxs)("div",{className:"bg-surface-300 pt-2 pb-1","data-sentry-component":"LockedCreateQuerySection","data-sentry-source-file":"LockedQuerySection.tsx",children:[(0,a.jsx)("div",{className:"flex items-center justify-between px-5 mb-1",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"pl-0.5 pr-5 flex items-center justify-center",children:(0,a.jsx)(P.A,{size:14,className:"text-foreground-lighter","data-sentry-element":"Lock","data-sentry-source-file":"LockedQuerySection.tsx"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter font-mono uppercase",children:"Use options above to edit"})]})}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"1"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:l?"alter":"create"}),' policy "',0===i.length?"policy_name":i,'"']})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"2"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"on"}),' "',t,'"."',r,'"']})]}),!l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"3"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"as"})," ",o.toLocaleUpperCase()]})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"4"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"for"})," ",c.toLocaleUpperCase()]})]})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"5"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"to"})," ",0===d.length?"public":d]})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"6"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"insert"===c?"with check":"using"})," ",(0,a.jsx)("span",{className:"text-[#ffd700]",children:"("})]})]})]})},L=e=>{let{oldName:t,newName:s,schema:n,table:l,lineNumber:i}=e;return(0,a.jsxs)("div",{className:"bg-surface-300 py-1","data-sentry-component":"LockedRenameQuerySection","data-sentry-source-file":"LockedQuerySection.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:i})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"alter"}),' policy "',t,'"']})]}),(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:i+1})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"on"}),' "',n,'"."',l,'"']})]}),(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:i+2})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"rename"}),' to "',s,'";']})]})]})};var T=s(32157),R=s(23892),M=s(4322),z=s(49810),I=s(27371),D=s(61548),V=s(29244),F=s(66329),O=s(23812),Q=s(54207);let H=e=>{let{schema:t,searchString:s,selectedTable:n,isEditing:i,form:r,onUpdateCommand:o,authContext:d}=e,{data:u}=(0,_.YA)(),[x,m]=(0,c.useState)(!1),{can:h}=(0,g.Qp)(l.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{data:p,isSuccess:f}=(0,z.LW)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,schema:t,sortByProperty:"name",includeColumns:!0}),{data:y}=(0,M._X)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString}),j=(null!=y?y:[]).map(e=>({id:e.id,name:e.name,value:e.name,disabled:!1})).sort((e,t)=>e.name.localeCompare(t.name));return(0,c.useEffect)(()=>{if(!i&&void 0===n){let e=null==p?void 0:p.find(e=>e.schema===t&&(e.id.toString()===s||e.name===s));e?r.setValue("table",e.name):f&&p.length>0&&r.setValue("table",p[0].name)}},[i,r,s,p,f,n]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"px-5 py-5 flex flex-col gap-y-4 border-b",children:(0,a.jsxs)("div",{className:"items-start justify-between gap-4 grid grid-cols-12",children:[(0,a.jsx)(v.zB,{control:r.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(v.eI,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,a.jsx)(v.lR,{children:"Policy Name"}),(0,a.jsx)(v.MJ,{children:(0,a.jsx)(I.p,{...t,disabled:!h,className:"bg-control border-control",placeholder:"Provide a name for your policy"})}),(0,a.jsx)(v.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(v.zB,{control:r.control,name:"table",render:e=>{let{field:s}=e;return(0,a.jsxs)(v.eI,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,a.jsxs)(v.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Table"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"on"})," clause"]})]}),"database"===d&&(0,a.jsx)(v.MJ,{children:(0,a.jsxs)(D.AM,{open:x,onOpenChange:m,modal:!1,children:[(0,a.jsx)(D.Wv,{asChild:!0,children:(0,a.jsx)(k.$,{type:"default",disabled:!h,className:"w-full [&>span]:w-full h-[38px] text-sm",iconRight:(0,a.jsx)(T.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:(0,a.jsx)("div",{className:"w-full flex gap-1",children:(0,a.jsxs)("span",{className:"text-foreground",children:[t,".",s.value]})})})}),(0,a.jsx)(D.hl,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,a.jsxs)(V.uB,{children:[(0,a.jsx)(V.G7,{placeholder:"Find a table..."}),(0,a.jsxs)(V.oI,{children:[(0,a.jsx)(V.xL,{children:"No tables found"}),(0,a.jsx)(V.L$,{children:(0,a.jsx)(A.FK,{className:(null!=p?p:[]).length>7?"h-[200px]":"",children:(null!=p?p:[]).map(e=>(0,a.jsx)(V.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{r.setValue("table",e.name),m(!1)},onClick:()=>{r.setValue("table",e.name),m(!1)},children:(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[s.value===e.name?(0,a.jsx)(R.A,{size:13}):"",e.name]})},e.id))})})]})]})})]})}),"realtime"===d&&(0,a.jsx)(v.MJ,{children:(0,a.jsx)(I.p,{disabled:!0,value:"messages.realtime",className:"bg-control border-control"})}),(0,a.jsx)(v.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(v.zB,{control:r.control,name:"behavior",render:e=>{let{field:t}=e;return(0,a.jsxs)(v.eI,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,a.jsxs)(v.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Policy Behavior"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"as"})," clause"]})]}),(0,a.jsx)(v.MJ,{children:(0,a.jsxs)(F.l6,{disabled:i,value:t.value,onValueChange:e=>r.setValue("behavior",e),children:[(0,a.jsx)(F.bq,{className:"text-sm h-10 capitalize",children:t.value}),(0,a.jsx)(F.gC,{children:(0,a.jsxs)(F.s3,{children:[(0,a.jsxs)(F.eb,{value:"permissive",className:"text-sm",children:[(0,a.jsx)("p",{children:"Permissive"}),(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:'Policies are combined using the "OR" Boolean operator'})]}),(0,a.jsxs)(F.eb,{value:"restrictive",className:"text-sm",children:[(0,a.jsx)("p",{children:"Restrictive"}),(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:'Policies are combined using the "AND" Boolean operator'})]})]})})]})}),(0,a.jsx)(v.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(v.zB,{control:r.control,name:"command",render:e=>{let{field:t}=e;return(0,a.jsxs)(v.eI,{className:"col-span-12 flex flex-col gap-y-1",children:[(0,a.jsxs)(v.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Policy Command"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"for"})," clause"]})]}),(0,a.jsx)(v.MJ,{children:(0,a.jsx)(O.z6,{disabled:i,value:t.value,defaultValue:t.value,onValueChange:e=>{r.setValue("command",e),o(e)},className:"grid grid-cols-10 gap-3 ".concat(i?"opacity-50":""),children:["select","insert",..."database"===d?["update","delete","all"]:[]].map(e=>(0,a.jsx)(O.Dv,{value:e,disabled:i,label:e.toLocaleUpperCase(),className:"col-span-2 w-auto ".concat(i?"cursor-not-allowed":"")},e))})}),(0,a.jsx)(v.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(v.zB,{control:r.control,name:"roles",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(v.eI,{className:"col-span-12 flex flex-col gap-y-1",children:[(0,a.jsxs)(v.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Target Roles"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"to"})," clause"]})]}),(0,a.jsx)(v.MJ,{children:(0,a.jsx)(Q._,{disabled:!h,options:j,value:0===s.value.length?[]:null==(t=s.value)?void 0:t.split(", "),placeholder:"Defaults to all (public) roles if none selected",searchPlaceholder:"Search for a role",onChange:e=>r.setValue("roles",e.join(", "))})}),(0,a.jsx)(v.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"})]})})})};var B=s(68152),W=s(76174),G=s(39353);let Y=(0,s(86848).A)("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);var U=s(66755),K=s(30404);let $=e=>{var t;let{selectedPolicy:s,showTools:n,setShowTools:l}=e,[i,r]=(0,c.useState)(!1);return(0,a.jsxs)(N.Fm,{className:(0,b.cn)("py-3 flex flex-row justify-between items-start border-b"),"data-sentry-element":"SheetHeader","data-sentry-component":"PolicyEditorPanelHeader","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-3 max-w-[75%] items-start",children:[(0,a.jsxs)(N.kN,{className:(0,b.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","transition disabled:pointer-events-none data-[state=open]:bg-secondary","mt-1.5"),"data-sentry-element":"SheetClose","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[(0,a.jsx)(B.A,{className:"h-3 w-3","data-sentry-element":"X","data-sentry-source-file":"PolicyEditorPanelHeader.tsx"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,a.jsx)("div",{className:"h-[24px] w-[1px] bg-border-overlay"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(N.qp,{className:"truncate","data-sentry-element":"SheetTitle","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:void 0!==s?"Update policy: ".concat(s.name):"Create a new Row Level Security policy"}),void 0!==s&&(0,a.jsxs)(U.Nt,{className:"-mt-1.5 pb-1.5",open:i,onOpenChange:r,children:[(0,a.jsx)(U.R6,{className:"group  font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2 w-full",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"View policy details"}),(0,a.jsx)(W.A,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,a.jsx)(U.Ke,{className:"grid gap-1.5",children:(0,a.jsx)("div",{className:"flex my-2",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Name:"}),(0,a.jsx)("p",{className:"pr-4",children:null==s?void 0:s.name})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Action:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.action})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Command:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.command})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Target roles:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.roles.join(", ")})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"USING expression:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.definition})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 pt-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"CHECK expression:"}),(0,a.jsx)("p",{className:"".concat((null==s?void 0:s.check)?"":"text-foreground-light"," font-mono pr-4"),children:null!=(t=null==s?void 0:s.check)?t:"None"})]})]})})})]})]})]}),(0,a.jsxs)(K.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[(0,a.jsx)(K.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:(0,a.jsx)("button",{"aria-expanded":n,"aria-controls":"ai-chat-assistant",className:(0,b.cn)(n?"text-light":"text-foreground-lighter","mt-1 hover:text-foreground transition"),onClick:()=>l(!n),children:n?(0,a.jsx)(Y,{size:19,strokeWidth:1}):(0,a.jsx)(G.A,{size:19,strokeWidth:1})})}),(0,a.jsxs)(K.ZI,{side:"left","data-sentry-element":"TooltipContent","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[n?"Hide":"Show"," tools"]})]})]})};var Z=s(31092),X=s(80421),J=s(28243),ee=s(21650),et=s(29445),es=s(64982),ea=s(27519),en=s(89077),el=s(53626),ei=s(289);let er=e=>{let{schema:t,table:s,selectedPolicy:n,selectedTemplate:l,onSelectTemplate:i}=e,[r,o]=(0,c.useState)(""),d="realtime"===t?(0,ei.z_)():"pgmq"===t?(0,ei.$Q)():(0,ei.S3)(t,s.length>0?s:"table_name"),u=void 0!==n?d.filter(e=>e.command===n.command):d,x=r.length>0?u.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.command.toLowerCase().includes(r.toLowerCase())):u;return(0,a.jsxs)("div",{className:"h-full px-content py-content flex flex-col gap-3","data-sentry-component":"PolicyTemplates","data-sentry-source-file":"PolicyTemplates.tsx",children:[(0,a.jsx)("label",{className:"sr-only",htmlFor:"template-search",children:"Search templates"}),(0,a.jsx)(X.A,{size:"small",id:"template-search",icon:(0,a.jsx)(Z.A,{size:16,className:"text-foreground-muted"}),placeholder:"Search templates",value:r,onChange:e=>o(e.target.value),"data-sentry-element":"Input","data-sentry-source-file":"PolicyTemplates.tsx"}),r.length>0&&0===x.length&&(0,a.jsx)(en.o,{searchString:r,className:"min-w-full"}),(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:x.map(e=>(0,a.jsxs)(J.jc,{openDelay:100,closeDelay:100,children:[(0,a.jsx)(J.d0,{children:(0,a.jsx)(es.A,{title:e.name,titleClass:"text-sm",className:(0,b.cn)("transition w-full",e.id===l?"!border-stronger bg-surface-200 hover:!border-stronger":""),onClick:()=>i(e),hideChevron:!0,fixedHeight:!1,icon:(0,a.jsx)("div",{className:"min-w-16",children:(0,a.jsx)(ee.E,{className:(0,b.cn)("!rounded font-mono","UPDATE"===e.command?"bg-blue-400 text-blue-900 border border-blue-800":""),variant:"ALL"===e.command?"outline":"SELECT"===e.command?"brand":"UPDATE"===e.command?"default":"DELETE"===e.command?"destructive":"warning",children:e.command})}),children:(0,a.jsx)(et.o,{content:e.description,className:"[&>p]:m-0 space-y-2"})},e.id)}),(0,a.jsxs)(J.Et,{hideWhenDetached:!0,side:"left",align:"center",className:"w-[500px] flex",animate:"slide-in",children:[(0,a.jsx)(el.X,{showCopy:!1,className:"sql",parentClassName:"!p-0 [&>div>span]:text-xs",children:e.statement}),(0,a.jsx)(ea.A,{iconOnly:!0,type:"default",className:"px-1 absolute top-1.5 right-1.5",text:e.statement})]})]},e.id))})]})};var eo=s(53029),ec=s.n(eo),ed=s(88491),eu=s.n(ed),ex=s(15967),em=s.n(ex),eh=s(20033);let ep=e=>{var t,s,n,l;let{error:i,open:r,setOpen:o}=e,c=null!=(l=null==(t=null!=(n=null==i||null==(s=i.message)?void 0:s.split("\n"))?n:[])?void 0:t.filter(e=>e.length>0))?l:[];return(0,a.jsxs)("div",{className:"flex flex-col gap-y-3 px-5","data-sentry-component":"QueryError","data-sentry-source-file":"QueryError.tsx",children:[(0,a.jsxs)(eh.Fc,{variant:"destructive","data-sentry-element":"Alert_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5","data-sentry-element":"svg","data-sentry-source-file":"QueryError.tsx",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z","data-sentry-element":"path","data-sentry-source-file":"QueryError.tsx"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(eh.XL,{className:"m-0","data-sentry-element":"AlertTitle_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:"Error running SQL query"}),(0,a.jsxs)(U.Nt,{defaultOpen:!0,className:"flex flex-col gap-3",open:r,onOpenChange:()=>o(!r),"data-sentry-element":"Collapsible_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(U.R6,{asChild:!0,"data-sentry-element":"CollapsibleTrigger_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:(0,a.jsx)(k.$,{size:"tiny",type:"outline",className:(0,b.cn)("group",em()["ai-icon__container--allow-hover-effect"]),"data-sentry-element":"Button","data-sentry-source-file":"QueryError.tsx",children:r?"Hide error details":"Show error details"})})}),(0,a.jsx)(U.Ke,{className:"overflow-auto","data-sentry-element":"CollapsibleContent_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:c.length>0?c.map((e,t)=>(0,a.jsx)("pre",{className:"font-mono text-xs whitespace-pre-wrap",children:e.split(" ").reduce((e,t)=>{let s=eu()(e);return s&&"ERROR:"!==s?ec()(e).concat([[s,t].join(" ")]):""===s?e.concat([" "]):e.concat([t])},[]).map((e,t,s)=>(0,a.jsx)("span",{className:(0,b.cn)("break-all","ERROR:"===e&&"text-destructive"),children:e},t))},"error-".concat(t))):(0,a.jsx)("p",{className:"font-mono text-xs",children:i.error})})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto"})]})};var ef=s(14360),ey=s(83927),eg=s.n(ey),e_=s(48303);let ej=e=>{let{id:t,defaultValue:s,wrapperClassName:n,className:l,value:i,placeholder:r,readOnly:o=!1,disableTabToUsePlaceholder:d=!1,lineNumberStart:u,onChange:x=eg(),onMount:m=eg(),editorRef:h,monacoRef:p}=e,f=(0,c.useRef)(),y=(0,ef.useMonaco)(),g="monaco-placeholder-".concat(t),_=async(e,t)=>{h.current=e,void 0!==p&&(p.current=t),f.current=e.createContextKey("hasValue",!1);let s=document.getElementById(g);s&&void 0!==r&&0===(null!=i?i:"").trim().length&&(s.style.display="block"),d||e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(null!=r?r:"").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue"),e.focus(),m()};return(0,c.useEffect)(()=>{x()},[i]),(0,c.useEffect)(()=>{if(y){let e=y.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),s=(0,e_.A)(t);return[{range:e.getFullModelRange(),text:s.trim()}]}});return()=>{e.dispose()}}},[y]),(0,c.useEffect)(()=>{if(void 0!==i&&i.trim().length>0){let e=document.getElementById(g);e&&(e.style.display="none")}},[i]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ef.default,{path:t,theme:"supabase",wrapperProps:{className:(0,b.cn)(n)},className:(0,b.cn)(l,"monaco-editor"),value:null!=i?i:void 0,defaultLanguage:"pgsql",defaultValue:null!=s?s:void 0,options:{tabSize:2,fontSize:13,readOnly:o,minimap:{enabled:!1},wordWrap:"on",contextmenu:!0,lineNumbers:void 0!==u?e=>(e+u).toString():void 0,glyphMargin:void 0,lineNumbersMinChars:4,folding:void 0,scrollBeyondLastLine:!1},onMount:_,onChange:e=>{f.current.set((null!=e?e:"").length>0);let t=document.getElementById(g);t&&(e?t.style.display="none":t.style.display="block"),x()},"data-sentry-element":"Editor","data-sentry-source-file":"RLSCodeEditor.tsx"}),void 0!==r&&(0,a.jsx)("div",{id:g,className:(0,b.cn)("monaco-placeholder absolute top-[0px] left-[57px] text-sm pointer-events-none font-mono tracking-tighter","[&>div>p]:text-foreground-lighter [&>div>p]:!m-0"),style:{display:"none"},children:(0,a.jsx)(et.o,{content:r})})]})},ev="rls-editor",eN=x.Ik({name:x.Yj().min(1,"Please provide a name"),table:x.Yj(),behavior:x.Yj(),command:x.Yj(),roles:x.Yj()}),eb={name:"",table:"",behavior:"permissive",command:"select",roles:""},ew=(0,c.memo)(function(e){let{visible:t,schema:s,searchString:r,selectedTable:x,selectedPolicy:q,onSelectCancel:P,authContext:T}=e,{ref:R}=(0,m.g)(),M=(0,i.jE)(),{data:z}=(0,_.YA)(),{can:I}=(0,g.Qp)(l.aG.TENANT_SQL_ADMIN_WRITE,"tables"),[D,V]=(0,c.useState)(""),[F,O]=(0,c.useState)(""),[Q,B]=(0,c.useState)(),[W,G]=(0,c.useState)(!0),Y=(0,c.useRef)(null),U=(0,c.useRef)(null),[K,Z]=(0,c.useState)(1),[X,J]=(0,c.useState)(0),ee=(0,c.useRef)(null),et=(0,c.useRef)(null),[es,ea]=(0,c.useState)(1),[en,el]=(0,c.useState)(0),[ei,eo]=(0,c.useState)(),[ec,ed]=(0,c.useState)(!0),[eu,ex]=(0,c.useState)(!1),[em,eh]=(0,c.useState)(),[ef,ey]=(0,c.useState)(!1),eg=(0,d.mN)({mode:"onBlur",reValidateMode:"onBlur",resolver:(0,n.u)(eN),defaultValues:eb}),{name:e_,table:ew,behavior:ek,command:eC,roles:eA}=eg.watch(),eq=["update","all"].includes(eC),eP=void 0!==q&&e_!==q.name,{mutate:eE,isPending:eL}=(0,y.Y)({onSuccess:async()=>{await M.invalidateQueries({queryKey:f.S.list(R)}),u.oR.success("Successfully created new policy"),P()},onError:e=>eo(e)}),{mutate:eT,isPending:eR}=(0,p.V)({onSuccess:()=>{u.oR.success("Successfully updated policy"),P()}}),eM=(0,c.useCallback)(()=>{var e,t,s,a,n;let l=(null!=(s=null==(e=U.current)?void 0:e.getValue().trim())?s:null)||null,i=(null!=(a=null==(t=et.current)?void 0:t.getValue().trim())?a:null)||null,r=void 0===q&&(e_.length>0||eA.length>0||!!l||!!i),c=void 0!==q&&(n={name:e_,roles:0===eA.length?["public"]:eA.split(", "),definition:l,check:"INSERT"===eC?l:i},!(("INSERT"!==q.command||q.check===n.check)&&("INSERT"===q.command||q.definition===n.definition&&q.check===n.check)&&q.name===n.name&&o()(q.roles,n.roles)));return r||c},[eC,e_,eA,q]),{confirmOnClose:ez,modalProps:eI}=(0,j.$)({checkIsDirty:eM,onClose:P});return(0,c.useEffect)(()=>{if(t)if(I&&ey(!0),void 0!==q){let{name:e,action:t,table:s,command:a,roles:n}=q;eg.reset({name:e,table:s,behavior:t.toLowerCase(),command:a.toLowerCase(),roles:1===n.length&&"public"===n[0]?"":n.join(", ")}),q.definition&&V("  ".concat(q.definition)),q.check&&O("  ".concat(q.check)),q.check&&"INSERT"!==q.command&&G(!0)}else void 0!==x&&eg.reset({...eb,table:x});else{var e,s;null==(e=U.current)||e.setValue(""),null==(s=et.current)||s.setValue(""),ey(!1),eo(void 0),ex(!1),eh(void 0),V(""),O(""),G(!1),B(void 0),eg.reset(eb)}},[t]),(0,c.useEffect)(()=>{var e;null==(e=U.current)||e.layout({width:0,height:0}),window.requestAnimationFrame(()=>{var e;null==(e=U.current)||e.layout()})},[eu,ei,ec]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.lV,{...eg,children:(0,a.jsx)("form",{id:ev,onSubmit:eg.handleSubmit(e=>{var t,a,n;let{name:l,table:i,behavior:r,command:c,roles:d}=e,u=null!=(n=null==(t=U.current)?void 0:t.getValue().trim())?n:void 0,x=null==(a=et.current)?void 0:a.getValue().trim();if("insert"===c&&(x=u),"insert"===c&&(void 0===x||0===x.length))return B("Please provide a SQL expression for the WITH CHECK statement");if("insert"!==c&&(void 0===u||0===u.length))return B("Please provide a SQL expression for the USING statement");if(B(void 0),void 0===q){let e=(e=>{let{name:t,schema:s,table:a,behavior:n,command:l,roles:i,using:r,check:o}=e,c='create policy "'.concat(t,'" on "').concat(s,'"."').concat(a,'" as ').concat(n," for ").concat(l," to ").concat(i);return"insert"===l?"".concat(c," with check (").concat(o,");"):"".concat(c," using (").concat(r,")").concat((null!=o?o:"").length>0?"with check (".concat(o,");"):";")})({name:l,schema:s,table:i,behavior:r,command:c,roles:0===d.length?"public":d,using:null!=u?u:"",check:"insert"===c?null!=u?u:"":null!=x?x:""});eo(void 0),eE({sql:e,projectRef:null==z?void 0:z.ref,connectionString:null==z?void 0:z.connectionString,handleError:e=>{throw e}})}else if(void 0!==z){let e={},t=0===d.length?["public"]:d.split(", ");if(l!==q.name&&(e.name=l),o()(q.roles,t)||(e.roles=t),null!==q.definition&&q.definition!==u&&(e.definition=u),"INSERT"===q.command?q.check!==u&&(e.check=u):q.check!==x&&(e.check=x),0===Object.keys(e).length)return P();eT({projectRef:z.ref,connectionString:null==z?void 0:z.connectionString,originalPolicy:q,payload:e})}}),children:(0,a.jsx)(N.cj,{open:t,onOpenChange:ez,children:(0,a.jsxs)(N.h,{showClose:!1,size:ef?"lg":"default",className:(0,b.cn)("bg-surface-200 p-0 flex flex-row gap-0",ef?"!min-w-[100vw] lg:!min-w-[1000px]":"!min-w-[100vw] lg:!min-w-[600px]"),children:[(0,a.jsxs)("div",{className:(0,b.cn)("flex flex-col grow w-full",ef&&"w-[60%]"),children:[(0,a.jsx)($,{selectedPolicy:q,showTools:ef,setShowTools:ey}),(0,a.jsxs)("div",{className:"flex flex-col h-full w-full justify-between overflow-y-auto",children:[(0,a.jsx)(H,{schema:s,searchString:r,selectedTable:x,isEditing:void 0!==q,form:eg,onUpdateCommand:e=>{B(void 0),["update","all"].includes(e)?G(!0):G(!1)},authContext:T}),(0,a.jsxs)("div",{className:"h-full",children:[(0,a.jsx)(E,{schema:s,selectedPolicy:q,formFields:{name:e_,table:ew,behavior:ek,command:eC,roles:eA}}),(0,a.jsx)("div",{className:"mt-1 relative block",style:{height:X<=100?"".concat(8+X,"px"):"108px"},children:(0,a.jsx)(ej,{disableTabToUsePlaceholder:!0,readOnly:!I,id:"rls-exp-one-editor",placeholder:"insert"===eC?"-- Provide a SQL expression for the with check statement":"-- Provide a SQL expression for the using statement",defaultValue:"insert"===eC?F:D,value:"insert"===eC?F:D,editorRef:U,monacoRef:Y,lineNumberStart:6,onChange:()=>{var e,t,s,a,n;J(null!=(a=null==(e=U.current)?void 0:e.getContentHeight())?a:0),Z(null!=(n=null==(s=U.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},onMount:()=>{setTimeout(()=>{var e,t,s,a,n;J(null!=(a=null==(e=U.current)?void 0:e.getContentHeight())?a:0),Z(null!=(n=null==(s=U.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},200)}})}),(0,a.jsx)("div",{className:"bg-surface-300 py-1",children:(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:7+K})}),(0,a.jsx)("p",{className:"font-mono tracking-tighter",children:W?(0,a.jsxs)(a.Fragment,{children:[eq&&W&&(0,a.jsx)("span",{className:"text-[#ffd700]",children:") "}),(0,a.jsx)("span",{className:"text-[#569cd6]",children:"with check"})," ",(0,a.jsx)("span",{className:"text-[#ffd700]",children:"("})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[#ffd700]",children:")"}),";"]})})]})}),W&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-1 min-h-[28px] relative block",style:{height:en<=100?"".concat(8+en,"px"):"108px"},children:(0,a.jsx)(ej,{disableTabToUsePlaceholder:!0,readOnly:!I,id:"rls-exp-two-editor",placeholder:"-- Provide a SQL expression for the with check statement",defaultValue:F,value:F,editorRef:et,monacoRef:ee,lineNumberStart:7+K,onChange:()=>{var e,t,s,a,n;el(null!=(a=null==(e=et.current)?void 0:e.getContentHeight())?a:0),ea(null!=(n=null==(s=et.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},onMount:()=>{setTimeout(()=>{var e,t,s,a,n;el(null!=(a=null==(e=et.current)?void 0:e.getContentHeight())?a:0),ea(null!=(n=null==(s=et.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},200)}})}),(0,a.jsx)("div",{className:"bg-surface-300 py-1",children:(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:8+K+es})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#ffd700]",children:")"}),";"]})]})})]}),eP&&(0,a.jsx)(L,{oldName:q.name,newName:e_,schema:s,table:ew,lineNumber:8+K+(W?es:0)}),void 0!==Q&&(0,a.jsx)("p",{className:"px-5 py-2 pb-0 text-sm text-red-900",children:Q}),eq&&(0,a.jsxs)("div",{className:"px-5 py-3 flex items-center gap-x-2",children:[(0,a.jsx)(w.S,{id:"use-check",name:"use-check",checked:W,onCheckedChange:()=>{B(void 0),G(!W)}}),(0,a.jsx)(S.J,{className:"text-xs cursor-pointer",htmlFor:"use-check",children:"Use check expression"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[void 0!==ei&&(0,a.jsx)(ep,{error:ei,open:ec,setOpen:ed}),(0,a.jsxs)(N.XW,{className:"flex items-center !justify-end px-5 py-4 w-full border-t",children:[(0,a.jsx)(k.$,{type:"default",disabled:eL||eR,onClick:ez,children:"Cancel"}),(0,a.jsx)(h.G,{form:ev,htmlType:"submit",loading:eL||eR,disabled:!I||eL||eR,tooltip:{content:{side:"top",text:I?void 0:"You need additional permissions to update policies"}},children:"Save policy"})]})]})]})]}),ef&&(0,a.jsx)("div",{className:(0,b.cn)("border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10",ef&&"w-[50%]","bg-studio overflow-auto"),children:(0,a.jsxs)(C.tU,{defaultValue:"templates",className:"flex flex-col h-full w-full",children:[(0,a.jsx)(C.j7,{className:"flex gap-4 px-content pt-2",children:(0,a.jsx)(C.Xi,{value:"templates",className:"px-0 data-[state=active]:bg-transparent",children:"Templates"},"templates")}),(0,a.jsx)(C.av,{value:"templates",className:(0,b.cn)("!mt-0 overflow-y-auto","data-[state=active]:flex data-[state=active]:grow"),children:(0,a.jsx)(A.FK,{className:"h-full w-full",children:(0,a.jsx)(er,{schema:s,table:ew,selectedPolicy:q,selectedTemplate:em,onSelectTemplate:e=>{var t;eg.setValue("name",e.name),eg.setValue("behavior","permissive"),eg.setValue("command",e.command.toLowerCase()),eg.setValue("roles",null!=(t=e.roles.join(", "))?t:""),V("  ".concat(e.definition)),O("  ".concat(e.check)),Z(1),ea(1),B(void 0),["update","all"].includes(e.command.toLowerCase())&&e.check.length>0?G(!0):G(!1)}})})})]})})]})})})}),(0,a.jsx)(eS,{...eI})]})});ew.displayName="PolicyEditorPanel";let eS=e=>{let{visible:t,onClose:s,onCancel:n}=e;return(0,a.jsx)(q.A,{visible:t,title:"Discard changes",confirmLabel:"Discard",onCancel:n,onConfirm:s,"data-sentry-element":"ConfirmationModal","data-sentry-component":"CloseConfirmationModal","data-sentry-source-file":"index.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to close the editor? Any unsaved changes on your policy and conversations with the Assistant will be lost."})})}},15967:e=>{e.exports={"spin-ai-icon-container":"ai-icon-animation-style_spin-ai-icon-container__7sgAA",spinAiIconContainer:"ai-icon-animation-style_spinAiIconContainer__rBP6P","ai-icon__container":"ai-icon-animation-style_ai-icon__container__2aXBS","ai-icon__grid":"ai-icon-animation-style_ai-icon__grid__Qrwxf","ai-icon__grid__square":"ai-icon-animation-style_ai-icon__grid__square__YU8EZ","ai-icon__grid__square--static":"ai-icon-animation-style_ai-icon__grid__square--static__1tOM_","ai-icon__container--allow-hover-effect":"ai-icon-animation-style_ai-icon__container--allow-hover-effect__HrB86","ai-icon__grid__square--step-1":"ai-icon-animation-style_ai-icon__grid__square--step-1__KATlI",step1_square1:"ai-icon-animation-style_step1_square1__BIjL3",step1_square2:"ai-icon-animation-style_step1_square2__QzsE7",step1_square3:"ai-icon-animation-style_step1_square3__ls1SO",step1_square4:"ai-icon-animation-style_step1_square4__Kk8zi","ai-icon__grid__square--step-2":"ai-icon-animation-style_ai-icon__grid__square--step-2__9OoIG",step2_square1:"ai-icon-animation-style_step2_square1__o_hcu",step2_square2:"ai-icon-animation-style_step2_square2__HBZt7",step2_square3:"ai-icon-animation-style_step2_square3__K6E2K",step2_square4:"ai-icon-animation-style_step2_square4__oDGDL","ai-icon__grid__square--step-3":"ai-icon-animation-style_ai-icon__grid__square--step-3__RldL4",step3_square1:"ai-icon-animation-style_step3_square1__Oo6vT",step3_square2:"ai-icon-animation-style_step3_square2__36Os9",step3_square3:"ai-icon-animation-style_step3_square3__Nj5rc",step3_square4:"ai-icon-animation-style_step3_square4__OFVFh","ai-icon__grid__square--step-4":"ai-icon-animation-style_ai-icon__grid__square--step-4__7o69c",step4_square1:"ai-icon-animation-style_step4_square1__G_8pn",step4_square2:"ai-icon-animation-style_step4_square2__KHYf3",step4_square3:"ai-icon-animation-style_step4_square3__XON12",step4_square4:"ai-icon-animation-style_step4_square4__Aq8dV","ai-icon__grid__square--step-5":"ai-icon-animation-style_ai-icon__grid__square--step-5__cF2Rx",step5_square1:"ai-icon-animation-style_step5_square1__me9Ru",step5_square2:"ai-icon-animation-style_step5_square2__0Ydfw",step5_square3:"ai-icon-animation-style_step5_square3__bOHqW",step5_square4:"ai-icon-animation-style_step5_square4__m2l32","ai-icon__grid__square--exiting--step-1":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-1__JYREY",exit_step1_square1:"ai-icon-animation-style_exit_step1_square1__C_GBC",exit_step1_square2:"ai-icon-animation-style_exit_step1_square2__TID0l",exit_step1_square3:"ai-icon-animation-style_exit_step1_square3__ADmUT",exit_step1_square4:"ai-icon-animation-style_exit_step1_square4__kilu_","ai-icon__grid__square--exiting--step-2":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-2__kDUVt",exit_step2_square1:"ai-icon-animation-style_exit_step2_square1__vmYa5",exit_step2_square2:"ai-icon-animation-style_exit_step2_square2__zxv0q",exit_step2_square3:"ai-icon-animation-style_exit_step2_square3__Dhey5",exit_step2_square4:"ai-icon-animation-style_exit_step2_square4__P1UKx","ai-icon__grid__square--exiting--step-3":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-3__h48Ts",exit_step3_square1:"ai-icon-animation-style_exit_step3_square1__l1FKu",exit_step3_square2:"ai-icon-animation-style_exit_step3_square2__4RPQL",exit_step3_square3:"ai-icon-animation-style_exit_step3_square3__s2vMz",exit_step3_square4:"ai-icon-animation-style_exit_step3_square4__Zros9","ai-icon__grid__square--exiting--step-4":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-4__VEmk_",exit_step4_square1:"ai-icon-animation-style_exit_step4_square1__bG99O",exit_step4_square2:"ai-icon-animation-style_exit_step4_square2__1Fxvf",exit_step4_square3:"ai-icon-animation-style_exit_step4_square3__EWeB7",exit_step4_square4:"ai-icon-animation-style_exit_step4_square4__HC5ov","ai-icon__grid__square--exiting--step-5":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-5___9jFB",exit_step5_square1:"ai-icon-animation-style_exit_step5_square1__w4ctB",exit_step5_square2:"ai-icon-animation-style_exit_step5_square2__UZdas",exit_step5_square3:"ai-icon-animation-style_exit_step5_square3__O_mvc",exit_step5_square4:"ai-icon-animation-style_exit_step5_square4__SKL7Z"}},21416:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(80263),n=s(52555),l=s.n(n),i=s(24487),r=s(21650),o=s(99779);let c=e=>{let{name:t="",isActive:s,isExternal:n,icon:c,rightIcon:d,url:u="",target:x="_self",onClick:m,textClassName:h="",hoverText:p="",label:f}=e,y=(0,a.jsx)(i.Ay.Item,{icon:c,rounded:!0,active:s,onClick:m,children:(0,a.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,a.jsxs)("div",{title:p||("string"==typeof t?t:""),className:"flex space-between items-center gap-2 truncate w-full "+h,children:[(0,a.jsx)("span",{className:"truncate flex-1",children:t}),void 0!==f&&(0,a.jsx)(r.E,{variant:"warning",size:"tiny",children:f})]}),d&&(0,a.jsx)("div",{children:d})]})});return u?n?(0,a.jsx)(o.$,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,a.jsx)(l(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,a.jsx)(l(),{href:u,className:"block",target:x,children:y}):y}},24487:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>x});var a=s(80263),n=s(53239),l=s(7981),i=s(80100);function r(e){let{children:t,className:s,tag:n="div",style:l}=e;return(0,a.jsx)("".concat(n),{style:l,"data-sentry-element":"CustomTag","data-sentry-component":"Typography","data-sentry-source-file":"Typography.tsx",children:t})}r.Title=function(e){let{className:t,level:s=1,children:n,style:l}=e;return(0,a.jsx)("h".concat(s),{style:l,"data-sentry-element":"CustomTag","data-sentry-component":"Title","data-sentry-source-file":"Title.tsx",children:n})},r.Text=function(e){let{className:t,children:s,style:n,type:l,disabled:i,mark:r,code:o,keyboard:c,underline:d,strikethrough:u,strong:x,small:m}=e;return o?(0,a.jsx)("code",{style:n,children:s}):r?(0,a.jsx)("mark",{style:n,children:s}):c?(0,a.jsx)("kbd",{style:n,children:s}):x?(0,a.jsx)("strong",{style:n,children:s}):(0,a.jsx)("span",{style:n,"data-sentry-component":"Text","data-sentry-source-file":"Text.tsx",children:s})},r.Link=function(e){let{children:t,target:s="_blank",href:n,className:l,onClick:i,style:r}=e;return(0,a.jsx)("a",{onClick:i,href:n,target:s,rel:"noopener noreferrer",style:r,"data-sentry-component":"Link","data-sentry-source-file":"Link.tsx",children:t})};let o=(0,n.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,a.jsx)(o.Provider,{value:{type:t},"data-sentry-element":"MenuContext.Provider","data-sentry-component":"MenuContextProvider","data-sentry-source-file":"MenuContext.tsx",children:e.children})},d=()=>{let e=(0,n.useContext)(o);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:s,ulClassName:n,style:l,type:i="text"}=e;return(0,a.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:s,style:l,"data-sentry-component":"Menu","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)(c,{type:i,"data-sentry-element":"MenuContextProvider","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)("ul",{className:n,children:t})})})}u.Item=function(e){let{children:t,icon:s,active:n,rounded:r,onClick:o,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:x}=e,m=(0,l.A)("menu"),{type:h}=d(),p=[m.item.base];p.push(m.item.variants[h].base),n?p.push(m.item.variants[h].active):p.push(m.item.variants[h].normal);let f=[m.item.content.base];n?f.push(m.item.content.active):f.push(m.item.content.normal);let y=[m.item.icon.base];return n?y.push(m.item.icon.active):y.push(m.item.icon.normal),(0,a.jsxs)("li",{role:"menuitem",className:(0,i.cn)("outline-none",p),style:x,onClick:o,"aria-current":n?"page":void 0,"data-sentry-component":"Item","data-sentry-source-file":"Menu.tsx",children:[s&&(0,a.jsx)("div",{className:"".concat(y.join(" ")," min-w-fit"),children:s}),(0,a.jsx)("span",{className:f.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:s,title:n}=e,i=(0,l.A)("menu"),{type:r}=d();return(0,a.jsxs)("div",{className:[i.group.base,i.group.variants[r]].join(" "),"data-sentry-component":"Group","data-sentry-source-file":"Menu.tsx",children:[s&&(0,a.jsx)("span",{className:i.group.icon,children:s}),(0,a.jsx)("span",{className:i.group.content,children:n}),t]})},u.Misc=function(e){let{children:t}=e;return(0,a.jsx)("div",{"data-sentry-component":"Misc","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)(r.Text,{"data-sentry-element":"Typography.Text","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)("span",{children:t})})})};let x=u},29948:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},30146:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>V});var a=s(80263),n=s(72112),l=s(31092),i=s(68152),r=s(23850),o=s(53239),c=s(73969),d=s(41200),u=s(45666),x=s(6740),m=s(289),h=s(13656),p=s(56759),f=s(87442),y=s(10508),g=s(8750),_=s(69498),j=s(37873),v=s(44168),N=s(41273),b=s(39624),w=s(84438),S=s(53931),k=s(94636),C=s(62550),A=s(49810),q=s(80090),P=s(46087),E=s(9620),L=s(63335),T=s(85039),R=s(89144),M=s(18664),z=s(99779),I=s(64758);let D=()=>{let[e,t]=(0,r.ZA)("schema",r.tU.withDefault("public").withOptions({history:"replace"})),[s,f]=(0,r.ZA)("search",r.tU.withDefault("").withOptions({history:"replace",clearOnDefault:!0})),y=(0,o.useDeferredValue)(s),{data:g}=(0,E.YA)(),{data:N}=(0,k.y)({projectRef:null==g?void 0:g.ref}),T=(0,d.h)(),{openSidebar:D}=(0,M.rM)(),{setValue:V,setTemplates:F,setInitialPrompt:O}=(0,R.ab)(),[Q,H]=(0,o.useState)(),[B,W]=(0,r.ZA)("new",r.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),{isSchemaLocked:G}=(0,L.BQ)({schema:e,excludedSchemas:["realtime"]}),{data:Y,isLoading:U,isError:K,error:$}=(0,C.j)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),{setValue:Z,value:X}=(0,P.s)({urlKey:"edit",select:e=>e?null==Y?void 0:Y.find(t=>t.id.toString()===e):void 0,enabled:!!Y,onError:()=>c.oR.error("Policy not found")}),{data:J,isLoading:ee,isSuccess:et,isError:es,error:ea}=(0,A.LW)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:e}),{tables:en,visibleTableIds:el}=(0,o.useMemo)(()=>((e,t,s)=>{let a=e.slice().sort((e,t)=>e.name.localeCompare(t.name)),n=new Set;if(!s)return a.forEach(e=>n.add(e.id)),{tables:a,visibleTableIds:n};let l=s.toLowerCase(),i=new Set(t.filter(e=>e.name.toLowerCase().includes(l)).map(e=>"".concat(e.schema,".").concat(e.table)));return a.forEach(e=>{(e.name.toLowerCase().includes(l)||e.id.toString()===l||i.has("".concat(e.schema,".").concat(e.name)))&&n.add(e.id)}),{tables:a,visibleTableIds:n}})(null!=J?J:[],null!=Y?Y:[],s),[J,Y,s]),ei=(0,o.useMemo)(()=>(null==N?void 0:N.db_schema)?N.db_schema.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],[null==N?void 0:N.db_schema]),{can:er,isSuccess:eo}=(0,q.Qp)(n.aG.TENANT_SQL_ADMIN_READ,"policies"),ec=(0,o.useCallback)(t=>{if(H(t),Z(null),W(!0),T){let s='create policy "replace_with_policy_name"\n  on '.concat(e,".").concat(t,"\n  for select\n  to authenticated\n  using (\n    true  -- Write your policy condition here\n);");O("Create a new RLS policy that..."),V(s),F([]),D(_.c.EDITOR_PANEL)}else W(!0)},[T,D,e]),ed=(0,o.useCallback)(e=>{Z(e.id.toString()),H(void 0),T?(O('Update the RLS policy with name "'.concat(e.name,'" that...')),V((0,p.F)(e)),F((0,m.S3)(e.schema,e.table).map(e=>({name:e.templateName,description:e.description,content:e.statement}))),D(_.c.EDITOR_PANEL)):Z(e.id.toString())},[T,D]),eu=(0,o.useCallback)(()=>f(""),[f]),ex=!!X;return eo&&!er?(0,a.jsx)(b.A,{isFullPage:!0,resourceText:"view this project's RLS policies"}):(0,a.jsx)(j.eh,{size:"large","data-sentry-element":"ScaffoldContainer","data-sentry-component":"AuthPoliciesPage","data-sentry-source-file":"policies.tsx",children:(0,a.jsxs)(j.gu,{isFullWidth:!0,"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"policies.tsx",children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-row gap-x-2",children:[(0,a.jsx)(w.A,{className:"w-full lg:w-[180px]",size:"tiny",align:"end",showError:!1,selectedSchemaName:e,onSelectSchema:e=>{t(e),f("")},"data-sentry-element":"SchemaSelector","data-sentry-source-file":"policies.tsx"}),(0,a.jsx)(I.p,{size:"tiny",placeholder:"Filter tables and policies",className:"block w-full lg:w-52",containerClassName:"[&>div>svg]:-mt-0.5",value:s||"",onChange:e=>{f(e.target.value)},icon:(0,a.jsx)(l.A,{size:14}),actions:s?(0,a.jsx)(z.$,{size:"tiny",type:"text",className:"p-0 h-5 w-5",icon:(0,a.jsx)(i.A,{}),onClick:()=>f("")}):null,"data-sentry-element":"Input","data-sentry-source-file":"policies.tsx"})]}),ee&&(0,a.jsx)(S.yV,{}),es&&(0,a.jsx)(v.A,{error:ea,subject:"Failed to retrieve tables"}),et&&(0,a.jsx)(x.S,{policies:null!=Y?Y:[],isPoliciesLoading:U,isPoliciesError:K,policiesError:null!=$?$:void 0,exposedSchemas:ei,children:(0,a.jsx)(u.l,{search:y,schema:e,tables:en,hasTables:(null!=J?J:[]).length>0,isLocked:G,visibleTableIds:el,onSelectCreatePolicy:ec,onSelectEditPolicy:ed,onResetSearch:eu})}),(0,a.jsx)(h.s,{visible:B||ex,schema:e,searchString:s,selectedTable:ex?void 0:Q,selectedPolicy:ex?X:void 0,onSelectCancel:()=>{H(void 0),ex?Z(null):W(!1)},authContext:"database","data-sentry-element":"PolicyEditorPanel","data-sentry-source-file":"policies.tsx"})]})})};D.getLayout=e=>(0,a.jsx)(y.A,{children:(0,a.jsx)(f.A,{children:(0,a.jsx)(g.M,{title:"Policies",subtitle:"Manage Row Level Security policies for your tables",secondaryActions:(0,a.jsx)(N.A,{href:"".concat(T.aq,"/learn/auth-deep-dive/auth-row-level-security")}),size:"large",children:e})})});let V=D},30788:(e,t,s)=>{var a=s(98198),n=s(33312);e.exports=function(e,t,s,l){return null==e?[]:(n(t)||(t=null==t?[]:[t]),n(s=l?void 0:s)||(s=null==s?[]:[s]),a(e,t,s))}},31626:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},37253:(e,t,s)=>{var a=s(48550),n=s(92479),l=s(50084);e.exports=n(function(e,t){return l(e)?a(e,t):[]})},39353:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]])},39624:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(80263),n=s(12123);let l=e=>{let{resourceText:t,isFullPage:s=!1}=e,l=()=>(0,a.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(n.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,a.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("div",{className:"w-[550px]",children:(0,a.jsx)(l,{})})}):(0,a.jsx)(l,{})}},45666:(e,t,s)=>{"use strict";s.d(t,{l:()=>U});var a=s(80263),n=s(97344),l=s.n(n),i=s(52555),r=s.n(i),o=s(53239),c=s(73969),d=s(22891),u=s(83927),x=s.n(u),m=s(44168),h=s(10723),p=s(67850),f=s(59356),y=s(31958);async function g(e,t){let{schema:s,projectRef:a,connectionString:n}=e;if(!s)throw Error("schema is required");let l=(e=>{let{schema:t}=e;return"\nSELECT c.relname AS table_name\nFROM pg_catalog.pg_class AS c\nJOIN pg_catalog.pg_namespace AS n ON n.oid = c.relnamespace\nWHERE n.nspname = '".concat(t,"'\n  AND c.relkind IN ('r','p')  -- table, partitioned table\n  AND EXISTS (\n    SELECT 1\n    FROM pg_catalog.aclexplode(COALESCE(c.relacl, '{}'::aclitem[])) AS a\n    JOIN pg_catalog.pg_roles r ON r.oid = a.grantee\n    WHERE r.rolname IN ('anon','authenticated')\n  )\n;\n").trim()})({schema:s}),{result:i}=await (0,f.E)({projectRef:a,connectionString:n,sql:l,queryKey:["TablesRolesAccess",s]},t);return new Set(i.map(e=>e.table_name))}let _=function(e){let{projectRef:t,connectionString:s,schema:a}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,p.I)({queryKey:y.v.rolesAccess(t,a),queryFn:e=>{let{signal:n}=e;return g({projectRef:t,connectionString:s,schema:a},n)},enabled:n&&void 0!==t&&void 0!==a&&!!s,...l})};var j=s(9620),v=s(78039),N=s(80100),b=s(20033),w=s(78511),S=s(44725),k=s(16488),C=s(6740),A=s(13597),q=s(72112),P=s(31160),E=s(11743),L=s(23729),T=s(71875),R=s(80090),M=s(95448),z=s(21650),I=s(72432),D=s(69498),V=s(18664);let F=e=>{let{table:t,isLocked:s,onSelectToggleRLS:n=x(),onSelectCreatePolicy:l}=e,{ref:i}=(0,d.g)(),r=(0,M.xd)(),{openSidebar:o}=(0,V.rM)(),{can:c}=(0,R.Qp)(q.aG.TENANT_SQL_ADMIN_WRITE,"policies"),{can:u}=(0,R.Qp)(q.aG.TENANT_SQL_ADMIN_WRITE,"tables"),m="realtime"===t.schema,h=m&&"messages"===t.name,p=m?!h:s;return(0,a.jsxs)("div",{id:t.id.toString(),className:"flex w-full items-center justify-between","data-sentry-component":"PolicyTableRowHeader","data-sentry-source-file":"PolicyTableRowHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex gap-x-4 text-left flex-wrap",children:[(0,a.jsxs)(T.tv,{projectRef:i,id:String(t.id),className:"flex items-center gap-3 flex-wrap","data-sentry-element":"EditorTablePageLink","data-sentry-source-file":"PolicyTableRowHeader.tsx",children:[(0,a.jsx)(P.A,{strokeWidth:1.5,size:16,className:"text-foreground-muted","data-sentry-element":"Table","data-sentry-source-file":"PolicyTableRowHeader.tsx"}),(0,a.jsx)(v.ZB,{className:"m-0 normal-case","data-sentry-element":"CardTitle","data-sentry-source-file":"PolicyTableRowHeader.tsx",children:t.name}),!t.rls_enabled&&(0,a.jsx)(z.E,{variant:"warning",className:"shrink-0",children:"RLS Disabled"})]}),p&&(0,a.jsx)(z.E,{children:(0,a.jsxs)("span",{className:"flex gap-2 items-center text-xs uppercase text-foreground-lighter",children:[(0,a.jsx)(E.A,{size:12})," Locked"]})})]}),!p&&(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex flex-row justify-end gap-x-2",children:[!h&&(0,a.jsx)(L.G,{type:"default",disabled:!u,onClick:()=>n(t),"data-testid":"".concat(t.name,"-toggle-rls"),tooltip:{content:{side:"bottom",text:u?void 0:"You need additional permissions to toggle RLS"}},children:t.rls_enabled?"Disable RLS":"Enable RLS"}),(0,a.jsx)(L.G,{type:"default",disabled:!u||!c,onClick:()=>l(t),"data-testid":"".concat(t.name,"-create-policy"),tooltip:{content:{side:"bottom",text:u||u&&c?void 0:"You need additional permissions to create RLS policies"}},children:"Create policy"}),(0,a.jsx)(L.G,{type:"default",className:"px-1",onClick:()=>{o(D.c.AI_ASSISTANT),r.newChat({name:"Create new policy",initialInput:"Create and name a new policy for the ".concat(t.schema," schema on the ").concat(t.name," table that ...")})},tooltip:{content:{side:"bottom",text:u&&c?"Create with Supabase Assistant":"You need additional permissions to create RLS policies"}},children:(0,a.jsx)(I.M,{size:16})})]})})]})},O=(0,o.memo)(e=>{let{table:t,isLocked:s,onSelectToggleRLS:n=x(),onSelectCreatePolicy:l=x(),onSelectEditPolicy:i=x(),onSelectDeletePolicy:r=x()}=e,{ref:c}=(0,d.g)(),{data:u}=(0,j.YA)(),{getPoliciesForTable:p,isPoliciesLoading:f,isPoliciesError:y,policiesError:g,exposedSchemas:q}=(0,C.G)(),P=(0,o.useMemo)(()=>p(t.schema,t.name),[p,t.schema,t.name]),E=t.rls_enabled,L=(0,o.useMemo)(()=>q.has(t.schema),[q,t.schema]),{data:T=new Set}=_({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,schema:t.schema}),R=T.has(t.name),M=!E&&L&&R,z=E&&0===P.length,I="realtime"===t.schema,D=I&&"messages"===t.name,V=I?!D:s;return(0,a.jsxs)(v.Zp,{className:(0,N.cn)(M&&"border-warning-500"),"data-sentry-element":"Card","data-sentry-component":"PolicyTableRowComponent","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(v.aR,{className:(0,N.cn)("py-3 px-4",(M||z||!L)&&"border-b-0"),"data-sentry-element":"CardHeader","data-sentry-source-file":"index.tsx",children:(0,a.jsx)(F,{table:t,isLocked:s,onSelectToggleRLS:n,onSelectCreatePolicy:l,"data-sentry-element":"PolicyTableRowHeader","data-sentry-source-file":"index.tsx"})}),!L&&(0,a.jsxs)(S.Z,{showIcon:!1,type:"warning",className:"mb-0 border-0 border-y rounded-none [&>div]:text-foreground-light h-[50px] py-0 flex items-center",children:["No data will be selectable via Supabase APIs as this schema is not exposed. You may configure this in your project's"," ",(0,a.jsx)(h.g,{href:"/project/".concat(c,"/settings/api"),children:"API settings"}),"."]}),(M||z)&&L&&(0,a.jsx)(b.Fc,{className:"border-0 rounded-none mb-0 border-y h-[50px] py-0 flex items-center",variant:M?"warning":"default",children:(0,a.jsx)(b.TN,{children:M?"Anyone with your project's anonymous key can read, modify, or delete your data.":"No data will be selectable via Supabase APIs because RLS is enabled but no policies have been created yet."})}),f&&(0,a.jsx)(v.Wu,{children:(0,a.jsx)(k.Ay,{})}),y&&(0,a.jsx)(v.Wu,{children:(0,a.jsx)(m.A,{className:"border-0 rounded-none",error:g,subject:"Failed to retrieve policies"})}),!f&&!y&&(0,a.jsx)(v.Wu,{className:"p-0",children:0===P.length?(0,a.jsx)("p",{className:"text-foreground-lighter text-sm p-4",children:"No policies created yet"}):(0,a.jsxs)(w.XI,{className:"table-fixed",children:[(0,a.jsx)(w.A0,{children:(0,a.jsxs)(w.Hj,{children:[(0,a.jsx)(w.nd,{className:"w-[40%]",children:"Name"}),(0,a.jsx)(w.nd,{className:"w-[20%]",children:"Command"}),(0,a.jsx)(w.nd,{className:"w-[30%]",children:"Applied to"}),(0,a.jsx)(w.nd,{className:"text-right",children:(0,a.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,a.jsx)(w.BF,{children:P.map(e=>(0,a.jsx)(A.V,{policy:e,isLocked:V,onSelectEditPolicy:i,onSelectDeletePolicy:r},e.id))})]})})]})});O.displayName="PolicyTableRow";var Q=s(35693),H=s(89077),B=s(16643),W=s(93424),G=s(99779),Y=s(59403);let U=e=>{let{search:t,schema:s,tables:n,hasTables:i,isLocked:u,visibleTableIds:x,onSelectCreatePolicy:m,onSelectEditPolicy:h,onResetSearch:p}=e,{ref:f}=(0,d.g)(),{data:y}=(0,j.YA)(),[g,_]=(0,o.useState)(),[N,b]=(0,o.useState)({}),{mutate:w}=(0,W.e)({onError:e=>{c.oR.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{k()}}),{mutate:S}=(0,B.f)({onSuccess:()=>{c.oR.success("Successfully deleted policy!")},onSettled:()=>{k()}}),k=(0,o.useCallback)(()=>{b({}),_(void 0)},[]),C=(0,o.useCallback)(e=>{_(e)},[]),A=(0,o.useCallback)(e=>{h(e)},[h]),q=(0,o.useCallback)(e=>{b(e)},[]),P=async()=>{if(!g)return console.error("Table is required");let e={id:g.id,rls_enabled:!g.rls_enabled};w({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,id:g.id,name:g.name,schema:g.schema,payload:e})},E=async()=>{if(!y)return console.error("Project is required");S({projectRef:y.ref,connectionString:y.connectionString,originalPolicy:N})},L=(0,o.useCallback)(e=>{m(e.name)},[m]);return i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-4 pb-4",children:[u&&(0,a.jsx)(Q.i,{schema:s,entity:"policies"}),n.length>0?(0,a.jsxs)(a.Fragment,{children:[n.map(e=>{let t=x.has(e.id);return(0,a.jsx)("section",{hidden:!t,"aria-hidden":!t,"data-testid":"policy-table-".concat(e.name),children:(0,a.jsx)(O,{table:e,isLocked:"realtime"===s||u,onSelectToggleRLS:C,onSelectCreatePolicy:L,onSelectEditPolicy:A,onSelectDeletePolicy:q})},e.id)}),!!t&&0===x.size&&(0,a.jsx)(H.o,{searchString:null!=t?t:"",onResetFilter:p})]}):i?(0,a.jsx)(H.o,{searchString:null!=t?t:"",onResetFilter:p}):null]}),(0,a.jsx)(Y.A,{danger:!0,visible:!l()(N),title:"Confirm to delete policy",description:'This is permanent! Are you sure you want to delete the policy "'.concat(N.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:k,onSelectConfirm:E,"data-sentry-element":"ConfirmModal","data-sentry-source-file":"Policies.tsx"}),(0,a.jsx)(Y.A,{danger:null==g?void 0:g.rls_enabled,visible:void 0!==g,title:"Confirm to ".concat((null==g?void 0:g.rls_enabled)?"disable":"enable"," Row Level Security"),description:"Are you sure you want to ".concat((null==g?void 0:g.rls_enabled)?"disable":"enable",' Row Level Security for the table "').concat(null==g?void 0:g.name,'"?'),buttonLabel:"Confirm",buttonLoadingLabel:"Saving",onSelectCancel:k,onSelectConfirm:P,"data-sentry-element":"ConfirmModal","data-sentry-source-file":"Policies.tsx"})]}):(0,a.jsx)(v.Zp,{className:"w-full bg-transparent",children:(0,a.jsxs)(v.Wu,{className:"flex flex-col items-center justify-center p-8",children:[(0,a.jsx)("h2",{className:"heading-default",children:"No tables to create policies for"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light text-center mb-4",children:"RLS Policies control per-user access to table rows. Create a table in this schema first before creating a policy."}),(0,a.jsx)(G.$,{asChild:!0,type:"default",children:(0,a.jsx)(r(),{href:"/project/".concat(f,"/editor"),children:"Create a table"})})]})})}},46087:(e,t,s)=>{"use strict";s.d(t,{$:()=>r,s:()=>i});var a=s(53239),n=s(23850),l=s(73969);function i(e){let{enabled:t,urlKey:s,select:l,onError:i}=e,[r,o]=(0,n.ZA)(s,n.tU.withOptions({history:"push",clearOnDefault:!0})),c=(0,a.useMemo)(()=>r?l(r):void 0,[r,l]);return(0,a.useEffect)(()=>{t&&r&&!c&&(i(Error("not found"),r),o(null))},[t,i,r,o,c]),{value:c,setValue:o}}let r=(e,t,s)=>{t!==e.current?l.oR.error(s):e.current=null}},48550:(e,t,s)=>{var a=s(45558),n=s(10116),l=s(59568),i=s(71057),r=s(10876),o=s(99582);e.exports=function(e,t,s,c){var d=-1,u=n,x=!0,m=e.length,h=[],p=t.length;if(!m)return h;s&&(t=i(t,r(s))),c?(u=l,x=!1):t.length>=200&&(u=o,x=!1,t=new a(t));e:for(;++d<m;){var f=e[d],y=null==s?f:s(f);if(f=c||0!==f?f:0,x&&y==y){for(var g=p;g--;)if(t[g]===y)continue e;h.push(f)}else u(t,y,c)||h.push(f)}return h}},53029:(e,t,s)=>{var a=s(24813);e.exports=function(e){return(null==e?0:e.length)?a(e,0,-1):[]}},53407:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]])},54207:(e,t,s)=>{"use strict";s.d(t,{_:()=>f});var a=s(80263),n=s(30788),l=s.n(n),i=s(37253),r=s.n(i),o=s(76174),c=s(23892),d=s(53239),u=s(61548),x=s(80100),m=s(29244),h=s(97757),p=s(37048);let f=e=>{let{options:t,value:s,placeholder:n,searchPlaceholder:i="Search for option",disabled:f=!1,onChange:y=()=>{}}=e,[g,_]=(0,d.useState)(!1),[j,v]=(0,d.useState)(s||[]),N=s||j,b=l()(t,["disabled"],["desc"]),w=e=>{let s=void 0!==(N||[]).find(t=>t===e.value)?[...r()(N,e.value)]:[...N.concat([e.value])],a=t.filter(e=>e.disabled).map(e=>e.name),n=[...new Set(s.concat(a))];v(n),y(n)};return(0,a.jsx)("div",{className:f?"pointer-events-none opacity-50":"","data-sentry-component":"MultiSelectV2","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsxs)(u.AM,{open:g,onOpenChange:_,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:[(0,a.jsx)(u.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsxs)("div",{className:(0,x.cn)("relative border border-strong bg-control rounded","flex w-full flex-wrap items-start gap-1.5 p-1.5 cursor-pointer","".concat(0===N.length?"h-9":"")),onClick:()=>_(!0),children:[0===N.length&&n&&(0,a.jsx)("div",{className:"px-2 text-sm text-foreground-light h-full flex items-center",children:n}),N.map((e,t)=>{var s;let n="".concat(e,"-").concat(t),l=b.find(t=>t.value===e),i=null!=(s=null==l?void 0:l.disabled)&&s;return l?i?(0,a.jsx)(p.a,{name:l.name},n):(0,a.jsx)(p.h,{name:l.name,handleRemove:()=>w(l)},n):(0,a.jsx)(a.Fragment,{})}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 pl-3 pr-2 flex space-x-1 items-center cursor-pointer ",children:(0,a.jsx)(o.A,{size:16,strokeWidth:2,className:"text-foreground-lighter","data-sentry-element":"ChevronDown","data-sentry-source-file":"MultiSelectV2.tsx"})})]})}),(0,a.jsx)(u.hl,{className:"p-0 w-96 border-strong",side:"bottom",align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsxs)(m.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:[(0,a.jsx)(m.G7,{placeholder:i,"data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx"}),(0,a.jsxs)(m.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:[(0,a.jsx)(m.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:"No options found"}),(0,a.jsx)(m.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsx)(h.FK,{className:(0,x.cn)(b.length>7?"h-[210px]":""),"data-sentry-element":"ScrollArea","data-sentry-source-file":"MultiSelectV2.tsx",children:null==b?void 0:b.map(e=>{let t=!!(N&&N.find(t=>t===e.value));return(0,a.jsx)(m.h_,{value:e.value,className:"cursor-pointer w-full",onClick:()=>w(e),onSelect:()=>w(e),children:(0,a.jsxs)("div",{className:"w-full flex items-center justify-between",children:[e.name,t&&(0,a.jsx)(c.A,{size:14})]})},e.id)})})})]})]})})]})})}},54831:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},66959:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("DatabaseZap",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 15 21.84",key:"14ibmq"}],["path",{d:"M21 5V8",key:"1marbg"}],["path",{d:"M21 12L18 17H22L19 22",key:"zafso"}],["path",{d:"M3 12A9 3 0 0 0 14.59 14.87",key:"1y4wr8"}]])},69988:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]])},74195:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]])},74310:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},77444:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},84438:(e,t,s)=>{"use strict";s.d(t,{A:()=>g});var a=s(80263),n=s(72112),l=s(32157),i=s(23892),r=s(90376),o=s(53239),c=s(32775),d=s(80090),u=s(9620),x=s(99779),m=s(73640),h=s(20033),p=s(61548),f=s(29244),y=s(97757);let g=e=>{let{className:t,disabled:s=!1,size:g="tiny",showError:_=!0,selectedSchemaName:j,supportSelectAll:v=!1,excludedSchemas:N=[],onSelectSchema:b,onSelectCreateSchema:w,portal:S=!0,align:k="start"}=e,[C,A]=(0,o.useState)(!1),{can:q}=(0,d.Qp)(n.aG.TENANT_SQL_ADMIN_WRITE,"schemas"),{data:P}=(0,u.YA)(),{data:E,isLoading:L,isSuccess:T,isError:R,error:M,refetch:z}=(0,c.w$)({projectRef:null==P?void 0:P.ref,connectionString:null==P?void 0:P.connectionString}),I=(E||[]).filter(e=>!N.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[L&&(0,a.jsx)(x.$,{type:"default",className:"w-full [&>span]:w-full",size:g,disabled:!0,children:(0,a.jsx)(m.E,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),_&&R&&(0,a.jsxs)(h.Fc,{variant:"warning",className:"!px-3 !py-3",children:[(0,a.jsx)(h.XL,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,a.jsxs)(h.TN,{className:"text-xs mb-2 break-words",children:["Error: ",null==M?void 0:M.message]}),(0,a.jsx)(x.$,{type:"default",size:"tiny",onClick:()=>z(),children:"Reload schemas"})]}),T&&(0,a.jsxs)(p.AM,{open:C,onOpenChange:A,modal:!1,children:[(0,a.jsx)(p.Wv,{asChild:!0,children:(0,a.jsx)(x.$,{size:g,disabled:s,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,a.jsx)(l.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:j?(0,a.jsxs)("div",{className:"w-full flex gap-1",children:[(0,a.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,a.jsx)("p",{className:"text-foreground",children:"*"===j?"All schemas":j})]}):(0,a.jsx)("div",{className:"w-full flex gap-1",children:(0,a.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema..."})})})}),(0,a.jsx)(p.hl,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:k,portal:S,sameWidthAsTrigger:!0,children:(0,a.jsxs)(f.uB,{children:[(0,a.jsx)(f.G7,{placeholder:"Find schema..."}),(0,a.jsxs)(f.oI,{children:[(0,a.jsx)(f.xL,{children:"No schemas found"}),(0,a.jsx)(f.L$,{children:(0,a.jsxs)(y.FK,{className:(I||[]).length>7?"h-[210px]":"",children:[v&&(0,a.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{b("*"),A(!1)},onClick:()=>{b("*"),A(!1)},children:[(0,a.jsx)("span",{children:"All schemas"}),"*"===j&&(0,a.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==I?void 0:I.map(e=>(0,a.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{b(e.name),A(!1)},onClick:()=>{b(e.name),A(!1)},children:[(0,a.jsx)("span",{children:e.name}),j===e.name&&(0,a.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==w&&q&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.fx,{}),(0,a.jsx)(f.L$,{children:(0,a.jsxs)(f.h_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{w(),A(!1)},onClick:()=>{w(),A(!1)},children:[(0,a.jsx)(r.A,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},87442:(e,t,s)=>{"use strict";s.d(t,{A:()=>h});var a=s(80263),n=s(80814),l=s(22891),i=s(91958),r=s(93873),o=s(37631),c=s(2657),d=s(9497),u=s(29471),x=s(1458);let m=()=>{let e=(0,n.useRouter)(),{ref:t="default"}=(0,l.g)(),s=(0,l._P)("authOverviewPage"),d=(0,l._P)("EnableOAuth21"),u=(0,i.hN)(),{authenticationSignInProviders:m,authenticationRateLimits:h,authenticationEmails:p,authenticationMultiFactor:f,authenticationAttackProtection:y,authenticationAdvanced:g}=(0,c.x)(["authentication:sign_in_providers","authentication:rate_limits","authentication:emails","authentication:multi_factor","authentication:attack_protection","authentication:advanced"]);(0,o.$E)({projectRef:t});let _=e.pathname.split("/")[4];return(0,a.jsx)(r.l,{page:_,menu:(0,x.B)(t,{authenticationSignInProviders:m,authenticationRateLimits:h,authenticationEmails:p,authenticationMultiFactor:f,authenticationAttackProtection:y,authenticationAdvanced:g,authenticationShowOverview:s,authenticationShowSecurityNotifications:u,authenticationOauth21:d}),"data-sentry-element":"ProductMenu","data-sentry-component":"AuthProductMenu","data-sentry-source-file":"AuthLayout.tsx"})},h=(0,d.r)(e=>{let{children:t}=e;return(0,a.jsx)(u.k,{title:"Authentication",product:"Authentication",productMenu:(0,a.jsx)(m,{}),isBlocking:!1,"data-sentry-element":"ProjectLayout","data-sentry-component":"AuthLayout","data-sentry-source-file":"AuthLayout.tsx",children:t})})},93873:(e,t,s)=>{"use strict";s.d(t,{l:()=>r});var a=s(80263),n=s(24487),l=s(21650),i=s(21416);let r=e=>{let{page:t,menu:s}=e;return(0,a.jsx)("div",{className:"flex flex-col space-y-8","data-sentry-component":"ProductMenu","data-sentry-source-file":"index.tsx",children:(0,a.jsx)(n.Ay,{type:"pills","data-sentry-element":"Menu","data-sentry-source-file":"index.tsx",children:s.map((e,r)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"my-6 space-y-8",children:(0,a.jsxs)("div",{className:"mx-3",children:[(0,a.jsx)(n.Ay.Group,{title:e.title?(0,a.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,a.jsx)("span",{children:e.title}),e.isPreview&&(0,a.jsx)(l.E,{variant:"warning",children:"Not production ready"})]}):null}),(0,a.jsx)("div",{children:e.items.map(e=>{let s=e.pages?e.pages.includes(null!=t?t:""):t===e.key;return(0,a.jsx)(i.A,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:s,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key)})})]})}),r!==s.length-1&&(0,a.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},97344:(e,t,s)=>{var a=s(58381),n=s(51276),l=s(5689),i=s(33312),r=s(89527),o=s(79661),c=s(86458),d=s(63570),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(r(e)&&(i(e)||"string"==typeof e||"function"==typeof e.splice||o(e)||d(e)||l(e)))return!e.length;var t=n(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!a(e).length;for(var s in e)if(u.call(e,s))return!1;return!0}},98103:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]])},99940:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(86848).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,2838,21436,57459,26616,76984,72391,35035,40545,596,10508,48340,75187,29471,8750,63335,84698,35349,90636,46593,38792],()=>e(e.s=6981)),_N_E=e.O()}]);