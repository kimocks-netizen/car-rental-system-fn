try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a93c1567-9952-4ddf-a236-0b26fcbff91c",e._sentryDebugIdIdentifier="sentry-dbid-a93c1567-9952-4ddf-a236-0b26fcbff91c")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17150],{107:(e,t,a)=>{var r=a(50117),n=a(94277),s=Object.prototype.hasOwnProperty;e.exports=n(function(e,t,a){s.call(e,a)?e[a].push(t):r(e,a,[t])})},6712:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(86848).A)("Vault",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}],["path",{d:"m7.9 7.9 2.7 2.7",key:"hpeyl3"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}],["path",{d:"m13.4 10.6 2.7-2.7",key:"264c1n"}],["circle",{cx:"7.5",cy:"16.5",r:".5",fill:"currentColor",key:"nkw3mc"}],["path",{d:"m7.9 16.1 2.7-2.7",key:"p81g5e"}],["circle",{cx:"16.5",cy:"16.5",r:".5",fill:"currentColor",key:"fubopw"}],["path",{d:"m13.4 13.4 2.7 2.7",key:"abhel3"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},11658:(e,t,a)=>{"use strict";a.d(t,{y:()=>m});var r=a(72112),n=a(65471),s=a(12957),l=a(70825),o=a(27664),i=a(58350),c=a(80090),d=a(9620),u=a(60734);let m=()=>{var e,t,a,m;let{data:y}=(0,d.YA)(),{data:p}=(0,o.G)({projectRef:null==y?void 0:y.ref}),f=null!=(m=null==p||null==(e=p.app_config)?void 0:e.protocol)?m:"https",h=(null==p||null==(t=p.app_config)?void 0:t.storage_endpoint)||(null==p||null==(a=p.app_config)?void 0:a.endpoint),g=n.V4.find(e=>"s3_vectors_wrapper"===e.name),{can:x}=(0,c.Qp)(r.aG.STORAGE_ADMIN_WRITE,"*"),{mutateAsync:b,isPending:k}=(0,u.S)(),{mutateAsync:j,isPending:v}=(0,i.m_)();return{mutateAsync:async e=>{var t;let{bucketName:a}=e,r=await b({projectRef:null==y?void 0:y.ref,description:(0,l.YF)(a)}),n=(0,l.Eo)(a),o={projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,wrapperMeta:g,formState:{wrapper_name:n,server_name:"".concat(n,"_server"),vault_access_key_id:null==r?void 0:r.access_key,vault_secret_access_key:null==r?void 0:r.secret_key,aws_region:p.region,endpoint_url:(0,s.oA)(null!=(t=null==y?void 0:y.ref)?t:"",f,h),supabase_target_schema:(0,l.Xn)(a)},mode:"skip",tables:[],sourceSchema:"",targetSchema:""};await j(o)},isPending:v||k,hasPermission:x}}},19686:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>c});var r={};a.r(r),a.d(r,{BRAND:()=>o.qt,DIRTY:()=>s.jm,EMPTY_PATH:()=>s.I3,INVALID:()=>s.uY,NEVER:()=>o.tm,OK:()=>s.OK,ParseStatus:()=>s.MY,Schema:()=>o.Sj,ZodAny:()=>o.Ml,ZodArray:()=>o.n,ZodBigInt:()=>o.Lr,ZodBoolean:()=>o.WF,ZodBranded:()=>o.eN,ZodCatch:()=>o.hw,ZodDate:()=>o.aP,ZodDefault:()=>o.Xi,ZodDiscriminatedUnion:()=>o.jv,ZodEffects:()=>o.k1,ZodEnum:()=>o.Vb,ZodError:()=>i.G,ZodFirstPartyTypeKind:()=>o.kY,ZodFunction:()=>o.CZ,ZodIntersection:()=>o.Jv,ZodIssueCode:()=>i.eq,ZodLazy:()=>o.Ih,ZodLiteral:()=>o.DN,ZodMap:()=>o.Ut,ZodNaN:()=>o.Tq,ZodNativeEnum:()=>o.WM,ZodNever:()=>o.iS,ZodNull:()=>o.PQ,ZodNullable:()=>o.l1,ZodNumber:()=>o.rS,ZodObject:()=>o.bv,ZodOptional:()=>o.Ii,ZodParsedType:()=>l.Zp,ZodPipeline:()=>o._c,ZodPromise:()=>o.$i,ZodReadonly:()=>o.EV,ZodRecord:()=>o.b8,ZodSchema:()=>o.lK,ZodSet:()=>o.Kz,ZodString:()=>o.ND,ZodSymbol:()=>o.K5,ZodTransformer:()=>o.BG,ZodTuple:()=>o.y0,ZodType:()=>o.aR,ZodUndefined:()=>o._Z,ZodUnion:()=>o.fZ,ZodUnknown:()=>o._,ZodVoid:()=>o.a0,addIssueToContext:()=>s.zn,any:()=>o.bz,array:()=>o.YO,bigint:()=>o.o,boolean:()=>o.zM,coerce:()=>o.au,custom:()=>o.Ie,date:()=>o.p6,datetimeRegex:()=>o.fm,defaultErrorMap:()=>n.su,discriminatedUnion:()=>o.gM,effect:()=>o.QZ,enum:()=>o.k5,function:()=>o.fH,getErrorMap:()=>n.$W,getParsedType:()=>l.CR,instanceof:()=>o.Nl,intersection:()=>o.E$,isAborted:()=>s.G4,isAsync:()=>s.xP,isDirty:()=>s.DM,isValid:()=>s.fn,late:()=>o.fn,lazy:()=>o.RZ,literal:()=>o.eu,makeIssue:()=>s.y7,map:()=>o.Tj,nan:()=>o.oi,nativeEnum:()=>o.fc,never:()=>o.Zm,null:()=>o.ch,nullable:()=>o.me,number:()=>o.ai,object:()=>o.Ik,objectUtil:()=>l.o6,oboolean:()=>o.yN,onumber:()=>o.p7,optional:()=>o.lq,ostring:()=>o.Di,pipeline:()=>o.Tk,preprocess:()=>o.vk,promise:()=>o.iv,quotelessJson:()=>i.WI,record:()=>o.g1,set:()=>o.hZ,setErrorMap:()=>n.pJ,strictObject:()=>o.re,string:()=>o.Yj,symbol:()=>o.HR,transformer:()=>o.Gu,tuple:()=>o.PV,undefined:()=>o.Vx,union:()=>o.KC,unknown:()=>o.L5,util:()=>l.ZS,void:()=>o.rI});var n=a(54686),s=a(93298),l=a(14595),o=a(10663),i=a(63324);let c=r},23034:(e,t,a)=>{"use strict";a.d(t,{k:()=>c});var r=a(67850),n=a(24523),s=a(9620),l=a(85039),o=a(80658);async function i(e,t){let{projectRef:a}=e;if(!a)throw Error("projectRef is required");let{data:r,error:s}=await (0,n.Jt)("/platform/storage/{ref}/vector-buckets",{params:{path:{ref:a}},signal:t});return s&&(0,n.H4)(s),r}let c=function(e){let{projectRef:t}=e,{enabled:a=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:c}=(0,s.YA)(),d=(null==c?void 0:c.status)===l.BU.ACTIVE_HEALTHY;return(0,r.I)({queryKey:o.w.vectorBuckets(t),queryFn:e=>{let{signal:a}=e;return i({projectRef:t},a)},enabled:a&&void 0!==t&&d,...n})}},29556:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var r=a(80263),n=a(48510),s=a(80100),l=a(39108),o=a(62230),i=a(61767),c=a(99292);let d=e=>{let{bucketType:t,className:a}=e,d=i.TD[t];return(0,r.jsxs)("aside",{className:(0,s.cn)("border border-dashed w-full bg-surface-100 rounded-lg px-4 py-10 flex flex-col gap-y-3 items-center text-center text-balance",a),"data-sentry-component":"EmptyBucketState","data-sentry-source-file":"EmptyBucketState.tsx",children:[(0,r.jsx)(n.K7,{size:24,strokeWidth:1.5,className:"text-foreground-muted","data-sentry-element":"BucketAdd","data-sentry-source-file":"EmptyBucketState.tsx"}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsxs)("h3",{children:["Create ",d.article," ",d.singularName," bucket"]}),(0,r.jsx)("p",{className:"text-foreground-light text-sm",children:d.valueProp})]}),"files"===t&&(0,r.jsx)(o.c,{buttonSize:"tiny",buttonType:"primary",buttonClassName:"w-fit"}),"analytics"===t&&(0,r.jsx)(l.s,{buttonSize:"tiny",buttonType:"primary",buttonClassName:"w-fit"}),"vectors"===t&&(0,r.jsx)(c.G,{})]})}},39108:(e,t,a)=>{"use strict";a.d(t,{s:()=>q});var r=a(80263),n=a(32981),s=a(72112),l=a(90376),o=a(80814),i=a(87494),c=a(73969),d=a(19686),u=a(23850),m=a(22891),y=a(23729),p=a(10723),f=a(78960),h=a(42018),g=a(51355),x=a(80210),b=a(24523),k=a(80658);async function j(e){let{projectRef:t,bucketName:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let{data:r,error:n}=await (0,b.bE)("/platform/storage/{ref}/analytics-buckets",{params:{path:{ref:t}},body:{bucketName:a}});return n&&(0,b.H4)(n),r}let v=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,g.jE)();return(0,x.n)({mutationFn:e=>j(e),async onSuccess(t,a,n){let{projectRef:s}=a;await r.invalidateQueries({queryKey:k.w.analyticsBuckets(s)}),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?c.oR.error("Failed to create analytics bucket: ".concat(e.message)):t(e,a,r)},...a})};var _=a(3413),w=a(43964),C=a(36261),B=a(80090),S=a(84512),A=a(9620),M=a(85039),D=a(95137),E=a(80100),z=a(65887),N=a(27371),Z=a(99779),R=a(44725),T=a(44053),I=a(21993),P=a(61767),F=a(84988);let O=d.Ay.object({name:d.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").refine(e=>!e.endsWith(" "),"The name of the bucket cannot end with a whitespace").refine(e=>"public"!==e,'"public" is a reserved name. Please choose another name')}).superRefine((e,t)=>{if(!I.Bt.test(e.name)){var a;let[r]=null!=(a=e.name.match(I.$P))?a:[];t.addIssue({path:["name"],code:d.Ay.ZodIssueCode.custom,message:r?'Bucket name cannot contain the "'.concat(r,'" character'):"Bucket name contains an invalid special character"})}}),V="create-analytics-storage-bucket-form",q=e=>{var t,a;let{buttonSize:d="tiny",buttonType:g="default",buttonClassName:x,disabled:b=!1,tooltip:k}=e,j=(0,o.useRouter)(),{ref:I}=(0,m.g)(),{data:q}=(0,S.s)(),{data:L}=(0,A.YA)(),{can:G}=(0,B.Qp)(s.aG.STORAGE_WRITE,"*"),{extension:U,state:W}=(0,F.P)(),[Y,K]=(0,u.ZA)("new",u.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),{data:H=[],isLoading:J}=(0,_.j)({projectRef:I}),$=(0,f.mM)({projectRef:I}),Q="needs-upgrade"===W,{mutate:X}=(0,C.h)(),{mutateAsync:ee,isPending:et}=v({onError:()=>{}}),{mutateAsync:ea,isPending:er}=(0,w.Z)(),{mutateAsync:en,isPending:es}=(0,h.E)(),el=P.TD.analytics,eo=es||er||et,ei=!G||!$||J||H.length>=2||b,ec=(0,i.mN)({resolver:(0,n.u)(O),defaultValues:{name:""}}),ed=async e=>{if(!I)return console.error("Project ref is required");if(!L)return console.error("Project details is required");if(!U)return console.error("Unable to find wrappers extension");if(H.some(t=>t.name===e.name))return c.oR.error("Bucket name already exists");try{var t,a;await ee({projectRef:I,bucketName:e.name}),"not-installed"===W?(await en({projectRef:null==L?void 0:L.ref,connectionString:null==L?void 0:L.connectionString,name:U.name,schema:null!=(t=U.schema)?t:"extensions",version:U.default_version}),await ea({bucketName:e.name})):"installed"===W&&await ea({bucketName:e.name}),X({action:"storage_bucket_created",properties:{bucketType:"analytics"},groups:{project:null!=I?I:"Unknown",organization:null!=(a=null==q?void 0:q.slug)?a:"Unknown"}}),ec.reset(),c.oR.success("Created bucket “".concat(e.name,"”")),K(!1),j.push("/project/".concat(I,"/storage/analytics/buckets/").concat(e.name))}catch(e){c.oR.error("Failed to create bucket: ".concat(e.message))}};return(0,r.jsxs)(D.lG,{open:Y,onOpenChange:e=>{e||(ec.reset(),K(!1))},"data-sentry-element":"Dialog","data-sentry-component":"CreateAnalyticsBucketModal","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(D.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,r.jsx)(y.G,{block:!0,size:d,type:g,className:x,icon:(0,r.jsx)(l.A,{size:14}),disabled:ei,tabIndex:ei?-1:0,style:{justifyContent:"start"},onClick:()=>K(!0),tooltip:{content:{side:(null==k||null==(t=k.content)?void 0:t.side)||"bottom",className:(0,E.cn)($?"":"w-72 text-center"),text:$?G?H.length>=2?"Bucket limit reached":null==k||null==(a=k.content)?void 0:a.text:"You need additional permissions to create buckets":"Analytics buckets are not enabled for your project. Please contact support to enable it."}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"New bucket"})}),(0,r.jsxs)(D.Cf,{size:"large","aria-describedby":void 0,"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(D.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,r.jsxs)(D.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:["Create ",el.singularName," bucket"]})}),(0,r.jsx)(D.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx"}),(0,r.jsx)(z.lV,{...ec,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,r.jsx)("form",{id:V,onSubmit:ec.handleSubmit(ed),children:(0,r.jsxs)(D.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(z.zB,{name:"name",control:ec.control,render:e=>{let{field:t}=e;return(0,r.jsx)(T.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",description:"Must be between 3–63 characters. Only lowercase letters, numbers, dots, and hyphens are allowed.",children:(0,r.jsx)(z.MJ,{children:(0,r.jsx)(N.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx"},"name"),Q?(0,r.jsx)(R.Z,{type:"warning",title:"Wrappers extension must be updated for Iceberg Wrapper support",children:(0,r.jsxs)("p",{className:"prose max-w-full text-sm !leading-normal",children:["Update the ",(0,r.jsx)("code",{className:"text-xs",children:"wrappers"})," extension by upgrading your project from your"," ",(0,r.jsx)(p.g,{href:"/project/".concat(I,"/settings/infrastructure"),children:"project settings"})," ","before creating an Analytics bucket."," ",(0,r.jsx)(p.g,{href:"".concat(M.aq,"/guides/database/extensions/wrappers/iceberg"),children:"Learn more"}),"."]})}):(0,r.jsx)(R.Z,{type:"default",children:(0,r.jsxs)("p",{className:"!leading-normal",children:["Supabase will install the"," ","installed"!==W?"Wrappers extension and ":"","Iceberg Wrapper integration on your behalf."," ",(0,r.jsx)(p.g,{href:"".concat(M.aq,"/guides/database/extensions/wrappers/iceberg"),children:"Learn more"}),"."]})})]})})}),(0,r.jsxs)(D.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(Z.$,{type:"default",disabled:eo,onClick:()=>K(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"Cancel"}),(0,r.jsx)(Z.$,{form:V,htmlType:"submit",loading:eo,disabled:Q||eo,"data-sentry-element":"Button","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"Create bucket"})]})]})]})}},42018:(e,t,a)=>{"use strict";a.d(t,{E:()=>m});var r=a(72391),n=a(29395),s=a(51355),l=a(80210),o=a(73969),i=a(30659),c=a(59356),d=a(87727);async function u(e){let{projectRef:t,connectionString:a,schema:s,name:l,version:o,cascade:i=!1,createSchema:d=!1}=e,u=new Headers;a&&u.set("x-connection-encrypted",a);let{sql:m}=r.A.extensions.create({schema:s,name:l,version:o,cascade:i}),{result:y}=await (0,c.E)({projectRef:t,connectionString:a,sql:d?"create schema if not exists ".concat((0,n.bD)(s),"; ").concat(m):m,queryKey:["extension","create"]});return y}let m=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,s.jE)();return(0,l.n)({mutationFn:e=>u(e),async onSuccess(t,a,n){let{projectRef:s}=a;await Promise.all([r.invalidateQueries({queryKey:d.I.list(s)}),r.invalidateQueries({queryKey:i.n.upgradeEligibility(s)})]),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?o.oR.error("Failed to enable database extension: ".concat(e.message)):t(e,a,r)},...a})}},42092:(e,t,a)=>{var r=a(48550),n=a(40293),s=a(92479),l=a(50084);e.exports=s(function(e,t){return l(e)?r(e,n(t,1,l,!0)):[]})},48550:(e,t,a)=>{var r=a(45558),n=a(10116),s=a(59568),l=a(71057),o=a(10876),i=a(99582);e.exports=function(e,t,a,c){var d=-1,u=n,m=!0,y=e.length,p=[],f=t.length;if(!y)return p;a&&(t=l(t,o(a))),c?(u=s,m=!1):t.length>=200&&(u=i,m=!1,t=new r(t));e:for(;++d<y;){var h=e[d],g=null==a?h:a(h);if(h=c||0!==h?h:0,m&&g==g){for(var x=f;x--;)if(t[x]===g)continue e;p.push(h)}else u(t,g,c)||p.push(h)}return p}},56492:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(86848).A)("Clock5",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 14.5 16",key:"1pcbox"}]])},62230:(e,t,a)=>{"use strict";a.d(t,{c:()=>F});var r=a(80263),n=a(32981),s=a(72112),l=a(90376),o=a(53239),i=a(87494),c=a(73969),d=a(19686),u=a(23850),m=a(22891),y=a(16581),p=a(23729),f=a(10723),h=a(78960),g=a(51355),x=a(80210),b=a(24523),k=a(80658);async function j(e){let{projectRef:t,id:a,type:r,isPublic:n,file_size_limit:s,allowed_mime_types:l}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let o={id:a,type:r,public:n};"STANDARD"===r&&(s&&(o.file_size_limit=s),l&&(o.allowed_mime_types=l));let{data:i,error:c}=await (0,b.bE)("/platform/storage/{ref}/buckets",{params:{path:{ref:t}},body:o});return c&&(0,b.H4)(c),i}let v=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,g.jE)();return(0,x.n)({mutationFn:e=>j(e),async onSuccess(t,a,n){let{projectRef:s}=a;await r.invalidateQueries({queryKey:k.w.buckets(s)}),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?c.oR.error("Failed to create bucket: ".concat(e.message)):t(e,a,r)},...a})};var _=a(36261),w=a(80090),C=a(84512),B=a(85039),S=a(95137),A=a(65887),M=a(27371),D=a(72608),E=a(66329),z=a(99779),N=a(44725),Z=a(44053),R=a(21993),T=a(12957);let I=d.Ay.object({name:d.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").refine(e=>!e.endsWith(" "),"The name of the bucket cannot end with a whitespace").refine(e=>"public"!==e,'"public" is a reserved name. Please choose another name'),public:d.Ay.boolean().default(!1),has_file_size_limit:d.Ay.boolean().default(!1),formatted_size_limit:d.Ay.coerce.number().min(0,"File size upload limit has to be at least 0").optional(),allowed_mime_types:d.Ay.string().trim().default("")}).superRefine((e,t)=>{if(!R.Bt.test(e.name)){var a;let[r]=null!=(a=e.name.match(R.$P))?a:[];t.addIssue({path:["name"],code:d.Ay.ZodIssueCode.custom,message:r?'Bucket name cannot contain the "'.concat(r,'" character'):"Bucket name contains an invalid special character"})}}),P="create-storage-bucket-form",F=e=>{var t;let{buttonSize:a="tiny",buttonType:d="default",buttonClassName:g,label:x="New bucket"}=e,{ref:b}=(0,m.g)(),{data:k}=(0,C.s)(),[j,R]=(0,u.ZA)("new",u.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),[F,O]=(0,o.useState)(y.s2.MB),[V,q]=(0,o.useState)(!1),{can:L}=(0,w.Qp)(s.aG.STORAGE_WRITE,"*"),{data:G}=(0,h.Ij)({projectRef:b},{enabled:B.pe}),{value:U,unit:W}=(0,T.Jb)(null!=(t=null==G?void 0:G.fileSizeLimit)?t:0),Y="".concat(U," ").concat(W),{mutate:K}=(0,_.h)(),{mutateAsync:H,isPending:J}=v({onError:()=>{}}),$=(0,i.mN)({resolver:(0,n.u)(I),defaultValues:{name:"",public:!1,has_file_size_limit:!1,formatted_size_limit:void 0,allowed_mime_types:""}}),{formatted_size_limit:Q}=$.formState.errors,X=$.watch("public"),ee=$.watch("has_file_size_limit"),et=async e=>{var t,a;if(!b)return console.error("Project ref is required");try{let a=e.has_file_size_limit&&void 0!==e.formatted_size_limit?(0,T.OG)(e.formatted_size_limit,F):void 0,r=V&&e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):void 0;if(a&&(null==G?void 0:G.fileSizeLimit)&&a>G.fileSizeLimit)return $.setError("formatted_size_limit",{type:"manual",message:"exceed_global_limit"});await H({projectRef:b,id:e.name,type:"STANDARD",isPublic:e.public,file_size_limit:a,allowed_mime_types:r}),K({action:"storage_bucket_created",properties:{bucketType:"STANDARD"},groups:{project:null!=b?b:"Unknown",organization:null!=(t=null==k?void 0:k.slug)?t:"Unknown"}}),c.oR.success("Successfully created bucket ".concat(e.name)),$.reset(),O(y.s2.MB),R(!1)}catch(t){let e=(null==(a=t.message)?void 0:a.toLowerCase())||"";e.includes("mime type")&&(e.includes("is not supported")||e.includes("not supported"))?$.setError("allowed_mime_types",{type:"manual",message:"Invalid MIME type format. Please check your input."}):c.oR.error("Failed to create bucket: ".concat(t.message))}};return(0,r.jsxs)(S.lG,{open:j,onOpenChange:e=>{e||($.reset(),O(y.s2.MB),R(!1))},"data-sentry-element":"Dialog","data-sentry-component":"CreateBucketModal","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(S.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(p.G,{block:!0,size:a,type:d,className:g,icon:(0,r.jsx)(l.A,{size:14}),disabled:!L,style:{justifyContent:"start"},onClick:()=>R(!0),tabIndex:L?0:-1,tooltip:{content:{side:"bottom",text:L?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateBucketModal.tsx",children:x})}),(0,r.jsxs)(S.Cf,{"aria-describedby":void 0,"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(S.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(S.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateBucketModal.tsx",children:"Create file bucket"})}),(0,r.jsx)(S.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsx)(A.lV,{...$,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsxs)("form",{id:P,onSubmit:$.handleSubmit(et),children:[(0,r.jsx)(S.OO,{className:"flex flex-col gap-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(A.zB,{name:"name",control:$.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",children:(0,r.jsx)(A.MJ,{children:(0,r.jsx)(M.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"name")}),(0,r.jsx)(S.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsxs)(S.OO,{className:"space-y-3","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(A.zB,{name:"public",control:$.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.M,{hideMessage:!0,name:"public",label:"Public bucket",description:"Allow anyone to read objects without authorization",layout:"flex",children:(0,r.jsx)(A.MJ,{children:(0,r.jsx)(D.d,{id:"public",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"public"),X&&(0,r.jsx)(N.Z,{type:"warning",title:"Public buckets are not protected",description:"Users can read objects in public buckets without any authorization. Row level security (RLS) policies are still required for other operations such as object uploads and deletes."})]}),(0,r.jsx)(S.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsxs)(S.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(A.zB,{name:"has_file_size_limit",control:$.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.M,{name:"has_file_size_limit",label:"Restrict file size",description:"Prevent uploading of files larger than a specified limit",layout:"flex",children:(0,r.jsx)(A.MJ,{children:(0,r.jsx)(D.d,{id:"has_file_size_limit",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"has_file_size_limit"),ee&&(0,r.jsxs)("div",{children:[(0,r.jsx)(A.zB,{name:"formatted_size_limit",control:$.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.M,{hideMessage:!0,name:"formatted_size_limit",label:"File size limit",children:(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-x-2",children:[(0,r.jsx)("div",{className:"col-span-8",children:(0,r.jsx)(A.MJ,{children:(0,r.jsx)(M.p,{id:"formatted_size_limit","aria-label":"File size limit",type:"number",min:0,placeholder:"0",...t})})}),(0,r.jsx)("div",{className:"col-span-4",children:(0,r.jsxs)(E.l6,{value:F,onValueChange:O,children:[(0,r.jsx)(E.bq,{"aria-label":"File size limit unit",size:"small",children:(0,r.jsx)(E.yv,{children:F})}),(0,r.jsx)(E.gC,{children:Object.values(y.s2).map(e=>(0,r.jsx)(E.eb,{value:e,className:"text-xs",children:e},e))})]})})]})})}},"formatted_size_limit"),(null==Q?void 0:Q.message)==="exceed_global_limit"&&(0,r.jsxs)(A.C5,{className:"mt-2",children:["Exceeds global limit of ",Y,". Increase limit in"," ",(0,r.jsx)(f.g,{className:"text-destructive decoration-destructive-500 hover:decoration-destructive",href:"/project/".concat(b,"/storage/settings"),onClick:()=>R(!1),children:"Storage Settings"})," ","first."]}),B.pe&&(0,r.jsxs)("p",{className:"text-sm text-foreground-lighter mt-2",children:["This project has a"," ",(0,r.jsx)(f.g,{className:"text-foreground-light hover:text-foreground",href:"/project/".concat(b,"/storage/settings"),onClick:()=>R(!1),children:"global file size limit"})," ","of ",Y,"."]})]})]}),(0,r.jsx)(S.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsxs)(S.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(Z.M,{name:"has_allowed_mime_types",label:"Restrict MIME types",description:"Allow only certain types of files to be uploaded",layout:"flex","data-sentry-element":"FormItemLayout","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(A.MJ,{"data-sentry-element":"FormControl_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(D.d,{id:"has_allowed_mime_types",size:"large",checked:V,onCheckedChange:q,"data-sentry-element":"Switch","data-sentry-source-file":"CreateBucketModal.tsx"})})}),V&&(0,r.jsx)(A.zB,{name:"allowed_mime_types",control:$.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.M,{name:"allowed_mime_types",label:"Allowed MIME types",labelOptional:"Comma separated values",description:"Wildcards are allowed, e.g. image/*.",children:(0,r.jsx)(A.MJ,{children:(0,r.jsx)(M.p,{id:"allowed_mime_types",...t,placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc"})})})}},"allowed_mime_types")]})]})}),(0,r.jsxs)(S.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(z.$,{type:"default",disabled:J,onClick:()=>R(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateBucketModal.tsx",children:"Cancel"}),(0,r.jsx)(z.$,{form:P,htmlType:"submit",loading:J,disabled:J,"data-sentry-element":"Button","data-sentry-source-file":"CreateBucketModal.tsx",children:"Create"})]})]})]})}},63685:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(86848).A)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]])},64382:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(86848).A)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]])},70825:(e,t,a)=>{"use strict";a.d(t,{Eo:()=>o,Xn:()=>l,YF:()=>s});var r=a(52793),n=a.n(r);let s=e=>"".concat(n()(e),"_keys"),l=e=>"fdw_vector_".concat(n()(e)),o=e=>"".concat(n()(e),"_fdw")},87829:(e,t,a)=>{"use strict";a.d(t,{D:()=>d});var r=a(80263),n=a(22891),s=a(61767),l=a(39691),o=a(41273),i=a(8750),c=a(37873);let d=e=>{var t;let{title:a,hideSubtitle:d=!1,children:u}=e,{ref:m}=(0,n.g)(),y=(0,l.kM)(),p=y&&"s3"!==y?s.TD[y]:void 0;return(0,r.jsx)(i.M,{title:a||(null!=(t=null==p?void 0:p.displayName)?t:"Storage"),subtitle:d?null:(null==p?void 0:p.description)||"Manage your storage buckets and files.",navigationItems:"files"===y?[{label:"Buckets",href:"/project/".concat(m,"/storage/files")},{label:"Settings",href:"/project/".concat(m,"/storage/files/settings")},{label:"Policies",href:"/project/".concat(m,"/storage/files/policies")}]:[],secondaryActions:(null==p?void 0:p.docsUrl)?[(0,r.jsx)(o.A,{href:p.docsUrl},"docs")]:[],"data-sentry-element":"PageLayout","data-sentry-component":"StorageBucketsLayout","data-sentry-source-file":"StorageBucketsLayout.tsx",children:(0,r.jsx)(c.eh,{className:"min-h-0","data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"StorageBucketsLayout.tsx",children:u})})}},88445:(e,t,a)=>{"use strict";a.d(t,{k:()=>l});var r=a(93784),n=a(22730),s=a(9620);let l=()=>{var e,t;let{data:a}=(0,s.YA)(),{data:l,isLoading:o}=(0,n.z)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),i=r.o.find(e=>"s3_vectors_wrapper"===e.id);if(!i||"wrapper"!==i.type)return{extension:void 0,state:"not-found"};let c=i.meta,d=null==l?void 0:l.find(e=>"wrappers"===e.name),u=!!(null==d?void 0:d.installed_version),m=(null!=(e=null==d?void 0:d.installed_version)?e:"")>=(null!=(t=null==c?void 0:c.minimumExtensionVersion)?t:"");return{extension:d,state:o?"loading":u?m?"installed":"needs-upgrade":"not-installed"}}},94637:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(86848).A)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]])},99292:(e,t,a)=>{"use strict";a.d(t,{G:()=>O});var r=a(80263),n=a(32981),s=a(72112),l=a(90376),o=a(53239),i=a(87494),c=a(73969),d=a(19686),u=a(23850),m=a(22891),y=a(23729),p=a(10723),f=a(53404),h=a(11658),g=a(51355),x=a(80210),b=a(24523),k=a(80658);async function j(e){let{projectRef:t,bucketName:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let{data:r,error:n}=await (0,b.bE)("/platform/storage/{ref}/vector-buckets",{params:{path:{ref:t}},body:{bucketName:a}});return n&&(0,b.H4)(n),r}let v=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,g.jE)();return(0,x.n)({mutationFn:e=>j(e),async onSuccess(t,a,n){let{projectRef:s}=a;await r.invalidateQueries({queryKey:k.w.vectorBuckets(s)}),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?c.oR.error("Failed to create vector bucket: ".concat(e.message)):t(e,a,r)},...a})};var _=a(23034),w=a(36261),C=a(80090),B=a(84512),S=a(9620),A=a(85039),M=a(95137),D=a(65887),E=a(27371),z=a(99779),N=a(44725),Z=a(44053),R=a(21993),T=a(88445),I=a(70825);let P=d.Ay.object({name:d.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").superRefine((e,t)=>{if(!R.Bt.test(e)){var a;let[r]=null!=(a=e.match(R.$P))?a:[];t.addIssue({path:[],code:d.Ay.ZodIssueCode.custom,message:r?'Bucket name cannot contain the "'.concat(r,'" character'):"Bucket name contains an invalid special character"})}})}),F="create-storage-bucket-form",O=()=>{let{ref:e}=(0,m.g)(),{data:t}=(0,B.s)(),{data:a}=(0,S.YA)(),[d,g]=(0,o.useState)(!1),[x,b]=(0,u.ZA)("new",u.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),{can:k}=(0,C.Qp)(s.aG.STORAGE_WRITE,"*"),{data:j}=(0,_.k)({projectRef:e}),R=(0,i.mN)({resolver:(0,n.u)(P),defaultValues:{name:""}}),{mutate:O}=(0,w.h)(),{mutateAsync:V}=v({onError:()=>{}}),{state:q}=(0,T.k)(),{mutateAsync:L}=(0,h.y)(),{mutateAsync:G}=(0,f.C)({onError:()=>{}}),U=async r=>{var n,s;if(!e)return console.error("Project ref is required");if((null!=(n=null==j?void 0:j.vectorBuckets)?n:[]).some(e=>e.vectorBucketName===r.name))return c.oR.error("Bucket name already exists");g(!0);try{await V({projectRef:e,bucketName:r.name})}catch(e){c.oR.error("Failed to create vector bucket: ".concat(e.message)),g(!1);return}try{"installed"===q&&(await L({bucketName:r.name}),await G({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString,name:(0,I.Xn)(r.name)}))}catch(e){c.oR.warning("Failed to create vector bucket integration: ".concat(e.message,". The bucket will be created but you will need to manually install the integration."))}g(!1),O({action:"storage_bucket_created",properties:{bucketType:"vector"},groups:{project:null!=e?e:"Unknown",organization:null!=(s=null==t?void 0:t.slug)?s:"Unknown"}}),c.oR.success("Successfully created vector bucket ".concat(r.name)),R.reset(),b(!1)};return(0,o.useEffect)(()=>{x||R.reset()},[x]),(0,r.jsxs)(M.lG,{open:x,onOpenChange:b,"data-sentry-element":"Dialog","data-sentry-component":"CreateVectorBucketDialog","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(M.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)(y.G,{block:!0,size:"tiny",type:"primary",className:"w-fit",icon:(0,r.jsx)(l.A,{size:14}),disabled:!k,tabIndex:k?0:-1,onClick:()=>b(!0),tooltip:{content:{side:"bottom",text:k?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"New bucket"})}),(0,r.jsxs)(M.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(M.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)(M.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Create vector bucket"})}),(0,r.jsx)(M.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateVectorBucketDialog.tsx"}),(0,r.jsx)(D.lV,{...R,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)("form",{id:F,onSubmit:R.handleSubmit(U),children:(0,r.jsxs)(M.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(D.zB,{name:"name",control:R.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",description:"A target schema will be created that matches this name.",children:(0,r.jsx)(D.MJ,{children:(0,r.jsx)(E.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateVectorBucketDialog.tsx"},"name"),(0,r.jsx)(N.Z,{type:"default","data-sentry-element":"Admonition","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsxs)("p",{children:["Supabase will install the"," ","installed"!==q?"Wrappers extension and ":"","S3 Vectors Wrapper integration on your behalf."," ",(0,r.jsx)(p.g,{href:"".concat(A.aq,"/guides/database/extensions/wrappers/s3-vectors"),"data-sentry-element":"InlineLink","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Learn more"}),"."]})})]})})}),(0,r.jsxs)(M.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(z.$,{type:"default",disabled:d,onClick:()=>b(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Cancel"}),(0,r.jsx)(z.$,{form:F,htmlType:"submit",loading:d,"data-sentry-element":"Button","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Create"})]})]})]})}}}]);