try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="798ba418-b02e-4777-aeb1-8cec3e3fc422",e._sentryDebugIdIdentifier="sentry-dbid-798ba418-b02e-4777-aeb1-8cec3e3fc422")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6239],{1438:(e,t,s)=>{"use strict";s.d(t,{b:()=>_});var r=s(80263),a=s(39899),n=s.n(a),l=s(29948),i=s(76174),o=s(41121),d=s(9753),c=s(77406),u=s(77191),m=s.n(u),x=s(53239),p=s(73969),h=s(52555),f=s.n(h),y=s(22891),g=s(38904),v=s(21162),j=s(99779);let _=e=>{let{iconOnly:t=!1,type:s="default",text:a="Export",align:u="start",results:h,fileName:_,onDownloadAsCSV:b,onCopyAsMarkdown:w,onCopyAsJSON:N}=e,{ref:S}=(0,y.g)(),A=h.map(e=>{let t={...e};return Object.keys(e).forEach(s=>{"object"==typeof e[s]&&(t[s]=JSON.stringify(e[s]))}),t}),C=(0,x.useMemo)(()=>{if(h){let e=Array.from(h)[0];if(e)return Object.keys(e)}},[h]);return(0,r.jsxs)(v.rI,{"data-sentry-element":"DropdownMenu","data-sentry-component":"DownloadResultsButton","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(v.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,r.jsx)(j.$,{type:s,icon:t?(0,r.jsx)(l.A,{}):void 0,iconRight:t?void 0:(0,r.jsx)(i.A,{}),disabled:0===h.length,className:t?"w-7":"","data-sentry-element":"Button","data-sentry-source-file":"DownloadResultsButton.tsx",children:!t&&a})}),(0,r.jsxs)(v.SQ,{align:u,className:"w-44","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(v._2,{asChild:!0,className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,r.jsxs)(f(),{href:"/project/".concat(S,"/settings/log-drains"),"data-sentry-element":"Link","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(o.A,{size:14,"data-sentry-element":"Settings","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Add a Log Drain"})]})}),(0,r.jsxs)(v._2,{onClick:()=>{if(navigator){0==A.length&&(0,p.oR)("Results are empty");let e=Object.keys(A[0]),t=A.map(t=>{let s=[];return e.forEach(e=>s.push(t[e])),s}),s=[e].concat(t),r=(0,c.Q)(s);(0,g.l)(r,()=>{p.oR.success("Copied results to clipboard"),null==w||w()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(d.A,{size:14,"data-sentry-element":"Copy","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Copy as markdown"})]}),(0,r.jsxs)(v._2,{onClick:()=>{if(navigator){if(0===h.length)return(0,p.oR)("Results are empty");(0,g.l)(JSON.stringify(h,null,2),()=>{p.oR.success("Copied results to clipboard"),null==N||N()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(d.A,{size:14,"data-sentry-element":"Copy","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Copy as JSON"})]}),(0,r.jsxs)(v._2,{className:"gap-x-2",onClick:()=>(()=>{let e=new Blob([m().unparse(A,{columns:C})],{type:"text/csv;charset=utf-8;"});n()(e,"".concat(_,".csv")),p.oR.success("Downloading results as CSV"),null==b||b()})(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,r.jsx)(l.A,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,r.jsx)("p",{children:"Download CSV"})]})]})]})}},4322:(e,t,s)=>{"use strict";s.d(t,{tV:()=>c,_X:()=>d});var r=s(72391),a=s(67850),n=s(59356);let l={databaseRoles:e=>["projects",e,"database-roles"]},i=r.A.roles.list();async function o(e,t){let{projectRef:s,connectionString:r}=e,{result:a}=await (0,n.E)({projectRef:s,connectionString:r,sql:i.sql,queryKey:["database-roles"]},t);return a}let d=function(e){let{projectRef:t,connectionString:s}=e,{enabled:r=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:l.databaseRoles(t),queryFn:e=>{let{signal:r}=e;return o({projectRef:t,connectionString:s},r)},enabled:r&&void 0!==t,...n})};function c(e,t){return e.invalidateQueries({queryKey:l.databaseRoles(t)})}},15833:(e,t,s)=>{"use strict";s.d(t,{$m:()=>c,As:()=>d,nD:()=>o,ub:()=>u});var r=s(80263),a=s(50286),n=s(76174),l=s(53239),i=s(80100);let o=a.bL,d=l.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.q7,{ref:t,className:(0,i.cn)("border-b",s),...n})});d.displayName="AccordionItem";let c=l.forwardRef((e,t)=>{let{className:s,children:l,hideIcon:o,...d}=e;return(0,r.jsx)(a.Y9,{className:"flex",children:(0,r.jsxs)(a.l9,{ref:t,className:(0,i.cn)("flex flex-1 gap-2 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180 text-left",s),...d,children:[l,!o&&(0,r.jsx)(n.A,{className:"h-4 w-4 transition-transform duration-200 shrink-0"})]})})});c.displayName=a.l9.displayName;let u=l.forwardRef((e,t)=>{let{className:s,children:n,...l}=e;return(0,r.jsx)(a.UC,{ref:t,className:(0,i.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",s),...l,children:(0,r.jsx)("div",{className:"pb-4 pt-0",children:n})})});u.displayName=a.UC.displayName},21861:(e,t,s)=>{"use strict";s.d(t,{$:()=>f,n:()=>h});var r=s(80263),a=s(76174),n=s(53239),l=s(883),i=s(61548),o=s(66329),d=s(99779),c=s(80100),u=s(64758),m=s(10663);let x={"=":"Equals",">=":"Greater than or equal to","<=":"Less than or equal to",">":"Greater than","<":"Less than","!=":"Not equal to"},p=m.k5(["=",">=","<=",">","<","!="]),h=m.Ik({operator:p,value:m.ai()}),f=e=>{let{label:t,value:s,onChange:m,operators:p=["=",">=","<=",">","<","!="],defaultOperator:h="=",placeholder:f="Enter value",min:y,max:g,step:v=1,isLoading:j=!1,className:_}=e,[b,w]=(0,n.useState)(!1),[N,S]=(0,n.useState)(s),A=null!==s;(0,n.useEffect)(()=>{b||S(s)},[b,s]);let C=()=>{m(N),w(!1)},q=()=>s?"".concat(s.operator," ").concat(s.value):"";return(0,r.jsxs)(i.AM,{open:b,onOpenChange:w,"data-sentry-element":"Popover","data-sentry-component":"ReportsNumericFilter","data-sentry-source-file":"ReportsNumericFilter.tsx",children:[(0,r.jsx)(i.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger","data-sentry-source-file":"ReportsNumericFilter.tsx",children:(0,r.jsx)(d.$,{type:A?"default":"outline",className:(0,c.cn)("min-w-20 border-dashed relative group justify-between",{"border-solid":A},_),iconRight:(0,r.jsx)(a.A,{size:14}),"data-sentry-element":"Button","data-sentry-source-file":"ReportsNumericFilter.tsx",children:(0,r.jsxs)("span",{children:[t,q()&&(0,r.jsx)("span",{className:"ml-1 text-xs font-mono text-foreground-light",children:q()})]})})}),(0,r.jsxs)(i.hl,{align:"start",className:"p-0 w-72",portal:!0,"data-sentry-element":"PopoverContent","data-sentry-source-file":"ReportsNumericFilter.tsx",children:[(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C()},className:"px-3 py-3 flex flex-col gap-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsx)(l.J,{className:"text-xs","data-sentry-element":"Label","data-sentry-source-file":"ReportsNumericFilter.tsx",children:"Operator"}),(0,r.jsxs)(o.l6,{value:(null==N?void 0:N.operator)||h,onValueChange:e=>{var t;S({operator:e,value:null!=(t=null==N?void 0:N.value)?t:0})},"data-sentry-element":"Select","data-sentry-source-file":"ReportsNumericFilter.tsx",children:[(0,r.jsx)(o.bq,{className:"text-xs","data-sentry-element":"SelectTrigger","data-sentry-source-file":"ReportsNumericFilter.tsx",children:(0,r.jsx)(o.yv,{"data-sentry-element":"SelectValue","data-sentry-source-file":"ReportsNumericFilter.tsx"})}),(0,r.jsx)(o.gC,{"data-sentry-element":"SelectContent","data-sentry-source-file":"ReportsNumericFilter.tsx",children:p.map(e=>(0,r.jsxs)(o.eb,{value:e,className:"text-xs flex items-center",children:[(0,r.jsx)("span",{className:"font-mono",children:e}),(0,r.jsx)("span",{className:"text-foreground-light ml-2",children:x[e]})]},e))})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsx)(l.J,{className:"text-xs","data-sentry-element":"Label","data-sentry-source-file":"ReportsNumericFilter.tsx",children:"Value"}),(0,r.jsx)(u.p,{autoFocus:!0,type:"number",placeholder:f,value:(null==N?void 0:N.value)||"",onChange:e=>(e=>{if(""===e)S(null);else{let s=parseFloat(e);if(!isNaN(s)){var t;S({operator:null!=(t=null==N?void 0:N.operator)?t:h,value:s})}}})(e.target.value),min:y,max:g,step:v,"data-sentry-element":"Input","data-sentry-source-file":"ReportsNumericFilter.tsx"}),(void 0!==y||void 0!==g)&&(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:void 0!==y&&void 0!==g?"Range: ".concat(y," - ").concat(g):void 0!==y?"Min: ".concat(y):"Max: ".concat(g)})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-default p-2",children:[(0,r.jsx)(d.$,{size:"tiny",type:"outline",onClick:()=>{S(null)},"data-sentry-element":"Button","data-sentry-source-file":"ReportsNumericFilter.tsx",children:"Clear"}),(0,r.jsx)(d.$,{loading:j,size:"tiny",type:"primary",onClick:C,htmlType:"button","data-sentry-element":"Button","data-sentry-source-file":"ReportsNumericFilter.tsx",children:"Apply"})]})]})]})}},22730:(e,t,s)=>{"use strict";s.d(t,{z:()=>c});var r=s(78510),a=s(67850),n=s(24523),l=s(9620),i=s(85039),o=s(87727);async function d(e,t,s){let{projectRef:a,connectionString:l}=e;if(!a)throw Error("projectRef is required");let i=new Headers(s);l&&i.set("x-connection-encrypted",l);let{data:o,error:d}=await (0,n.Jt)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":l,"x-pg-application-name":r.r},path:{ref:a}},headers:i,signal:t});return d&&(0,n.H4)(d),o}let c=function(e){let{projectRef:t,connectionString:s}=e,{enabled:r=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:c}=(0,l.YA)(),u=(null==c?void 0:c.status)===i.BU.ACTIVE_HEALTHY;return(0,a.I)({queryKey:o.I.list(t),queryFn:e=>{let{signal:r}=e;return d({projectRef:t,connectionString:s},r)},enabled:r&&void 0!==t&&u,...n})}},22806:(e,t,s)=>{"use strict";s.d(t,{$v:()=>g,EO:()=>p,Lt:()=>d,Rx:()=>v,Zr:()=>j,ck:()=>f,r7:()=>y,tv:()=>c,wd:()=>h});var r=s(80263),a=s(39823),n=s(53239),l=s(80100),i=s(99779),o=s(79279);let d=a.bL,c=a.l9,u=e=>{let{children:t,...s}=e;return(0,r.jsx)(a.ZL,{...s,"data-sentry-element":"AlertDialogPrimitive.Portal","data-sentry-component":"AlertDialogPortal","data-sentry-source-file":"alert-dialog.tsx",children:(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:t})})};u.displayName=a.ZL.displayName;let m=n.forwardRef((e,t)=>{let{className:s,centered:n=!0,...i}=e;return(0,r.jsx)(a.hJ,{ref:t,className:(0,l.cn)("bg-black/40 backdrop-blur-sm","z-50 fixed inset-0 grid place-items-center overflow-y-auto data-closed:animate-overlay-hide py-8",!n&&"flex flex-col flex-start pb-8 sm:pt-12 md:pt-20 lg:pt-32 xl:pt-40 px-5",s),...i})});m.displayName=a.hJ.displayName;let x=(0,o.F)((0,l.cn)("relative z-50 w-full max-w-screen border shadow-md dark:shadow-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-[0%] data-[state=closed]:slide-out-to-top-[0%]","data-[state=open]:slide-in-from-left-[0%] data-[state=open]:slide-in-from-top-[0%]","sm:rounded-lg md:w-full","bg-dash-sidebar"),{variants:{size:{tiny:"sm:align-middle sm:w-full sm:max-w-xs",small:"sm:align-middle sm:w-full sm:max-w-sm",medium:"sm:align-middle sm:w-full sm:max-w-lg",large:"sm:align-middle sm:w-full md:max-w-xl",xlarge:"sm:align-middle sm:w-full md:max-w-3xl",xxlarge:"sm:align-middle sm:w-full md:max-w-6xl",xxxlarge:"sm:align-middle sm:w-full md:max-w-7xl"}},defaultVariants:{size:"medium"}}),p=n.forwardRef((e,t)=>{let{className:s,children:n,size:i,dialogOverlayProps:o,centered:d=!0,...c}=e;return(0,r.jsx)(u,{children:(0,r.jsx)(m,{centered:d,...o,children:(0,r.jsx)(a.UC,{ref:t,className:(0,l.cn)(x({size:i}),s),...c,children:n})})})});p.displayName=a.UC.displayName;let h=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s,"data-sentry-component":"AlertDialogHeader","data-sentry-source-file":"alert-dialog.tsx"})};h.displayName="AlertDialogHeader";let f=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 border-t py-3 px-5",t),...s,"data-sentry-component":"AlertDialogFooter","data-sentry-source-file":"alert-dialog.tsx"})};f.displayName="AlertDialogFooter";let y=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.hE,{ref:t,className:(0,l.cn)("text-base text-foreground border-b px-5 py-3",s),...n})});y.displayName=a.hE.displayName;let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.VY,{ref:t,className:(0,l.cn)("text-sm text-foreground-light px-5 py-3",s),...n})});g.displayName=a.VY.displayName;let v=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.rc,{ref:t,className:(0,l.cn)((0,i.r)({type:"primary",size:"tiny"}),s),...n})});v.displayName=a.rc.displayName;let j=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.ZD,{ref:t,className:(0,l.cn)((0,i.r)({type:"default",size:"tiny"}),"mt-2 sm:mt-0",s),...n})});j.displayName=a.ZD.displayName},41645:(e,t,s)=>{"use strict";s.d(t,{$:()=>n});var r=s(80263),a=s(80100);let n=e=>{let{loading:t}=e;return(0,r.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto","data-sentry-component":"LoadingLine","data-sentry-source-file":"LoadingLine.tsx",children:(0,r.jsx)("span",{className:(0,a.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",t&&"animate-line-loading-slower opacity-100",t?"opacity-100":"opacity-0")})})}},41877:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/observability/query-performance",function(){return s(43449)}])},42018:(e,t,s)=>{"use strict";s.d(t,{E:()=>m});var r=s(72391),a=s(29395),n=s(51355),l=s(80210),i=s(73969),o=s(30659),d=s(59356),c=s(87727);async function u(e){let{projectRef:t,connectionString:s,schema:n,name:l,version:i,cascade:o=!1,createSchema:c=!1}=e,u=new Headers;s&&u.set("x-connection-encrypted",s);let{sql:m}=r.A.extensions.create({schema:n,name:l,version:i,cascade:o}),{result:x}=await (0,d.E)({projectRef:t,connectionString:s,sql:c?"create schema if not exists ".concat((0,a.bD)(n),"; ").concat(m):m,queryKey:["extension","create"]});return x}let m=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,n.jE)();return(0,l.n)({mutationFn:e=>u(e),async onSuccess(t,s,a){let{projectRef:n}=s;await Promise.all([r.invalidateQueries({queryKey:c.I.list(n)}),r.invalidateQueries({queryKey:o.n.upgradeEligibility(n)})]),await (null==e?void 0:e(t,s,a))},async onError(e,s,r){void 0===t?i.oR.error("Failed to enable database extension: ".concat(e.message)):t(e,s,r)},...s})}},43449:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>tm});var r=s(80263),a=s(23850),n=s(22891),l=s(73969),i=s(59356);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{hypopg:e.find(e=>"hypopg"===e.name),indexAdvisor:e.find(e=>"index_advisor"===e.name)}}function d(e,t){return void 0===e||void 0===t||e<=0||e<=t?0:(e-t)/e*100}async function c(e){let{projectRef:t,connectionString:s,indexStatements:r,onSuccess:a,onError:n}=e;if(!t){let e=Error("Project ref is required");return n&&n(e),Promise.reject(e)}if(0===r.length){let e=Error("No index statements provided");return n&&n(e),Promise.reject(e)}try{return await (0,i.E)({projectRef:t,connectionString:s,sql:r.join(";\n")+";"}),l.oR.success("Successfully created index"),a&&a(),Promise.resolve()}catch(e){return l.oR.error("Failed to create index: ".concat(e.message)),n&&n(e),Promise.reject(e)}}function u(e,t){return!!(t&&(null==e?void 0:e.index_statements)&&e.index_statements.length>0)}var m=s(22730),x=s(9620);function p(){let{data:e}=(0,x.YA)(),{data:t}=(0,m.z)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{hypopg:s,indexAdvisor:r}=o(null!=t?t:[]),a=!!s&&!!r,n=a&&null!==s.installed_version&&null!==r.installed_version;return{isIndexAdvisorAvailable:a,isIndexAdvisorEnabled:n}}let h=()=>{let[{sort:e,order:t},s]=(0,a.ab)({sort:a.tU,order:a.tU});return{sort:e&&t&&["asc","desc"].includes(t)?{column:e,order:t}:null,setSortConfig:(e,t)=>{s({sort:e,order:t})},clearSort:()=>{s({sort:null,order:null})}}};var f=s(53239),y=s(42018),g=s(22806),v=s(30404),j=s(99779),_=s(60793),b=s(21650);let w=()=>{let{data:e}=(0,x.YA)(),{isIndexAdvisorAvailable:t,isIndexAdvisorEnabled:s}=p(),[a,n]=(0,f.useState)(!1),{data:i}=(0,m.z)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{hypopg:d,indexAdvisor:c}=o(i),{mutateAsync:u,isPending:h}=(0,y.E)(),w=async()=>{if(void 0===e)return l.oR.error("Project is required");try{var t,s;(null==d?void 0:d.installed_version)===null&&await u({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,name:d.name,schema:null!=(t=null==d?void 0:d.schema)?t:"extensions",version:d.default_version}),(null==c?void 0:c.installed_version)===null&&await u({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,name:c.name,schema:null!=(s=null==c?void 0:c.schema)?s:"extensions",version:c.default_version}),l.oR.success("Successfully enabled Index Advisor!"),n(!1)}catch(e){l.oR.error("Failed to enable Index Advisor: ".concat(e.message))}};return!t||s?null:(0,r.jsxs)(g.Lt,{open:a,onOpenChange:()=>n(!a),"data-sentry-element":"AlertDialog","data-sentry-component":"EnableIndexAdvisorButton","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,r.jsxs)(v.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,r.jsx)(v.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:(0,r.jsx)(g.tv,{asChild:!0,"data-sentry-element":"AlertDialogTrigger","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:(0,r.jsx)(j.$,{type:"outline",className:"rounded-full",icon:(0,r.jsx)(_.mo,{}),"data-sentry-element":"Button","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Enable Index Advisor"})})}),(0,r.jsx)(v.ZI,{side:"top","data-sentry-element":"TooltipContent","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Recommends indexes to improve query performance"})]}),(0,r.jsxs)(g.EO,{"data-sentry-element":"AlertDialogContent","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,r.jsxs)(g.wd,{"data-sentry-element":"AlertDialogHeader","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,r.jsx)(g.r7,{"data-sentry-element":"AlertDialogTitle","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Enable Index Advisor"}),(0,r.jsxs)(g.$v,{"data-sentry-element":"AlertDialogDescription","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:["Index Advisor is a tool that helps you identify and simulate indexes that can improve query performance. To use Index Advisor, you need to enable the following Postgres extensions:",(0,r.jsxs)("ul",{className:"list-disc pl-6 py-4 flex flex-col gap-2",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)(b.E,{className:"font-mono text-foreground","data-sentry-element":"Badge","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"index_advisor"})," - Recommends database indexes"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)(b.E,{className:"font-mono text-foreground","data-sentry-element":"Badge","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"hypopg"})," - For hypothetical indexes simulation"]})]}),"These extensions help identify and simulate indexes that can improve query performance without having to create actual indexes."]})]}),(0,r.jsxs)(g.ck,{"data-sentry-element":"AlertDialogFooter","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:[(0,r.jsx)(g.Zr,{"data-sentry-element":"AlertDialogCancel","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:"Cancel"}),(0,r.jsx)(g.Rx,{onClick:e=>{e.preventDefault(),w()},disabled:h,"data-sentry-element":"AlertDialogAction","data-sentry-source-file":"EnableIndexAdvisorButton.tsx",children:h?"Enabling...":"Enable Extensions"})]})]})]})};var N=s(76174),S=s(54941),A=s(21480),C=s(74310),q=s(69978),I=s(24560),R=s(23729),E=s(21162),F=s(80100),T=s(95052),D=s(65346),k=s(11101),P=s(4969),Q=s(16488),M=s(73886),L=s(28243),B=s(75878);let W=e=>{let{indexStatements:t,totalCostBefore:s,totalCostAfter:a,className:n,...l}=e,i=d(s,a);return(0,r.jsxs)("p",{className:(0,F.cn)("text-sm text-foreground-light mb-3",n),...l,"data-sentry-component":"IndexImprovementText","data-sentry-source-file":"IndexImprovementText.tsx",children:["Query's performance can be improved by"," ",(0,r.jsxs)("span",{className:"text-brand",children:[i.toFixed(2),"%"]})," by creating this"," ",t.length>1?"indexes":"index",":"]})};var z=s(52554);let O=e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,F.cn)("flex flex-col gap-y-0 py-4",s),"data-sentry-component":"QueryPanelContainer","data-sentry-source-file":"QueryPanel.tsx",children:t})},H=e=>{let{children:t,className:s}=e;return(0,r.jsx)("div",{className:(0,F.cn)("px-6 flex flex-col gap-y-0",s),"data-sentry-component":"QueryPanelSection","data-sentry-source-file":"QueryPanel.tsx",children:t})},U=e=>{let{className:t,name:s,description:a,before:n,after:l,hideArrowMarkers:i=!1}=e;return(0,r.jsxs)("div",{className:(0,F.cn)("py-4 px-4 flex",t),"data-sentry-component":"QueryPanelScoreSection","data-sentry-source-file":"QueryPanel.tsx",children:[(0,r.jsxs)("div",{className:"flex gap-x-2 w-48",children:[(0,r.jsx)("span",{className:"text-sm",children:s}),(0,r.jsxs)(v.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"QueryPanel.tsx",children:[(0,r.jsx)(v.k$,{asChild:!0,className:"mt-1","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"QueryPanel.tsx",children:(0,r.jsx)(z.A,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light","data-sentry-element":"InformationCircleIcon","data-sentry-source-file":"QueryPanel.tsx"})}),(0,r.jsx)(v.ZI,{side:"top",className:"w-52 text-center","data-sentry-element":"TooltipContent","data-sentry-source-file":"QueryPanel.tsx",children:a})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsxs)("div",{className:"flex gap-x-2 text-sm",children:[(0,r.jsx)("span",{className:"text-foreground-light w-20",children:"Currently:"}),(0,r.jsx)("span",{className:(0,F.cn)("font-mono",void 0!==n&&void 0!==l&&n!==l?"text-foreground-light":""),children:n})]}),void 0!==n&&void 0!==l&&n!==l&&(0,r.jsxs)("div",{className:"flex items-center gap-x-2 text-sm",children:[(0,r.jsx)("span",{className:"text-foreground-light w-20",children:"With index:"}),(0,r.jsx)("span",{className:"font-mono",children:l}),void 0!==n&&!i&&(0,r.jsxs)("div",{className:"flex items-center gap-x-1",children:[l>n?(0,r.jsx)(S.A,{size:14,className:"text-warning"}):(0,r.jsx)(A.A,{size:14,className:"text-brand"}),"number"==typeof n&&0!==n&&!isNaN(n)&&isFinite(n)&&(0,r.jsxs)("span",{className:(0,F.cn)("font-mono tracking-tighter",l>n?"text-warning":"text-brand"),children:[((n-l)/n*100).toFixed(2),"%"]})]})]})]})]})};var $=s(51355),V=s(80814),Y=s(60894),G=s(63185),K=s(32510),J=function(e){return e.MOST_TIME_CONSUMING="most_time_consuming",e.MOST_FREQUENT="most_frequent",e.SLOWEST_EXECUTION="slowest_execution",e.UNIFIED="unified",e}({});let X={most_time_consuming:"mostTimeConsuming",most_frequent:"mostFrequentlyInvoked",slowest_execution:"slowestExecutionTime",unified:"unified"},Z=[{id:"query",name:"Query",description:void 0,minWidth:500},{id:"prop_total_time",name:"Time consumed",description:void 0,minWidth:150},{id:"calls",name:"Count",description:void 0,minWidth:100},{id:"max_time",name:"Max time",description:void 0,minWidth:100},{id:"mean_time",name:"Mean time",description:void 0,minWidth:100},{id:"min_time",name:"Min time",description:void 0,minWidth:100},{id:"rows_read",name:"Rows processed",description:void 0,minWidth:130},{id:"cache_hit_rate",name:"Cache hit rate",description:void 0,minWidth:130},{id:"rolname",name:"Role",description:void 0,minWidth:200}],ee=[{name:"postgres",description:"The default Postgres role. This has admin privileges."},{name:"anon",description:"For unauthenticated, public access. This is the role which the API (PostgREST) will use when a user is not logged in."},{name:"authenticator",description:'A special role for the API (PostgREST). It has very limited access, and is used to validate a JWT and then "change into" another role determined by the JWT verification.'},{name:"authenticated",description:'For "authenticated access." This is the role which the API (PostgREST) will use when a user is logged in.'},{name:"service_role",description:"For elevated access. This role is used by the API (PostgREST) to bypass Row Level Security."},{name:"supabase_auth_admin",description:"Used by the Auth middleware to connect to the database and run migration. Access is scoped to the auth schema."},{name:"supabase_storage_admin",description:"Used by the Auth middleware to connect to the database and run migration. Access is scoped to the storage schema."},{name:"dashboard_user",description:"For running commands via the Supabase UI."},{name:"supabase_admin",description:"An internal role Supabase uses for administrative tasks, such as running upgrades and automations."},{name:"pgbouncer",description:"PgBouncer is a lightweight connection pooler for PostgreSQL. Available on paid plans only."}],et=[{id:"query_latency",label:"Query latency"},{id:"rows_read",label:"Rows read"},{id:"calls",label:"Calls"},{id:"cache_hits",label:"Cache hits"}],es=(e,t)=>"\nselect \n  id,\n  pgl.timestamp as timestamp,\n  'postgres' as log_type,\n  CAST(pgl_parsed.sql_state_code AS STRING) as status,\n  CASE\n      WHEN pgl_parsed.error_severity = 'LOG' THEN 'success'\n      WHEN pgl_parsed.error_severity = 'WARNING' THEN 'warning'\n      WHEN pgl_parsed.error_severity = 'FATAL' THEN 'error'\n      WHEN pgl_parsed.error_severity = 'ERROR' THEN 'error'\n      ELSE null\n  END as level,\n  event_message as event_message\nfrom postgres_logs as pgl\ncross join unnest(pgl.metadata) as pgl_metadata\ncross join unnest(pgl_metadata.parsed) as pgl_parsed\nWHERE pgl.event_message LIKE '%[pg_stat_monitor]%'\n  AND pgl.timestamp >= CAST('".concat(e,"' AS TIMESTAMP)\n  AND pgl.timestamp <= CAST('").concat(t,"' AS TIMESTAMP)\nORDER BY timestamp DESC\n").trim();function er(){var e,t;let s=(0,V.useRouter)(),r=(0,$.jE)(),{data:n}=(0,x.YA)(),{isIndexAdvisorEnabled:l}=p(),[{preset:i,search:o,order:d,sort:c}]=(0,a.ab)({sort:a.tU,search:a.tU.withDefault(""),order:a.tU,preset:a.tU.withDefault("unified")}),u=X[i],m=null!=(t=null==s||null==(e=s.query)?void 0:e.roles)?t:[],h=(0,Y.a)({searchQuery:o,orderBy:c?{column:c,order:d}:void 0,preset:u,roles:"string"==typeof m?[m]:m,runIndexAdvisor:l});return(0,f.useCallback)(()=>{h.runQuery(),r.invalidateQueries({queryKey:K.c.indexAdvisorFromQuery(null==n?void 0:n.ref,"")}),r.invalidateQueries({queryKey:G.K.list(null==n?void 0:n.ref)})},[h,r,null==n?void 0:n.ref])}es(new Date(Date.now()-864e5).toISOString(),new Date().toISOString());let ea=e=>{var t;let{indexAdvisorResult:s,onClickIcon:a}=e,{data:n}=(0,x.YA)(),[l,i]=(0,f.useState)(!1),[o,d]=(0,f.useState)(!1),u=er(),m=async e=>{e.stopPropagation(),i(!0);try{await c({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,indexStatements:s.index_statements,onSuccess:()=>{a&&(a(),d(!1))}}),u()}catch(e){console.error("Failed to create index:",e),i(!1)}finally{setTimeout(()=>i(!1),1e3)}};return(null==s||null==(t=s.index_statements)?void 0:t.length)?(0,r.jsxs)(L.jc,{open:o,onOpenChange:d,"data-sentry-element":"HoverCard","data-sentry-component":"IndexSuggestionIcon","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:[(0,r.jsx)(L.d0,{"data-sentry-element":"HoverCardTrigger","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:(0,r.jsx)("div",{onClick:e=>{a&&!l&&(e.stopPropagation(),a())},className:"cursor-pointer",children:l?(0,r.jsx)(M.A,{size:16,className:"animate-spin text-foreground-light"}):(0,r.jsx)(_.id,{})})}),(0,r.jsxs)(L.Et,{className:"w-[520px] p-0 overflow-hidden",align:"start",alignOffset:-32,"data-sentry-element":"HoverCardContent","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:[(0,r.jsx)("div",{className:"px-4 py-3 bg-surface-75",children:(0,r.jsx)(W,{indexStatements:s.index_statements,totalCostBefore:s.total_cost_before,totalCostAfter:s.total_cost_after,className:"text-sm","data-sentry-element":"IndexImprovementText","data-sentry-source-file":"IndexSuggestionIcon.tsx"})}),(0,r.jsx)(B.w,{"data-sentry-element":"Separator","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,r.jsx)("div",{children:(0,r.jsx)(T.N,{hideLineNumbers:!0,value:s.index_statements.join(";\n")+";",language:"sql",className:(0,F.cn)("border-none rounded-none","max-w-full","!py-0.5 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap"),"data-sentry-element":"CodeBlock","data-sentry-source-file":"IndexSuggestionIcon.tsx"})}),(0,r.jsx)(B.w,{"data-sentry-element":"Separator","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,r.jsx)(U,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:s.total_cost_before,after:s.total_cost_after,"data-sentry-element":"QueryPanelScoreSection","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,r.jsx)(U,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:s.startup_cost_before,after:s.startup_cost_after,"data-sentry-element":"QueryPanelScoreSection","data-sentry-source-file":"IndexSuggestionIcon.tsx"}),(0,r.jsxs)("div",{className:"p-3 flex gap-2 items-center border-t justify-end",children:[(0,r.jsx)(j.$,{type:"text",onClick:e=>{e.stopPropagation(),a&&!l&&a(),d(!1)},disabled:l,"data-sentry-element":"Button","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:"View details"}),(0,r.jsx)(j.$,{onClick:m,loading:l,disabled:l,"data-sentry-element":"Button","data-sentry-source-file":"IndexSuggestionIcon.tsx",children:"Create index"})]})]})]}):null};s(63159);var en=s(32157),el=s(26080),ei=s.n(el),eo=s(48303),ed=s(20033),ec=s(53434),eu=s.n(ec),em=s(64741),ex=s.n(em);eu().extend(ex());let ep=e=>{let t=eu().duration(e,"milliseconds"),s=Math.floor(t.asDays()),r=t.hours(),a=t.minutes(),n=t.seconds(),l=t.asSeconds();if(l<60)return"".concat(l.toFixed(2),"s");let i=[];return s>0&&i.push("".concat(s,"d")),r>0&&i.push("".concat(r,"h")),a>0&&i.push("".concat(a,"m")),n>0&&i.push("".concat(n,"s")),i.length>0?i.join(" "):"0s"},eh=ei()(()=>s.e(35799).then(s.bind(s,35799)).then(e=>{let{SqlMonacoBlock:t}=e;return t}),{loadableGenerated:{webpack:()=>[35799]},ssr:!1}),ef=e=>{let{selectedRow:t,onClickViewSuggestion:s}=e,[a,n]=(0,f.useState)(null==t?void 0:t.query);(0,f.useEffect)(()=>{void 0!==t&&n((0,eo.A)(t.query))},[t]);let[l,i]=(0,f.useState)(!1);return(0,r.jsxs)(O,{"data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryDetail","data-sentry-source-file":"QueryDetail.tsx",children:[(0,r.jsxs)(H,{className:"pt-2 border-b relative","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:[(0,r.jsx)("h4",{className:"mb-4",children:"Query pattern"}),(0,r.jsxs)("div",{className:(0,F.cn)("overflow-hidden pb-0 z-0 relative transition-all duration-300",l?"h-[348px]":"h-[120px]"),children:[(0,r.jsx)(eh,{value:a,height:322,lineNumbers:"off",wrapperClassName:(0,F.cn)("pl-3 bg-surface-100",!l&&"pointer-events-none"),"data-sentry-element":"SqlMonacoBlock","data-sentry-source-file":"QueryDetail.tsx"}),!1]}),(0,r.jsx)("div",{className:(0,F.cn)("absolute left-0 bottom-0 w-full bg-gradient-to-t from-black/30 to-transparent h-24 transition-opacity duration-300",l&&"opacity-0 pointer-events-none")}),(0,r.jsx)("div",{className:"absolute -bottom-[13px] left-0 right-0 w-full flex items-center justify-center z-10",children:(0,r.jsx)(j.$,{type:"default",className:"rounded-full",icon:(0,r.jsx)(en.A,{}),onClick:()=>i(!l),"data-sentry-element":"Button","data-sentry-source-file":"QueryDetail.tsx",children:l?"Collapse":"Expand"})})]}),(0,r.jsxs)(H,{className:"pb-3 pt-6","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:[(0,r.jsx)("h4",{className:"mb-2",children:"Metadata"}),(0,r.jsx)("ul",{className:"flex flex-col gap-y-3 divide-y divide-dashed",children:Z.filter(e=>"query"!==e.id).map(e=>{let s=null==t?void 0:t[e.id],a=e.name.includes("time")?"number"==typeof s&&!isNaN(s)&&isFinite(s)?"".concat(Math.round(s).toLocaleString(),"ms"):"n/a":null!=s?String(s):"n/a";if("prop_total_time"===e.id){let s=(null==t?void 0:t.prop_total_time)||0,a=(null==t?void 0:t.total_time)||0;return(0,r.jsxs)("li",{className:"flex justify-between pt-3 text-sm",children:[(0,r.jsx)("p",{className:"text-foreground-light",children:e.name}),s&&a?(0,r.jsxs)("p",{className:"flex items-center gap-x-1.5",children:[(0,r.jsxs)("span",{className:(0,F.cn)("tabular-nums","0.0"===s.toFixed(1)&&"text-foreground-lighter"),children:[s.toFixed(1),"%"]})," ",(0,r.jsx)("span",{className:"text-muted",children:"/"})," ",(0,r.jsx)("span",{className:(0,F.cn)("tabular-nums","0.00s"===ep(a)&&"text-foreground-lighter"),children:ep(a)})]}):(0,r.jsx)("p",{className:"text-muted",children:"–"})]},e.id)}if("rows_read"==e.id)return(0,r.jsxs)("li",{className:"flex justify-between pt-3 text-sm",children:[(0,r.jsx)("p",{className:"text-foreground-light",children:e.name}),"number"==typeof s&&!isNaN(s)&&isFinite(s)?(0,r.jsx)("p",{className:(0,F.cn)("tabular-nums",0===s&&"text-foreground-lighter"),children:s.toLocaleString()}):(0,r.jsx)("p",{className:"text-muted",children:"–"})]},e.id);let n=e=>"number"==typeof e?e:parseFloat(e.toString().replace("%",""))||0;return"cache_hit_rate"===e.id?(0,r.jsxs)("li",{className:"flex justify-between pt-3 text-sm",children:[(0,r.jsx)("p",{className:"text-foreground-light",children:e.name}),"string"==typeof s||"number"==typeof s?(0,r.jsxs)("p",{className:(0,F.cn)("0.00"===n(s).toFixed(2)&&"text-foreground-lighter"),children:[n(s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),"%"]}):(0,r.jsx)("p",{className:"text-muted",children:"–"})]},e.id):(0,r.jsxs)("li",{className:"flex justify-between pt-3 text-sm",children:[(0,r.jsx)("p",{className:"text-foreground-light",children:e.name}),(0,r.jsx)("p",{className:(0,F.cn)("tabular-nums","rolname"===e.id&&"font-mono"),children:a})]},e.id)})})]})]})};var ey=s(53923),eg=s(23892),ev=s(15833),ej=s(44168),e_=s(67850);async function eb(e){let{projectRef:t,connectionString:s,query:r}=e;if(!t)throw Error("Project ref is required");let a=r.replace(/'/g,"''"),{result:n}=await (0,i.E)({projectRef:t,connectionString:s,sql:"select * from index_advisor('".concat(a,"');")});return n[0]}let ew=function(e){let{projectRef:t,connectionString:s,query:r}=e,{enabled:a=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,e_.I)({queryKey:K.c.indexAdvisorFromQuery(t,r),queryFn:()=>eb({projectRef:t,connectionString:s,query:r}),retry:!1,enabled:a&&void 0!==t&&void 0!==r&&(r.startsWith("select")||r.startsWith("SELECT"))||r.trim().toLowerCase().startsWith("with pgrst_source"),...n})};async function eN(e){let{projectRef:t,connectionString:s,query:r}=e;if(!t)throw Error("Project ref is required");try{let{result:e}=await (0,i.E)({projectRef:t,connectionString:s,queryKey:["involved-indexes-explain-query"],sql:"\n        create or replace function pg_temp.explain_query(query text) returns jsonb\n        language plpgsql\n        as $$\n        declare\n            explain_result jsonb;\n            prepared_statement_name text := 'query_to_explain';\n            explain_plan_statement text;\n            n_args int;\n        begin\n            -- Remove comment lines (its common that they contain semicolons)\n            query := trim(\n                regexp_replace(\n                    regexp_replace(\n                        regexp_replace(query,'\\/\\*.+\\*\\/', '', 'g'),\n                    '--[^\\r\\n]*', ' ', 'g'),\n                '\\s+', ' ', 'g')\n            );\n      \n            -- Remove trailing semicolon\n            query := regexp_replace(query, ';\\s*$', '');\n\n            -- Disallow multiple statements\n            if query ilike '%;%' then\n                raise exception 'Query must not contain a semicolon';\n            end if;\n        \n            -- Hack to support PostgREST because the prepared statement for args incorrectly defaults to text\n            query := replace(query, 'WITH pgrst_payload AS (SELECT $1 AS json_data)', \n                                    'WITH pgrst_payload AS (SELECT $1::json AS json_data)');\n        \n            -- Create a prepared statement for the given query\n            deallocate all;\n            execute format('prepare %I as %s', prepared_statement_name, query);\n        \n            -- Detect how many arguments are present in the prepared statement\n            n_args = (\n                select\n                    coalesce(array_length(parameter_types, 1), 0)\n                from\n                    pg_prepared_statements\n                where\n                    name = prepared_statement_name\n                limit\n                    1\n            );\n        \n            -- Create a SQL statement that can be executed to collect the explain plan\n            explain_plan_statement = format(\n                'set local plan_cache_mode = force_generic_plan; explain (format json) execute %I%s',\n                prepared_statement_name,\n                case\n                    when n_args = 0 then ''\n                    else format(\n                        '(%s)', array_to_string(array_fill('null'::text, array[n_args]), ',')\n                    )\n                end\n            );\n        \n            -- Execute the explain plan statement and get the result\n            execute explain_plan_statement into explain_result;\n        \n            -- Clean up the prepared statement\n            deallocate all;\n        \n            -- Return the explain result\n            return explain_result;\n        end;\n        $$;\n\n        select pg_temp.explain_query('".concat(r,"') as plans;\n      ")}),a=function(e){let t=[];return!function e(s){null!==s&&"object"==typeof s&&("Index Name"in s&&t.push(s["Index Name"]),Object.values(s).forEach(t=>e(t)))}(e),t}(e);if(a.length<=0)return[];let{result:n}=await (0,i.E)({projectRef:t,connectionString:s,queryKey:["involved-indexes-names"],sql:"select schemaname as schema, tablename as table, indexname as name from pg_indexes where indexname in (".concat(a.map(e=>"'".concat(e,"'")).join(", "),");")});return n}catch(e){return[]}}let eS=function(e){let{projectRef:t,connectionString:s,query:r}=e,{enabled:a=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(null!=r?r:"").trim().toLowerCase(),i=l.startsWith("select")||l.startsWith("with pgrst_source")||l.startsWith("with pgrst_payload");return(0,e_.I)({queryKey:K.c.indexesFromQuery(t,r),queryFn:()=>eN({projectRef:t,connectionString:s,query:r}),retry:!1,enabled:a&&void 0!==t&&void 0!==r&&i,...n})};var eA=s(66755),eC=s(52555),eq=s.n(eC),eI=s(41273),eR=s(85039),eE=s(29445);let eF=()=>{let{ref:e}=(0,n.g)(),{data:t}=(0,x.YA)(),{data:s}=(0,m.z)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),{hypopg:a,indexAdvisor:i}=o(s),{mutateAsync:d,isPending:c}=(0,y.E)(),u=async()=>{if(void 0===t)return console.error("Project is required");try{var e,s;(null==a?void 0:a.installed_version)===null&&await d({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:a.name,schema:null!=(e=null==a?void 0:a.schema)?e:"extensions",version:a.default_version}),(null==i?void 0:i.installed_version)===null&&await d({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:i.name,schema:null!=(s=null==i?void 0:i.schema)?s:"extensions",version:i.default_version}),l.oR.success("Successfully enabled index advisor!")}catch(e){l.oR.error("Failed to enable index advisor: ".concat(e.message))}};return(0,r.jsxs)(ed.Fc,{className:"mb-6","data-sentry-element":"Alert_Shadcn_","data-sentry-component":"IndexAdvisorDisabledState","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:[(0,r.jsx)(ed.XL,{"data-sentry-element":"AlertTitle_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,r.jsx)(eE.o,{className:"text-foreground",content:void 0===i?"Newer version of Postgres required":"Postgres extensions `index_advisor` and `hypopg` required","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,r.jsx)(ed.TN,{"data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,r.jsx)(eE.o,{content:void 0===i?"Upgrade to the latest version of Postgres to get recommendations on indexes for your queries":"These extensions can help in recommending database indexes to reduce the costs of your query.","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,r.jsx)(ed.TN,{className:"mt-3","data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0===i?(0,r.jsx)(j.$,{asChild:!0,type:"default",children:(0,r.jsx)(eq(),{href:"/project/".concat(e,"/settings/infrastructure"),children:"Upgrade Postgres version"})}):(0,r.jsx)(j.$,{type:"default",disabled:c,loading:c,onClick:()=>u(),children:"Enable extensions"}),(0,r.jsx)(eI.A,{href:"".concat(eR.aq,"/guides/database/extensions/index_advisor"),"data-sentry-element":"DocsButton","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})]})})]})},eT=e=>{let{selectedRow:t}=e,{data:s}=(0,x.YA)(),[a,n]=(0,f.useState)(!1),[l,i]=(0,f.useState)(!1),{data:o,isSuccess:h,isLoading:y,isError:g,error:v}=eS({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,query:null==t?void 0:t.query}),{data:_,isLoading:b}=(0,m.z)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString}),{isIndexAdvisorEnabled:w}=p(),{data:N,error:S,refetch:A,isError:C,isSuccess:q,isLoading:I}=ew({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,query:null==t?void 0:t.query},{enabled:w}),{index_statements:R,startup_cost_after:E,startup_cost_before:D,total_cost_after:k,total_cost_before:P}=null!=N?N:{index_statements:[],total_cost_after:0,total_cost_before:0},M=u(N,q),L=(d(P,k),er()),B=async()=>{if(0!==R.length){i(!0);try{await c({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,indexStatements:R,onSuccess:()=>A()}),L()}catch(e){console.error("Failed to create index:",e),i(!1)}finally{i(!1)}}};return(0,r.jsxs)(O,{className:"h-full","data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryIndexes","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,r.jsxs)(H,{className:"pt-2 mb-6","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,r.jsxs)("div",{className:"mb-4 flex flex-col gap-y-1",children:[(0,r.jsx)("h4",{children:"Indexes in use"}),(0,r.jsxs)("p",{className:"text-sm text-foreground-light",children:["This query is using the following index",(null!=o?o:[]).length>1?"s":"",":"]})]}),y&&(0,r.jsx)(Q.yV,{}),g&&(0,r.jsx)(ej.A,{projectRef:null==s?void 0:s.ref,error:v,subject:"Failed to retrieve indexes in use"}),h&&(0,r.jsxs)("div",{children:[0===o.length&&(0,r.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-20 gap-y-1",children:[(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"No indexes are involved in this query"}),(0,r.jsx)("p",{className:"text-center text-xs text-foreground-lighter",children:"Indexes may not necessarily be used if they incur a higher cost when executing the query"})]}),o.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-x-4 bg-surface-100 border first:rounded-tl first:rounded-tr border-b-0 last:border-b last:rounded-b px-2 py-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(ey.A,{size:14,className:"text-foreground-light"}),(0,r.jsxs)("span",{className:"text-xs font-mono text-foreground-light",children:[e.schema,".",e.table]})]}),(0,r.jsx)("span",{className:"text-xs font-mono",children:e.name})]},e.name))]})]}),(0,r.jsx)(H,{className:"flex flex-col gap-y-6 py-6 border-t","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsx)("h4",{children:"New index recommendations"}),b?(0,r.jsx)(Q.yV,{}):w?(0,r.jsxs)(r.Fragment,{children:[I&&(0,r.jsx)(Q.yV,{}),C&&(0,r.jsx)(ej.A,{projectRef:null==s?void 0:s.ref,error:S,subject:"Failed to retrieve result from index advisor"}),q&&(0,r.jsx)(r.Fragment,{children:0===(null!=R?R:[]).length?(0,r.jsxs)(ed.Fc,{className:"[&>svg]:rounded-full",children:[(0,r.jsx)(eg.A,{}),(0,r.jsx)(ed.XL,{children:"This query is optimized"}),(0,r.jsx)(ed.TN,{children:"Recommendations for indexes will show here"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W,{indexStatements:R,totalCostBefore:P,totalCostAfter:k,className:"text-sm text-foreground-light"}),(0,r.jsx)(T.N,{hideLineNumbers:!0,value:R.join(";\n")+";",language:"sql",className:(0,F.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,r.jsx)("p",{className:"text-sm text-foreground-light mt-3",children:"This recommendation serves to prevent your queries from slowing down as your application grows, and hence the index may not be used immediately after it's created (e.g If your table is still small at this time)."})]})})]}):(0,r.jsx)(eF,{})]})}),w&&M&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H,{className:"py-6 border-t",children:(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsx)("h4",{children:"Query costs"}),(0,r.jsxs)("div",{className:"border rounded-md flex flex-col bg-surface-100 mt-3",children:[(0,r.jsx)(U,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:P,after:k}),(0,r.jsxs)(eA.Nt,{open:a,onOpenChange:n,children:[(0,r.jsx)(eA.Ke,{asChild:!0,className:"pb-3",children:(0,r.jsx)(U,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:D,after:E})}),(0,r.jsxs)(eA.R6,{className:"text-xs py-1.5 border-t text-foreground-light bg-studio w-full rounded-b-md",children:["View ",a?"less":"more"]})]})]})]})}),(0,r.jsx)(H,{className:"py-6 border-t",children:(0,r.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,r.jsx)("h4",{children:"FAQ"}),(0,r.jsxs)(ev.nD,{collapsible:!0,type:"single",className:"border rounded-md",children:[(0,r.jsxs)(ev.As,{value:"1",children:[(0,r.jsx)(ev.$m,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"What units are cost in?"}),(0,r.jsx)(ev.ub,{className:"px-4 text-foreground-light",children:"Costs are in an arbitrary unit, and do not represent a unit of time. The units are anchored (by default) to a single sequential page read costing 1.0 units. They do, however, serve as a predictor of higher execution times."})]}),(0,r.jsxs)(ev.As,{value:"2",className:"border-b-0",children:[(0,r.jsx)(ev.$m,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"How should I prioritize start up and total cost?"}),(0,r.jsxs)(ev.ub,{className:"px-4 text-foreground-light [&>div]:space-y-2",children:[(0,r.jsx)("p",{children:"This depends on the expected size of the result set from the query."}),(0,r.jsx)("p",{children:"For queries that return a small number or rows, the startup cost is more critical and minimizing startup cost can lead to faster response times, especially in interactive applications."}),(0,r.jsx)("p",{children:"For queries that return a large number of rows, the total cost becomes more important, and optimizing it will help in efficiently using resources and reducing overall query execution time."})]})]})]})]})})]}),w&&M&&(0,r.jsxs)("div",{className:"bg-studio sticky bottom-0 border-t py-3 flex items-center justify-between px-5",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-y-0.5 text-xs",children:[(0,r.jsx)("span",{children:"Apply index to database"}),(0,r.jsx)("span",{className:"text-xs text-foreground-light",children:"This will run the SQL that is shown above"})]}),(0,r.jsx)(j.$,{disabled:l,loading:l,type:"primary",onClick:()=>B(),children:"Create index"})]})]})},eD=e=>{var t,s;let{aggregatedData:l,isLoading:i,currentSelectedQuery:o,onCurrentSelectQuery:d}=e,{sort:c,setSortConfig:m}=h(),x=(0,f.useRef)(null),{sort:p,order:y}=(0,n.g)(),[{search:g,roles:v,callsFilter:_}]=(0,a.ab)({search:a.tU.withDefault(""),roles:(0,a.IN)(a.tU).withDefault([]),callsFilter:(0,a.os)(e=>e).withDefault({operator:">=",value:0})}),b=(0,f.useRef)(null),[w,M]=(0,f.useState)("details"),[L,B]=(0,f.useState)(),W=J.UNIFIED,z=Z.map(e=>{var t;let s=["query"];return{key:e.id,name:e.name,cellClass:"column-".concat(e.id),resizable:!0,minWidth:"prop_total_time"===e.id?(e=>{if(!e||0===e.length)return 150;let t=150;return e.forEach(e=>{let s=e.prop_total_time||0,r=e.total_time||0;if(s&&r){let e="".concat(s.toFixed(1),"%"),a=ep(r),n=8*"".concat(e," / ").concat(a).length+40;t=Math.max(t,n)}}),Math.min(t,300)})(null!=l?l:[]):null!=(t=e.minWidth)?t:120,sortable:!s.includes(e.id),headerCellClass:"first:pl-6 cursor-pointer",renderHeaderCell:()=>{let t=!s.includes(e.id);return(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs w-full",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)("p",{className:"!text-foreground font-medium",children:e.name}),e.description&&(0,r.jsx)("p",{className:"text-foreground-lighter font-normal",children:e.description})]}),t&&(0,r.jsxs)(E.rI,{children:[(0,r.jsx)(E.ty,{asChild:!0,children:(0,r.jsx)(j.$,{type:"text",size:"tiny",className:"p-1 h-5 w-5 flex-shrink-0",icon:(0,r.jsx)(N.A,{size:14,className:"text-foreground-muted"}),onClick:e=>e.stopPropagation()})}),(0,r.jsxs)(E.SQ,{align:"end",className:"w-48",children:[(0,r.jsxs)(E._2,{onClick:()=>{m(e.id,"asc")},className:(0,F.cn)("flex gap-2",(null==c?void 0:c.column)===e.id&&(null==c?void 0:c.order)==="asc"&&"text-foreground"),children:[(0,r.jsx)(S.A,{size:14}),"Sort Ascending"]}),(0,r.jsxs)(E._2,{onClick:()=>{m(e.id,"desc")},className:(0,F.cn)("flex gap-2",(null==c?void 0:c.column)===e.id&&(null==c?void 0:c.order)==="desc"&&"text-foreground"),children:[(0,r.jsx)(A.A,{size:14}),"Sort Descending"]})]})]})]})},renderCell:t=>{var s,a;let n=null==(s=t.row)?void 0:s[e.id];if("query"===e.id)return(0,r.jsxs)("div",{className:"w-full flex items-center gap-x-3 group",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-4",children:u(t.row.index_advisor_result,!0)&&(0,r.jsx)(ea,{indexAdvisorResult:t.row.index_advisor_result,onClickIcon:()=>{var e;B(t.rowIdx),M("suggestion"),null==(e=x.current)||e.scrollToCell({idx:0,rowIdx:t.rowIdx})}})}),(0,r.jsx)(T.N,{language:"pgsql",className:"!bg-transparent !p-0 !m-0 !border-none !whitespace-nowrap [&>code]:!whitespace-nowrap [&>code]:break-words !overflow-visible !truncate !w-full !pr-20 pointer-events-none",wrapperClassName:"!max-w-full flex-1",hideLineNumbers:!0,hideCopy:!0,value:n.replace(/\s+/g," ").trim(),wrapLines:!1}),d&&(0,r.jsx)(R.G,{tooltip:{content:{text:"Query details"}},icon:(0,r.jsx)(C.A,{size:14}),size:"tiny",type:"default",onClick:e=>{var s;e.stopPropagation(),B(t.rowIdx),M("details"),null==(s=x.current)||s.scrollToCell({idx:0,rowIdx:t.rowIdx})},className:"p-1 flex-shrink-0 -translate-x-2 group-hover:flex hidden"})]});let l=e.name.includes("time"),i=n&&"number"==typeof n&&!isNaN(n)&&isFinite(n)?l?"".concat(n.toFixed(0).toLocaleString(),"ms"):n.toLocaleString():"";if("prop_total_time"===e.id){let e=t.row.prop_total_time||0,s=t.row.total_time||0,a=Math.min(e,100);return(0,r.jsxs)("div",{className:"w-full flex flex-col justify-center text-xs text-right tabular-nums font-mono",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-foreground transition-all duration-200 z-0",style:{width:"".concat(a,"%"),opacity:.04}}),e&&s?(0,r.jsxs)("span",{className:"flex items-center justify-end gap-x-1.5",children:[(0,r.jsxs)("span",{className:(0,F.cn)("0.0"===e.toFixed(1)&&"text-foreground-lighter"),children:[e.toFixed(1),"%"]})," ",(0,r.jsx)("span",{className:"text-muted",children:"/"}),(0,r.jsx)("span",{className:(0,F.cn)("0.00s"===ep(s)&&"text-foreground-lighter"),children:ep(s)})]}):(0,r.jsx)("p",{className:"text-muted",children:"–"})]})}if("calls"===e.id)return(0,r.jsx)("div",{className:"w-full flex flex-col justify-center text-xs text-right tabular-nums font-mono",children:"number"==typeof n&&!isNaN(n)&&isFinite(n)?(0,r.jsx)("p",{className:(0,F.cn)(0===n&&"text-foreground-lighter"),children:n.toLocaleString()}):(0,r.jsx)("p",{className:"text-muted",children:"–"})});if("max_time"===e.id||"mean_time"===e.id||"min_time"===e.id)return(0,r.jsx)("div",{className:"w-full flex flex-col justify-center text-xs text-right tabular-nums font-mono",children:"number"==typeof n&&!isNaN(n)&&isFinite(n)?(0,r.jsxs)("p",{className:(0,F.cn)("0"===n.toFixed(0)&&"text-foreground-lighter"),children:[Math.round(n).toLocaleString(),"ms"]}):(0,r.jsx)("p",{className:"text-muted",children:"–"})});if("rows_read"===e.id)return(0,r.jsx)("div",{className:"w-full flex flex-col justify-center text-xs text-right tabular-nums font-mono",children:"number"==typeof n&&!isNaN(n)&&isFinite(n)?(0,r.jsx)("p",{className:(0,F.cn)(0===n&&"text-foreground-lighter"),children:n.toLocaleString()}):(0,r.jsx)("p",{className:"text-muted",children:"–"})});if("cache_hit_rate"===e.id){let e="number"==typeof n?n:parseFloat(n);return(0,r.jsx)("div",{className:"w-full flex flex-col justify-center text-xs text-right tabular-nums font-mono",children:"number"==typeof e&&!isNaN(e)&&isFinite(e)?(0,r.jsxs)("p",{className:(0,F.cn)("0.00"===e.toFixed(2)&&"text-foreground-lighter"),children:[e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),"%"]}):(0,r.jsx)("p",{className:"text-muted",children:"–"})})}return"rolname"===e.id?(0,r.jsx)("div",{className:"w-full flex flex-col justify-center",children:n?(0,r.jsxs)("span",{className:"flex items-center gap-x-1",children:[(0,r.jsx)("p",{className:"font-mono text-xs",children:n}),(0,r.jsx)(P.I,{align:"end",alignOffset:-12,className:"w-56",children:null==(a=ee.find(e=>e.name===n))?void 0:a.description})]}):(0,r.jsx)("p",{className:"text-muted",children:"–"})}):(0,r.jsx)("div",{className:"w-full flex flex-col gap-y-0.5 justify-center text-xs",children:(0,r.jsx)("p",{children:i})})}}}),O=(0,f.useMemo)(()=>{let e=[...l];if(g&&"string"==typeof g&&g.length>0&&(e=e.filter(e=>e.query.toLowerCase().includes(g.toLowerCase()))),v&&Array.isArray(v)&&v.length>0&&(e=e.filter(e=>e.rolname&&v.includes(e.rolname))),_){let{operator:t,value:s}=_;e=e.filter(e=>{let r=e.calls||0;switch(t){case"=":return r===s;case">=":return r>=s;case"<=":return r<=s;case">":return r>s;case"<":return r<s;case"!=":return r!==s;default:return!0}})}return(null==c?void 0:c.column)==="prop_total_time"?e.sort((e,t)=>{let s=e.prop_total_time||0,r=t.prop_total_time||0;return"asc"===c.order?s-r:r-s}):(null==c?void 0:c.column)&&"query"!==c.column&&e.sort((e,t)=>{let s=e[c.column]||0,r=t[c.column]||0;return"number"==typeof s&&"number"==typeof r?"asc"===c.order?s-r:r-s:0}),e},[l,c,g,v,_]),H=void 0!==L?null==(t=O[L])?void 0:t.query:void 0,U=(null!=H?H:"").trim().toLowerCase(),$=(U.startsWith("select")||U.startsWith("with pgrst_source")||U.startsWith("with pgrst_payload"))&&u(null==(s=O[L])?void 0:s.index_advisor_result,!0);(0,f.useEffect)(()=>{B(void 0)},[g,v,p,y,_]);let V=(0,f.useCallback)(e=>{if(!O.length||void 0===L||"ArrowUp"!==e.key&&"ArrowDown"!==e.key)return;e.stopPropagation();let t=L;if("ArrowUp"===e.key&&L>0?t=L-1:"ArrowDown"===e.key&&L<O.length-1&&(t=L+1),t!==L){var s,r,a;B(t),null==(s=x.current)||s.scrollToCell({idx:0,rowIdx:t}),(null!=(a=null==(r=O[t])?void 0:r.query)?a:"").trim().toLowerCase().startsWith("select")||M("details")}},[O,L]);return(0,f.useEffect)(()=>(window.addEventListener("keydown",V,!0),()=>{window.removeEventListener("keydown",V,!0)}),[V]),(0,r.jsxs)("div",{className:"relative flex flex-grow bg-alternative min-h-0","data-sentry-component":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,r.jsx)("div",{ref:b,className:"flex-1 min-w-0 overflow-x-auto",children:(0,r.jsx)(I.Ay,{ref:x,style:{height:"100%"},className:(0,F.cn)("flex-1 flex-grow h-full"),rowHeight:44,headerRowHeight:36,columns:z,rows:O,rowClass:(e,t)=>{var s;let r=t===L,a=null==(s=O[t])?void 0:s.query,n=!!o&&o===a;return["".concat(r?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"".concat(r?"[&>div:first-child]:border-l-4 border-l-secondary [&>div]:!border-l-foreground":""),"".concat(n?"bg-surface-200 dark:bg-surface-200":""),"".concat(n?"[&>div:first-child]:border-l-4 border-l-secondary [&>div]:border-l-brand":""),"[&>.rdg-cell]:box-border [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none [&>.rdg-cell.column-prop_total_time]:relative"].join(" ")},renderers:{renderRow:(e,t)=>(0,f.createElement)(I.fI,{...t,key:"qp-row-".concat(t.rowIdx),onClick:t=>{if(t.stopPropagation(),"number"==typeof e&&e>=0){var s,r;if(d){let t=null==(s=O[e])?void 0:s.query;t&&d(t)}else B(e),M("details"),null==(r=x.current)||r.scrollToCell({idx:0,rowIdx:e})}}}),noRowsFallback:i?(0,r.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,r.jsx)(Q.yV,{})}):(0,r.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,r.jsx)(q.A,{className:"text-foreground-muted",strokeWidth:1}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-foreground",children:"No queries detected"}),(0,r.jsx)("p",{className:"text-foreground-light",children:"There are no actively running queries that match the criteria"})]})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx"})}),(0,r.jsxs)(D.cj,{open:void 0!==L,onOpenChange:e=>{e||B(void 0)},modal:!1,"data-sentry-element":"Sheet","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,r.jsx)(D.qp,{className:"sr-only","data-sentry-element":"SheetTitle","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:"Query details"}),(0,r.jsx)(D.h,{side:"right",className:"flex flex-col h-full bg-studio border-l lg:!w-[calc(100vw-802px)] max-w-[700px] w-full",hasOverlay:!1,onInteractOutside:e=>{var t;(null==(t=b.current)?void 0:t.contains(e.target))&&e.preventDefault()},"data-sentry-element":"SheetContent","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:(0,r.jsxs)(k.tU,{value:w,className:"flex flex-col h-full",onValueChange:e=>M(e),"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,r.jsx)("div",{className:"px-5 border-b",children:(0,r.jsxs)(k.j7,{className:"px-0 flex gap-x-4 min-h-[46px] border-b-0 [&>button]:h-[47px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,r.jsx)(k.Xi,{value:"details",className:"px-0 pb-0 data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:"Query details"}),$&&(0,r.jsx)(k.Xi,{value:"suggestion",className:"px-0 pb-0 data-[state=active]:bg-transparent !shadow-none",children:"Indexes"})]})}),(0,r.jsx)(k.av,{value:"details",className:"mt-0 flex-grow min-h-0 overflow-y-auto","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:void 0!==L&&(0,r.jsx)(ef,{reportType:W,selectedRow:O[L],onClickViewSuggestion:()=>M("suggestion")})}),(0,r.jsx)(k.av,{value:"suggestion",className:"mt-0 flex-grow min-h-0 overflow-y-auto","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:void 0!==L&&(0,r.jsx)(eT,{selectedRow:O[L]})})]})})]})]})};var ek=s(41645),eP=s(4133),eQ=s(37361),eM=s.n(eQ);eu().extend(eM());let eL=e=>{let t=[{min:0,max:1},{min:1,max:10},{min:10,max:100},{min:100,max:1e3},{min:1e3,max:1e4},{min:1e4,max:1e5}],s=e.reduce((e,t)=>e+t,0);if(0===s)return{p50:0,p95:0};let r=[],a=0;e.forEach((e,s)=>{if(e>0&&s<t.length){let n=t[s];a+=e,r.push({minValue:n.min,maxValue:n.max,cumulativeCount:a,count:e})}});let n=e=>{var t;let a=s*e;for(let e=0;e<r.length;e++){let t=e>0?r[e-1].cumulativeCount:0;if(r[e].cumulativeCount>=a){let s=(a-t)/r[e].count,n=r[e].minValue,l=r[e].maxValue,i=Math.log10(Math.max(n,.1));return Math.pow(10,i+s*(Math.log10(l)-i))}}return(null==(t=r[r.length-1])?void 0:t.maxValue)||0};return{p50:n(.5),p95:n(.95)}},eB=e=>{let{label:t,value:s}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-0.5 text-xs","data-sentry-component":"QueryMetricBlock","data-sentry-source-file":"QueryPerformanceChart.tsx",children:[(0,r.jsx)("span",{className:"font-mono text-xs text-foreground-lighter uppercase",children:t}),(0,r.jsx)("span",{className:"text-lg tabular-nums",children:s})]})},eW=e=>e>=1e3?"".concat((e/1e3).toFixed(1),"s"):"".concat(e.toFixed(1),"ms"),ez=e=>e.toLocaleString(),eO=e=>{var t;let{onDateRangeChange:s,chartData:a,isLoading:n,error:l,currentSelectedQuery:i,parsedLogs:o}=e,[d,c]=(0,f.useState)("query_latency"),u=(0,f.useMemo)(()=>{if(!a||0===a.length)return[];switch(d){case"query_latency":{let s=0;if(o&&o.length>0){var e,t;let r=Array((null==(t=o[0])||null==(e=t.resp_calls)?void 0:e.length)||50).fill(0);o.forEach(e=>{e.resp_calls&&Array.isArray(e.resp_calls)&&e.resp_calls.forEach((e,t)=>{t<r.length&&(r[t]+=e)})}),s=eL(r).p95}else{let e=a.reduce((e,t)=>e+t.calls,0);s=e>0?a.reduce((e,t)=>e+t.p95_time*t.calls,0)/e:0}return[{label:"Average p95",value:"".concat(Math.round(s),"ms")}]}case"rows_read":return[{label:"Total Rows Read",value:a.reduce((e,t)=>e+t.rows_read,0).toLocaleString()}];case"calls":return[{label:"Total Calls",value:a.reduce((e,t)=>e+t.calls,0).toLocaleString()}];case"cache_hits":{let e=a.reduce((e,t)=>e+t.cache_hits,0),t=e+a.reduce((e,t)=>e+t.cache_misses,0);return[{label:"Cache Hit Rate",value:"".concat((t>0?e/t*100:0).toFixed(2),"%")}]}default:return[]}},[a,d]),m=(0,f.useMemo)(()=>"query_latency"!==d?a:a.map(e=>({...e,p50_time:parseFloat((e.p50_time/1e3).toFixed(3)),p95_time:parseFloat((e.p95_time/1e3).toFixed(3))})),[a,d]),x=(0,f.useMemo)(()=>{if(!i||!o.length)return null;let e=i.replace(/\s+/g," ").trim(),t=o.filter(t=>(t.query||"").replace(/\s+/g," ").trim()===e),s=new Map;return t.forEach(e=>{var t,r,a,n,l,i,o,d;let c=[e.bucket_start_time,e.bucket,e.timestamp,e.ts].find(e=>e&&!isNaN(new Date(e).getTime()));if(!c)return;let u=new Date(c).getTime(),m=null!=(a=null!=(r=null!=(t=e.mean_time)?t:e.mean_exec_time)?r:e.mean_query_time)?a:0,x=null!=(l=null!=(n=e.rows_read)?n:e.rows)?l:0,p=null!=(i=e.calls)?i:0,h=null!=(d=null!=(o=e.shared_blks_hit)?o:e.cache_hits)?d:0;s.set(u,{time:parseFloat(String(m)),rows_read:parseFloat(String(x)),calls:parseFloat(String(p)),cache_hits:parseFloat(String(h))})}),s},[i,o]),p=(0,f.useMemo)(()=>x&&i?m.map(e=>{let t=x.get(e.period_start);return{...e,selected_query_time:(null==t?void 0:t.time)!==void 0?"query_latency"===d?t.time/1e3:t.time:null,selected_query_rows_read:(null==t?void 0:t.rows_read)!==void 0?t.rows_read:null,selected_query_calls:(null==t?void 0:t.calls)!==void 0?t.calls:null,selected_query_cache_hits:(null==t?void 0:t.cache_hits)!==void 0?t.cache_hits:null}}):m,[m,x,i,d]),h=(0,f.useMemo)(()=>{let e={query_latency:[{attribute:"p50_time",label:"p50",provider:"logs",type:"line",color:{light:"#8B5CF6",dark:"#8B5CF6"}},{attribute:"p95_time",label:"p95",provider:"logs",type:"line",color:{light:"#65BCD9",dark:"#65BCD9"}}],rows_read:[{attribute:"rows_read",label:"Rows Read",provider:"logs"}],calls:[{attribute:"calls",label:"Calls",provider:"logs"}],cache_hits:[{attribute:"cache_hits",label:"Cache Hits",provider:"logs",type:"line",color:{light:"#10B981",dark:"#10B981"}}]}[d]||[];if(i&&x){let t={query_latency:{attribute:"selected_query_time",label:"Selected Query",provider:"logs",type:"line",color:{light:"#10B981",dark:"#10B981"},strokeWidth:3},rows_read:{attribute:"selected_query_rows_read",label:"Selected Query",provider:"logs",type:"line",color:{light:"#F59E0B",dark:"#F59E0B"},strokeWidth:3},calls:{attribute:"selected_query_calls",label:"Selected Query",provider:"logs",type:"line",color:{light:"#EC4899",dark:"#EC4899"},strokeWidth:3},cache_hits:{attribute:"selected_query_cache_hits",label:"Selected Query",provider:"logs",type:"line",color:{light:"#8B5CF6",dark:"#8B5CF6"},strokeWidth:3}}[d];if(t)return[...e,t]}return e},[d,i,x]),y=(0,f.useMemo)(()=>"query_latency"===d?eW:ez,[d]);return(0,r.jsx)("div",{className:"bg-surface-200 border-t","data-sentry-component":"QueryPerformanceChart","data-sentry-source-file":"QueryPerformanceChart.tsx",children:(0,r.jsxs)(k.tU,{value:d,onValueChange:e=>c(e),className:"w-full","data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"QueryPerformanceChart.tsx",children:[(0,r.jsx)(k.j7,{className:"flex justify-start rounded-none gap-x-4 border-b !mt-0 pt-0 px-6","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"QueryPerformanceChart.tsx",children:et.map(e=>(0,r.jsx)(k.Xi,{value:e.id,className:"flex items-center gap-2 text-xs py-3 border-b-[1px] font-mono uppercase",children:e.label},e.id))}),(0,r.jsx)(k.av,{value:d,className:"bg-surface-200 mt-0 h-inherit","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"QueryPerformanceChart.tsx",children:(0,r.jsx)("div",{className:"w-full flex items-center justify-center min-h-[320px]",children:n?(0,r.jsx)(M.A,{size:20,className:"animate-spin text-foreground-lighter"}):l?(0,r.jsx)("p",{className:"text-sm text-foreground-light text-center h-full flex items-center justify-center",children:"Error loading chart data"}):(0,r.jsxs)("div",{className:"w-full flex flex-col h-full px-6 py-4",children:[(0,r.jsx)("div",{className:"flex gap-6 mb-4",children:u.map((e,t)=>(0,r.jsx)(eB,{label:e.label,value:e.value},t))}),(0,r.jsx)(eP.X,{data:p,attributes:h,yAxisKey:(null==(t=h[0])?void 0:t.attribute)||"",xAxisKey:"period_start",title:"",customDateFormat:"MMM D, YYYY hh:mm A",hideChartType:!0,hideHighlightArea:!0,showTooltip:!0,showGrid:!0,showLegend:"query_latency"===d||"cache_hits"===d||"rows_read"===d||"calls"===d,showTotal:!1,showMaxValue:!1,updateDateRange:(e,t)=>{null==s||s(e,t)},YAxisProps:{tick:!0,width:60,tickFormatter:y},xAxisIsDate:!0,className:"mt-6"})]})})})]})})};var eH=s(56404),eU=s(31092),e$=s(68152),eV=s(81969),eY=s(4322),eG=s(64758),eK=s(21861);let eJ=e=>{let{actions:t,showRolesFilter:s=!1}=e,{data:n}=(0,x.YA)(),{sort:l,clearSort:i}=h(),[{search:o,roles:d,callsFilter:c},u]=(0,a.ab)({search:a.tU.withDefault(""),roles:(0,a.IN)(a.tU).withDefault([]),callsFilter:(0,a.os)(e=>e).withDefault({operator:">=",value:0})}),{data:m,isLoading:p}=(0,eY._X)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),y=(null!=m?m:[]).sort((e,t)=>e.name.localeCompare(t.name)),[g,_]=(0,f.useState)({roles:d}),[b,w]=(0,f.useState)(o),N=(0,eH.d7)(b,500),S=0===b.length?b:N;return(0,f.useEffect)(()=>{u({search:S||""})},[S]),(0,r.jsxs)("div",{className:"px-4 py-1.5 bg-surface-200 border-t -mt-px flex justify-between items-center overflow-x-auto overflow-y-hidden w-full flex-shrink-0","data-sentry-component":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,r.jsx)("div",{className:"flex items-center gap-x-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(eG.p,{size:"tiny",autoComplete:"off",icon:(0,r.jsx)(eU.A,{size:12}),value:b,onChange:e=>w(e.target.value),name:"keyword",id:"keyword",placeholder:"Filter by query",className:"w-56",actions:[b&&(0,r.jsx)(j.$,{size:"tiny",type:"text",icon:(0,r.jsx)(e$.A,{}),onClick:()=>w(""),className:"p-0 h-5 w-5"})],"data-sentry-element":"Input","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,r.jsx)(eK.$,{label:"Calls",value:c,onChange:e=>u({callsFilter:e}),operators:["=",">=","<=",">","<","!="],defaultOperator:">=",placeholder:"e.g. 100",min:0,className:"w-auto","data-sentry-element":"ReportsNumericFilter","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),s&&(0,r.jsx)(eV.I,{name:"Roles",options:y,labelKey:"name",valueKey:"name",activeOptions:p?[]:g.roles,onSaveFilters:e=>{_({...g,roles:e}),u({roles:e})},className:"w-56"}),l&&(0,r.jsxs)("div",{className:"text-xs border rounded-md px-1.5 md:px-2.5 py-1 h-[26px] flex items-center gap-x-2",children:[(0,r.jsxs)("p",{className:"md:inline-flex gap-x-1 hidden truncate",children:["Sort: ",l.column," ",(0,r.jsx)("span",{className:"text-foreground-lighter",children:l.order})]}),(0,r.jsxs)(v.m_,{children:[(0,r.jsx)(v.k$,{onClick:i,children:(0,r.jsx)(e$.A,{size:14,className:"text-foreground-light hover:text-foreground"})}),(0,r.jsx)(v.ZI,{side:"bottom",children:"Clear sort"})]})]})]})}),(0,r.jsx)("div",{className:"flex gap-2 items-center pl-2",children:t})]})};var eX=s(68224),eZ=s(1438);eu().extend(eM());let e0=e=>{let{dateRange:t,onDateRangeChange:s}=e,{ref:a}=(0,n.g)(),[l,i]=(0,f.useState)(null),o=(0,f.useMemo)(()=>{if(t)return{iso_timestamp_start:t.period_start.date,iso_timestamp_end:t.period_end.date};let e=eu().utc();return{iso_timestamp_start:e.subtract(24,"hours").toISOString(),iso_timestamp_end:e.toISOString()}},[t]),d=(0,f.useMemo)(()=>es(o.iso_timestamp_start,o.iso_timestamp_end),[o]),{logData:c,isLoading:u,error:m}=(0,eX.A)(a,{sql:d,iso_timestamp_start:o.iso_timestamp_start,iso_timestamp_end:o.iso_timestamp_end}),x=(0,f.useMemo)(()=>(e=>e&&0!==e.length?e.map(e=>({...e,parsedEventMessage:(e=>{try{let t=e.replace("[pg_stat_monitor] ","");return t=t.replace(/""/g,'","'),JSON.parse(t)}catch(e){return null}})(e.event_message)})).filter(e=>null!==e.parsedEventMessage).filter(e=>{var t;return(null==(t=e.parsedEventMessage)?void 0:t.event)==="bucket_query"}).map(e=>e.parsedEventMessage):[])(c||[]),[c]),p=(0,f.useMemo)(()=>(e=>e&&0!==e.length?e.map(e=>{var t,s,r,a,n,l,i,o,d,c,u,m,x,p,h,f,y,g,v;let j=[e.bucket_start_time,e.bucket,e.timestamp,e.ts],_=null;for(let e of j)if(e){let t=new Date(e).getTime();if(!isNaN(t)&&t>0&&t>9466848e5){_=t;break}}if(!_)return null;let b=e.resp_calls&&Array.isArray(e.resp_calls)?eL(e.resp_calls):{p50:0,p95:0};return{period_start:_,timestamp:j.find(e=>e)||"",query_latency:parseFloat(String(null!=(r=null!=(s=null!=(t=e.mean_time)?t:e.mean_exec_time)?s:e.mean_query_time)?r:0)),mean_time:parseFloat(String(null!=(l=null!=(n=null!=(a=e.mean_time)?a:e.mean_exec_time)?n:e.mean_query_time)?l:0)),min_time:parseFloat(String(null!=(d=null!=(o=null!=(i=e.min_time)?i:e.min_exec_time)?o:e.min_query_time)?d:0)),max_time:parseFloat(String(null!=(m=null!=(u=null!=(c=e.max_time)?c:e.max_exec_time)?u:e.max_query_time)?m:0)),stddev_time:parseFloat(String(null!=(h=null!=(p=null!=(x=e.stddev_time)?x:e.stddev_exec_time)?p:e.stddev_query_time)?h:0)),p50_time:b.p50,p95_time:b.p95,rows_read:parseInt(String(null!=(f=e.rows)?f:0),10),calls:parseInt(String(null!=(y=e.calls)?y:0),10),cache_hits:parseFloat(String(null!=(g=e.shared_blks_hit)?g:0)),cache_misses:parseFloat(String(null!=(v=e.shared_blks_read)?v:0))}}).filter(e=>null!==e).sort((e,t)=>e.period_start-t.period_start):[])(x),[x]),h=(0,f.useMemo)(()=>(e=>{if(!e||0===e.length)return[];let t=new Map;e.forEach(e=>{let s=(e.query||"").replace(/\s+/g," ").trim();s&&(t.has(s)||t.set(s,[]),t.get(s).push(e))});let s=[],r=0;return Array.from(t.entries()).map(e=>{let[t,s]=e,a=s.length,n=0,l=0,i=0,o=0,d=s[0].username,c=1/0,u=-1/0,m=0;s.forEach(e=>{var t,s,r,a,d,x,p,h,f,y,g,v,j;let _=parseFloat(String(null!=(r=null!=(s=null!=(t=e.mean_time)?t:e.mean_exec_time)?s:e.mean_query_time)?r:0)),b=parseFloat(String(null!=(x=null!=(d=null!=(a=e.min_time)?a:e.min_exec_time)?d:e.min_query_time)?x:0)),w=parseFloat(String(null!=(f=null!=(h=null!=(p=e.max_time)?p:e.max_exec_time)?h:e.max_query_time)?f:0)),N=parseInt(String(null!=(y=e.calls)?y:0),10),S=parseInt(String(null!=(g=e.rows)?g:0),10),A=parseFloat(String(null!=(v=e.shared_blks_hit)?v:0)),C=parseFloat(String(null!=(j=e.shared_blks_read)?j:0));c=Math.min(c,b),u=Math.max(u,w),n+=N,l+=S,i+=A,o+=C,m+=_*N});let x=n>0?m/n:0,p=c===1/0?0:c,h=u===-1/0?0:u;return r+=m,{query:t,rolname:d,count:a,avgMeanTime:x,minTime:p,maxTime:h,totalCalls:n,totalRowsRead:l,totalTime:m,totalCacheHits:i,totalCacheMisses:o}}).forEach(e=>{let t=e.totalCacheHits+e.totalCacheMisses,a=t>0?e.totalCacheHits/t*100:0,n=r>0?e.totalTime/r*100:0;s.push({query:e.query,rolname:e.rolname,calls:e.totalCalls,mean_time:e.avgMeanTime,min_time:e.minTime,max_time:e.maxTime,total_time:e.totalTime,rows_read:e.totalRowsRead,cache_hit_rate:a,prop_total_time:n,index_advisor_result:null,_total_cache_hits:e.totalCacheHits,_total_cache_misses:e.totalCacheMisses,_count:e.count})}),s.sort((e,t)=>t.total_time-e.total_time)})(x),[x]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eO,{dateRange:t,onDateRangeChange:s,chartData:p,isLoading:u,error:m,currentSelectedQuery:l,parsedLogs:x,"data-sentry-element":"QueryPerformanceChart","data-sentry-source-file":"WithMonitor.tsx"}),(0,r.jsx)(eJ,{actions:(0,r.jsx)(eZ.b,{results:h,fileName:"Supabase Query Performance Monitor (".concat(a,")"),align:"end"}),"data-sentry-element":"QueryPerformanceFilterBar","data-sentry-source-file":"WithMonitor.tsx"}),(0,r.jsx)(ek.$,{loading:u,"data-sentry-element":"LoadingLine","data-sentry-source-file":"WithMonitor.tsx"}),(0,r.jsx)(eD,{aggregatedData:h,isLoading:u,currentSelectedQuery:l,onCurrentSelectQuery:e=>{i(t=>t===e?null:e)},"data-sentry-element":"QueryPerformanceGrid","data-sentry-source-file":"WithMonitor.tsx"})]})};var e1=s(81672),e2=s(49697),e3=s(68421),e5=s(28202),e4=s(72341),e6=s(63351),e9=s(59129),e8=s(73640);let e7=()=>{let{data:e,isLoading:t}=(0,Y.a)({preset:"queryMetrics"}),s=(0,f.useMemo)(()=>{var t,s,r,a;return[{title:(null==e||null==(t=e[0])?void 0:t.slow_queries)===1?"Slow Query":"Slow Queries",value:(null==e||null==(s=e[0])?void 0:s.slow_queries)||"0"},{title:"Cache Hit Rate",value:(null==e||null==(r=e[0])?void 0:r.cache_hit_rate)||"0%"},{title:"Avg. Rows Per Call",value:(null==e||null==(a=e[0])?void 0:a.avg_rows_per_call)||"0"}]},[e]);return(0,r.jsx)("section",{className:"px-6 pt-2 pb-4 flex flex-wrap gap-x-6 gap-y-2 w-full","data-sentry-component":"QueryPerformanceMetrics","data-sentry-source-file":"QueryPerformanceMetrics.tsx",children:s.map((e,a)=>(0,r.jsxs)(f.Fragment,{children:[(0,r.jsx)("div",{className:"flex items-baseline gap-2 heading-subSection text-foreground-light",children:t?(0,r.jsx)(e8.E,{className:"h-5 w-24"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-foreground",children:e.value}),(0,r.jsx)("span",{children:e.title})]})}),a<s.length-1&&(0,r.jsx)("span",{className:"text-foreground-muted",children:"/"})]},a))})},te=e=>{var t;let{queryHitRate:s,queryPerformanceQuery:a,queryMetrics:o}=e,{ref:d}=(0,n.g)(),{data:c}=(0,x.YA)(),u=(0,e4.RE)(),{data:m,isLoading:p,isRefetching:h}=a,y=u.selectedDatabaseId===d,g=(0,e9.s)(null!=(t=u.selectedDatabaseId)?t:""),[v,_]=(0,f.useState)(!1),[b,w]=(0,e5.U)(n.rS.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),N=()=>{a.runQuery(),s.runQuery(),o.runQuery()},S=(0,f.useMemo)(()=>(e=>{if(!e||0===e.length)return[];let t=e.reduce((e,t)=>e+(t.total_time||0),0);return e.map(e=>({query:e.query,rolname:e.rolname||void 0,calls:e.calls||0,mean_time:e.mean_time||0,min_time:e.min_time||0,max_time:e.max_time||0,total_time:e.total_time||0,rows_read:e.rows_read||0,cache_hit_rate:e.cache_hit_rate||0,prop_total_time:t>0?e.total_time/t*100:0,index_advisor_result:e.index_advisor_result||null}))})(m||[]),[m]),{data:A}=(0,e6.Vh)({projectRef:d});return(0,f.useEffect)(()=>{u.setSelectedDatabaseId(d)},[d]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e7,{"data-sentry-element":"QueryPerformanceMetrics","data-sentry-source-file":"WithStatements.tsx"}),(0,r.jsx)(eJ,{showRolesFilter:!0,actions:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.$,{type:"default",size:"tiny",icon:(0,r.jsx)(e1.A,{}),onClick:N,loading:h,children:"Refresh"}),(0,r.jsx)(j.$,{type:"default",size:"tiny",icon:(0,r.jsx)(e2.A,{}),onClick:()=>_(!0),children:"Reset report"}),(0,r.jsx)(eZ.b,{results:S,fileName:"Supabase Query Performance Statements (".concat(d,")"),align:"end"})]}),"data-sentry-element":"QueryPerformanceFilterBar","data-sentry-source-file":"WithStatements.tsx"}),(0,r.jsx)(ek.$,{loading:p||h,"data-sentry-element":"LoadingLine","data-sentry-source-file":"WithStatements.tsx"}),(0,r.jsx)(eD,{aggregatedData:S,isLoading:p,"data-sentry-element":"QueryPerformanceGrid","data-sentry-source-file":"WithStatements.tsx"}),(0,r.jsxs)("div",{className:(0,F.cn)("px-6 py-6 flex gap-x-4 border-t relative",{hidden:!1===b}),children:[(0,r.jsx)(j.$,{className:"absolute top-1.5 right-3 px-1.5",type:"text",size:"tiny",onClick:()=>w(!1),"data-sentry-element":"Button","data-sentry-source-file":"WithStatements.tsx",children:(0,r.jsx)(e$.A,{size:"14","data-sentry-element":"X","data-sentry-source-file":"WithStatements.tsx"})}),(0,r.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,r.jsx)("p",{children:"Reset report"}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Consider resetting the analysis after optimizing any queries"}),(0,r.jsx)(j.$,{type:"default",className:"!mt-3 w-min",onClick:()=>_(!0),"data-sentry-element":"Button","data-sentry-source-file":"WithStatements.tsx",children:"Reset report"})]}),(0,r.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,r.jsx)("p",{children:"How is this report generated?"}),(0,r.jsx)(eE.o,{className:"text-xs",content:"This report uses the pg_stat_statements table, and pg_stat_statements extension. [Learn more here](".concat(eR.aq,"/guides/platform/performance#examining-query-performance)."),"data-sentry-element":"Markdown","data-sentry-source-file":"WithStatements.tsx"})]}),(0,r.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,r.jsx)("p",{children:"Inspect your database for potential issues"}),(0,r.jsx)(eE.o,{className:"text-xs",content:"The Supabase CLI comes with a range of tools to help inspect your Postgres instances for\n            potential issues. [Learn more here](".concat(eR.aq,"/guides/database/inspect)."),"data-sentry-element":"Markdown","data-sentry-source-file":"WithStatements.tsx"})]})]}),(0,r.jsx)(e3.A,{visible:v,size:"medium",variant:"destructive",title:"Reset query performance analysis",confirmLabel:"Reset report",confirmLabelLoading:"Resetting report",onCancel:()=>_(!1),onConfirm:async()=>{var e;let t=null==A||null==(e=A.find(e=>e.identifier===u.selectedDatabaseId))?void 0:e.connectionString;if(eR.pe&&!t)return l.oR.error("Unable to run query: Connection string is missing");try{await (0,i.E)({projectRef:null==c?void 0:c.ref,connectionString:t,sql:"SELECT pg_stat_statements_reset();"}),N(),_(!1)}catch(e){l.oR.error("Failed to reset analysis: ".concat(e.message))}},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"WithStatements.tsx",children:(0,r.jsxs)("p",{className:"text-foreground-light text-sm",children:["This will reset the pg_stat_statements table in the extensions schema on your"," ",(0,r.jsx)("span",{className:"text-foreground",children:y?"primary database":"read replica (ID: ".concat(g,")")}),", which is used to calculate query performance. This data will repopulate immediately after."]})})]})},tt=e=>{let{queryHitRate:t,queryPerformanceQuery:s,queryMetrics:a,isPgStatMonitorEnabled:l,dateRange:i,onDateRangeChange:o}=e,{ref:d}=(0,n.g)(),c=(0,e4.RE)();return((0,f.useEffect)(()=>{c.setSelectedDatabaseId(d)},[d]),l)?(0,r.jsx)(e0,{dateRange:i,onDateRangeChange:o}):(0,r.jsx)(te,{queryHitRate:t,queryPerformanceQuery:s,queryMetrics:a,"data-sentry-element":"WithStatements","data-sentry-component":"QueryPerformance","data-sentry-source-file":"QueryPerformance.tsx"})};var ts=s(23463),tr=s(12719),ta=s(34179),tn=s(34842),tl=s(10508),ti=s(92043),to=s(34016),td=s(91205),tc=s(8089);let tu=()=>{let{ref:e}=(0,n.g)(),{data:t}=(0,x.YA)(),{isIndexAdvisorEnabled:s}=p(),{sort:l}=h(),{selectedDateRange:i,datePickerValue:o,datePickerHelpers:d,updateDateRange:c,handleDatePickerChange:u}=(0,tc.T)(ts.s3.LAST_60_MINUTES),[{search:m,roles:f,minCalls:y}]=(0,a.ab)({sort:a.tU,order:a.tU,search:a.tU.withDefault(""),roles:(0,a.IN)(a.tU).withDefault([]),minCalls:a.GJ}),g=ts.NY[tr.N.QUERY_PERFORMANCE],v=(0,ta.B7)(g.queries,null!=e?e:"default"),j=v.queryHitRate(),_=v.queryMetrics(),b=(0,Y.a)({searchQuery:m,orderBy:l||void 0,preset:"unified",roles:f,runIndexAdvisor:s,minCalls:null!=y?y:void 0}),N=(null==t?void 0:t.dbVersion)==="17.4.1.076-psml-1";return(0,r.jsxs)("div",{className:"h-full flex flex-col","data-sentry-component":"QueryPerformanceReport","data-sentry-source-file":"query-performance.tsx",children:[(0,r.jsx)(td.M,{className:"py-4 px-6 !mb-0 md:flex-row flex-col",title:"Query Performance",actions:(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsx)(w,{}),(0,r.jsx)(eI.A,{href:"".concat(eR.aq,"/guides/platform/performance#examining-query-performance")}),(0,r.jsx)(to.A,{}),N&&(0,r.jsx)(tn.O,{value:o,helpers:d.filter(e=>e.text===ts.s3.LAST_60_MINUTES||e.text===ts.s3.LAST_3_HOURS||e.text===ts.s3.LAST_24_HOURS),onSubmit:u})]}),"data-sentry-element":"FormHeader","data-sentry-source-file":"query-performance.tsx"}),(0,r.jsx)(tt,{queryHitRate:j,queryPerformanceQuery:b,queryMetrics:_,isPgStatMonitorEnabled:N,dateRange:i,onDateRangeChange:c,"data-sentry-element":"QueryPerformance","data-sentry-source-file":"query-performance.tsx"})]})};tu.getLayout=e=>(0,r.jsx)(tl.A,{children:(0,r.jsx)(ti.A,{title:"Query performance",children:e})});let tm=tu},60894:(e,t,s)=>{"use strict";s.d(t,{a:()=>l});var r=s(51797),a=s(23463),n=s(12719);let l=e=>{let{preset:t,orderBy:s,searchQuery:l="",roles:i,runIndexAdvisor:o=!1,minCalls:d}=e,c=a.NY[n.N.QUERY_PERFORMANCE].queries[t],u=[void 0!==i&&i.length>0?"auth.rolname in (".concat(i.map(e=>"'".concat(e,"'")).join(", "),")"):"",l.length>0?"statements.query ~* '".concat(l,"'"):"","number"==typeof d&&d>0?"statements.calls >= ".concat(d):""].filter(e=>e.length>0).join(" AND "),m=s&&"ORDER BY ".concat(s.column," ").concat(s.order),x=c.sql([],u.length>0?"WHERE ".concat(u):void 0,m,o);return(0,r.A)({sql:x,params:void 0,where:u,orderBy:m})}},91205:(e,t,s)=>{"use strict";s.d(t,{M:()=>l});var r=s(80263),a=s(80100),n=s(41273);let l=e=>{let{title:t,description:s,docsUrl:l,actions:i,className:o}=e;return(0,r.jsxs)("div",{className:(0,a.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(o)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,r.jsx)("p",{className:"prose text-sm max-w-2xl",children:s})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==l&&(0,r.jsx)(n.A,{href:l}),i]})]})}}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,2838,21436,57459,47876,87654,652,81285,90042,2651,35831,86567,76984,72391,35035,40545,596,10508,48340,75187,29471,92043,51697,61732,90636,46593,38792],()=>e(e.s=41877)),_N_E=e.O()}]);