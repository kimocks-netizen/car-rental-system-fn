try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d3c3cc21-3b4a-406b-a0c9-ff1d18e40a6a",e._sentryDebugIdIdentifier="sentry-dbid-d3c3cc21-3b4a-406b-a0c9-ff1d18e40a6a")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87006],{1438:(e,t,n)=>{"use strict";n.d(t,{b:()=>j});var a=n(80263),s=n(39899),l=n.n(s),r=n(29948),i=n(76174),o=n(41121),c=n(9753),d=n(77406),u=n(77191),m=n.n(u),h=n(53239),x=n(73969),p=n(52555),f=n.n(p),y=n(22891),g=n(38904),v=n(21162),b=n(99779);let j=e=>{let{iconOnly:t=!1,type:n="default",text:s="Export",align:u="start",results:p,fileName:j,onDownloadAsCSV:w,onCopyAsMarkdown:N,onCopyAsJSON:S}=e,{ref:C}=(0,y.g)(),_=p.map(e=>{let t={...e};return Object.keys(e).forEach(n=>{"object"==typeof e[n]&&(t[n]=JSON.stringify(e[n]))}),t}),E=(0,h.useMemo)(()=>{if(p){let e=Array.from(p)[0];if(e)return Object.keys(e)}},[p]);return(0,a.jsxs)(v.rI,{"data-sentry-element":"DropdownMenu","data-sentry-component":"DownloadResultsButton","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(v.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,a.jsx)(b.$,{type:n,icon:t?(0,a.jsx)(r.A,{}):void 0,iconRight:t?void 0:(0,a.jsx)(i.A,{}),disabled:0===p.length,className:t?"w-7":"","data-sentry-element":"Button","data-sentry-source-file":"DownloadResultsButton.tsx",children:!t&&s})}),(0,a.jsxs)(v.SQ,{align:u,className:"w-44","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(v._2,{asChild:!0,className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,a.jsxs)(f(),{href:"/project/".concat(C,"/settings/log-drains"),"data-sentry-element":"Link","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(o.A,{size:14,"data-sentry-element":"Settings","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Add a Log Drain"})]})}),(0,a.jsxs)(v._2,{onClick:()=>{if(navigator){0==_.length&&(0,x.oR)("Results are empty");let e=Object.keys(_[0]),t=_.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),a=(0,d.Q)(n);(0,g.l)(a,()=>{x.oR.success("Copied results to clipboard"),null==N||N()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(c.A,{size:14,"data-sentry-element":"Copy","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as markdown"})]}),(0,a.jsxs)(v._2,{onClick:()=>{if(navigator){if(0===p.length)return(0,x.oR)("Results are empty");(0,g.l)(JSON.stringify(p,null,2),()=>{x.oR.success("Copied results to clipboard"),null==S||S()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(c.A,{size:14,"data-sentry-element":"Copy","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as JSON"})]}),(0,a.jsxs)(v._2,{className:"gap-x-2",onClick:()=>(()=>{let e=new Blob([m().unparse(_,{columns:E})],{type:"text/csv;charset=utf-8;"});l()(e,"".concat(j,".csv")),x.oR.success("Downloading results as CSV"),null==w||w()})(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(r.A,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Download CSV"})]})]})]})}},1561:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return n(94896)}])},4281:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(86848).A)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]])},14981:(e,t,n)=>{"use strict";n.d(t,{_:()=>N});var a=n(80263),s=n(53434),l=n.n(s),r=n(80356),i=n(66646),o=n(28009),c=n(93713),d=n(90309),u=n(52555),m=n.n(u),h=n(80814),x=n(53239),p=n(80100),f=n(22891),y=n(23729),g=n(6436),v=n(66e3),b=n(74544),j=n(4969),w=n(21650);let N=e=>{let{format:t,highlightedValue:n,highlightedLabel:s,hideHighlightedValue:u=!1,hideHighlightedLabel:N=!1,hideHighlightArea:S=!1,title:C,minimalHeader:_=!1,hideChartType:E=!1,chartStyle:k="bar",onChartStyleChange:A,showMaxValue:R=!1,setShowMaxValue:L,docsUrl:I,syncId:D,data:T,xAxisKey:q,yAxisKey:M,xAxisIsDate:U=!0,displayDateInUtc:K,customDateFormat:O,valuePrecision:P=2,shouldFormatBytes:z=!1,isNetworkChart:F=!1,attributes:Q,sql:H,titleTooltip:G,showNewBadge:B}=e,{hoveredIndex:V,isHovered:W,isCurrentChart:Y,setHover:$,clearHover:J}=(0,b.Z)(D||"default"),[Z,X]=(0,x.useState)(n),[ee,et]=(0,x.useState)(s),{ref:en}=(0,f.g)();(0,h.useRouter)(),(0,x.useEffect)(()=>{if(D&&null!==V&&W&&T&&q&&M){let n=T[V];if(n){let a=n[M];if(Q&&Q.length>1){var e,t;let s=null!=(t=null==Q||null==(e=Q.filter(e=>e.omitFromTotal||e.isMaxValue||"reference-line"===e.provider))?void 0:e.map(e=>e.attribute))?t:[];a=Object.entries(n).filter(e=>{let[t,n]=e;return"number"==typeof n&&"timestamp"!==t&&"period_start"!==t&&!s.includes(t)&&Q.some(e=>e.attribute===t&&!1!==e.enabled)}).reduce((e,t)=>{let[n,a]=t;return e+a},0)}X(a);let r=s;U&&n[q]?r=(e=>K?l()(e).utc():l()(e))(n[q]).format(O||"YYYY-MM-DD HH:mm:ss"):n[q]&&(r=n[q]),et(r)}}else X(n),et(s)},[V,W,D,T,q,M,U,K,O,n,s,Q]);let ea=(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,a.jsx)("h3",{className:"text-foreground-lighter "+(_?"text-xs":"text-sm"),children:C}),G&&(0,a.jsx)(j.I,{children:G})]}),I&&(0,a.jsx)(y.G,{type:"text",className:"px-1",asChild:!0,tooltip:{content:{side:"top",text:"Read docs"}},children:(0,a.jsx)(m(),{href:I,target:"_blank",children:(0,a.jsx)(r.A,{className:"w-4 h-4 text-foreground-lighter"})})})]}),es=(0,a.jsx)("h4",{className:"text-foreground text-xl font-normal ".concat(_?"text-base":"text-2xl"),children:void 0!==Z&&(e=>{if("number"!=typeof e)return e;if("function"==typeof t)return t(e);if(z){let t=F?Math.abs(e):e;return(0,g.z3)(t,P)}return(0,v.Eg)(e,P)})(Z)}),el=(0,a.jsx)("h4",{className:"text-foreground-lighter text-xs",children:ee});if(_)return(0,a.jsxs)("div",{className:(0,p.cn)("flex flex-row items-center gap-x-4",S&&"hidden"),style:{minHeight:"1.8rem"},children:[C&&ea,(0,a.jsxs)("div",{className:"flex flex-row items-baseline gap-x-2",children:[void 0!==n&&!u&&es,!N&&el]})]});let er=void 0!==n&&!u;return(0,a.jsxs)("div",{className:(0,p.cn)("flex-grow flex justify-between items-start min-h-16",S&&"hidden"),"data-sentry-component":"ChartHeader","data-sentry-source-file":"ChartHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[C&&ea,B&&(0,a.jsx)(w.E,{variant:"success",children:"New"})]}),(0,a.jsxs)("div",{className:"h-4",children:[er&&es,!N&&el]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[H?(0,a.jsx)(y.G,{type:"default",className:"px-1.5",asChild:!0,tooltip:{content:{side:"top",text:"Open in Log Explorer"}},children:(0,a.jsx)(m(),{href:"/project/".concat(en,"/logs/explorer?q=").concat(encodeURIComponent(H)),children:(0,a.jsx)(i.A,{className:"w-4 h-4 text-foreground-lighter"})})}):null,!E&&A&&(0,a.jsx)(y.G,{type:"default",className:"px-1.5",icon:"bar"===k?(0,a.jsx)(o.A,{}):(0,a.jsx)(c.A,{}),onClick:()=>A("bar"===k?"line":"bar"),tooltip:{content:{side:"top",text:"View as ".concat("bar"===k?"line chart":"bar chart")}}}),L&&(0,a.jsx)(y.G,{type:R?"default":"dashed",className:"px-1.5",icon:(0,a.jsx)(d.A,{className:R?"text-foreground-light":"text-foreground-lighter"}),onClick:()=>L(!R),tooltip:{content:{side:"top",text:"".concat(R?"Hide":"Show"," limit")}}})]})]})}},21874:(e,t,n)=>{"use strict";n.d(t,{e:()=>c});var a=n(72391),s=n(67850),l=n(32510),r=n(59356);let i=a.A.functions.list();async function o(e,t,n){let{projectRef:a,connectionString:s}=e,l=new Headers(n),{result:o}=await (0,r.E)({projectRef:a,connectionString:s,sql:i.sql,queryKey:["database-functions"]},t,l);return o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)({queryKey:l.c.databaseFunctions(t),queryFn:e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n},a)},enabled:a&&void 0!==t,...r})}},28669:(e,t,n)=>{"use strict";n.d(t,{HJ:()=>i});var a=n(67850),s=n(59356),l=n(32510);async function r(e,t){let{projectRef:n,connectionString:a,table:l,schema:r}=e,i=(e=>{let{table:t,schema:n}=e,a=[];t&&a.push("tablename = '".concat(t,"'")),n&&a.push("schemaname = '".concat(n,"'"));let s=a.length>0?"WHERE ".concat(a.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(s,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()})({table:l,schema:r}),{result:o}=await (0,s.E)({projectRef:n,connectionString:a,sql:i,queryKey:["table-columns",r,l]},t);return o}let i=function(e){let{projectRef:t,connectionString:n,schema:s,table:i}=e,{enabled:o=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:l.c.tableColumns(t,s,i),queryFn:e=>{let{signal:a}=e;return r({projectRef:t,connectionString:n,schema:s,table:i},a)},enabled:o&&void 0!==t,...c})}},35862:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var a=n(80263),s=n(28651),l=n(80100),r=n(14981),i=n(66e3);let o=e=>{let{attribute:t,message:n="No data to show",description:o,format:c,className:d="",size:u,isFullHeight:m=!1,titleTooltip:h,hideTotalPlaceholder:x=!1}=e,{minHeight:p}=(0,i.dQ)(u);return(0,a.jsxs)("div",{className:(0,l.cn)(m&&"h-full"),"data-sentry-component":"NoDataPlaceholder","data-sentry-source-file":"NoDataPlaceholder.tsx",children:[void 0!==t&&(0,a.jsx)(r._,{title:t,format:c,highlightedValue:x?void 0:0,titleTooltip:h}),(0,a.jsxs)("div",{className:(0,l.cn)("border-control flex flex-grow w-full flex-col items-center justify-center space-y-2 border border-dashed text-center",m&&"h-full",d),style:{minHeight:p+20},children:[(0,a.jsx)(s.A,{size:20,className:"text-border-stronger","data-sentry-element":"BarChart2","data-sentry-source-file":"NoDataPlaceholder.tsx"}),(0,a.jsxs)("div",{className:"px-1",children:[(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:n}),o&&(0,a.jsx)("p",{className:"text-foreground-lighter text-xs",children:o})]})]})]})}},66e3:(e,t,n)=>{"use strict";n.d(t,{BY:()=>x,Eg:()=>c,XO:()=>u,bk:()=>m,dQ:()=>h});var a=n(80263),s=n(53434),l=n.n(s),r=n(53239),i=n(47041),o=n(30761);let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return d(e)?u(e,t):e.toLocaleString()},d=e=>String(e).includes("."),u=(e,t)=>{if(0===t)return String(Math.round(e));if(!d(e))return e.toLocaleString()+"."+"0".repeat(t);{let[n,a]=String(e).split(".");return Number(n).toLocaleString()+"."+a.slice(0,t)}},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.C_.FULL,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?l().utc(e).format(t):l()(e).format(t)},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tiny:76,small:96,normal:160,large:280},n=t[e];return{Container:(0,r.useMemo)(()=>e=>{let{className:t,children:s}=e;return(0,a.jsx)(i.u,{className:t,height:n,minHeight:n,width:"100%",children:s})},[e]),minHeight:n}},x=e=>{let{data:t,xAxisKey:n,yAxisKey:a,stackKey:s,variant:l="values"}=e,i=(0,r.useMemo)(()=>t?Object.entries(t.reduce((e,t)=>{let l=t[n],r=t[a],i=t[s];return e[l]||(e[l]={}),e[l][i]=r,e},{})).map(e=>{let[t,a]=e;return{...a,[n]:Number.isNaN(Number(t))?t:Number(t)}}):[],[JSON.stringify(t)]),o=(0,r.useMemo)(()=>Object.keys(i[0]||{}).filter(e=>e!==n&&e!==a).sort(),[JSON.stringify(i[0]||{})]),c=(0,r.useMemo)(()=>{if("percentages"===l)return i.map(e=>{let t=Object.entries(e),n=t.filter(e=>{let[t,n]=e;return o.includes(t)}).reduce((e,t)=>{let[n,a]=t;return e+a},0);return t.reduce((e,t)=>{let[a,s]=t;return o.includes(a)?{...e,[a]:0!==s?s/n:0}:{...e,[a]:s}},{})})},[JSON.stringify(i)]);return{dataKeys:o,stackedData:i,percentagesStackedData:c}}},66646:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(86848).A)("SquareTerminal",[["path",{d:"m7 11 2-2-2-2",key:"1lz0vl"}],["path",{d:"M11 13h4",key:"1p7l4v"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}]])},74544:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(53239);let s="supabase-chart-hover-sync-enabled",l="supabase-chart-tooltip-sync-enabled",r={hoveredIndex:null,hoveredChart:null,syncHover:!0,syncTooltip:!0},i=new Set;try{{let e=localStorage.getItem(s),t=localStorage.getItem(l);null!==e&&(r.syncHover=JSON.parse(e)),null!==t&&(r.syncTooltip=JSON.parse(t))}}catch(e){console.warn("Failed to load chart sync settings from localStorage:",e)}function o(e){let t=r;if(r={...r,...e},void 0!==e.syncHover)try{localStorage.setItem(s,JSON.stringify(r.syncHover))}catch(e){console.warn("Failed to save chart hover sync setting to localStorage:",e)}if(void 0!==e.syncTooltip)try{localStorage.setItem(l,JSON.stringify(r.syncTooltip))}catch(e){console.warn("Failed to save chart tooltip sync setting to localStorage:",e)}JSON.stringify(t)!==JSON.stringify(r)&&i.forEach(e=>e(r))}function c(e){let[t,n]=(0,a.useState)(r);(0,a.useEffect)(()=>{let e=e=>{n(e)};return i.add(e),()=>{i.delete(e)}},[]);let s=(0,a.useCallback)(t=>{r.syncHover?o({hoveredIndex:t,hoveredChart:null!==t?e:null}):n(n=>({...n,hoveredIndex:t,hoveredChart:null!==t?e:null}))},[e]),l=(0,a.useCallback)(()=>{r.syncHover?o({hoveredIndex:null,hoveredChart:null}):n(e=>({...e,hoveredIndex:null,hoveredChart:null}))},[]),c=(0,a.useCallback)(e=>{o({syncHover:e,...!1===e&&{syncTooltip:!1}})},[]),d=(0,a.useCallback)(e=>{o({syncTooltip:e,...!0===e&&{syncHover:!0}})},[]),u=t.hoveredChart===e,m=t.syncHover&&null!==t.hoveredChart&&!u;return{hoveredIndex:m||u?t.hoveredIndex:null,syncHover:t.syncHover,syncTooltip:t.syncTooltip,hoveredChart:t.hoveredChart,setHover:s,clearHover:l,setSyncHover:c,setSyncTooltip:d,isHovered:null!==t.hoveredIndex&&(u||m),isCurrentChart:u}}},90309:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(86848).A)("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]])},91049:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(86848).A)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},92333:(e,t,n)=>{"use strict";n.d(t,{C:()=>l});var a=n(80263),s=n(80100);let l=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{"aria-label":"Table grid footer",className:(0,s.cn)("flex min-h-9 h-9 overflow-hidden overflow-x-auto items-center px-2 w-full border-t",n),"data-sentry-component":"GridFooter","data-sentry-source-file":"GridFooter.tsx",children:t})}},94896:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ta});var a=n(80263),s=n(56404),l=n(52555),r=n.n(l),i=n(80814),o=n(53239),c=n(42152),d=n(51355),u=n(73886),m=n(96591),h=n(26080),x=n.n(h),p=n(73969),f=n(22891),y=n(69498),g=n(68586),v=n(92333),b=n(27402),j=n(67850),w=n(59356),N=n(1228),S=n(32510);async function C(e,t){let{projectRef:n,connectionString:a,schemas:s,limit:l}=e,r=(e=>{let{schemas:t,limit:n=100}=e;return"\n".concat(N.n,"\n\nwith records as (\n  select\n    c.oid::int8 as \"id\",\n    case c.relkind\n      when 'r' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n      when 'v' then concat(\n        'create view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'm' then concat(\n        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')\n      when 'p' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n    end as \"sql\"\n  from\n    pg_namespace nc\n    join pg_class c on nc.oid = c.relnamespace\n  where\n    c.relkind in ('r', 'v', 'm', 'f', 'p')\n    and not pg_is_other_temp_schema(nc.oid)\n    and (\n      pg_has_role(c.relowner, 'USAGE')\n      or has_table_privilege(\n        c.oid,\n        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      )\n      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n    and nc.nspname IN (").concat(t.map(e=>"'".concat(e,"'")).join(", "),")\n  order by c.relname asc\n  limit ").concat(n,"\n  offset 0\n)\nselect\n  jsonb_build_object(\n    'definitions', coalesce(jsonb_agg(\n      jsonb_build_object(\n        'id', r.id,\n        'sql', r.sql\n      )\n    ), '[]'::jsonb)\n  ) \"data\"\nfrom records r;\n  ").trim()})({schemas:s,limit:l}),{result:i}=await (0,w.E)({projectRef:n,connectionString:a,sql:r,queryKey:["entity-definitions",s]},t);return i[0].data.definitions}let _=function(e){let{projectRef:t,connectionString:n,schemas:a,limit:s}=e,{enabled:l=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,j.I)({queryKey:S.c.entityDefinitions(t,a),queryFn:e=>{let{signal:l}=e;return C({projectRef:t,connectionString:n,schemas:a,limit:s},l)},enabled:l&&void 0!==t&&a.length>0,...r})};var E=n(24523),k=n(89790),A=n(63351),R=n(85663),L=n(36261),I=n(50468),D=n(28202),T=n(84512),q=n(9620),M=n(85039),U=n(48303),K=n(6436),O=n(34983),P=n(99842),z=n(95448),F=n(72341),Q=n(13693),H=n(18664),G=n(19873),B=n(45550),V=n(39260),W=n(80100),Y=n(30404),$=n(21162),J=n(99779),Z=n(97561),X=n(75878),ee=n(68421);let et=e=>{let{visible:t,hasDestructiveOperations:n,hasUpdateWithoutWhere:s,onCancel:l,onConfirm:r}=e;return(0,a.jsxs)(ee.A,{visible:t,size:"large",title:"Potential issue".concat(n&&s?"s":""," detected with your query"),confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:n&&s?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:l,onConfirm:r,"data-sentry-element":"ConfirmationModal","data-sentry-component":"RunQueryWarningModal","data-sentry-source-file":"RunQueryWarningModal.tsx",children:[(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[n&&(0,a.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),n&&s&&(0,a.jsx)(X.w,{}),s&&(0,a.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,a.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,a.jsx)("code",{className:"text-xs",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,a.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]})};var en=n(69947),ea=n(12971),es=n(59615),el=n(28532);function er(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function ei(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var eo=n(21874);async function ec(e,t){let{projectRef:n,connectionString:a}=e,{result:s}=await (0,w.E)({projectRef:n,connectionString:a,sql:"\nSELECT word FROM pg_get_keywords();\n".trim(),queryKey:["keywords"]},t);return s.map(e=>e.word.toLocaleLowerCase())}let ed=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,j.I)({queryKey:S.c.keywords(t),queryFn:e=>{let{signal:a}=e;return ec({projectRef:t,connectionString:n},a)},enabled:a&&void 0!==t,...s})};var eu=n(32775),em=n(28669),eh=n(1438),ex=n(8579),ep=n(11101),ef=n(53434),ey=n.n(ef),eg=n(86848);let ev=(0,eg.A)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var eb=n(68152),ej=n(23729),ew=n(96459),eN=n(35862),eS=n(21650),eC=n(883),e_=n(66329),eE=n(48156),ek=n(44725);let eA=["number","string","date"],eR=e=>{let{results:t={rows:[]},config:n,onConfigChange:s}=e,{ref:l}=(0,f.g)(),[i,c]=(0,D.U)(f.rS.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(l),!1),d=(0,o.useMemo)(()=>Object.keys(t.rows[0]||{}).filter(e=>{let n=typeof t.rows[0][e];return eA.includes(n)}),[t]),u=(0,o.useMemo)(()=>t.rows[0]?Object.keys(t.rows[0]).filter(e=>{let n=t.rows[0][e];return"number"==typeof n||!isNaN(Number(n))}):[],[t]),m=n.xKey&&n.yKey,h=(0,o.useMemo)(()=>{var e,a;if(!m)return!1;let s=typeof(null==(e=t.rows[0])?void 0:e[n.xKey]),l=typeof(null==(a=t.rows[0])?void 0:a[n.yKey]);return"number"===s&&"number"===l},[m,t.rows,n.xKey,n.yKey]),x=(0,o.useMemo)(()=>((e,t)=>{var n;return(null==e||null==(n=e.rows)?void 0:n.length)?e.rows.reduce((e,n)=>{let a=e[e.length-1]||{};return[...e,{...n,[t.yKey]:(a[t.yKey]||0)+n[t.yKey]}]},[]):[]})(t,n),[t,n]),p=n.cumulative?x:t.rows,y=(e=>{var t;let n=(null==p||null==(t=p[0])?void 0:t[e])||"";return"number"==typeof n?"number":ey()(n).isValid()?"date":"string"})(n.xKey);return d.length?(0,a.jsxs)(V.HK,{direction:"horizontal",className:"flex-grow h-full","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"ChartConfig","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(V.wV,{className:"p-4 h-full",defaultSize:75,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:m?"bar"===n.type?(0,a.jsx)(ew.A,{showLegend:!0,size:"normal",xAxisIsDate:"date"===y,data:p,xAxisKey:n.xKey,yAxisKey:n.yKey,showGrid:n.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!n.showLabels,tickFormatter:e=>{let t=p[+e][n.xKey];return"date"===y?ey()(t).format("MMM D YYYY HH:mm"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!n.showLabels,domain:[0,"dataMax"]}}):null:(0,a.jsx)(V.wV,{className:"p-4 h-full",defaultSize:75,children:(0,a.jsx)(eN.A,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})})}),(0,a.jsx)(V.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"ChartConfig.tsx"}),(0,a.jsxs)(V.wV,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto","data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,a.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),n.xKey&&n.yKey&&(0,a.jsx)(ej.G,{type:"text",size:"tiny",onClick:()=>{let e=n.xKey,t=n.yKey;s({...n,xKey:t,yKey:e})},disabled:!h,icon:(0,a.jsx)(ev,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:h?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),!i&&(0,a.jsxs)(ek.Z,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{onClick:()=>c(!0),className:"absolute top-3 right-3 opacity-30 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(eb.A,{size:14,className:"text-foreground-light"})}),(0,a.jsx)(Y.ZI,{side:"bottom",children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(eS.E,{variant:"success",className:"text-xs rounded px-1",children:"NEW"}),(0,a.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,a.jsx)("p",{className:"text-xs text-foreground-light mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,a.jsx)(J.$,{asChild:!0,size:"tiny",type:"default",className:"mt-2",children:(0,a.jsx)(r(),{href:"/project/".concat(l,"/reports"),children:"Head to Reports"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eC.J,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"X Axis"}),(0,a.jsxs)(e_.l6,{value:n.xKey,onValueChange:e=>{s({...n,xKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(e_.bq,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:n.xKey||"Select X Axis"}),(0,a.jsx)(e_.gC,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(e_.s3,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:d.map(e=>(0,a.jsx)(e_.eb,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eC.J,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"Y Axis"}),(0,a.jsxs)(e_.l6,{value:n.yKey,onValueChange:e=>{s({...n,yKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(e_.bq,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:n.yKey||"Select Y Axis"}),(0,a.jsx)(e_.gC,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(e_.s3,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:u.map(e=>(0,a.jsx)(e_.eb,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,a.jsxs)(eC.J,{className:"",htmlFor:"cumulative","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eE.S,{id:"cumulative",name:"cumulative",checked:n.cumulative,onClick:()=>s({...n,cumulative:!n.cumulative}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Cumulative"]}),(0,a.jsxs)(eC.J,{htmlFor:"showLabels","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eE.S,{id:"showLabels",name:"showLabels",checked:n.showLabels,onClick:()=>s({...n,showLabels:!n.showLabels}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show labels"]}),(0,a.jsxs)(eC.J,{htmlFor:"showGrid","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eE.S,{id:"showGrid",name:"showGrid",checked:n.showGrid,onClick:()=>s({...n,showGrid:!n.showGrid}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show grid"]})]})]})]}):(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(eN.A,{size:"normal",description:"Execute a query and configure the chart options."})})};var eL=n(77444);let eI=(0,eg.A)("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);var eD=n(23892),eT=n(85024),eq=n(4281),eM=n(39327),eU=n(34016),eK=n(17e3),eO=n(91049),eP=n(12123);let ez=e=>{let{id:t}=e,{profile:n}=(0,O.xc)(),s=(0,G.aP)().snippets[t],l=(null==n?void 0:n.id)===(null==s?void 0:s.snippet.owner_id);return(0,a.jsx)(a.Fragment,{children:l?null:(0,a.jsx)(eS.E,{children:"Read-only"})})},eF=e=>{let{id:t}=e,{profile:n}=(0,O.xc)(),l=(0,G.aP)(),r=l.savingStates[t],i=(0,s.ZC)(r),[c,d]=(0,o.useState)(!1),m=l.snippets[t],h=(null==n?void 0:n.id)===(null==m?void 0:m.snippet.owner_id);return(0,o.useEffect)(()=>{let e=!1;return"UPDATING"===i&&"IDLE"===r&&(d(!0),setTimeout(()=>{e||d(!1)},5e3)),()=>{e=!0}},[r]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[h&&"UPDATING_FAILED"===r&&(0,a.jsx)(J.$,{type:"text",size:"tiny",icon:(0,a.jsx)(eO.A,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>l.addNeedsSaving(t),children:"Retry"}),c?(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{children:(0,a.jsx)(eD.A,{className:"text-brand",size:14,strokeWidth:3})}),(0,a.jsx)(Y.ZI,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===r?(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{children:(0,a.jsx)(u.A,{className:"animate-spin",size:14,strokeWidth:2})}),(0,a.jsx)(Y.ZI,{children:"Saving changes..."})]}):"UPDATING_FAILED"===r?h?(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{children:(0,a.jsx)(eP.A,{className:"text-red-900",size:14,strokeWidth:2})}),(0,a.jsx)(Y.ZI,{children:"Failed to save changes"})]}):(0,a.jsx)(ez,{id:t}):null]})})},eQ=e=>{let{id:t,isExecuting:n=!1,isDisabled:s=!1,hasSelection:l=!1,prettifyQuery:r,executeQuery:i}=e,{ref:o}=(0,f.g)(),c=(0,G.aP)(),[d]=(0,D.U)(f.rS.SQL_EDITOR_AI_OPEN,!0),[u,m]=(0,D.U)(f.rS.SQL_EDITOR_INTELLISENSE,!0),[h,x]=(0,D.U)(f.rS.SQL_EDITOR_LAST_SELECTED_DB(o),""),y=c.snippets[t],g=void 0!==y&&y.snippet.favorite,v=()=>{m(!u),p.oR.success("Successfully ".concat(u?"disabled":"enabled"," intellisense. ").concat(u?"Please refresh your browser for changes to take place.":""))},b=()=>c.addFavorite(t),j=()=>c.removeFavorite(t);return(0,a.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2","data-sentry-component":"UtilityActions","data-sentry-source-file":"UtilityActions.tsx",children:[M.pe&&(0,a.jsx)(eF,{id:t}),(0,a.jsxs)($.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)($.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(J.$,{"data-testid":"sql-editor-utility-actions",type:"default",className:(0,W.cn)("px-1",d?"block 2xl:hidden":"hidden"),icon:(0,a.jsx)(eL.A,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsxs)($.SQ,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)($._2,{className:"justify-between",onClick:v,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(eI,{size:14,className:"text-foreground-light","data-sentry-element":"Keyboard","data-sentry-source-file":"UtilityActions.tsx"}),"Intellisense enabled"]}),u&&(0,a.jsx)(eD.A,{className:"text-brand",size:16})]}),(0,a.jsx)($.mB,{"data-sentry-element":"DropdownMenuSeparator","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsxs)($._2,{className:"gap-x-2",onClick:()=>{g?j():b()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eT.A,{size:14,strokeWidth:2,className:g?"fill-brand stroke-none":"fill-none stroke-foreground-light","data-sentry-element":"Heart","data-sentry-source-file":"UtilityActions.tsx"}),g?"Remove from":"Add to"," favorites"]}),(0,a.jsxs)($._2,{className:"gap-x-2",onClick:r,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eq.A,{size:14,strokeWidth:2,className:"text-foreground-light","data-sentry-element":"AlignLeft","data-sentry-source-file":"UtilityActions.tsx"}),"Prettify SQL"]})]})]}),(0,a.jsxs)("div",{className:(0,W.cn)("items-center gap-x-2",d?"hidden 2xl:flex":"flex"),children:[(0,a.jsxs)($.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)($.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(J.$,{type:"text",className:"px-1",icon:(0,a.jsx)(eI,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)($.SQ,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsxs)($._2,{className:"justify-between",onClick:v,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:["Intellisense enabled",u&&(0,a.jsx)(eD.A,{className:"text-brand",size:16})]})})]}),M.pe&&(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{asChild:!0,children:g?(0,a.jsx)(J.$,{type:"text",size:"tiny",onClick:j,className:"px-1",icon:(0,a.jsx)(eT.A,{className:"fill-brand stroke-none"})}):(0,a.jsx)(J.$,{type:"text",size:"tiny",onClick:b,className:"px-1",icon:(0,a.jsx)(eT.A,{className:"fill-none stroke-foreground-light"})})}),(0,a.jsxs)(Y.ZI,{side:"bottom",children:[g?"Remove from":"Add to"," favorites"]})]}),(0,a.jsxs)(Y.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(Y.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(J.$,{type:"text",onClick:r,className:"px-1",icon:(0,a.jsx)(eq.A,{strokeWidth:2,className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(Y.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"UtilityActions.tsx",children:"Prettify SQL"})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[M.pe&&(0,a.jsx)(eU.A,{selectedDatabaseId:0===h.length?void 0:h,variant:"connected-on-right",onSelectId:e=>{c.resetResult(t),x(e)}}),(0,a.jsx)(eM.g,{serviceRoleLabel:"postgres",variant:M.pe?"connected-on-both":"connected-on-right","data-sentry-element":"RoleImpersonationPopover","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsx)(eK.C,{hasSelection:l,isDisabled:s||n,isExecuting:n,className:"rounded-l-none min-w-[82px]",onClick:i,"data-sentry-element":"SqlRunButton","data-sentry-source-file":"UtilityActions.tsx"})]})})]})};var eH=n(86510),eG=n(23850),eB=n(86759),eV=n(27519),eW=n(10723),eY=n(27664),e$=n(96698),eJ=n(72432),eZ=n(99570);let eX=(0,o.forwardRef)(e=>{var t,n,s,l,r,i,o,c,d,m,h,x,p;let{id:y,isExecuting:g,isDisabled:v,isDebugging:b,onDebug:j}=e,{ref:w}=(0,f.g)(),N=(0,F.RE)(),{data:S}=(0,T.s)(),C=(0,G.aP)(),[,_]=(0,eG.ZA)("showConnect",eG.cr.withDefault(!1)),E=null==(t=C.results[y])?void 0:t[0],{data:k}=(0,e$.j5)({orgSlug:null==S?void 0:S.slug}),{data:A}=(0,eY.G)({projectRef:w}),R=(0,eB.BP)(k)&&(null==A?void 0:A.is_sensitive),L=(null==E||null==(s=E.error)||null==(n=s.message)?void 0:n.includes("canceling statement due to statement timeout"))||(null==E||null==(r=E.error)||null==(l=r.message)?void 0:l.includes("upstream request timeout"))||(null==E||null==(o=E.error)||null==(i=o.message)?void 0:i.includes("Query read timeout")),I=null==E||null==(d=E.error)||null==(c=d.message)?void 0:c.includes("EHOSTUNREACH");if(g)return(0,a.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,a.jsx)(u.A,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(null==E?void 0:E.error){let e=(null!=(p=null==(h=E.error)||null==(m=h.formattedError)?void 0:m.split("\n"))?p:[]).filter(e=>e.length>0),t=N.selectedDatabaseId!==w&&E.error.message.includes("in a read-only transaction"),n=E.error.message.includes("Query is too large to be run via the SQL Editor");return(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[L?(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("p",{className:"font-mono text-sm tracking-tight",children:"Error: SQL query ran into an upstream timeout"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["You can either"," ",(0,a.jsx)(eW.g,{href:"".concat(M.aq,"/guides/platform/performance#examining-query-performance"),children:"optimize your query"}),", or"," ",(0,a.jsx)(eW.g,{href:"".concat(M.aq,"/guides/database/timeouts"),children:"increase the statement timeout"})," or ",(0,a.jsx)("span",{className:(0,W.cn)(eW.L,"cursor-pointer"),onClick:()=>_(!0),children:"connect to your database directly"}),"."]})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.length>0?e.map((e,t)=>(0,a.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},"error-".concat(t))):(0,a.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",null==(x=E.error)?void 0:x.message]}),!L&&!I&&E.autoLimit&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",E.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),t&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),n&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,a.jsxs)("span",{onClick:()=>_(!0),className:(0,W.cn)(eW.L,"flex items-center gap-x-1"),children:["connecting to your database directly",(0,a.jsx)(eH.A,{size:12})]}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[t&&(0,a.jsx)(J.$,{className:"py-2",type:"default",onClick:()=>{N.setSelectedDatabaseId(w),C.resetResult(y)},children:"Switch to primary database"}),e.length>0&&(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{children:(0,a.jsx)(eV.A,{iconOnly:!0,type:"default",text:e.join("\n")})}),(0,a.jsx)(Y.ZI,{side:"bottom",align:"center",children:(0,a.jsx)("span",{children:"Copy error"})})]}),!R&&(0,a.jsx)(J.$,{icon:(0,a.jsx)(eJ.M,{size:16,loading:b}),disabled:!!v||b,onClick:j,children:"Debug with Assistant"})]})]})})}return E?E.rows.length<=0?(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,a.jsx)(eZ.A,{rows:E.rows}):(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,a.jsx)("code",{children:"Run"})," to execute your query."]})})});eX.displayName="UtilityTabResults";let e0={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1},e1=e=>{var t,n;let{id:s,isExecuting:l,isDebugging:r,isDisabled:i,hasSelection:o,prettifyQuery:c,executeQuery:d,onDebug:u}=e,{ref:m}=(0,f.g)(),{data:h}=(0,T.s)(),x=(0,G.aP)(),y=null==(t=x.snippets[s])?void 0:t.snippet,g=null==(n=x.results[s])?void 0:n[0],{mutate:v}=(0,L.h)(),{mutate:b}=(0,ex.v)({invalidateQueriesOnSuccess:!1,onMutate:async e=>{let{payload:t}=e;if("sql"!==t.type||!("chart"in t.content))return;let n={...y,content:{...y.content,chart:t.content.chart}};x.updateSnippet({id:s,snippet:n})},onError:async(e,t,n)=>{p.oR.error("Failed to update chart. Please try again.")}}),j=function(){var e;return y&&"sql"===y.type&&(null==(e=y.content)?void 0:e.chart)?y.content.chart:e0}();return(0,a.jsxs)(ep.tU,{defaultValue:"results",className:"w-full h-full flex flex-col","data-sentry-element":"Tabs_Shadcn_","data-sentry-component":"UtilityPanel","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)(ep.j7,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(ep.Xi,{className:"py-3 text-xs",value:"results","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),(0,a.jsx)(ep.Xi,{className:"py-3 text-xs",value:"chart","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),(null==g?void 0:g.rows)&&(0,a.jsx)(eh.b,{type:"text",results:g.rows,fileName:"Supabase Snippet ".concat(y.name),onDownloadAsCSV:()=>{var e;return v({action:"sql_editor_result_download_csv_clicked",groups:{project:null!=m?m:"",organization:null!=(e=null==h?void 0:h.slug)?e:""}})},onCopyAsMarkdown:()=>{var e;v({action:"sql_editor_result_copy_markdown_clicked",groups:{project:null!=m?m:"",organization:null!=(e=null==h?void 0:h.slug)?e:""}})},onCopyAsJSON:()=>{var e;v({action:"sql_editor_result_copy_json_clicked",groups:{project:null!=m?m:"",organization:null!=(e=null==h?void 0:h.slug)?e:""}})}})]}),(0,a.jsx)(eQ,{id:s,isExecuting:l,isDisabled:i,hasSelection:o,prettifyQuery:c,executeQuery:d,"data-sentry-element":"UtilityActions","data-sentry-source-file":"UtilityPanel.tsx"})]}),(0,a.jsx)(ep.av,{asChild:!0,value:"results",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(eX,{id:s,isExecuting:l,isDisabled:i,onDebug:u,isDebugging:r,"data-sentry-element":"UtilityTabResults","data-sentry-source-file":"UtilityPanel.tsx"})}),(0,a.jsx)(ep.av,{asChild:!0,value:"chart",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(eR,{results:g,config:j,onConfigChange:function(e){m&&(null==y?void 0:y.id)&&b({projectRef:m,payload:{...y,id:y.id,description:y.description||"",project_id:y.project_id||0,content:{...y.content,content_id:s,chart:e}}})},"data-sentry-element":"ChartConfig","data-sentry-source-file":"UtilityPanel.tsx"})})]})},e2=x()(()=>n.e(63498).then(n.bind(n,63498)),{loadableGenerated:{webpack:()=>[63498]},ssr:!1}),e4=x()(()=>Promise.resolve().then(n.bind(n,14360)).then(e=>{let{DiffEditor:t}=e;return t}),{loadableGenerated:{webpack:()=>[14360]},ssr:!1}),e6=()=>{var e,t,n;let s=(0,K.UX)(),l=(0,i.useRouter)(),{ref:r,id:c}=(0,f.g)(),{profile:h}=(0,O.xc)(),{data:x}=(0,q.YA)(),{data:j}=(0,T.s)(),w=(0,d.jE)(),N=(0,B.zv)(),S=(0,z.xd)(),{openSidebar:C}=(0,H.rM)(),X=(0,G.aP)(),ee=(0,Q.Qj)(),ec=(0,F.RE)(),{includeSchemaMetadata:eh,isHipaaProjectDisallowed:ex}=(0,I.KQ)(),[ep]=function(e){let[t,n]=(0,D.U)(f.rS.SQL_EDITOR_AI_SCHEMA(e),["public"]);return e?[t,n]:[[],()=>{}]}(null==x?void 0:x.ref),{sourceSqlDiff:ef,setSourceSqlDiff:ey,selectedDiffType:eg,setSelectedDiffType:ev,setIsAcceptDiffLoading:eb,isDiffOpen:ej,defaultSqlDiff:ew,closeDiff:eN}=(0,Z.yh)(),{promptState:eS,setPromptState:eC,promptInput:e_,setPromptInput:eE,resetPrompt:ek}=(0,Z.tB)(),eA=(0,o.useRef)(null),eR=(0,o.useRef)(null),eL=(0,o.useRef)(null),eI=(0,o.useRef)(0),[eD,eT]=(0,o.useState)(!1),[eq,eM]=(0,o.useState)([]),[eU,eK]=(0,o.useState)(!1),[eO,eP]=(0,o.useState)(!1),[ez,eF]=(0,o.useState)(!1),[eQ,eH]=(0,o.useState)(!1),[eG,eB]=(0,o.useState)(!1),eV=(0,o.useMemo)(()=>(0,K.gZ)(),[c]),eW=c&&"new"!==c?c:eV,eY=X.limit,e$=null==(e=X.results[eW])?void 0:e[0],eJ=!(eW in X.snippets&&void 0!==X.snippets[eW].snippet.content),eZ="new"!==c&&eJ;((e,t)=>{let{data:n}=(0,q.YA)(),a=(0,G.aP)(),[s]=(0,D.U)(f.rS.SQL_EDITOR_INTELLISENSE,!0),{data:l,isSuccess:r}=ed({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:s}),{data:i,isSuccess:c}=(0,eo.e)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:s}),{data:d,isSuccess:u}=(0,eu.w$)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:s}),{data:m,isSuccess:h}=(0,em.HJ)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:s}),x=(0,o.useRef)(null),p=s&&h&&u&&r&&c;p&&(null===x.current&&(x.current={}),x.current.tableColumns=m,x.current.schemas=d,x.current.keywords=l,x.current.functions=i),(0,o.useEffect)(()=>{if(t){let n=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(t){let n=t.getValue(),s=(0,U.A)(n);return e&&a.setSql(e,s),[{range:t.getFullModelRange(),text:s}]}});return()=>n.dispose()}},[t]),(0,o.useEffect)(()=>{let e=null,n=null;p&&t&&p&&(e=t.languages.registerCompletionItemProvider("pgsql",function(e,t){return{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(n,a,s){try{let o=new el.A(n,a.column-2,a.lineNumber-1);if('"'===s.triggerCharacter){var l=e,r=t,i=o;let n=[];if(!i.isFowardDQuote())return{suggestions:n};if(i.next(),i.isNextPeriod()){let e=i.readIdent(),t=!1;e.match(/^\".*?\"$/)&&(t=!0,e=er(e));let a=r.current.tableColumns.find(n=>t&&n.tablename===e||!t&&n.tablename.toLocaleLowerCase()==e.toLocaleLowerCase());if(!a)return{suggestions:n};a.columns.forEach(e=>{n.push({label:e.attname,kind:l.languages.CompletionItemKind.Property,detail:e.data_type,insertText:e.attname})})}else r.current.tableColumns.forEach(e=>{n.push({label:e.tablename,kind:l.languages.CompletionItemKind.Class,insertText:e.tablename})});return{suggestions:n}}if("."===s.triggerCharacter)return function(e,t,n){var a,s;let l=[],r=(a=n,s=3,a.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=er(e)),{isQuoted:t,name:e}})),i=0,o=t.current.schemas.find(e=>{var t,n;let a=r&&r.length>i?r[i]:{};return a.isQuoted&&e.name===a.name||!a.isQuoted&&(null==(t=e.name)?void 0:t.toLocaleLowerCase())==(null==(n=a.name)?void 0:n.toLocaleLowerCase())});if(o?i++:o=t.current.schemas.find(e=>"public"==e.name),r.length==i)return t.current.tableColumns.forEach(t=>{t.schemaname==o.name&&l.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:ei(t.tablename)})}),{suggestions:l};let c=t.current.tableColumns.find(e=>{var t,n;let a=r&&r.length>i?r[i]:{};return e.schemaname==o.name&&a.isQuoted&&e.tablename===a.name||!a.isQuoted&&(null==(t=e.tablename)?void 0:t.toLocaleLowerCase())==(null==(n=a.name)?void 0:n.toLocaleLowerCase())});return c&&c.columns.forEach(t=>{l.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:ei(t.attname)})}),{suggestions:l}}(e,t,o);return function(e,t){var n,a,s,l;let r=[];return(null==(n=t.current.keywords)?void 0:n.length)>0&&t.current.keywords.forEach(t=>{r.push({label:t,kind:e.languages.CompletionItemKind.Keyword,insertText:t})}),(null==(a=t.current.schemas)?void 0:a.length)>0&&t.current.schemas.forEach(t=>{r.push({label:t.name,kind:e.languages.CompletionItemKind.Keyword,insertText:t.name})}),(null==(s=t.current.tableColumns)?void 0:s.length)>0&&t.current.tableColumns.forEach(t=>{let n="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;r.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?e.languages.CompletionItemKind.Class:e.languages.CompletionItemKind.Interface,insertText:ei(n)}),t.columns.forEach(n=>{if(!n)return;let a=r.find(t=>t.label===(null==n?void 0:n.attname)&&t.kind===e.languages.CompletionItemKind.Field&&t.detail===(null==n?void 0:n.data_type));a?(a.tables.push(t.tablename),a.tables.sort(),a.documentation=a.tables.join(", ")):r.push({label:n.attname,kind:e.languages.CompletionItemKind.Field,detail:n.data_type,documentation:t.tablename,tables:[t.tablename],insertText:ei(n.attname)})})}),(null==(l=t.current.functions)?void 0:l.length)>0&&t.current.functions.forEach(t=>{r.push({label:t.name,kind:e.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:r}}(e,t)}catch(e){return{suggestions:[]}}}}}(t,x)),n=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let n=new el.A(e,t.column-2,t.lineNumber-1),a=n.readArguments();if(a<0)return null;let s=n.readIdent();if(!s||s.match(/^\".*?\"$/))return null;let l=x.current.functions.find(e=>e.name.toLocaleLowerCase()===s.toLocaleLowerCase());if(!l||!l.args||l.args.length<a)return null;let r=Math.min(a,l.args.length-1),i=[];return i.push({label:"".concat(l.name,"(").concat(l.argument_types,")"),parameters:l.args.map(e=>({label:e.name}))}),{value:{signatures:i,activeSignature:0,activeParameter:r},dispose:()=>{}}}}));return()=>{null==e||e.dispose(),null==n||n.dispose()}},[p,t])})(eW,eR.current);let{data:eX,isSuccess:e0}=(0,A.Vh)({projectRef:r},{enabled:(0,E.yF)(null==x?void 0:x.connectionString)}),{data:e6,refetch:e3}=_({schemas:ep,projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString},{enabled:(0,E.yF)(null==x?void 0:x.connectionString)&&eh}),e8=eh?null==e6?void 0:e6.map(e=>e.sql.trim()):void 0,{mutateAsync:e5}=(0,b.G)(),{mutate:e9}=(0,L.h)(),{mutate:e7,isPending:te}=(0,R.Y)({onSuccess(e,t){eW&&X.addResult(eW,e.result,t.autoLimit),e3(),w.invalidateQueries({queryKey:k.O.lint(r)})},onError(e,t){if(eW){if(e.position&&eR.current){var n,a,s;let t=eA.current,l=eR.current,r=eD&&null!=(a=null==t||null==(n=t.getSelection())?void 0:n.startLineNumber)?a:0,i=null!=(s=e.formattedError)?s:"",o=i.slice(i.indexOf("LINE")),c=r+Number(o.slice(0,o.indexOf(":")).split(" ")[1]);if(!isNaN(c)){let e=null==t?void 0:t.deltaDecorations([],[{range:new l.Range(c,1,c,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(null==t||t.revealLineInCenter(c),eM(e))}}X.addResultError(eW,e,t.autoLimit)}}}),tt=(0,o.useCallback)(async(e,t)=>{try{let{title:n}=await e5({sql:t});X.renameSnippet({id:e,name:n});let a=(0,B.lW)("sql",{id:e});N.updateTab(a,{label:n})}catch(e){}},[e5,X]),tn=(0,o.useCallback)(async()=>{if(ej)return;let e=(0,G.Lv)().snippets[eW];if(eA.current&&x){var t,n,a,s,l,r;let i=eA.current,o=i.getSelection(),c=o?null==(t=i.getModel())?void 0:t.getValueInRange(o):void 0,d=e?null!=(r=c||(null==(n=eA.current)?void 0:n.getValue()))?r:null==(a=e.snippet.content)?void 0:a.sql:c||(null==(s=eA.current)?void 0:s.getValue()),u=(0,U.A)(d),m=null==eA||null==(l=eA.current)?void 0:l.getModel();eA.current&&m&&(eA.current.executeEdits("apply-prettify-edit",[{text:u,range:m.getFullModelRange()}]),X.setSql(eW,u))}},[eW,ej,x,X]),ta=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(ej)return;let t=(0,G.Lv)().snippets[eW];if(null!==eA.current&&!te&&void 0!==x){var n,a,s,l,i,o,c;let d=eA.current,u=d.getSelection(),m=u?null==(n=d.getModel())?void 0:n.getValueInRange(u):void 0,h=t?null!=(o=m||(null==(a=eA.current)?void 0:a.getValue()))?o:null==(s=t.snippet.content)?void 0:s.sql:m||(null==(l=eA.current)?void 0:l.getValue()),f=!1,y=(0,es.rs)(h);!e&&y&&(eP(!0),eF(!0),f=!0);let g=(0,es.j8)(h);if(!e&&g&&(eP(!0),eH(!0),f=!0),f)return;ex||(null==t?void 0:t.snippet.name)!==en.tO||tt(eW,h),eq.length>0&&(null==d||d.deltaDecorations(eq,[]),eM([]));let v=ee(),b=null==eX||null==(i=eX.find(e=>e.identifier===ec.selectedDatabaseId))?void 0:i.connectionString;if(!(0,E.yF)(b))return p.oR.error("Unable to run query: Connection string is missing");let{appendAutoLimit:w}=(0,es.iD)(h,eY),N=(0,es.dZ)(h,eY);e7({projectRef:x.ref,connectionString:b,sql:(0,P.Nf)(N,v),autoLimit:w?eY:void 0,isRoleImpersonationEnabled:(0,Q._c)(v.role),isStatementTimeoutDisabled:!0,contextualInvalidation:!0,handleError:e=>{throw e}}),e9({action:"sql_editor_query_run_button_clicked",groups:{project:null!=r?r:"Unknown",organization:null!=(c=null==j?void 0:j.slug)?c:"Unknown"}})}},[ej,eW,te,x,ex,e7,ee,tt,ec.selectedDatabaseId,eX,eY]),ts=(0,o.useCallback)(async(e,t)=>{if(!r)return console.error("Project ref is required");if(!h)return console.error("Profile is required");if(!x)return console.error("Project is required");try{let n=(0,es.fW)({id:(0,K.gZ)(),name:t,sql:e,owner_id:h.id,project_id:x.id});X.addSnippet({projectRef:r,snippet:n}),X.addNeedsSaving(n.id),l.push("/project/".concat(r,"/sql/").concat(n.id))}catch(e){p.oR.error("Failed to create new query: ".concat(e.message))}},[null==h?void 0:h.id,null==x?void 0:x.id,r,l,X]),tl=(0,o.useCallback)(async()=>{try{var e,t,n;let a=X.snippets[eW],s=null==(e=X.results[eW])?void 0:e[0];C(y.c.AI_ASSISTANT),S.newChat({name:"Debug SQL snippet",sqlSnippets:[(null!=(n=null==(t=a.snippet.content)?void 0:t.sql)?n:"").replace(en.Fl,"").trim()],initialInput:"Help me to debug the attached sql snippet which gives the following error: \n\n".concat(s.error.message)})}catch(e){(function(e){return!!e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message})(e)&&p.oR.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[e8,eW,X.results,X.snippets]),tr=(0,o.useCallback)(async()=>{try{var e;if(eb(!0),!ef||!eA.current||!eL.current)return;let t=eA.current.getModel(),n=eL.current.getModel();if(!t||!n)return;let a=n.modified.getValue();if(eg===ea.s.NewSnippet){let{title:e}=await e5({sql:a});await ts(a,e)}else eA.current.executeEdits("apply-ai-edit",[{text:a,range:t.getFullModelRange()}]);e9({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!0},groups:{project:null!=r?r:"Unknown",organization:null!=(e=null==j?void 0:j.slug)?e:"Unknown"}}),ev(ea.s.Modification),ek(),eN()}finally{eb(!1)}},[ef,eg,ts,e5,l,eW,X]),ti=(0,o.useCallback)(()=>{var e;e9({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!1},groups:{project:null!=r?r:"Unknown",organization:null!=(e=null==j?void 0:j.slug)?e:"Unknown"}}),ek(),eN()},[eN,ek,e9]),[to,tc]=(0,o.useState)(!1),td=(0,o.useCallback)(async(e,t)=>{var n,a,s,l,r,i,o,c;try{tc(!0);let e=await fetch("".concat(M.o2,"/api/ai/code/complete"),{method:"POST",headers:{"Content-Type":"application/json",...null!=(a=null==t?void 0:t.headers)?a:{}},body:JSON.stringify({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,language:"sql",orgSlug:null==j?void 0:j.slug,...null!=(s=null==t?void 0:t.body)?s:{}})});if(!e.ok){let t=await e.text();throw Error(t||"Failed to generate completion")}let c=await e.json(),d=null!=(l=null==t||null==(n=t.body)?void 0:n.completionMetadata)?l:{},u=null!=(r=d.textBeforeCursor)?r:"",m=null!=(i=d.textAfterCursor)?i:"",h=null!=(o=d.selection)?o:"",p=(0,U.A)(u+c+m);ey({original:u+h+m,modified:p}),ev(ea.s.Modification),eC(e=>({...e,isLoading:!1})),tc(!1)}catch(e){throw p.oR.error("Failed to generate SQL: ".concat(null!=(c=null==e?void 0:e.message)?c:"Unknown error")),tc(!1),e}},[null==j?void 0:j.slug,null==x?void 0:x.connectionString,null==x?void 0:x.ref,eC,ev,ey]),tu=async(e,t)=>{try{eC(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let n=(await (0,E.We)()).get("Authorization");await td(e,{...n?{headers:{Authorization:n}}:void 0,body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){eC(e=>({...e,isLoading:!1}))}};return(0,o.useEffect)(()=>(eW&&(eN(),eC(e=>({...e,isOpen:!1}))),()=>{if(r){let e=(0,B.lW)("sql",{id:eW});N.updateTab(e,{scrollTop:eI.current})}}),[eN,eW]),(0,o.useEffect)(()=>{let e=e=>{if(ej||eS.isOpen)switch(e.key){case"Enter":("macos"===s?e.metaKey:e.ctrlKey)&&ej&&(tr(),ek());return;case"Escape":var t;ej&&ti(),ek(),null==(t=eA.current)||t.focus();return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s,ej,eS.isOpen,tr,ti,ek]),(0,o.useEffect)(()=>{if(ej){let e=eL.current,t=null==e?void 0:e.getModel();if(t&&t.original&&t.modified){t.original.setValue(ew.original),t.modified.setValue(ew.modified);let n=e.getModifiedEditor(),a=eS.startLineNumber;n.revealLineInCenter(a)}}},[eg,ef]),(0,o.useEffect)(()=>{if(e0){let e=eX.find(e=>e.identifier===r);ec.setSelectedDatabaseId(null==e?void 0:e.identifier)}},[e0,eX,r]),(0,o.useEffect)(()=>{if(void 0!==X.diffContent){var e,t,n,a,s;let{diffType:l,sql:r}=X.diffContent,i=null==(e=eA.current)?void 0:e.getModel();i&&(0===(null!=(n=null==(t=eA.current)?void 0:t.getValue())?n:"").length?null==(a=eA.current)||a.executeEdits("apply-ai-message",[{text:"".concat(r),range:i.getFullModelRange()}]):(ey({original:(null==(s=eA.current)?void 0:s.getValue())||"",modified:r}),ev(l)))}},[X.diffContent]),(0,o.useEffect)(()=>{if(ej){if(eL.current&&eU)return eB(!0),()=>eB(!1)}else eK(!1),eB(!1)},[ej,eU]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(et,{visible:eO,hasDestructiveOperations:ez,hasUpdateWithoutWhere:eQ,onCancel:()=>{eP(!1),eF(!1),eH(!1),setTimeout(()=>{var e;return null==(e=eA.current)?void 0:e.focus()},100)},onConfirm:()=>{eP(!1),ta(!0)},"data-sentry-element":"RunQueryWarningModal","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)("div",{className:"flex h-full",children:(0,a.jsxs)(V.HK,{className:"relative",direction:"vertical",autoSaveId:f.rS.SQL_EDITOR_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:[(0,a.jsx)(V.wV,{defaultSize:50,maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,a.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:eZ?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(u.A,{className:"animate-spin text-brand"})}):(0,a.jsxs)(a.Fragment,{children:[ej&&(0,a.jsxs)("div",{className:"w-full h-full",children:[(0,a.jsx)(e4,{theme:"supabase",language:"pgsql",original:ew.original,modified:ew.modified,onMount:e=>{eL.current=e,eK(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3},keepCurrentModifiedModel:!0,keepCurrentOriginalModel:!0}),eG&&(0,a.jsx)(g.A,{editor:eL.current,id:"ask-ai-diff",value:e_,onChange:eE,onSubmit:e=>{tu(e,{beforeSelection:eS.beforeSelection,selection:eS.selection||ew.modified,afterSelection:eS.afterSelection})},onAccept:tr,onReject:ti,onCancel:ek,isDiffVisible:!0,isLoading:to,startLineNumber:Math.max(0,eS.startLineNumber),endLineNumber:eS.endLineNumber})]}),(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)(e2,{autoFocus:!0,placeholder:eS.isOpen||(null==(t=eA.current)?void 0:t.getValue())?"":"Hit "+("macos"===s?"CMD+K":"CTRL+K")+" to generate query or just start typing",id:eW,className:(0,W.cn)(ej&&"hidden"),editorRef:eA,monacoRef:eR,executeQuery:ta,onHasSelection:eT,onMount:e=>{let t=(0,B.lW)("sql",{id:eW}),n=N.tabsMap[t];setTimeout(()=>{var t;(null==n||null==(t=n.metadata)?void 0:t.scrollTop)&&e.setScrollTop(n.metadata.scrollTop)},20),e.onDidScrollChange(e=>eI.current=e.scrollTop)},onPrompt:e=>{let{selection:t,beforeSelection:n,afterSelection:a,startLineNumber:s,endLineNumber:l}=e;eC(e=>({...e,isOpen:!0,selection:t,beforeSelection:n,afterSelection:a,startLineNumber:s,endLineNumber:l}))}}),eA.current&&eS.isOpen&&!ej&&(0,a.jsx)(g.A,{editor:eA.current,id:"ask-ai",value:e_,onChange:eE,onSubmit:e=>{tu(e,{beforeSelection:eS.beforeSelection,selection:eS.selection,afterSelection:eS.afterSelection})},onCancel:ek,isDiffVisible:!1,isLoading:to,startLineNumber:Math.max(0,eS.startLineNumber),endLineNumber:eS.endLineNumber})]},eW)]})})}),(0,a.jsx)(V.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)(V.wV,{defaultSize:50,maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:eZ?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(u.A,{className:"animate-spin text-brand"})}):(0,a.jsx)(e1,{id:eW,isExecuting:te,isDisabled:ej,hasSelection:eD,prettifyQuery:tn,executeQuery:ta,onDebug:tl})}),(0,a.jsx)("div",{className:"h-9",children:(null==e$?void 0:e$.rows)!==void 0&&!te&&(0,a.jsxs)(v.C,{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)(Y.m_,{children:[(0,a.jsx)(Y.k$,{children:(0,a.jsxs)("p",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-foreground",children:[e$.rows.length," row",e$.rows.length>1?"s":""]}),(0,a.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==e$.autoLimit&&" (Limited to only ".concat(e$.autoLimit," rows)")})]})}),(0,a.jsx)(Y.ZI,{className:"max-w-xs",children:(0,a.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,a.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==e$.autoLimit&&(0,a.jsxs)($.rI,{children:[(0,a.jsx)($.ty,{asChild:!0,children:(0,a.jsxs)(J.$,{type:"default",iconRight:(0,a.jsx)(m.A,{size:14}),children:["Limit results to:"," ",null==(n=en.Lo.find(e=>e.value===X.limit))?void 0:n.label]})}),(0,a.jsx)($.SQ,{className:"w-40",align:"end",children:(0,a.jsx)($.Hr,{value:X.limit.toString(),onValueChange:e=>X.setLimit(Number(e)),children:en.Lo.map(e=>(0,a.jsx)($.Ht,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})]})};var e3=n(10508),e8=n(50624),e5=n(78187),e9=n(68695),e7=n(26502),te=n(5098),tt=n(75674);let tn=()=>{let e=(0,i.useRouter)(),{id:t,ref:n,content:l,skip:d}=(0,c.g)(),u=(0,s.ZC)(t),{data:m}=(0,q.YA)(),h=(0,e5.l)(),x=(0,B.zv)(),p=(0,G.aP)(),{history:f,setLastVisitedSnippet:y}=(0,tt.q)(),g=(0,G.wU)(n),v=g.find(e=>e.id===t),b=t?x.openTabs.find(e=>e.endsWith(t)):void 0,j=!!("new"!==t&&"function"==typeof p.addSnippet&&!(null==v?void 0:v.isNotSavedInDatabaseYet)),{data:w,error:N,isError:S}=(0,te.K)({projectRef:n,id:t},{retry:!1,enabled:j}),C=S&&404===N.code&&N.message.includes("Content not found"),_=S&&400===N.code&&N.message.includes("Invalid uuid"),E=!!v&&C&&"new"===u&&"isNotSavedInDatabaseYet"in v;return((0,o.useEffect)(()=>{n&&w&&m&&(M.pe&&w.project_id!==m.id?(y(void 0),e.push("/project/".concat(n,"/sql/new"))):p.setSnippet(n,w))},[n,w,m]),(0,o.useEffect)(()=>{"new"===t&&"true"!==d&&void 0!==f.sql&&void 0===l&&void 0!==g.find(e=>e.id===f.sql)&&e.push("/project/".concat(n,"/sql/").concat(f.sql))},[t,g,l]),(0,o.useEffect)(()=>{if(!e.isReady||!t||"new"===t)return;let n=(0,B.lW)("sql",{id:t}),a=g.find(e=>e.id===t);x.addTab({id:n,type:"sql",label:(null==a?void 0:a.name)||"Untitled Query",metadata:{sqlId:t,name:null==a?void 0:a.name}})},[e.isReady,t]),(C||_)&&!E)?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"w-[400px]",children:(0,a.jsx)(ek.Z,{type:"default",title:"Unable to find snippet with ID ".concat(t),description:"This snippet doesn't exist in your project",children:b?(0,a.jsx)(J.$,{type:"default",className:"mt-2",onClick:()=>{x.handleTabClose({id:b,router:e,editor:h,onClearDashboardHistory:()=>y(void 0)})},children:"Close tab"}):(0,a.jsx)(J.$,{asChild:!0,type:"default",className:"mt-2",onClick:()=>y(void 0),children:(0,a.jsx)(r(),{href:"/project/".concat(n,"/sql"),children:"Head back"})})})})}):(0,a.jsx)(e6,{"data-sentry-element":"SQLEditor","data-sentry-component":"SqlEditor","data-sentry-source-file":"[id].tsx"})};tn.getLayout=e=>(0,a.jsx)(e3.A,{children:(0,a.jsx)(e8.$,{productMenu:(0,a.jsx)(e7.Z,{}),product:"SQL Editor",children:(0,a.jsx)(e9.A,{children:e})})});let ta=tn},96459:(e,t,n)=>{"use strict";n.d(t,{A:()=>b});var a=n(80263),s=n(53239),l=n(53434),r=n.n(l),i=n(2070),o=n(62065),c=n(30519),d=n(72195),u=n(64720),m=n(86058),h=n(75419),x=n(4860),p=n(30761),f=n(14981),y=n(66e3),g=n(35862),v=n(74544);let b=e=>{var t,n,l;let{data:b,yAxisKey:j,xAxisKey:w,format:N,customDateFormat:S=p.C_.FULL,title:C,highlightedValue:_,highlightedLabel:E,displayDateInUtc:k,minimalHeader:A,valuePrecision:R,className:L="",size:I="normal",emptyStateMessage:D,onBarClick:T,showLegend:q=!1,xAxisIsDate:M=!0,XAxisProps:U,YAxisProps:K,showGrid:O=!1,syncId:P}=e,{hoveredIndex:z,isHovered:F,isCurrentChart:Q,setHover:H,clearHover:G}=(0,v.Z)("default"),{Container:B}=(0,y.dQ)(I),[V,W]=(0,s.useState)(null),Y=(0,s.useMemo)(()=>b.map(e=>({...e,[j]:"string"==typeof e[j]?Number(e[j]):e[j]})),[b,j]),$=U||{interval:b.length-2,angle:0,tick:!1},J=K||{tickFormatter:e=>(0,y.Eg)(e,R),tick:!1,width:0},Z=e=>k?r()(e).utc():r()(e),X=function(){if(!M){var e;return V?null==(e=b[V])?void 0:e[w]:E}return null!==V&&b&&void 0!==b[V]&&Z(b[V][w]).format(S)||E}(),ee=null!==V?null==(t=b[V])?void 0:t[j]:_;return 0===b.length?(0,a.jsx)(g.A,{message:D,description:"It may take up to 24 hours for data to refresh",size:I,className:L,attribute:C,format:N}):(0,a.jsxs)("div",{className:["flex flex-col gap-y-3",L].join(" "),"data-sentry-component":"BarChart","data-sentry-source-file":"BarChart.tsx",children:[(0,a.jsx)(f._,{title:C,format:N,customDateFormat:S,highlightedValue:"number"==typeof ee?(0,y.Eg)(ee,R):ee,highlightedLabel:X,minimalHeader:A,syncId:P,data:b,xAxisKey:w,yAxisKey:j,xAxisIsDate:M,displayDateInUtc:k,valuePrecision:R,attributes:[],"data-sentry-element":"ChartHeader","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(B,{"data-sentry-element":"Container","data-sentry-source-file":"BarChart.tsx",children:(0,a.jsxs)(i.E,{data:Y,className:"overflow-visible",onMouseMove:e=>{e.activeTooltipIndex!==V&&W(e.activeTooltipIndex),H(e.activeTooltipIndex)},onMouseLeave:()=>{W(null),G()},onClick:e=>{var t,n;let a=null==e||null==(n=e.activePayload)||null==(t=n[0])?void 0:t.payload;T&&T(a,e)},"data-sentry-element":"RechartBarChart","data-sentry-source-file":"BarChart.tsx",children:[q&&(0,a.jsx)(o.s,{}),O&&(0,a.jsx)(c.d,{stroke:p.OK.AXIS}),(0,s.createElement)(d.h,{...J,axisLine:{stroke:p.OK.AXIS},tickLine:{stroke:p.OK.AXIS},key:j,"data-sentry-element":"YAxis","data-sentry-source-file":"BarChart.tsx"}),(0,s.createElement)(u.W,{...$,axisLine:{stroke:p.OK.AXIS},tickLine:{stroke:p.OK.AXIS},key:w,"data-sentry-element":"XAxis","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(m.m,{content:e=>{var t,n;return P&&F&&Q&&null!==z?(0,a.jsxs)("div",{className:"bg-black/90 text-white p-2 rounded text-xs",children:[(0,a.jsx)("div",{className:"font-medium",children:r()(null==(t=b[z])?void 0:t[w]).format(S)}),(0,a.jsxs)("div",{children:[(0,y.Eg)(Number(null==(n=b[z])?void 0:n[j])||0,R),"string"==typeof N?N:""]})]}):null},"data-sentry-element":"Tooltip","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(h.y,{dataKey:j,fill:p.OK.GREEN_1,animationDuration:300,maxBarSize:48,"data-sentry-element":"Bar","data-sentry-source-file":"BarChart.tsx",children:null==b?void 0:b.map((e,t)=>(0,a.jsx)(x.f,{className:"transition-all duration-300 ".concat(T?"cursor-pointer":""),fill:V===t||null===V?p.OK.GREEN_1:p.OK.GREEN_2,enableBackground:12},"cell-".concat(t)))})]})}),b&&(0,a.jsxs)("div",{className:"text-foreground-lighter -mt-9 flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{children:M?Z(b[0][w]).format(S):b[0][w]}),(0,a.jsx)("span",{children:M?Z(null==(n=b[(null==b?void 0:b.length)-1])?void 0:n[w]).format(S):null==(l=b[(null==b?void 0:b.length)-1])?void 0:l[w]})]})]})}}},e=>{e.O(0,[60858,15599,16110,27764,36538,44033,2838,21436,57459,26616,652,86692,47625,18705,76984,72391,35035,40545,596,10508,48340,75187,29471,92544,95403,52772,80072,62798,90636,46593,38792],()=>e(e.s=1561)),_N_E=e.O()}]);