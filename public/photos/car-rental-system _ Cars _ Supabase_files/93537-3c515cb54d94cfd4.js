try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="62442e53-2aa0-4310-981e-d80a7ba08683",e._sentryDebugIdIdentifier="sentry-dbid-62442e53-2aa0-4310-981e-d80a7ba08683")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63335,93537],{6894:(e,t,n)=>{n.d(t,{$:()=>o,I:()=>l});var a=n(67850),s=n(59356),r=n(1228),i=n(32510);async function l(e,t){let{projectRef:n,connectionString:a,id:i}=e;if(!i)throw Error("id is required");let l=(e=>{let{id:t}=e;return"\n    ".concat(r.n,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(t,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()})({id:i}),{result:o}=await (0,s.E)({projectRef:n,connectionString:a,sql:l,queryKey:["table-definition",i]},t);return o[0].definition.trim()}let o=function(e){let{projectRef:t,connectionString:n,id:s}=e,{enabled:r=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:i.c.tableDefinition(t,s),queryFn:e=>{let{signal:a}=e;return l({projectRef:t,connectionString:n,id:s},a)},enabled:r&&void 0!==t&&void 0!==s&&!isNaN(s),...o})}},17299:(e,t,n)=>{n.d(t,{Ax:()=>s,DH:()=>o,WV:()=>i,_m:()=>r,vN:()=>l});var a=n(65471);let s=e=>{let t=new Set(e.filter(e=>e.required).map(e=>e.name)),n=new Set(Array.from(t).filter(e=>e.includes("."))),a=Array.from(n);return e=>Object.fromEntries(Object.entries(e).flatMap(e=>{let[t,n]=e;return Array.isArray(n)?[[t,n],...n.map((e,n)=>["".concat(t,".").concat(n),e])]:[[t,n]]}).filter(e=>{let[s,r]=e,[i,l]=s.split(".");if(void 0!==l&&t.has(i)&&Object.keys(r).some(e=>n.has("".concat(i,".").concat(e)))){let e=a.find(e=>e.startsWith("".concat(i,".")));return!!e&&!r[e.split(".")[1]]}return t.has(i)&&(Array.isArray(r)?r.length<1:!r)}).map(e=>{let[t]=e;return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]}))},r=(e,t)=>{var n;return(null!=(n=null==e?void 0:e.tables)?n:[]).map(n=>{var s,r,i;let l=0,o=Object.fromEntries(n.options.map(e=>e.split("=")));switch(e.handler){case a.Ur.STRIPE:l=null!=(s=null==t?void 0:t.tables.findIndex(e=>{var t;return(null==(t=e.options.find(e=>"object"===e.name))?void 0:t.defaultValue)===o.object}))?s:0;break;case a.Ur.FIREBASE:l="auth/users"===o.object?null!=(r=null==t?void 0:t.tables.findIndex(e=>e.options.find(e=>"auth/users"===e.defaultValue)))?r:0:null!=(i=null==t?void 0:t.tables.findIndex(e=>"Firestore Collection"===e.label))?i:0;case a.Ur.S3:case a.Ur.AIRTABLE:case a.Ur.LOGFLARE:case a.Ur.BIG_QUERY:case a.Ur.CLICK_HOUSE:}return{...o,index:l,id:n.id,columns:n.columns,is_new_schema:!1,schema:n.schema,schema_name:n.schema,table_name:n.name}})},i=e=>Object.fromEntries(e.map(e=>e.split("=")));function l(e,t){if("wasm_fdw_handler"===e.handlerName){var n,a;let s=i(null!=(a=null==t?void 0:t.server_options)?a:[]);return(null==(n=e.server.options.find(e=>"fdw_package_name"===e.name))?void 0:n.defaultValue)===s.fdw_package_name}return e.handlerName===(null==t?void 0:t.handler)}function o(e){return a.V4.find(t=>l(t,e))}},22559:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]])},25975:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},26048:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(80263),s=n(72112),r=n(39624),i=n(80090),l=n(29471);let o=e=>{let{children:t}=e,{can:n,isSuccess:o}=(0,i.Qp)(s.aG.TENANT_SQL_ADMIN_READ,"tables");return o&&!n?(0,a.jsx)(l.S,{isBlocking:!1,children:(0,a.jsx)(r.A,{isFullPage:!0,resourceText:"view tables from this project"})}):t}},31421:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("Pointer",[["path",{d:"M22 14a8 8 0 0 1-8 8",key:"56vcr3"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1agjmk"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1",key:"wdbh2u"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10",key:"1ibuk9"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"g6ys72"}]])},39353:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]])},39624:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(80263),s=n(12123);let r=e=>{let{resourceText:t,isFullPage:n=!1}=e,r=()=>(0,a.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(s.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,a.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return n?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("div",{className:"w-[550px]",children:(0,a.jsx)(r,{})})}):(0,a.jsx)(r,{})}},40805:(e,t,n)=>{n.d(t,{RB:()=>i,ov:()=>l});var a=n(67850),s=n(59356),r=n(56748);async function i(e,t){let{projectRef:n,connectionString:a}=e,{result:r}=await (0,s.E)({projectRef:n,connectionString:a,sql:"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",queryKey:["fdws"]},t);return r}let l=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.Y.list(t),queryFn:e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},enabled:s&&void 0!==t,...l})}},42130:(e,t,n)=>{n.d(t,{fl:()=>o,oR:()=>c});var a=n(78510),s=n(67850),r=n(24523),i=n(87518);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let i=new Headers;s&&i.set("x-connection-encrypted",s);let{data:l,error:o}=await (0,r.Jt)("/platform/pg-meta/{ref}/triggers",{params:{header:{"x-connection-encrypted":s,"x-pg-application-name":a.r},path:{ref:n},query:void 0},headers:i,signal:t});return o&&(0,r.H4)(o),l}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)({queryKey:i.U.list(t),queryFn:e=>{let{signal:a}=e;return l({projectRef:t,connectionString:n},a)},select:e=>e.filter(e=>"supabase_functions"===e.function_schema&&("net"!==e.schema||0===e.function_args.length)),enabled:a&&void 0!==t,...r})},c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)({queryKey:i.U.list(t),queryFn:e=>{let{signal:a}=e;return l({projectRef:t,connectionString:n},a)},enabled:a&&void 0!==t,...r})}},44096:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("MousePointer2",[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]])},44412:(e,t,n)=>{let a,s;n.d(t,{P5:()=>b,iH:()=>y});var r=n(80263),i=n(62941),l=n(53239),o=n(80100),c=n(73640);let d=e=>{let{size:t,start:n}=e;return{position:"absolute",top:0,left:0,width:"100%",height:"".concat(t,"px"),transform:"translateY(".concat(n,"px)")}},u=(0,l.createContext)(null),m=e=>{let{children:t,value:n}=e;return(0,r.jsx)(u.Provider,{value:n,"data-sentry-element":"VirtualizerContext.Provider","data-sentry-component":"VirtualizerProvider","data-sentry-source-file":"InfiniteList.tsx",children:t})},p=()=>{let e=(0,l.useContext)(u);if(!e)throw Error("useVirtualizerContext must be used within a VirtualizerProvider");return e},h=e=>{let{children:t,items:n,getItemKey:a,getItemSize:s,hasNextPage:c=!1,isLoadingNextPage:d=!1,onLoadNextPage:u=()=>{},className:p,Component:h}=e,x=(0,l.useRef)(null),g=(0,i.Te)({count:c?n.length+1:n.length,getScrollElement:()=>x.current,getItemKey:a,estimateSize:s,overscan:5}),f=g.getVirtualItems(),y=(0,l.useMemo)(()=>({virtualizer:g,virtualItems:f}),[g,f]);(0,l.useEffect)(()=>{let e=f[f.length-1];e&&e.index>=n.length-1&&c&&!d&&u()},[f,n.length,c,d,u]);let b={ref:e=>{x.current=e},className:(0,o.cn)("overflow-auto",p),children:t};return(0,r.jsx)(m,{value:y,"data-sentry-element":"VirtualizerProvider","data-sentry-component":"InfiniteListScrollWrapper","data-sentry-source-file":"InfiniteList.tsx",children:(0,r.jsx)(null!=h?h:"div",{...b,"data-sentry-element":"WrapperToRender","data-sentry-source-file":"InfiniteList.tsx"})})},x=e=>{let{children:t,Component:n="div"}=e,{virtualizer:a}=p();return(0,r.jsx)(n,{style:{height:"".concat(a.getTotalSize(),"px"),width:"100%",position:"relative"},"data-sentry-element":"Component","data-sentry-component":"InfiniteListSizer","data-sentry-source-file":"InfiniteList.tsx",children:t})},g=(a=e=>{let{index:t,start:n,size:a,item:s,itemProps:r,ItemComponent:i}=e,o=(0,l.useMemo)(()=>d({size:a,start:n}),[a,n]),c=(0,l.useMemo)(()=>({index:t,item:s,style:o}),[t,s,o]),u=(0,l.useMemo)(()=>({...c,...null!=r?r:{}}),[c,r]);return(0,l.createElement)(i,u)},(0,l.memo)(a,s));g.displayName="MemoizedInfiniteListItem";let f=e=>{let{items:t,itemProps:n,ItemComponent:a,LoaderComponent:s}=e,{virtualItems:i}=p();return(0,r.jsx)(r.Fragment,{children:i.map(e=>{let i=e.index>t.length-1,o=t[e.index];return i?(0,r.jsx)(s,{style:d({size:e.size,start:e.start})},e.index):(0,l.createElement)(g,{key:e.index,index:e.index,start:e.start,size:e.size,item:o,itemProps:n,ItemComponent:a})})})},y=e=>{let{className:t,items:n,itemProps:a,getItemKey:s,getItemSize:i,hasNextPage:l=!1,isLoadingNextPage:o=!1,onLoadNextPage:c=()=>{},ItemComponent:d,LoaderComponent:u}=e;return(0,r.jsx)(h,{className:t,items:n,getItemKey:s,getItemSize:i,hasNextPage:l,isLoadingNextPage:o,onLoadNextPage:c,"data-sentry-element":"InfiniteListScrollWrapper","data-sentry-component":"InfiniteListDefault","data-sentry-source-file":"InfiniteList.tsx",children:(0,r.jsx)(x,{"data-sentry-element":"InfiniteListSizer","data-sentry-source-file":"InfiniteList.tsx",children:(0,r.jsx)(f,{items:n,itemProps:a,ItemComponent:d,LoaderComponent:u,"data-sentry-element":"InfiniteListItems","data-sentry-source-file":"InfiniteList.tsx"})})})},b=e=>{let{style:t}=e;return(0,r.jsx)("div",{className:"space-y-1 my-1",style:t,"data-sentry-component":"LoaderForIconMenuItems","data-sentry-source-file":"InfiniteList.tsx",children:(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsxs)("div",{className:"flex flex-row h-6 px-4 items-center gap-2",children:[(0,r.jsx)(c.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"}),(0,r.jsx)(c.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"})]}),(0,r.jsxs)("div",{className:"flex flex-row h-6 px-4 items-center gap-2",children:[(0,r.jsx)(c.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"}),(0,r.jsx)(c.E,{className:"w-32 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"})]}),(0,r.jsxs)("div",{className:"flex flex-row h-6 px-4 items-center gap-2 opacity-75",children:[(0,r.jsx)(c.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"}),(0,r.jsx)(c.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"})]}),(0,r.jsxs)("div",{className:"flex flex-row h-6 px-4 items-center gap-2 opacity-50",children:[(0,r.jsx)(c.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"}),(0,r.jsx)(c.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"})]}),(0,r.jsxs)("div",{className:"flex flex-row h-6 px-4 items-center gap-2 opacity-25",children:[(0,r.jsx)(c.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"}),(0,r.jsx)(c.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"InfiniteList.tsx"})]})]})})}},51007:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]])},57672:(e,t,n)=>{n.d(t,{I:()=>s,k:()=>a});let a=5e4,s="\nCREATE OR REPLACE FUNCTION pg_temp.count_estimate(\n    query text\n) RETURNS integer LANGUAGE plpgsql AS $$\nDECLARE\n    plan jsonb;\nBEGIN\n    EXECUTE 'EXPLAIN (FORMAT JSON)' || query INTO plan;\n    RETURN plan->0->'Plan'->'Plan Rows';\nEND;\n$$;\n".trim()},59403:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(80263),s=n(53239),r=n(6217),i=n(49151),l=n(99779);let o=e=>{let{visible:t=!1,danger:n=!1,title:o="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:p=()=>{},onSelectConfirm:h=()=>{}}=e;(0,s.useEffect)(()=>{t&&g(!1)},[t]);let[x,g]=(0,s.useState)(!1);return(0,a.jsx)(r.A,{header:o,visible:t,title:o,description:c,size:d,hideFooter:!0,onCancel:p,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,a.jsx)(i.A,{initialValues:{},validateOnBlur:!0,onSubmit:()=>void(g(!0),h()),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(r.A.Content,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.$,{block:!0,htmlType:"button",type:"default",onClick:p,disabled:x,children:"Cancel"}),(0,a.jsx)(l.$,{htmlType:"submit",block:!0,type:n?"danger":"primary",disabled:x,loading:x,children:m&&x?m:u||"Confirm"})]})})})})})}},62550:(e,t,n)=>{n.d(t,{j:()=>d});var a=n(67850),s=n(78510),r=n(24523),i=n(9620),l=n(85039),o=n(30399);async function c(e,t,n){let{projectRef:a,connectionString:i,schema:l}=e;if(!a)throw Error("projectRef is required");let o=new Headers(n);i&&o.set("x-connection-encrypted",i);let{data:c,error:d}=await (0,r.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":i,"x-pg-application-name":s.r},path:{ref:a},query:{included_schemas:l||"",excluded_schemas:""}},headers:o,signal:t});return d&&(0,r.H4)(d),c}let d=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:r=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:u}=(0,i.YA)(),m=(null==u?void 0:u.status)===l.BU.ACTIVE_HEALTHY;return(0,a.I)({queryKey:o.S.list(t,s),queryFn:e=>{let{signal:a}=e;return c({projectRef:t,connectionString:n,schema:s},a)},enabled:r&&void 0!==t&&m,...d})}},63335:(e,t,n)=>{n.d(t,{$O:()=>p,BQ:()=>x,Uu:()=>h});var a=n(74722),s=n.n(a),r=n(86727),i=n.n(r),l=n(53239),o=n(65471),c=n(17299),d=n(74809),u=n(40805),m=n(9620);let p=["auth","cron","extensions","information_schema","net","pgsodium","pgsodium_masks","pgbouncer","pgtle","realtime","storage","supabase_functions","supabase_migrations","vault","graphql","graphql_public",d.Lh],h=function(){let{excludeSchemas:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,l.useMemo)(()=>e,[JSON.stringify(e)]),n=(()=>{let{data:e}=(0,m.YA)(),t=(0,u.ov)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),n=(0,l.useMemo)(()=>o.V4.filter(e=>e.server.options.some(e=>e.name===o.xZ.name)),[]),a=(0,l.useMemo)(()=>{var e,a;return(null!=(a=null==(e=t.data)?void 0:e.filter(e=>n.some(t=>(0,c.vN)(t,e))))?a:[]).map(e=>{var t;let n=null!=(t=(0,c.WV)(e.server_options).supabase_target_schema)?t:"",a=s()(n.split(",").filter(Boolean));return{serverName:e.server_name,type:e.handler.replace("_fdw_handler",""),schemas:a}})},[t.data,n]);return{...t,data:a}})(),a=(0,l.useMemo)(()=>{var e;let a=p.map(e=>({name:e,type:"internal"})),s=null==(e=n.data)?void 0:e.flatMap(e=>e.schemas.map(t=>({name:t,type:"fdw",fdwType:e.type,serverName:e.serverName})));return i()([...a,...s],e=>e.name).filter(e=>!t.includes(e.name))},[n.data,t]);return{...n,data:a}},x=e=>{let{schema:t,excludedSchemas:n=[]}=e,{data:a}=h({excludeSchemas:n}),s=a.find(e=>e.name===t);return s?{isSchemaLocked:!0,reason:s.type,fdwType:s.fdwType}:{isSchemaLocked:!1,reason:void 0,fdwType:void 0}}},64327:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]])},69372:(e,t,n)=>{n.d(t,{A:()=>a});let a=(0,n(86848).A)("BookOpenText",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}],["path",{d:"M6 8h2",key:"30oboj"}],["path",{d:"M6 12h2",key:"32wvfc"}],["path",{d:"M16 8h2",key:"msurwy"}],["path",{d:"M16 12h2",key:"7q9ll5"}]])},74067:(e,t,n)=>{n.d(t,{V:()=>y});var a=n(80263),s=n(53239),r=n(22891),i=n(16841),l=n(63351),o=n(75204),c=n(6436),d=n(99842),u=n(13693),m=n(95137),p=n(11101),h=n(95052),x=n(80100),g=n(99779),f=n(44725);let y=e=>{let{table:t,filters:n=[],sorts:y=[],ignoreRoleImpersonation:b=!1,open:v,onOpenChange:j}=e,{ref:w}=(0,r.g)(),_=(0,u.RY)(),[S,N]=(0,s.useState)("csv"),{data:E}=(0,l.Vh)({projectRef:w}),R=(null!=E?E:[]).find(e=>e.identifier===w),A=(0,c.Av)(R||{db_user:"",db_host:"",db_port:"",db_name:""},["db_host","db_name","db_port","db_user","inserted_at"]),{db_host:k,db_port:I,db_user:C,db_name:q}=A,L=(0,i.H)({connectionInfo:A,metadata:{projectRef:w},poolingInfo:{connectionString:"",db_host:"",db_name:"",db_port:0,db_user:""}}),T="".concat(null==t?void 0:t.name,"_rows"),D=t?(0,o.PX)({table:t,sorts:y,filters:n}):void 0,z=D?b?D.toSql():(0,d.Nf)(D.toSql(),_):"",M="\n".concat(L.direct.psql,' -c "COPY (').concat(z,") TO STDOUT WITH CSV HEADER DELIMITER ',';\" > ").concat(T,".csv").trim(),P="\npg_dump -h ".concat(k," -p ").concat(I," -d ").concat(q," -U ").concat(C,' --table="').concat(null==t?void 0:t.schema,".").concat(null==t?void 0:t.name,'" --data-only --column-inserts > ').concat(T,".sql\n  ").trim();return(0,a.jsx)(m.lG,{open:v,onOpenChange:j,"data-sentry-element":"Dialog","data-sentry-component":"ExportDialog","data-sentry-source-file":"ExportDialog.tsx",children:(0,a.jsxs)(m.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"ExportDialog.tsx",children:[(0,a.jsx)(m.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"ExportDialog.tsx",children:(0,a.jsx)(m.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"ExportDialog.tsx",children:"Export table data via CLI"})}),(0,a.jsx)(m.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"ExportDialog.tsx"}),(0,a.jsxs)(m.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"ExportDialog.tsx",children:[(0,a.jsxs)("p",{className:"text-sm",children:["We highly recommend using ",(0,a.jsx)("code",{children:"csv"===S?"psql":"pg_dump"})," to export your table data, in particular if your table is relatively large. This can be done via the following command that you can run in your terminal:"]}),(0,a.jsxs)(p.tU,{value:S,onValueChange:N,"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,a.jsxs)(p.j7,{className:"gap-x-3","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,a.jsx)(p.Xi,{value:"csv","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:"As CSV"}),(0,a.jsx)(p.Xi,{value:"sql","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:"As SQL"})]}),(0,a.jsx)(p.av,{value:"csv","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:(0,a.jsx)(h.N,{hideLineNumbers:!0,wrapperClassName:(0,x.cn)("[&_pre]:px-4 [&_pre]:py-3"),language:"bash",value:M,className:"[&_code]:text-[12px] [&_code]:text-foreground","data-sentry-element":"CodeBlock","data-sentry-source-file":"ExportDialog.tsx"})}),(0,a.jsxs)(p.av,{value:"sql","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,a.jsx)(h.N,{hideLineNumbers:!0,wrapperClassName:(0,x.cn)("[&_pre]:px-4 [&_pre]:py-3"),language:"bash",value:P,className:"[&_code]:text-[12px] [&_code]:text-foreground","data-sentry-element":"CodeBlock","data-sentry-source-file":"ExportDialog.tsx"}),(0,a.jsx)(f.Z,{type:"note",className:"mt-2",title:"Filters are not supported when exporting as SQL via pg_dump",description:"If you'd like to export as SQL, we recommend creating a view first then exporting the data from there via pg_dump instead","data-sentry-element":"Admonition","data-sentry-source-file":"ExportDialog.tsx"})]})]}),(0,a.jsxs)("p",{className:"text-sm",children:["You will be prompted for your database password, and the output file"," ",(0,a.jsxs)("code",{children:[T,".",S]})," ","will be saved in the current directory that your terminal is in."]}),"sql"===S&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: ",(0,a.jsx)("code",{children:"pg_dump"})," needs to match your project's Postgres version. If you run into a server version mismatch error, you will need to update ",(0,a.jsx)("code",{children:"pg_dump"})," ","before running the command."]})]}),(0,a.jsx)(m.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"ExportDialog.tsx",children:(0,a.jsx)(g.$,{type:"default",onClick:()=>j(!1),"data-sentry-element":"Button","data-sentry-source-file":"ExportDialog.tsx",children:"Close"})})]})})}},74809:(e,t,n)=>{n.d(t,{Lh:()=>h,T_:()=>f});var a=n(51355),s=n(80210),r=n(26616),i=n.n(r),l=n(73969),o=n(32510),c=n(59356);function d(e){if(!e||"string"!=typeof e)return null;let t=e.trim().split(".");if(3!==t.length)return null;let n=parseInt(t[0],10),a=parseInt(t[1],10),s=parseInt(t[2],10);return isNaN(n)||isNaN(a)||isNaN(s)||n<0||a<0||s<0?null:{major:n,minor:a,patch:s}}function u(e,t){let n=function(e,t){let n=d(e),a=d(t);return n&&a?n.major!==a.major?n.major>a.major?1:-1:n.minor!==a.minor?n.minor>a.minor?1:-1:n.patch!==a.patch?n.patch>a.patch?1:-1:0:null}(e,t);return 1===n||0===n}var m=n(95341);let p="1.5.0",h="pgmq_public",x=i()("\n  drop function if exists \n    ".concat(h,".pop(queue_name text),\n    ").concat(h,".send(queue_name text, message jsonb, sleep_seconds integer),\n    ").concat(h,".send_batch(queue_name text, message jsonb[], sleep_seconds integer),\n    ").concat(h,".archive(queue_name text, message_id bigint),\n    ").concat(h,".delete(queue_name text, message_id bigint),\n    ").concat(h,".read(queue_name text, sleep integer, n integer)\n  ;\n\n  -- Revoke execute permissions on inner pgmq functions to roles (inverse of enabling)\n  do $$\n  begin\n      if exists (select 1 from pg_namespace where nspname = 'pgmq') then\n          -- Revoke privileges on the schema itself\n          revoke all on schema pgmq from anon, authenticated, service_role;\n          \n          -- Revoke default privileges for future objects\n          alter default privileges in schema pgmq revoke all on tables from anon, authenticated, service_role;\n          alter default privileges in schema pgmq revoke all on sequences from anon, authenticated, service_role;\n          alter default privileges in schema pgmq revoke all on functions from anon, authenticated, service_role;\n      end if;\n  end $$;\n\n  drop schema if exists ").concat(h,";\n"));async function g(e){let{projectRef:t,pgmqVersion:n,connectionString:a,enable:s}=e,r=s?(e=>{let t=u(e,p)?", conditional := '{}'::jsonb":"",n=u(e,p)?", jsonb":"";return i()("\n  create schema if not exists ".concat(h,";\n  grant usage on schema ").concat(h," to postgres, anon, authenticated, service_role;\n\n  create or replace function ").concat(h,".pop(\n      queue_name text\n  )\n    returns setof pgmq.message_record\n    language plpgsql\n    set search_path = ''\n  as $$\n  begin\n      return query\n      select *\n      from pgmq.pop(\n          queue_name := queue_name\n      );\n  end;\n  $$;\n\n  comment on function ").concat(h,".pop(queue_name text) is 'Retrieves and locks the next message from the specified queue.';\n\n\n  create or replace function ").concat(h,".send(\n      queue_name text,\n      message jsonb,\n      sleep_seconds integer default 0  -- renamed from 'delay'\n  )\n    returns setof bigint\n    language plpgsql\n    set search_path = ''\n  as $$\n  begin\n      return query\n      select *\n      from pgmq.send(\n          queue_name := queue_name,\n          msg := message,\n          delay := sleep_seconds\n      );\n  end;\n  $$;\n\n  comment on function ").concat(h,".send(queue_name text, message jsonb, sleep_seconds integer) is 'Sends a message to the specified queue, optionally delaying its availability by a number of seconds.';\n\n\n  create or replace function ").concat(h,".send_batch(\n      queue_name text,\n      messages jsonb[],\n      sleep_seconds integer default 0  -- renamed from 'delay'\n  )\n    returns setof bigint\n    language plpgsql\n    set search_path = ''\n  as $$\n  begin\n      return query\n      select *\n      from pgmq.send_batch(\n          queue_name := queue_name,\n          msgs := messages,\n          delay := sleep_seconds\n      );\n  end;\n  $$;\n\n  comment on function ").concat(h,".send_batch(queue_name text, messages jsonb[], sleep_seconds integer) is 'Sends a batch of messages to the specified queue, optionally delaying their availability by a number of seconds.';\n\n\n  create or replace function ").concat(h,".archive(\n      queue_name text,\n      message_id bigint\n  )\n    returns boolean\n    language plpgsql\n    set search_path = ''\n  as $$\n  begin\n      return\n      pgmq.archive(\n          queue_name := queue_name,\n          msg_id := message_id\n      );\n  end;\n  $$;\n\n  comment on function ").concat(h,".archive(queue_name text, message_id bigint) is 'Archives a message by moving it from the queue to a permanent archive.';\n\n\n  create or replace function ").concat(h,".delete(\n      queue_name text,\n      message_id bigint\n  )\n    returns boolean\n    language plpgsql\n    set search_path = ''\n  as $$\n  begin\n      return\n      pgmq.delete(\n          queue_name := queue_name,\n          msg_id := message_id\n      );\n  end;\n  $$;\n\n  comment on function ").concat(h,".delete(queue_name text, message_id bigint) is 'Permanently deletes a message from the specified queue.';\n\n  create or replace function ").concat(h,".read(\n      queue_name text,\n      sleep_seconds integer,\n      n integer\n  )\n    returns setof pgmq.message_record\n    language plpgsql\n    set search_path = ''\n  as $$\n  begin\n      return query\n      select *\n      from pgmq.read(\n          queue_name := queue_name,\n          vt := sleep_seconds,\n          qty := n ").concat(t,"\n      );\n  end;\n  $$;\n\n  comment on function ").concat(h,'.read(queue_name text, sleep_seconds integer, n integer) is \'Reads up to "n" messages from the specified queue with an optional "sleep_seconds" (visibility timeout).\';\n\n  -- Grant execute permissions on wrapper functions to roles\n  grant execute on function ').concat(h,".pop(text) to postgres, service_role, anon, authenticated;\n  grant execute on function pgmq.pop(text) to postgres, service_role, anon, authenticated;\n\n  grant execute on function ").concat(h,".send(text, jsonb, integer) to postgres, service_role, anon, authenticated;\n  grant execute on function pgmq.send(text, jsonb, integer) to postgres, service_role, anon, authenticated;\n\n  grant execute on function ").concat(h,".send_batch(text, jsonb[], integer) to postgres, service_role, anon, authenticated;\n  grant execute on function pgmq.send_batch(text, jsonb[], integer) to postgres, service_role, anon, authenticated;\n\n  grant execute on function ").concat(h,".archive(text, bigint) to postgres, service_role, anon, authenticated;\n  grant execute on function pgmq.archive(text, bigint) to postgres, service_role, anon, authenticated;\n\n  grant execute on function ").concat(h,".delete(text, bigint) to postgres, service_role, anon, authenticated;\n  grant execute on function pgmq.delete(text, bigint) to postgres, service_role, anon, authenticated;\n\n  grant execute on function ").concat(h,".read(text, integer, integer) to postgres, service_role, anon, authenticated;\n  grant execute on function pgmq.read(text, integer, integer ").concat(n,") to postgres, service_role, anon, authenticated;\n\n  -- For the service role, we want full access\n  -- Grant permissions on existing tables\n  grant all privileges on all tables in schema pgmq to postgres, service_role;\n\n  -- Ensure service_role has permissions on future tables\n  alter default privileges in schema pgmq grant all privileges on tables to postgres, service_role;\n\n  grant usage on schema pgmq to postgres, anon, authenticated, service_role;\n\n\n  /*\n    Grant access to sequences to API roles by default. Existing table permissions\n    continue to enforce insert restrictions. This is necessary to accommodate the\n    on-backup hook that rebuild queue table primary keys to avoid a pg_dump segfault.\n    This can be removed once logical backups are completely retired.\n  */\n  grant usage, select, update\n  on all sequences in schema pgmq\n  to anon, authenticated, service_role;\n\n  alter default privileges in schema pgmq\n  grant usage, select, update\n  on sequences\n  to anon, authenticated, service_role;\n"))})(n):x,{result:l}=await (0,c.E)({projectRef:t,connectionString:a,sql:r,queryKey:["toggle-queues-exposure"]});return l}let f=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,a.jE)();return(0,s.n)({mutationFn:e=>g(e),async onSuccess(t,n,a){let{projectRef:s}=n;await r.invalidateQueries({queryKey:m.m.exposePostgrestStatus(s)}),r.invalidateQueries({queryKey:o.c.schemas(s)}),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.oR.error("Failed to toggle queue exposure via PostgREST: ".concat(e.message)):t(e,n,a)},...n})}},76857:(e,t,n)=>{n.d(t,{G_:()=>l});var a=n(67850),s=n(59356),r=n(32510);async function i(e,t){let{projectRef:n,connectionString:a,id:r}=e,i=(e=>{let{id:t}=e;if(!t)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(t,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()})({id:r}),{result:l}=await (0,s.E)({projectRef:n,connectionString:a,sql:i,queryKey:["view-definition",r]},t);return l[0].definition.trim()}let l=function(e){let{projectRef:t,connectionString:n,id:s}=e,{enabled:l=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.c.viewDefinition(t,s),queryFn:e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n,id:s},a)},enabled:l&&void 0!==t&&void 0!==s&&!isNaN(s),...o})}},80230:(e,t,n)=>{n.d(t,{X:()=>ep});var a=n(80263),s=n(72112),r=n(90376),i=n(75590),l=n(53239),o=n(22891),c=n(14585),d=n(74067),u=n(89388),m=n(35693),p=n(35648),h=n(44168),x=n(23729),g=n(44412),f=n(84438),y=n(11018),b=n(68011),v=n(57648),j=n(80090),w=n(28202),_=n(57384),S=n(9620),N=n(63335),E=n(71344),R=n(61548),A=n(99779),k=n(48156),I=n(883),C=n(77308),q=n(37014),L=n(39899),T=n.n(L),D=n(77444),z=n(9753),M=n(3225),P=n(11743),F=n(29948),O=n(33922),$=n(52555),V=n.n($),H=n(77191),B=n.n(H),W=n(73969),Q=n(99894),G=n(80633),U=n(95470),K=n(10723),Y=n(6894),J=n(6542),X=n(71875),Z=n(52641),ee=n(75204),et=n(48303),en=n(45550),ea=n(80100),es=n(91786),er=n(30404),ei=n(21162),el=n(38904),eo=n(21650);let ec=e=>{let{entity:t,tableHasLints:n,viewHasLints:s,materializedViewHasLints:r,foreignTableHasLints:i}=e,{ref:l}=(0,o.g)(),c=null,d="Data is publicly accessible via API",u=(0,a.jsx)(K.g,{href:"/project/".concat(l,"/editor/").concat(t.id,"?schema=").concat(t.schema,"&showWarning=true"),children:"Learn more"});switch(t.type){case y.z.TABLE:n&&(c=(0,a.jsxs)(a.Fragment,{children:[d," as RLS is disabled. ",u,"."]}));break;case y.z.VIEW:s&&(c=(0,a.jsxs)(a.Fragment,{children:[d," as this is a Security definer view. ",u,"."]}));break;case y.z.MATERIALIZED_VIEW:r&&(c=(0,a.jsxs)(a.Fragment,{children:[d," as this is a Security definer view ",u,"."]}));break;case y.z.FOREIGN_TABLE:i&&(c=(0,a.jsxs)(a.Fragment,{children:[d," as RLS is not enforced on foreign tables. ",u,"."]}))}return c?(0,a.jsxs)(er.m_,{children:[(0,a.jsx)(er.k$,{className:"min-w-4",children:(0,a.jsx)(eo.E,{variant:"destructive",children:"Unrestricted"})}),(0,a.jsx)(er.ZI,{side:"right",className:"max-w-52 text-center",children:c})]}):null},ed=e=>{let{id:t,projectRef:n,item:s,isLocked:r,isActive:i,style:l,onExportCLI:c}=e,{data:d}=(0,S.YA)(),m=(0,E.ap)(),{selectedSchema:p}=(0,_.k)(),h=(0,en.lW)(s.type,{id:s.id}),x=(0,en.zv)(),g=x.previewTabId===h,f=Object.values(x.tabsMap).some(e=>{var t;return(null==(t=e.metadata)?void 0:t.tableId)===s.id}),b=Number(t)===s.id,j=b&&!r,{data:w=[]}=(0,J.b)({projectRef:null==d?void 0:d.ref}),N=(0,G.t)(s.name,"rls_disabled_in_public",["ERROR"],w,p).hasLint,R=(0,G.t)(s.name,"security_definer_view",["ERROR","WARN"],w,p).hasLint,k=(0,G.t)(s.name,"materialized_view_in_api",["ERROR","WARN"],w,p).hasLint,I=(0,G.t)(s.name,"foreign_table_in_api",["ERROR","WARN"],w,p).hasLint,C=async()=>{if(o.pe&&!(null==d?void 0:d.connectionString))return console.error("Connection string is required");let e=W.oR.loading("Exporting ".concat(s.name," as CSV..."));try{let t=await (0,v.Ap)({id:s.id,projectRef:n,connectionString:null==d?void 0:d.connectionString});if((0,Z.KO)(t)&&t.live_rows_estimate>Q.Jv)return W.oR.error((0,a.jsx)("div",{className:"text-foreground prose text-sm",children:Q.RH}),{id:e});let r=t&&(0,u.rH)(t);if(!r)return W.oR.error("Failed to export table: ".concat(s.name),{id:e});let i=(await (0,ee.HQ)({projectRef:n,connectionString:null==d?void 0:d.connectionString,table:r})).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));if(i.length>0){let e=B().unparse(i,{columns:r.columns.map(e=>e.name)}),t=new Blob([e],{type:"text/csv;charset=utf-8;"});T()(t,"".concat(s.name,"_rows.csv"))}W.oR.success("Successfully exported ".concat(s.name," as CSV"),{id:e})}catch(t){W.oR.error("Failed to export table: ".concat(t.message),{id:e})}},q=async()=>{if(o.pe&&!(null==d?void 0:d.connectionString))return console.error("Connection string is required");let e=W.oR.loading("Exporting ".concat(s.name," as SQL..."));try{let t=await (0,v.Ap)({id:s.id,projectRef:n,connectionString:null==d?void 0:d.connectionString});if((0,Z.KO)(t)&&t.live_rows_estimate>Q.Jv)return W.oR.error((0,a.jsx)("div",{className:"text-foreground prose text-sm",children:Q.RH}),{id:e});let r=t&&(0,u.rH)(t);if(!r)return W.oR.error("Failed to export table: ".concat(s.name),{id:e});let i=(await (0,ee.HQ)({projectRef:n,connectionString:null==d?void 0:d.connectionString,table:r})).map(e=>{let t={...e};return Object.keys(e).forEach(n=>{"object"==typeof e[n]&&null!==e[n]&&(t[n]=JSON.stringify(e[n]))}),t});if(i.length>0){let e=(0,G.S)(r,i),t=new Blob([e],{type:"text/sql;charset=utf-8;"});T()(t,"".concat(s.name,"_rows.sql"))}W.oR.success("Successfully exported ".concat(s.name," as SQL"),{id:e})}catch(t){W.oR.error("Failed to export table: ".concat(t.message),{id:e})}};return(0,a.jsx)(X.tv,{title:s.name,style:l,id:String(s.id),href:"/project/".concat(n,"/editor/").concat(s.id,"?schema=").concat(s.schema,"&").concat(u.bV,"=true"),role:"button","aria-label":"View ".concat(s.name),className:(0,ea.cn)((0,es.u2)({isSelected:b&&!g,isOpened:f&&!g,isPreview:g}),"pl-4 pr-1"),onDoubleClick:e=>{e.preventDefault();let t=(0,en.lW)(s.type,{id:s.id});x.makeTabPermanent(t)},"data-sentry-element":"EditorTablePageLink","data-sentry-component":"EntityListItem","data-sentry-source-file":"EntityListItem.tsx",children:(0,a.jsxs)(a.Fragment,{children:[b&&(0,a.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),(0,a.jsxs)(er.m_,{disableHoverableContent:!0,"data-sentry-element":"Tooltip","data-sentry-source-file":"EntityListItem.tsx",children:[(0,a.jsx)(er.k$,{className:"min-w-4","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"EntityListItem.tsx",children:(0,a.jsx)(U.L,{type:s.type,isActive:b,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"EntityListItem.tsx"})}),(0,a.jsx)(er.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"EntityListItem.tsx",children:(e=>{var t,n,a,s;let r=(null==(s=Object.entries(y.z).find(t=>{let[,n]=t;return n===e}))||null==(a=s[0])||null==(n=a.toLowerCase())||null==(t=n.split("_"))?void 0:t.join(" "))||"";return r.charAt(0).toUpperCase()+r.slice(1)})(s.type)})]}),(0,a.jsxs)("div",{className:(0,ea.cn)("truncate overflow-hidden text-ellipsis whitespace-nowrap flex items-center gap-2 relative w-full",b&&"text-foreground"),children:[(0,a.jsx)("span",{className:(0,ea.cn)(b?"text-foreground":"text-foreground-light group-hover:text-foreground","text-sm transition truncate"),children:s.name}),(0,a.jsx)("div",{children:(0,a.jsx)(ec,{entity:s,tableHasLints:N,viewHasLints:R,materializedViewHasLints:k,foreignTableHasLints:I,"data-sentry-element":"EntityTooltipTrigger","data-sentry-source-file":"EntityListItem.tsx"})})]}),j&&(0,a.jsxs)(ei.rI,{children:[(0,a.jsx)(ei.ty,{asChild:!0,className:"text-foreground-lighter transition-all text-transparent group-hover:text-foreground data-[state=open]:text-foreground",children:(0,a.jsx)(A.$,{type:"text",className:"w-6 h-6",icon:(0,a.jsx)(D.A,{size:14,strokeWidth:2}),onClick:e=>e.preventDefault()})}),(0,a.jsxs)(ei.SQ,{side:"bottom",align:"start",className:"w-44",children:[(0,a.jsxs)(ei._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),(0,el.l)(s.name)},children:[(0,a.jsx)(z.A,{size:12}),(0,a.jsx)("span",{children:"Copy name"})]},"copy-name"),function(e){return(null==e?void 0:e.type)===y.z.TABLE||(null==e?void 0:e.type)===y.z.PARTITIONED_TABLE}(s)&&(0,a.jsxs)(ei._2,{className:"space-x-2",onClick:async e=>{e.stopPropagation();let t=W.oR.loading("Getting table schema..."),n=await (0,Y.I)({id:s.id,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString});if(!n)return W.oR.error("Failed to get table schema",{id:t});try{let e=(0,et.A)(n);await (0,el.l)(e),W.oR.success("Table schema copied to clipboard",{id:t})}catch(e){W.oR.error("Failed to copy schema: "+(e.message||e),{id:t})}},children:[(0,a.jsx)(z.A,{size:12}),(0,a.jsx)("span",{children:"Copy table schema"})]},"copy-schema"),s.type===y.z.TABLE&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ei.mB,{}),(0,a.jsxs)(ei._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),m.onEditTable()},children:[(0,a.jsx)(M.A,{size:12}),(0,a.jsx)("span",{children:"Edit table"})]},"edit-table"),(0,a.jsxs)(ei._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),m.onDuplicateTable()},children:[(0,a.jsx)(z.A,{size:12}),(0,a.jsx)("span",{children:"Duplicate table"})]},"duplicate-table"),(0,a.jsx)(ei._2,{className:"space-x-2",asChild:!0,children:(0,a.jsxs)(V(),{href:"/project/".concat(n,"/auth/policies?schema=").concat(p,"&search=").concat(s.id),children:[(0,a.jsx)(P.A,{size:12}),(0,a.jsx)("span",{children:"View policies"})]},"view-policies")},"view-policies"),(0,a.jsxs)(ei.lv,{children:[(0,a.jsxs)(ei.nV,{className:"gap-x-2",children:[(0,a.jsx)(F.A,{size:12}),"Export data"]}),(0,a.jsxs)(ei.M5,{children:[(0,a.jsx)(ei._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),C()},children:(0,a.jsx)("span",{children:"Export table as CSV"})},"download-table-csv"),(0,a.jsx)(ei._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),q()},children:(0,a.jsx)("span",{children:"Export table as SQL"})},"download-table-sql"),(0,a.jsx)(ei._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),c()},children:(0,a.jsx)("span",{children:"Export table via CLI"})},"download-table-cli")]})]}),(0,a.jsx)(ei.mB,{}),(0,a.jsxs)(ei._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),m.onDeleteTable()},children:[(0,a.jsx)(O.A,{size:12}),(0,a.jsx)("span",{children:"Delete table"})]},"delete-table")]})]})]})]})})};var eu=n(31421);let em=()=>(0,a.jsx)(C.Q5,{title:"No tables or views",description:"Any tables or views you create will be listed here.",className:"mx-4","data-sentry-element":"InnerSideBarEmptyPanel","data-sentry-component":"TableMenuEmptyState","data-sentry-source-file":"TableMenuEmptyState.tsx",children:(0,a.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,a.jsxs)("div",{className:"relative h-content",children:[(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,a.jsx)("div",{className:"absolute left-[150px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,a.jsx)(eu.A,{size:16,className:"text-foreground-light",strokeWidth:1.5,"data-sentry-element":"Pointer","data-sentry-source-file":"TableMenuEmptyState.tsx"})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"border-l pointer-events-none",children:(0,a.jsxs)("div",{className:(0,ea.cn)("group",(0,es.u2)({isSelected:2===t,isOpened:2===t,isPreview:!1}),"px-4 min-w-40"),"aria-selected":2===t,children:[2===t&&(0,a.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),(0,a.jsx)(U.L,{type:"r"}),"postgres_table_".concat(t)]})},"some-".concat(t)))]})})}),ep=()=>{var e,t,n;let{id:L,ref:T}=(0,o.g)(),D=L?Number(L):void 0,z=(0,E.ap)(),{selectedSchema:M,setSelectedSchema:P}=(0,_.k)(),F=(0,c.d)(),[O,$]=(0,l.useState)(""),[V,H]=(0,l.useState)(),[B,W]=(0,l.useState)(Object.values(y.z)),[Q,G]=(0,w.M)("table-editor-sort","alphabetical"),{data:U}=(0,S.YA)(),{data:K,isLoading:Y,isSuccess:J,isError:X,error:Z,hasNextPage:ee,isFetchingNextPage:et,fetchNextPage:en}=(0,b.kD)({projectRef:null==U?void 0:U.ref,connectionString:null==U?void 0:U.connectionString,schemas:[M],search:O.trim()||void 0,sort:Q,filterTypes:B},{keepPreviousData:!!O}),ea=(0,l.useMemo)(()=>null==K?void 0:K.pages.flatMap(e=>e.data.entities),[null==K?void 0:K.pages]),{can:es}=(0,j.Qp)(s.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{isSchemaLocked:er}=(0,N.BQ)({schema:M}),{data:ei}=(0,v.Pk)({projectRef:null==U?void 0:U.ref,connectionString:null==U?void 0:U.connectionString,id:D});(null==ei?void 0:ei.schema)&&!M&&P(ei.schema);let el=(0,q.B)(),eo=(0,l.useCallback)(async e=>{let t=await (0,v.Ap)({id:e,projectRef:T,connectionString:null==U?void 0:U.connectionString});H(t&&(0,u.rH)(t))},[null==U?void 0:U.connectionString,T]),ec=(0,l.useCallback)(e=>{let t=null==ea?void 0:ea[e];return(null==t?void 0:t.id)?String(t.id):"table-editor-entity-".concat(e)},[ea]),eu=(0,l.useMemo)(()=>({projectRef:null==U?void 0:U.ref,id:Number(D),isLocked:er,onExportCLI:()=>eo(Number(D))}),[null==U?void 0:U.ref,D,er,eo]);return(0,l.useEffect)(()=>{ea&&!O&&el({schemas:[M],entities:ea})},[ea,O,M,el]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col flex-grow gap-5 pt-5 h-full",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1.5",children:[(0,a.jsx)(f.A,{className:"mx-4",selectedSchemaName:M,onSelectSchema:e=>{$(""),P(e)},onSelectCreateSchema:()=>z.onAddSchema(),portal:!F,"data-sentry-element":"SchemaSelector","data-sentry-source-file":"TableEditorMenu.tsx"}),(0,a.jsx)("div",{className:"grid gap-3 mx-4",children:er?(0,a.jsx)(m.i,{size:"sm",schema:M,entity:"table"}):(0,a.jsx)(x.G,{block:!0,title:"Create a new table",name:"New table",disabled:!es,size:"tiny",icon:(0,a.jsx)(r.A,{size:14,strokeWidth:1.5,className:"text-foreground-muted"}),type:"default",className:"justify-start",onClick:()=>z.onAddTable(),tooltip:{content:{side:"bottom",text:es?void 0:"You need additional permissions to create tables"}},children:"New table"})})]}),(0,a.jsxs)("div",{className:"grow min-h-0 flex flex-col gap-2 pb-4",children:[(0,a.jsxs)(C.a0,{className:"mx-2","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,a.jsx)(C.RK,{autoFocus:!F,name:"search-tables",value:O,placeholder:"Search tables...","aria-labelledby":"Search tables",onChange:e=>$(e.target.value),"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,a.jsxs)(C.i9,{value:Q,onValueChange:e=>G(e),"data-sentry-element":"InnerSideBarFilterSortDropdown","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,a.jsx)(C.Pl,{value:"alphabetical",className:"flex gap-2","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"TableEditorMenu.tsx",children:"Alphabetical"},"alphabetical"),(0,a.jsx)(C.Pl,{value:"grouped-alphabetical","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"TableEditorMenu.tsx",children:"Entity Type"},"grouped-alphabetical")]})}),(0,a.jsxs)(R.AM,{"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,a.jsx)(R.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,a.jsx)(A.$,{type:5!==B.length?"default":"dashed",className:"h-[32px] md:h-[28px] px-1.5",icon:(0,a.jsx)(i.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"TableEditorMenu.tsx"})}),(0,a.jsx)(R.hl,{className:"p-0 w-56",side:"bottom",align:"center","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,a.jsxs)("div",{className:"px-3 pt-3 pb-2 flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-xs",children:"Show entity types"}),(0,a.jsx)("div",{className:"flex flex-col",children:Object.entries(y.z).map(e=>{let[t,n]=e;return(0,a.jsxs)("div",{className:"group flex items-center justify-between py-0.5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(k.S,{id:t,name:t,checked:B.includes(n),onCheckedChange:()=>{B.includes(n)?W(B.filter(e=>e!==n)):W(B.concat([n]))}}),(0,a.jsx)(I.J,{htmlFor:t,className:"capitalize text-xs",children:t.toLowerCase().replace("_"," ")})]}),(0,a.jsx)(A.$,{size:"tiny",type:"default",onClick:()=>W([n]),className:"transition opacity-0 group-hover:opacity-100 h-auto px-1 py-0.5",children:"Select only"})]},t)})})]})})]})]}),Y&&(0,a.jsx)(p.A,{}),X&&(0,a.jsx)("div",{className:"mx-4",children:(0,a.jsx)(h.A,{error:null!=Z?Z:null,subject:"Failed to retrieve tables"})}),J&&(0,a.jsxs)(a.Fragment,{children:[0===O.length&&(null!=(e=null==ea?void 0:ea.length)?e:0)<=0&&(0,a.jsx)(em,{}),O.length>0&&(null!=(t=null==ea?void 0:ea.length)?t:0)<=0&&(0,a.jsx)(C.Q5,{className:"mx-2",title:"No results found",description:'Your search for "'.concat(O,'" did not return any results')}),(null!=(n=null==ea?void 0:ea.length)?n:0)>0&&(0,a.jsx)("div",{className:"flex flex-1 min-h-0 w-full","data-testid":"tables-list",children:(0,a.jsx)(g.iH,{className:"h-full w-full",items:ea,ItemComponent:ed,LoaderComponent:g.P5,itemProps:eu,getItemKey:ec,getItemSize:e=>0!==e&&e===ea.length?85:28,hasNextPage:ee,isLoadingNextPage:et,onLoadNextPage:en})})]})]})]}),(0,a.jsx)(d.V,{ignoreRoleImpersonation:!0,table:V,open:!!V,onOpenChange:e=>{e||H(void 0)},"data-sentry-element":"ExportDialog","data-sentry-source-file":"TableEditorMenu.tsx"})]})}},80633:(e,t,n)=>{n.d(t,{S:()=>s,t:()=>a});let a=(e,t,n,a,s)=>{let r=(null==a?void 0:a.find(a=>{var r,i;return(null==a||null==(r=a.metadata)?void 0:r.name)===e&&(null==a||null==(i=a.metadata)?void 0:i.schema)===s&&(null==a?void 0:a.name)===t&&n.includes(null==a?void 0:a.level)}))||null;return{hasLint:null!==r,count:+!!r,matchingLint:r}},s=(e,t)=>{if(0===t.length)return"";let n=e.columns.map(e=>'"'.concat(e.name,'"')).join(", "),a=t.map(t=>{let n={...t};"idx"in n&&delete n.idx;let a=Object.entries(n).map(t=>{var n;let[a,s]=t,{dataType:r,format:i}=null!=(n=e.columns.find(e=>e.name===a))?n:{};return null===s?"null":"ARRAY"===r?"'".concat(JSON.stringify(s).replace("[","{").replace(/.$/,"}"),"'"):(null==i?void 0:i.includes("json"))?"".concat(JSON.stringify(s).replace(/\\"/g,'"').replace(/'/g,"''").replace('"',"'").replace(/.$/,"'")):"string"==typeof i&&"string"==typeof s&&["text","varchar"].includes(i)?"'".concat(s.replaceAll("'","''"),"'"):"'".concat(s,"'")});return"(".concat(a.join(", "),")")}).join(", ");return'INSERT INTO "'.concat(e.schema,'"."').concat(e.name,'" (').concat(n,") VALUES ").concat(a,";")}},80646:(e,t,n)=>{n.d(t,{gt:()=>x});var a=n(76984),s=n(57672),r=n(51355),i=n(67850),l=n(89388),o=n(57648),c=n(99842),d=n(13693),u=n(59356),m=n(6843),p=n(90188);async function h(e,t){var n,r,i;let{queryClient:m,projectRef:h,connectionString:x,tableId:g,filters:f,roleImpersonationState:y,enforceExactCount:b}=e,v=await (0,o.Nj)(m,{projectRef:h,connectionString:x,id:g});if(!v)throw Error("Table not found");let j=(0,l.rH)(v),w=(0,c.Nf)((e=>{var t,n,r;let{table:i,filters:l=[],enforceExactCount:o=!1}=e;if(!i)return"";if(o){let e=new a.Query().from(i.name,null!=(t=i.schema)?t:void 0).count();return l.filter(e=>e.value&&""!==e.value).forEach(t=>{let n=(0,p.b)(i,t);e=e.filter(t.column,t.operator,n)}),"select (".concat(e.toSql().slice(0,-1),"), false as is_estimate;")}{let e=new a.Query().from(i.name,null!=(n=i.schema)?n:void 0).select("*");l.filter(e=>e.value&&""!=e.value).forEach(t=>{let n=(0,p.b)(i,t);e=e.filter(t.column,t.operator,n)});let t=e.toSql(),o=new a.Query().from(i.name,null!=(r=i.schema)?r:void 0).count();l.filter(e=>e.value&&""!=e.value).forEach(e=>{let t=(0,p.b)(i,e);o=o.filter(e.column,e.operator,t)});let c=o.toSql().slice(0,-1);return"\n".concat(s.I,"\n\nwith approximation as (\n    select reltuples as estimate\n    from pg_class\n    where oid = ").concat(i.id,"\n)\nselect \n  case \n    when estimate = -1 then (select pg_temp.count_estimate('").concat(t.replaceAll("'","''"),"'))\n    when estimate > ").concat(s.k," then ").concat(l.length>0?"pg_temp.count_estimate('".concat(t.replaceAll("'","''"),"')"):"estimate","\n    else (").concat(c,")\n  end as count,\n  estimate = -1 or estimate > ").concat(s.k," as is_estimate\nfrom approximation;\n").trim()}})({table:j,filters:f,enforceExactCount:b}),y),{result:_}=await (0,u.E)({projectRef:h,connectionString:x,sql:w,queryKey:["table-rows-count",j.id],isRoleImpersonationEnabled:(0,d._c)(null==y?void 0:y.role)},t);return{count:null==_||null==(n=_[0])?void 0:n.count,is_estimate:null!=(i=null==_||null==(r=_[0])?void 0:r.is_estimate)&&i}}let x=function(e){let{projectRef:t,connectionString:n,tableId:a,...s}=e,{enabled:l=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,r.jE)();return(0,i.I)({queryKey:m.j.tableRowsCount(t,{table:{id:a},...s}),queryFn:e=>{let{signal:r}=e;return h({queryClient:c,projectRef:t,connectionString:n,tableId:a,...s},r)},enabled:l&&void 0!==t&&void 0!==a,...o})}},84438:(e,t,n)=>{n.d(t,{A:()=>y});var a=n(80263),s=n(72112),r=n(32157),i=n(23892),l=n(90376),o=n(53239),c=n(32775),d=n(80090),u=n(9620),m=n(99779),p=n(73640),h=n(20033),x=n(61548),g=n(29244),f=n(97757);let y=e=>{let{className:t,disabled:n=!1,size:y="tiny",showError:b=!0,selectedSchemaName:v,supportSelectAll:j=!1,excludedSchemas:w=[],onSelectSchema:_,onSelectCreateSchema:S,portal:N=!0,align:E="start"}=e,[R,A]=(0,o.useState)(!1),{can:k}=(0,d.Qp)(s.aG.TENANT_SQL_ADMIN_WRITE,"schemas"),{data:I}=(0,u.YA)(),{data:C,isLoading:q,isSuccess:L,isError:T,error:D,refetch:z}=(0,c.w$)({projectRef:null==I?void 0:I.ref,connectionString:null==I?void 0:I.connectionString}),M=(C||[]).filter(e=>!w.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[q&&(0,a.jsx)(m.$,{type:"default",className:"w-full [&>span]:w-full",size:y,disabled:!0,children:(0,a.jsx)(p.E,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),b&&T&&(0,a.jsxs)(h.Fc,{variant:"warning",className:"!px-3 !py-3",children:[(0,a.jsx)(h.XL,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,a.jsxs)(h.TN,{className:"text-xs mb-2 break-words",children:["Error: ",null==D?void 0:D.message]}),(0,a.jsx)(m.$,{type:"default",size:"tiny",onClick:()=>z(),children:"Reload schemas"})]}),L&&(0,a.jsxs)(x.AM,{open:R,onOpenChange:A,modal:!1,children:[(0,a.jsx)(x.Wv,{asChild:!0,children:(0,a.jsx)(m.$,{size:y,disabled:n,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,a.jsx)(r.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:v?(0,a.jsxs)("div",{className:"w-full flex gap-1",children:[(0,a.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,a.jsx)("p",{className:"text-foreground",children:"*"===v?"All schemas":v})]}):(0,a.jsx)("div",{className:"w-full flex gap-1",children:(0,a.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema..."})})})}),(0,a.jsx)(x.hl,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:E,portal:N,sameWidthAsTrigger:!0,children:(0,a.jsxs)(g.uB,{children:[(0,a.jsx)(g.G7,{placeholder:"Find schema..."}),(0,a.jsxs)(g.oI,{children:[(0,a.jsx)(g.xL,{children:"No schemas found"}),(0,a.jsx)(g.L$,{children:(0,a.jsxs)(f.FK,{className:(M||[]).length>7?"h-[210px]":"",children:[j&&(0,a.jsxs)(g.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{_("*"),A(!1)},onClick:()=>{_("*"),A(!1)},children:[(0,a.jsx)("span",{children:"All schemas"}),"*"===v&&(0,a.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==M?void 0:M.map(e=>(0,a.jsxs)(g.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{_(e.name),A(!1)},onClick:()=>{_(e.name),A(!1)},children:[(0,a.jsx)("span",{children:e.name}),v===e.name&&(0,a.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==S&&k&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.fx,{}),(0,a.jsx)(g.L$,{children:(0,a.jsxs)(g.h_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{S(),A(!1)},onClick:()=>{S(),A(!1)},children:[(0,a.jsx)(l.A,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},88301:(e,t,n)=>{n.d(t,{m:()=>d});var a=n(80263),s=n(69372),r=n(22891),i=n(36261),l=n(84512),o=n(39148),c=n(23729);let d=e=>{let{section:t,source:n}=e,d=(0,o.qM)(),{ref:u}=(0,r.g)(),{data:m}=(0,l.s)(),{mutate:p}=(0,i.h)();return(0,a.jsx)(c.G,{size:"tiny",type:"default",onClick:()=>{var e;t&&d.setActiveDocsSection(t),d.setShowProjectApiDocs(!0),p({action:"api_docs_opened",properties:{source:n},groups:{project:null!=u?u:"Unknown",organization:null!=(e=null==m?void 0:m.slug)?e:"Unknown"}})},icon:(0,a.jsx)(s.A,{}),className:"h-7 w-7",tooltip:{content:{side:"bottom",text:"API Docs"}},"data-sentry-element":"ButtonTooltip","data-sentry-component":"APIDocsButton","data-sentry-source-file":"APIDocsButton.tsx"})}},95341:(e,t,n)=>{n.d(t,{m:()=>a});let a={create:()=>["queues","create"],delete:e=>["queues",e,"delete"],purge:e=>["queues",e,"purge"],getMessagesInfinite:(e,t,n)=>["projects",e,"queue-messages",t,n].filter(Boolean),list:e=>["projects",e,"queues"],metrics:(e,t)=>["projects",e,"queue-metrics",t],exposePostgrestStatus:e=>["projects",e,"queue-expose-status"]}},99894:(e,t,n)=>{n.d(t,{Y9:()=>eN,Jv:()=>e_,RH:()=>eS});var a=n(80263),s=n(72112),r=n(39899),i=n.n(r),l=n(76174),o=n(2534),c=n(54941),d=n(33922),u=n(52555),m=n.n(u),p=n(53239),h=n(73969),x=n(22891),g=n(41591),f=n(53005),y=n(25975),b=n(11743),v=n(44096),j=n(41258),w=n(24558),_=n(80633),S=n(88301),N=n(23729),E=n(62550),R=n(34230),A=n(15553),k=n(42130),I=n(6542),C=n(52641),q=n(93424),L=n(80090),T=n(2657),D=n(60468),z=n(9620),M=n(63335),P=n(85039),F=n(51982),O=n(23850),$=n(10247),V=n(30404),H=n(99779),B=n(80100),W=n(61548),Q=n(59403),G=n(68421),U=n(39327),K=n(51355),Y=n(76857),J=n(89790),X=n(85663),Z=n(97757),ee=n(53626),et=n(16488);function en(e){let{table:t,isAutofixViewSecurityModalOpen:n,setIsAutofixViewSecurityModalOpen:s}=e,{data:r}=(0,z.YA)(),i=(0,K.jE)(),{isSuccess:l,isLoading:o,data:c}=(0,Y.G_)({id:null==t?void 0:t.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{enabled:n&&(0,C.b4)(t)}),{mutate:d}=(0,X.Y)({onSuccess:async()=>{h.oR.success("View security changed successfully"),s(!1),await i.invalidateQueries({queryKey:J.O.lint(null==r?void 0:r.ref)})},onError:e=>{h.oR.error("Failed to autofix view security: ".concat(e.message))}});return(0,C.b4)(t)?(0,a.jsxs)(G.A,{visible:n,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>s(!1),onConfirm:()=>(function(){let e='\n	ALTER VIEW "'.concat(t.schema,'"."').concat(t.name,'" SET (security_invoker = on);\n	');d({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:e})})(),"data-sentry-element":"ConfirmationModal","data-sentry-component":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,a.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,a.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,a.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,a.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,a.jsxs)(Z.FK,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[o&&(0,a.jsx)(et.yV,{}),l&&(0,a.jsx)(ee.X,{children:"create view ".concat(t.schema,".").concat(t.name," as\n ").concat(c)})]})]}),(0,a.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,a.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,a.jsxs)(Z.FK,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[o&&(0,a.jsx)(et.yV,{}),l&&(0,a.jsx)(ee.X,{children:"create view ".concat(t.schema,".").concat(t.name," with (security_invoker = on) as\n ").concat(c)})]})]})]})]}):null}let ea=e=>{var t;let{table:n,isRefetching:r}=e,{ref:i}=(0,x.g)(),{data:l}=(0,z.YA)(),o=(0,F.n)(),[c,d]=(0,O.ZA)("showWarning",O.cr.withDefault(!1)),{data:u=[]}=(0,I.b)({projectRef:null==l?void 0:l.ref}),g=(0,C.KO)(n),f=(0,C.bL)(n),K=(0,C.eg)(n),Y=(0,C.rW)(n),{realtimeAll:J}=(0,T.x)(["realtime:all"]),{isSchemaLocked:X}=(0,M.BQ)({schema:n.schema}),{mutate:Z}=(0,q.e)({onError:e=>{h.oR.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{eI()}}),[ee,et]=(0,p.useState)(!1),[ea,es]=(0,p.useState)(!1),[er,ei]=(0,p.useState)(!1),el=0===(0,$.Ir)().selectedRows.size,eo=null==l?void 0:l.ref,{data:ec}=(0,E.j)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),ed=(null!=ec?ec:[]).filter(e=>e.schema===n.schema&&e.table===n.name),{data:eu}=(0,R._)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),em=(null!=eu?eu:[]).find(e=>"supabase_realtime"===e.name),ep=null!=(t=null==em?void 0:em.tables)?t:[],eh=ep.some(e=>e.id===(null==n?void 0:n.id)),{activeVariant:ex}=(0,D.gI)({projectInsertedAt:null==l?void 0:l.inserted_at,isTable:g,isRealtimeEnabled:eh}),{mutate:eg,isPending:ef}=(0,A.H)({onSuccess:()=>{et(!1),o(eh?"table_realtime_disabled":"table_realtime_enabled",{method:"ui",schema_name:n.schema,table_name:n.name})},onError:e=>{h.oR.error("Failed to toggle realtime for ".concat(n.name,": ").concat(e.message))}}),{data:ey}=(0,k.oR)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{enabled:g}),eb=(null!=ey?ey:[]).filter(e=>e.schema===n.schema&&e.table===n.name).length,{can:ev,isLoading:ej}=(0,L.Qp)(s.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{can:ew}=(0,L.Qp)(s.aG.TENANT_SQL_ADMIN_WRITE,"columns"),e_="public"===n.schema,{hasLint:eS,matchingLint:eN}=(0,_.t)(n.name,"security_definer_view",["ERROR","WARN"],u,n.schema),{hasLint:eE,matchingLint:eR}=(0,_.t)(n.name,"materialized_view_in_api",["ERROR","WARN"],u,n.schema),eA="/project/".concat(i,"/database/triggers?schema=").concat(n.schema),ek=async()=>{if(!l||!em)return;let e=ep.some(e=>e.id===n.id),t=e?ep.filter(e=>e.id!==n.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(n.schema,".").concat(n.name)].concat(ep.map(e=>"".concat(e.schema,".").concat(e.name)));o("realtime_toggle_table_clicked",{newState:e?"disabled":"enabled",origin:"tableGridHeader"}),eg({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:em.id,tables:t})},eI=()=>{es(!1)},eC=async()=>{let e={id:n.id,rls_enabled:!(g&&n.rls_enabled)};Z({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:n.id,name:n.name,schema:n.schema,payload:e}),o("table_rls_enabled",{method:"table_editor",schema_name:n.schema,table_name:n.name})};return(0,a.jsxs)("div",{className:"sb-grid-header__inner","data-sentry-component":"GridHeaderActions","data-sentry-source-file":"GridHeaderActions.tsx",children:[el&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[!ej&&!ev&&!ew&&(0,a.jsxs)(V.m_,{children:[(0,a.jsx)(V.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,a.jsx)(V.ZI,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),g&&!X?n.rls_enabled?(0,a.jsx)(a.Fragment,{children:ed.length<1&&!X?(0,a.jsx)(N.G,{asChild:!0,type:"default",className:"group",icon:(0,a.jsx)(y.A,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,a.jsx)(m(),{passHref:!0,href:"/project/".concat(eo,"/auth/policies?search=").concat(n.name,"&schema=").concat(n.schema),children:"Add RLS policy"})}):(0,a.jsx)(H.$,{asChild:!0,type:ed.length<1&&!X?"warning":"default",className:"group",icon:X||ed.length>0?(0,a.jsx)("div",{className:(0,B.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",ed.length>9?" px-1":"w-[16px]",""),children:(0,a.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:ed.length})}):(0,a.jsx)(y.A,{strokeWidth:1.5}),children:(0,a.jsxs)(m(),{passHref:!0,href:"/project/".concat(eo,"/auth/policies?search=").concat(n.name,"&schema=").concat(n.schema),children:["RLS ",ed.length>1?"policies":"policy"]})})}):(0,a.jsxs)(W.AM,{modal:!1,open:c,onOpenChange:d,children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsx)(H.$,{type:"warning",icon:(0,a.jsx)(b.A,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,a.jsxs)(W.hl,{portal:!0,className:"w-80 text-sm",align:"end",children:[(0,a.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{size:16})," Row Level Security (RLS)"]}),(0,a.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-xs",children:[(0,a.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,a.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!X&&(0,a.jsx)(H.$,{type:"default",className:"mt-2 w-min",onClick:()=>es(!ea),children:"Enable RLS for this table"})]})]})]}):null,g&&ex===D.Lj.TRIGGERS?(0,a.jsx)(H.$,{asChild:!0,type:"default",size:"tiny",icon:(0,a.jsx)("div",{className:(0,B.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",eb>9?"px-1":"w-[16px]"),children:(0,a.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:eb})}),children:(0,a.jsx)(m(),{href:eA,children:1===eb?"Trigger":"Triggers"})}):ex!==D.Lj.HIDE_BUTTON&&J&&(0,a.jsx)(N.G,{type:"default",size:"tiny",icon:(0,a.jsx)(v.A,{strokeWidth:1.5,className:eh?"text-brand":"text-foreground-muted"}),onClick:()=>et(!0),className:(0,B.cn)(eh&&"w-7 h-7 p-0 text-brand hover:text-brand-hover"),tooltip:{content:{side:"bottom",text:eh?"Click to disable realtime for this table":"Click to enable realtime for this table"}},children:!eh&&"Enable Realtime"}),K&&eS&&(0,a.jsxs)(W.AM,{modal:!1,open:c,onOpenChange:d,children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsx)(H.$,{type:"warning",icon:(0,a.jsx)(j.A,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,a.jsxs)(W.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.A,{size:16})," Secure your View"]}),(0,a.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,a.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,a.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsx)(H.$,{type:"secondary",onClick:()=>{ei(!0)},children:"Autofix"}),(0,a.jsx)(H.$,{type:"default",asChild:!0,children:(0,a.jsx)(m(),{target:"_blank",href:"/project/".concat(i,"/advisors/security?preset=").concat(null==eN?void 0:eN.level,"&id=").concat(null==eN?void 0:eN.cache_key),children:"Learn more"})})]})]})]})]}),Y&&eE&&(0,a.jsxs)(W.AM,{modal:!1,open:c,onOpenChange:d,children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsx)(H.$,{type:"warning",icon:(0,a.jsx)(j.A,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,a.jsxs)(W.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.A,{size:16})," Secure your View"]}),(0,a.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,a.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,a.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(H.$,{type:"default",asChild:!0,children:(0,a.jsx)(m(),{target:"_blank",href:"/project/".concat(i,"/advisors/security?preset=").concat(null==eR?void 0:eR.level,"&id=").concat(null==eR?void 0:eR.cache_key),children:"Learn more"})})})]})]})]}),f&&"public"===n.schema&&(0,a.jsxs)(W.AM,{modal:!1,open:c,onOpenChange:d,children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsx)(H.$,{type:"warning",icon:(0,a.jsx)(j.A,{strokeWidth:1.5}),children:"Unprotected Data API access"})}),(0,a.jsxs)(W.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.A,{size:16})," Secure Foreign table"]}),(0,a.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,a.jsxs)("p",{children:["Foreign tables do not enforce RLS, which may allow unrestricted access. To secure them, either move foreign tables to a private schema not exposed by PostgREST, or ",(0,a.jsx)("a",{href:"",children:"disable PostgREST access"})," entirely."]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(H.$,{type:"default",asChild:!0,children:(0,a.jsx)(m(),{target:"_blank",href:"".concat(P.aq,"/guides/database/extensions/wrappers/overview#security"),children:"Learn more"})})})]})]})]}),(0,a.jsx)(U.g,{serviceRoleLabel:"postgres"}),e_&&(0,a.jsx)(S.m,{section:["entities",n.name],source:"table_editor"}),(0,a.jsx)(w.s,{tableId:n.id,isRefetching:r})]}),(0,a.jsx)(G.A,{visible:ee,loading:ef,title:"".concat(eh?"Disable":"Enable"," realtime for ").concat(n.name),confirmLabel:"".concat(eh?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(eh?"Disabling":"Enabling"," realtime"),onCancel:()=>et(!1),onConfirm:()=>ek(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"GridHeaderActions.tsx",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",eh?"disabled":"enabled",", the table will"," ",eh?"no longer ":"","broadcast any changes to authorized subscribers."]}),!eh&&(0,a.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,a.jsx)(m(),{href:"/project/".concat(i,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,a.jsx)(en,{table:n,isAutofixViewSecurityModalOpen:er,setIsAutofixViewSecurityModalOpen:ei,"data-sentry-element":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"GridHeaderActions.tsx"}),g&&(0,a.jsx)(Q.A,{danger:n.rls_enabled,visible:ea,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:eI,onSelectConfirm:eC})]})};var es=n(80646),er=n(75204),ei=n(36261),el=n(84512),eo=n(13693),ec=n(71344),ed=n(21162),eu=n(38904),em=n(92246),ep=n(75878),eh=n(74067),ex=n(89388),eg=n(41578);let ef=e=>{let{portal:t=!0}=e,{urlFilters:n,onApplyFilters:s}=(0,g.M)(),r=(0,p.useMemo)(()=>(0,ex.hl)(null!=n?n:[]),[n]);return(0,a.jsx)(eg.b,{portal:t,filters:r,onApplyFilters:s,"data-sentry-element":"FilterPopoverPrimitive","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx"})};var ey=n(77191),eb=n.n(ey);let ev=e=>{let{rows:t,columns:n}=e,a=t.map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));return eb().unparse(a,{columns:n})};var ej=n(24116);let ew=e=>{var t;let{portal:n=!0}=e,{urlSorts:s,onApplySorts:r}=(0,f.G)(),i=(0,$.Ir)(),l=(null==i||null==(t=i.table)?void 0:t.name)||"",o=(0,p.useMemo)(()=>l&&s?(0,ex.FU)(l,s):[],[l,s]);return(0,a.jsx)(ej.l,{portal:n,sorts:o,onApplySorts:r,"data-sentry-element":"SortPopoverPrimitive","data-sentry-component":"SortPopover","data-sentry-source-file":"SortPopover.tsx"})},e_=5e5,eS=(0,a.jsxs)(a.Fragment,{children:["Sorry! We're unable to support exporting row counts larger than"," ",e_.toLocaleString("en-US")," at the moment. Alternatively, you may consider using"," ",(0,a.jsx)(m(),{href:"".concat(P.aq,"/reference/cli/supabase-db-dump"),target:"_blank",children:"pg_dump"})," ","via our CLI instead."]}),eN=e=>{let{customHeader:t,isRefetching:n,tableQueriesEnabled:s=!0}=e,r=(0,$.Ir)();return(0,a.jsx)("div",{"data-sentry-component":"Header","data-sentry-source-file":"Header.tsx",children:(0,a.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar dark:bg-surface-100 px-1.5 py-1.5 gap-2 overflow-x-auto ",children:[t||(r.selectedRows.size>0?(0,a.jsx)(eR,{tableQueriesEnabled:s}):(0,a.jsx)(eE,{})),(0,a.jsx)(ea,{table:r.originalTable,isRefetching:n,"data-sentry-element":"GridHeaderActions","data-sentry-source-file":"Header.tsx"})]})})},eE=()=>{var e;let{ref:t}=(0,x.g)(),{data:n}=(0,el.s)(),r=(0,$.Ir)(),i=(0,ec.ap)(),{can:d}=(0,L.Qp)(s.aG.TENANT_SQL_ADMIN_WRITE,"columns"),{mutate:u}=(0,ei.h)(),m=r.editable&&(null!=(e=r.table.columns)?e:[]).length>0?i.onAddRow:void 0,p=r.editable?i.onAddColumn:void 0,h=r.editable?i.onImportData:void 0;return(0,a.jsxs)("div",{className:"flex items-center gap-4","data-sentry-component":"DefaultHeader","data-sentry-source-file":"Header.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ef,{"data-sentry-element":"FilterPopover","data-sentry-source-file":"Header.tsx"}),(0,a.jsx)(ew,{"data-sentry-element":"SortPopover","data-sentry-source-file":"Header.tsx"})]}),(void 0!==m||void 0!==p)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:d&&(0,a.jsxs)(ed.rI,{children:[(0,a.jsx)(ed.ty,{asChild:!0,children:(0,a.jsx)(H.$,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,a.jsx)(l.A,{strokeWidth:1.5}),children:"Insert"})}),(0,a.jsx)(ed.SQ,{side:"bottom",align:"start",children:[...void 0!==m?[(0,a.jsxs)(ed._2,{className:"group space-x-2",onClick:m,children:[(0,a.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,a.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,a.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,a.jsx)("div",{className:(0,B.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Insert row"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",r.table.name]})]})]},"add-row")]:[],...void 0!==p?[(0,a.jsxs)(ed._2,{className:"group space-x-2",onClick:p,children:[(0,a.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,a.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,a.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,a.jsx)("div",{className:(0,B.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Insert column"}),(0,a.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",r.table.name]})]})]},"add-column")]:[],...void 0!==h?[(0,a.jsxs)(ed._2,{className:"group space-x-2",onClick:()=>{var e;h(),u({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!=t?t:"Unknown",organization:null!=(e=null==n?void 0:n.slug)?e:"Unknown"}})},children:[(0,a.jsxs)("div",{className:"relative -mt-2",children:[(0,a.jsx)(o.A,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,a.jsx)(c.A,{className:(0,B.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Import data from CSV"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},eR=e=>{var t,n;let{tableQueriesEnabled:s=!0}=e,{data:r}=(0,z.YA)(),o=(0,ec.ap)(),c=(0,$.Ir)(),u=(0,eo.RY)(),m=void 0!==u.role,{filters:x}=(0,g.M)(),{sorts:y}=(0,f.G)(),[b,v]=(0,p.useState)(!1),[j,w]=(0,p.useState)(!1),{data:S}=(0,er.vs)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,tableId:c.table.id,sorts:y,filters:x,page:c.page,limit:o.rowsPerPage,roleImpersonationState:u},{enabled:s}),{data:E}=(0,es.gt)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,tableId:c.table.id,filters:x,enforceExactCount:c.enforceExactCount,roleImpersonationState:u},{keepPreviousData:!0,enabled:s}),R=null!=(t=null==S?void 0:S.rows)?t:[],A=null!=(n=null==E?void 0:E.count)?n:0,k=e=>{let t=R.filter(e=>c.selectedRows.has(e.idx));if("csv"===e){let e=ev({rows:t,columns:c.table.columns.map(e=>e.name)});(0,eu.l)(e)}else if("sql"===e){let e=(0,_.S)(c.table,t);(0,eu.l)(e)}else"json"===e&&(0,eu.l)(JSON.stringify(t));h.oR.success("Copied rows to clipboard")},I=async()=>{if(v(!0),c.allRowsSelected&&A>e_)return h.oR.error((0,a.jsx)("div",{className:"prose text-sm text-foreground",children:eS})),v(!1);if(!r)return h.oR.error("Project is required"),v(!1);let e=c.allRowsSelected?(0,h.oR)((0,a.jsx)(em.t,{progress:0,message:"Exporting all rows from ".concat(c.table.name)}),{closeButton:!1,duration:1/0}):h.oR.loading("Exporting ".concat(c.selectedRows.size," row").concat(c.selectedRows.size>1?"s":""," from ").concat(c.table.name)),t=c.allRowsSelected?await (0,er.HQ)({projectRef:r.ref,connectionString:r.connectionString,table:c.table,filters:x,sorts:y,roleImpersonationState:u,progressCallback:t=>{let n=Math.min(t/A*100,100);(0,h.oR)((0,a.jsx)(em.t,{progress:n,message:"Exporting all rows from ".concat(c.table.name)}),{id:e,closeButton:!1,duration:1/0})}}):R.filter(e=>c.selectedRows.has(e.idx));if(0===t.length){h.oR.dismiss(e),h.oR.error("Export failed, please try exporting again"),v(!1);return}let n=new Blob([ev({rows:t,columns:c.table.columns.map(e=>e.name)})],{type:"text/csv;charset=utf-8;"});h.oR.success("Downloaded ".concat(t.length," rows as CSV"),{id:e,closeButton:!0,duration:4e3}),i()(n,"".concat(c.table.name,"_rows.csv")),v(!1)},C=async()=>{if(v(!0),c.allRowsSelected&&A>e_)return h.oR.error((0,a.jsx)("div",{className:"prose text-sm text-foreground",children:eS})),v(!1);if(!r)return h.oR.error("Project is required"),v(!1);if(c.allRowsSelected&&0===A)return h.oR.error("Export failed, please try exporting again"),v(!1);let e=c.allRowsSelected?(0,h.oR)((0,a.jsx)(em.t,{progress:0,message:"Exporting all rows from ".concat(c.table.name)}),{closeButton:!1,duration:1/0}):h.oR.loading("Exporting ".concat(c.selectedRows.size," row").concat(c.selectedRows.size>1?"s":""," from ").concat(c.table.name)),t=c.allRowsSelected?await (0,er.HQ)({projectRef:r.ref,connectionString:r.connectionString,table:c.table,filters:x,sorts:y,roleImpersonationState:u,progressCallback:t=>{let n=Math.min(t/A*100,100);(0,h.oR)((0,a.jsx)(em.t,{progress:n,message:"Exporting all rows from ".concat(c.table.name)}),{id:e,closeButton:!1,duration:1/0})}}):R.filter(e=>c.selectedRows.has(e.idx));if(0===t.length){h.oR.error("Export failed, please exporting try again"),v(!1);return}let n=new Blob([(0,_.S)(c.table,t)],{type:"text/sql;charset=utf-8;"});h.oR.success("Downloading ".concat(t.length," rows as SQL"),{id:e,closeButton:!0,duration:4e3}),i()(n,"".concat(c.table.name,"_rows.sql")),v(!1)},q=async()=>{if(!r)return h.oR.error("Project is required");v(!0);let e=h.oR.loading("Exporting ".concat(c.selectedRows.size," row").concat(c.selectedRows.size>1?"s":""," from ").concat(c.table.name)),t=R.filter(e=>c.selectedRows.has(e.idx)),n=new Blob([JSON.stringify(t)],{type:"text/sql;charset=utf-8;"});h.oR.success("Downloading ".concat(t.length," rows as JSON"),{id:e,closeButton:!0,duration:4e3}),i()(n,"".concat(c.table.name,"_rows.json")),v(!1)};return(0,eo.sc)(()=>{(c.allRowsSelected||c.selectedRows.size>0)&&c.setSelectedRows(new Set)}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[c.editable&&(0,a.jsx)(N.G,{type:"default",size:"tiny",icon:(0,a.jsx)(d.A,{}),onClick:()=>{let e=c.allRowsSelected?A:c.selectedRows.size,t=Array.from(c.selectedRows),n=R.filter(e=>t.includes(e.idx));o.onDeleteRows(n,{allRowsSelected:c.allRowsSelected,numRows:e,callback:()=>{c.setSelectedRows(new Set)}})},disabled:c.allRowsSelected&&m,tooltip:{content:{side:"bottom",text:c.allRowsSelected&&m?"Table truncation is not supported when impersonating a role":void 0}},children:c.allRowsSelected?"Delete all rows in table":c.selectedRows.size>1?"Delete ".concat(c.selectedRows.size," rows"):"Delete ".concat(c.selectedRows.size," row")}),c.allRowsSelected?(0,a.jsx)(N.G,{disabled:!0,type:"default",tooltip:{content:{side:"bottom",className:"w-64 text-center",text:"Copy to clipboard is not supported while all rows in the table are selected"}},children:"Copy"}):(0,a.jsxs)(ed.rI,{children:[(0,a.jsx)(ed.ty,{asChild:!0,children:(0,a.jsx)(H.$,{type:"default",size:"tiny",iconRight:(0,a.jsx)(l.A,{}),loading:b,disabled:b,children:"Copy"})}),(0,a.jsxs)(ed.SQ,{align:"start",className:"w-40",children:[(0,a.jsx)(ed._2,{onClick:()=>k("csv"),children:"Copy as CSV"}),(0,a.jsx)(ed._2,{onClick:()=>k("sql"),children:"Copy as SQL"}),(0,a.jsx)(ed._2,{onClick:()=>k("json"),children:"Copy as JSON"})]})]}),(0,a.jsxs)(ed.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"Header.tsx",children:[(0,a.jsx)(ed.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"Header.tsx",children:(0,a.jsx)(H.$,{type:"default",size:"tiny",iconRight:(0,a.jsx)(l.A,{}),loading:b,disabled:b,"data-sentry-element":"Button","data-sentry-source-file":"Header.tsx",children:"Export"})}),(0,a.jsxs)(ed.SQ,{align:"start",className:c.allRowsSelected?"w-52":"w-40","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"Header.tsx",children:[(0,a.jsx)(ed._2,{onClick:I,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"Header.tsx",children:"Export as CSV"}),(0,a.jsx)(ed._2,{onClick:C,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"Header.tsx",children:"Export as SQL"}),c.allRowsSelected?(0,a.jsx)(ed._2,{className:"group",onClick:()=>w(!0),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"group-hover:text-foreground",children:"Export via CLI"}),(0,a.jsx)("p",{className:"text-foreground-lighter",children:"Recommended for large tables"})]})}):(0,a.jsx)(ed._2,{onClick:q,children:"Export as JSON"})]})]}),!c.allRowsSelected&&A>R.length&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-6 ml-0.5",children:(0,a.jsx)(ep.w,{orientation:"vertical"})}),(0,a.jsx)(H.$,{type:"text",onClick:()=>void c.setSelectedRows(new Set(R.map(e=>e.idx)),!0),children:"Select all rows in table"})]})]}),(0,a.jsx)(eh.V,{table:c.table,filters:x,sorts:y,open:j,onOpenChange:()=>w(!1),"data-sentry-element":"ExportDialog","data-sentry-source-file":"Header.tsx"})]})}}}]);