try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="241762ff-f524-470f-a640-247c9ebd8a4a",e._sentryDebugIdIdentifier="sentry-dbid-241762ff-f524-470f-a640-247c9ebd8a4a")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[39831],{4328:(e,t,n)=>{n.d(t,{b:()=>a});let a={list:e=>["projects",e,"database-publications"]}},8187:(e,t,n)=>{n.d(t,{T:()=>s});var a=n(80263),l=n(14360);let s=e=>{let{width:t,height:n,value:s,language:r,readOnly:i=!1,onChange:o,onMount:c}=e;return(0,a.jsx)(l.default,{width:t,height:n||"200px",theme:"supabase",wrapperProps:{className:"grid-monaco-editor-container"},className:"grid-monaco-editor",defaultLanguage:r||"plaintext",defaultValue:s,onChange:o,onMount:function(e){e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})});let t=e.getModel().getPositionAt(null==s?void 0:s.length);e.setPosition(t),setTimeout(()=>{null==e||e.focus()},0),c&&c(e)},options:{readOnly:i,tabSize:2,fontSize:13,minimap:{enabled:!1},glyphMargin:!1,folding:!1,lineNumbers:"off",lineNumbersMinChars:0,scrollBeyondLastLine:!1,wordWrap:"on",unusualLineTerminators:"off"},"data-sentry-element":"Editor","data-sentry-component":"MonacoEditor","data-sentry-source-file":"MonacoEditor.tsx"})}},10247:(e,t,n)=>{n.d(t,{HQ:()=>h,Ir:()=>p});var a=n(80263),l=n(53239),s=n(56028),r=n(12532),i=n(79166),o=n(89388),c=n(89034);function d(e,t){let n=e;if(null==t?void 0:t.gridColumns){n=[];let a=t.gridColumns.filter(e=>(null==e?void 0:e.name)!=="");for(let t=0;t<a.length;t++){let l=a[t],s=e.find(e=>e.key===l.key);s&&n.push({...s,width:l.width,frozen:l.frozen})}let l=e.filter(e=>!a.find(t=>t.key===e.key)&&""!==e.name);n=n.concat(l);let s=e.find(e=>e.key===c.od);s&&(n=[s,...n]);let r=e.find(e=>e.key===c.Hy);r&&n.push(r)}return n}var u=n(24681),m=n(71344);let x=(0,l.createContext)(void 0),h=e=>{let{children:t,projectRef:n,table:r,...c}=e,h=(0,m.ap)(),p=(0,l.useRef)((e=>{let{projectRef:t,table:n,editable:a=!0,onAddColumn:l,onExpandJSONEditor:r,onExpandTextEditor:c}=e,m=(0,o.rH)(n),x=(0,o.Tk)(t,m.name,m.schema),h=d((0,u.og)(m,{tableId:m.id,editable:a,onAddColumn:a?l:void 0,onExpandJSONEditor:r,onExpandTextEditor:c}),x),p=(0,s.BX)({table:m,originalTable:n,_originalTableRef:(0,s.KR)(n),updateTable:e=>{let t=(0,o.rH)(e),n=d((0,u.og)(t,{tableId:e.id,editable:p.editable,onAddColumn:p.editable?l:void 0,onExpandJSONEditor:r,onExpandTextEditor:c}),{gridColumns:p.gridColumns});p.table=t,p.gridColumns=n,p.originalTable=e,p._originalTableRef=(0,s.KR)(e)},selectedRows:(0,i.zJ)(),allRowsSelected:!1,setSelectedRows:(e,t)=>{p.allRowsSelected=null!=t&&t,p.selectedRows=(0,i.zJ)(e)},gridColumns:h,moveColumn:(e,t)=>{let n=p.gridColumns.findIndex(t=>t.key===e),a=p.gridColumns.findIndex(e=>e.key===t),l=p.gridColumns[n];p.gridColumns.splice(n,1),p.gridColumns.splice(a,0,l)},updateColumnSize:(e,t)=>{p.gridColumns[e]&&(p.gridColumns[e].width=t)},freezeColumn:e=>{let t=p.gridColumns.findIndex(t=>t.key===e);p.gridColumns[t]&&(p.gridColumns[t].frozen=!0)},unfreezeColumn:e=>{let t=p.gridColumns.findIndex(t=>t.key===e);p.gridColumns[t]&&(p.gridColumns[t].frozen=!1)},updateColumnIdx:(e,t)=>{let n=p.gridColumns.findIndex(t=>t.key===e);p.gridColumns[n]&&(p.gridColumns[n].idx=t),p.gridColumns.sort((e,t)=>e.idx-t.idx)},selectedCellPosition:null,setSelectedCellPosition:e=>{p.selectedCellPosition=e},enforceExactCount:!1,setEnforceExactCount:e=>{p.enforceExactCount=e},page:1,setPage:e=>{p.page=e,p.setSelectedRows(new Set)},editable:a,setEditable:e=>{p.editable=e,p.gridColumns=d((0,u.og)(p.table,{tableId:m.id,editable:e,onAddColumn:e?l:void 0,onExpandJSONEditor:r,onExpandTextEditor:c}),{gridColumns:p.gridColumns})}});return p})({...c,projectRef:n,table:r,onAddColumn:h.onAddColumn,onExpandJSONEditor:(e,t)=>{h.onExpandJSONEditor({column:e,row:t,value:JSON.stringify(t[e])||""})},onExpandTextEditor:(e,t)=>{h.onExpandTextEditor(e,t)}})).current;return(0,l.useEffect)(()=>(0,s.B1)(p,()=>{(0,o.kz)({gridColumns:p.gridColumns,projectRef:n,tableName:p.table.name,schema:p.table.schema})}),[]),(0,l.useEffect)(()=>{p._originalTableRef!==r&&p.updateTable(r)},[r]),(0,l.useEffect)(()=>{if(p.editable!==c.editable){var e;p.setEditable(null==(e=c.editable)||e)}},[c.editable,p]),(0,a.jsx)(x.Provider,{value:p,"data-sentry-element":"TableEditorTableStateContext.Provider","data-sentry-component":"TableEditorTableStateContextProvider","data-sentry-source-file":"table-editor-table.tsx",children:t})},p=e=>{let t=(0,l.useContext)(x);return(0,r.s)(t,e)}},11078:(e,t,n)=>{n.d(t,{o:()=>s});var a=n(80814),l=n(53239);let s=()=>{let e=(0,a.useRouter)(),t=(0,l.useMemo)(()=>new URLSearchParams(e.asPath.split("?")[1]),[e.asPath]),n=(0,l.useMemo)(()=>t.getAll("filter"),[t]),s=(0,l.useMemo)(()=>t.getAll("sort"),[t]);return{filters:n,sorts:s,setParams:t=>{let a=t({filter:n,sort:s}),l=void 0!==a.filter,r=void 0!==a.sort;e.push({query:{...e.query,...l?{filter:a.filter}:{},...r?{sort:a.sort}:{}}})}}}},15553:(e,t,n)=>{n.d(t,{H:()=>d});var a=n(72391),l=n(51355),s=n(80210),r=n(73969),i=n(59356),o=n(4328);async function c(e){let{projectRef:t,connectionString:n,id:l,tables:s,publish_insert:r,publish_update:o,publish_delete:c,publish_truncate:d}=e,{sql:u}=a.A.publications.update(l,{tables:s,publish_insert:r,publish_update:o,publish_delete:c,publish_truncate:d}),{result:m}=await (0,i.E)({projectRef:t,connectionString:n,sql:u,queryKey:["publication","update",l]});return m}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)({mutationFn:e=>c(e),async onSuccess(t,n,l){let{projectRef:s}=n;await a.invalidateQueries({queryKey:o.b.list(s)}),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to update database publication: ".concat(e.message)):t(e,n,a)},...n})}},19197:(e,t,n)=>{n.d(t,{AL:()=>c,J5:()=>u,J_:()=>o,N1:()=>i,aw:()=>d,fX:()=>y,mL:()=>m,mN:()=>x,wB:()=>h,wy:()=>f,x0:()=>p});var a=n(9012),l=n.n(a),s=n(14506),r=n.n(s);let i=["int2","int4","int8","float4","float8","numeric","double precision"],o=["json","jsonb"],c=["text","varchar"],d=["timestamp","timestamptz"],u=["date"],m=["time","timetz"],x=l()(d,u,m),h=["uuid","bool","vector","bytea"],p=r()(l()(i,o,c,x,h)),f={varchar:{alternative:"text",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_varchar.28n.29_by_default"},json:{alternative:"jsonb",reference:"https://www.postgresql.org/docs/current/datatype-json.html"},timetz:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timetz"},timestamp:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29"}},y=[{name:"int2",description:"Signed two-byte integer",type:"number"},{name:"int4",description:"Signed four-byte integer",type:"number"},{name:"int8",description:"Signed eight-byte integer",type:"number"},{name:"float4",description:"Single precision floating-point number (4 bytes)",type:"number"},{name:"float8",description:"Double precision floating-point number (8 bytes)",type:"number"},{name:"numeric",description:"Exact numeric of selectable precision",type:"number"},{name:"json",description:"Textual JSON data",type:"json"},{name:"jsonb",description:"Binary JSON data, decomposed",type:"json"},{name:"text",description:"Variable-length character string",type:"text"},{name:"varchar",description:"Variable-length character string",type:"text"},{name:"uuid",description:"Universally unique identifier",type:"text"},{name:"date",description:"Calendar date (year, month, day)",type:"time"},{name:"time",description:"Time of day (no time zone)",type:"time"},{name:"timetz",description:"Time of day, including time zone",type:"time"},{name:"timestamp",description:"Date and time (no time zone)",type:"time"},{name:"timestamptz",description:"Date and time, including time zone",type:"time"},{name:"bool",description:"Logical boolean (true/false)",type:"bool"},{name:"bytea",description:"Variable-length binary string",type:"others"}]},20426:(e,t,n)=>{n.d(t,{T:()=>h,z:()=>x});var a=n(72391),l=n(51355),s=n(80210),r=n(73969),i=n(32510),o=n(66832),c=n(59356),d=n(88403),u=n(6843),m=n(78155);async function x(e){let{projectRef:t,connectionString:n,column:l,cascade:s=!1}=e,{sql:r}=a.A.columns.remove(l,{cascade:s}),{result:i}=await (0,c.E)({projectRef:t,connectionString:n,sql:r,queryKey:["column","delete",l.id]});return i}let h=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)({mutationFn:e=>x(e),async onSuccess(t,n,l){let{projectRef:s,column:r}=n;await Promise.all([a.invalidateQueries({queryKey:o.C.list(s)}),a.invalidateQueries({queryKey:i.c.foreignKeyConstraints(s,r.schema)}),a.invalidateQueries({queryKey:d.i.tableEditor(s,r.table_id)}),a.invalidateQueries({queryKey:i.c.tableDefinition(s,r.table_id)}),a.invalidateQueries({queryKey:m.k.listBySchema(s,r.schema)})]),await a.invalidateQueries({queryKey:u.j.tableRowsAndCount(s,r.table_id)}),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to delete database column: ".concat(e.message)):t(e,n,a)},...n})}},24116:(e,t,n)=>{n.d(t,{l:()=>v});var a=n(80263),l=n(84305),s=n.n(l),r=n(76174),i=n(19616),o=n(53239),c=n(10247),d=n(61548),u=n(99779),m=n(47773),x=n(44071),h=n(68152),p=n(25212),f=n(30068),y=n(72608);let g=(0,o.memo)(e=>{let{index:t,columnName:n,sort:l,onDelete:s,onToggle:r,onDrag:i}=e,d=(0,c.Ir)().table.columns.find(e=>e.name===n),m=(0,o.useRef)(null),[{isDragging:g},v]=(0,p.i)({type:"sort-row",item:()=>({key:n,index:t}),collect:e=>({isDragging:e.isDragging()})}),[{handlerId:j},b]=(0,f.H)({accept:"sort-row",collect:e=>({handlerId:e.getHandlerId()}),hover(e,n){var a;if(!m.current)return;let l=e.index;if(l===t)return;let s=null==(a=m.current)?void 0:a.getBoundingClientRect(),r=(s.bottom-s.top)/2,i=n.getClientOffset().y-s.top;(!(l<t)||!(i<r))&&(l>t&&i>r||(N(l,t),e.index=t))}}),N=(e,t)=>{e!=t&&i(e,t)};return(v(b(m)),d)?(0,a.jsxs)("div",{className:"flex items-center gap-3 px-3",ref:m,style:{opacity:+!g},"data-handler-id":j,"data-sentry-component":"SortRow","data-sentry-source-file":"SortRow.tsx",children:[(0,a.jsx)("span",{className:"transition-color text-foreground-lighter hover:text-foreground-light",children:(0,a.jsx)(x.A,{strokeWidth:2,size:16,"data-sentry-element":"Menu","data-sentry-source-file":"SortRow.tsx"})}),(0,a.jsx)("div",{className:"grow",children:(0,a.jsxs)("span",{className:"flex grow items-center gap-1 truncate text-sm text-foreground",children:[(0,a.jsx)("span",{className:"text-xs text-foreground-lighter",children:t>0?"then by":"sort by"}),(0,a.jsx)("span",{className:"text-xs",children:d.name})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,a.jsx)("label",{className:"text-xs text-foreground-lighter",children:"ascending:"}),(0,a.jsx)(y.d,{defaultChecked:l.ascending,onCheckedChange:e=>r(n,e),"data-sentry-element":"Switch","data-sentry-source-file":"SortRow.tsx"})]}),(0,a.jsx)(u.$,{icon:(0,a.jsx)(h.A,{strokeWidth:1.5}),size:"tiny",type:"text",onClick:()=>s(n),"data-sentry-element":"Button","data-sentry-source-file":"SortRow.tsx"})]}):null}),v=e=>{var t;let{buttonText:n,sorts:l,onApplySorts:x,portal:h=!0}=e,[p,f]=(0,o.useState)(!1),y=(0,c.Ir)(),[v,j]=(0,o.useState)(l),b=(0,o.useRef)(l),N=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(N.current){N.current=!1;return}s()(l,b.current)||(j(l),b.current=l)},[l]);let w=null!=n?n:v.length>0?"Sorted by ".concat(v.length," rule").concat(v.length>1?"s":""):"Sort",C=(0,o.useMemo)(()=>{var e;return(null==y||null==(e=y.table)?void 0:e.columns)?y.table.columns.filter(e=>!v.find(t=>t.column==e.name)):[]},[null==y||null==(t=y.table)?void 0:t.columns,v]),S=(0,o.useMemo)(()=>(null==C?void 0:C.map(e=>({value:e.name,label:e.name,postLabel:e.dataType,disabled:"json"===e.dataType||"jsonb"===e.dataType,tooltip:"json"===e.dataType||"jsonb"===e.dataType?"Sorting on JSON-based columns is currently not supported":""})))||[],[C]),A=(0,o.useCallback)(e=>{j(t=>t.filter(t=>t.column!==e))},[]),k=(0,o.useCallback)((e,t)=>{j(n=>{let a=n.findIndex(t=>t.column===e);if(-1===a)return n;let l={...n[a],ascending:t};return[...n.slice(0,a),l,...n.slice(a+1)]})},[]),E=(0,o.useCallback)((e,t)=>{j(n=>{if(e<0||e>=n.length||t<0||t>=n.length)return n;let a=n[e],l=[...n.slice(0,e),...n.slice(e+1)];return[...l.slice(0,t),a,...l.slice(t)]})},[]),_=(0,o.useMemo)(()=>v.length!==l.length||v.some((e,t)=>{let n=l[t];return!n||e.column!==n.column||e.ascending!==n.ascending}),[v,l]),R=(0,a.jsxs)("div",{className:"space-y-2 py-2",children:[v.map((e,t)=>(0,a.jsx)(g,{index:t,columnName:e.column,sort:e,onDelete:A,onToggle:k,onDrag:E},((e,t)=>"sort-".concat(e.table,"-").concat(e.column,"-").concat(t))(e,t))),0===v.length&&(0,a.jsxs)("div",{className:"space-y-1 px-3",children:[(0,a.jsx)("h5",{className:"text-xs text-foreground-light",children:"No sorts applied to this view"}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to sort the view"})]}),(0,a.jsx)(d.zT,{}),(0,a.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[S&&S.length>0?(0,a.jsx)(m.X,{options:S,onSelect:e=>{var t;let n=null==(t=y.table)?void 0:t.name;n&&j([...v,{table:n,column:e,ascending:!0}])},side:"bottom",align:"start",children:(0,a.jsx)(u.$,{asChild:!0,type:"dashed",iconRight:(0,a.jsx)(r.A,{size:"14",className:"text-foreground-light"}),className:"sb-grid-dropdown__item-trigger","data-testid":"table-editor-pick-column-to-sort-button",children:(0,a.jsxs)("span",{children:["Pick ",v.length>1?"another":"a"," column to sort by"]})})}):(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"All columns have been added"}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(u.$,{disabled:!_,type:"default",onClick:()=>{N.current=!0,b.current=[...v],x(v.map(e=>({...e})))},children:"Apply sorting"})})]})]});return(0,a.jsxs)(d.AM,{modal:!1,open:p,onOpenChange:f,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"SortPopoverPrimitive","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:[(0,a.jsx)(d.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:(0,a.jsx)(u.$,{type:v.length>0?"link":"text",icon:(0,a.jsx)(i.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:w})}),(0,a.jsx)(d.hl,{className:"p-0 w-96",side:"bottom",align:"start",portal:h,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:R})]})}},24558:(e,t,n)=>{n.d(t,{s:()=>c});var a=n(80263),l=n(51355),s=n(81672),r=n(22891),i=n(23729),o=n(6843);let c=e=>{let{tableId:t,isRefetching:n}=e,{ref:c}=(0,r.g)(),d=(0,l.jE)(),u=o.j.tableRowsAndCount(c,t);async function m(){await d.invalidateQueries({queryKey:u})}return(0,a.jsx)(i.G,{type:"outline",loading:n,icon:(0,a.jsx)(s.A,{}),onClick:()=>m(),className:"w-7 h-7 p-0",tooltip:{content:{side:"bottom",text:"Refresh table data"}},"data-sentry-element":"ButtonTooltip","data-sentry-component":"RefreshButton","data-sentry-source-file":"RefreshButton.tsx"})}},24681:(e,t,n)=>{n.d(t,{lu:()=>eF,AM:()=>eO,og:()=>eD});var a=n(80263),l=n(89034),s=n(49523);let r=e=>{let{row:t,column:n,isNullable:l,onRowChange:r,onClose:i}=e,o=t[n.key];return(0,a.jsxs)(s.Ay,{autoFocus:!0,id:"boolean-editor",name:"boolean-editor",size:"small",onBlur:()=>i(!1),onChange:e=>{let a=e.target.value;"null"===a?r({...t,[n.key]:null},!0):r({...t,[n.key]:"true"===a},!0)},defaultValue:null===o?"null":o.toString(),style:{width:"".concat(n.width,"px")},"data-sentry-element":"Select","data-sentry-component":"BooleanEditor","data-sentry-source-file":"BooleanEditor.tsx",children:[(0,a.jsx)(s.Ay.Option,{value:"true","data-sentry-element":"Select.Option","data-sentry-source-file":"BooleanEditor.tsx",children:"TRUE"}),(0,a.jsx)(s.Ay.Option,{value:"false","data-sentry-element":"Select.Option","data-sentry-source-file":"BooleanEditor.tsx",children:"FALSE"}),l&&(0,a.jsx)(s.Ay.Option,{value:"null",children:"NULL"})]})};var i=n(53434),o=n.n(i),c=n(76174),d=n(53239),u=n(61548),m=n(80100),x=n(99779),h=n(21162),p=n(88044),f=n(64758);let y=e=>{let{value:t,children:n,onEscape:l,onEnter:s,ignoreOutsideClicks:r=!1}=e,i=(0,d.useRef)(null),o=(e=>{let[t,n]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let t=t=>{e.current&&!e.current.contains(t.target)?n(!0):n(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[e]),t})(i),c=(0,d.useCallback)(e=>{switch(e.key){case"Escape":e.stopPropagation(),l&&l(t);break;case"Enter":e.stopPropagation(),!e.shiftKey&&s&&(e.preventDefault(),s(t))}},[t]);return(0,d.useEffect)(()=>{!r&&o&&void 0!==s&&s(t)},[o]),(0,a.jsx)("div",{ref:i,onKeyDown:c,"data-sentry-component":"BlockKeys","data-sentry-source-file":"BlockKeys.tsx",children:n})},g={date:"YYYY-MM-DD",datetime:"YYYY-MM-DD HH:mm:ss",datetimetz:"YYYY-MM-DD HH:mm:ss+ZZ"};function v(e){let{row:t,column:n,type:l,isNullable:s,onRowChange:r,onClose:i}=e,v=(0,d.useRef)(null),j=g[l],b=t[n.key],[N,w]=(0,d.useState)(b),C=N?Number(o()(N,j)):N,S=e=>{("string"!=typeof e||0!==e.length)&&"Invalid Date"!==C&&r({...t,[n.key]:e},!0)},A=()=>{S(o()().format("date"===l?"YYYY-MM-DD":"datetimetz"===l?"YYYY-MM-DDTHH:mm:ssZ":"YYYY-MM-DDTHH:mm:ss"))};return(0,d.useEffect)(()=>{var e,t;try{null==(e=v.current)||e.focus({preventScroll:!0})}catch(e){null==(t=v.current)||t.focus()}},[]),(0,a.jsxs)(u.AM,{open:!0,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"BaseEditor","data-sentry-source-file":"DateTimeEditor.tsx",children:[(0,a.jsx)(u.Wv,{"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"DateTimeEditor.tsx",children:(0,a.jsx)("div",{className:(0,m.cn)("px-[8px]",null===b?"text-foreground-lighter":""),children:null===b?"NULL":b})}),(0,a.jsxs)(u.hl,{align:"start",className:"p-0 rounded-none w-64","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"DateTimeEditor.tsx",children:[(0,a.jsx)(y,{ignoreOutsideClicks:!0,value:N,onEscape:()=>i(!1),onEnter:S,"data-sentry-element":"BlockKeys","data-sentry-source-file":"DateTimeEditor.tsx",children:(0,a.jsx)(f.p,{ref:v,value:null!=N?N:"",placeholder:j,onChange:e=>w(e.target.value),className:"border-0 rounded-none bg-dash-sidebar outline-none !ring-0 !ring-offset-0","data-sentry-element":"Input","data-sentry-source-file":"DateTimeEditor.tsx"})}),(0,a.jsxs)("div",{className:"px-3 py-1 flex flex-col gap-y-0.5",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Formatted value:"}),0===(null!=N?N:"").length?(0,a.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Enter a valid date format"}):"Invalid Date"===C?(0,a.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Invalid date format"}):"datetimetz"===l?(0,a.jsx)(p.T,{displayAs:"utc",utcTimestamp:C,labelFormat:"DD MMM YYYY HH:mm:ss (ZZ)",className:"text-left !text-sm font-mono tracking-tight"}):(0,a.jsx)("p",{className:"text-sm font-mono tracking-tight",children:(0,p.K)({utcTimestamp:C,format:"date"===l?"DD MMM YYYY":"datetime"===l?"DD MMM YYYY HH:mm:ss":void 0})})]}),(0,a.jsxs)("div",{className:"px-3 pt-1 pb-2 flex justify-between gap-x-1",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsx)("div",{className:"flex",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.$,{type:"default",className:"rounded-r-none",onClick:()=>S(null),children:"Set NULL"}),(0,a.jsxs)(h.rI,{children:[(0,a.jsx)(h.ty,{asChild:!0,children:(0,a.jsx)(x.$,{type:"default",icon:(0,a.jsx)(c.A,{}),className:"px-1 rounded-l-none border-l-0"})}),(0,a.jsx)(h.SQ,{className:"w-20",align:"end",children:(0,a.jsx)(h._2,{onClick:A,children:"Set to NOW"})})]})]}):(0,a.jsx)(x.$,{type:"default",onClick:A,children:"Set to NOW"})})]})]})]})}function j(e,t){return n=>(0,a.jsx)(v,{...n,type:e,isNullable:t})}var b=n(35834),N=n(73969),w=n(22891),C=n(55108),S=n(57648),A=n(52641),k=n(46548),E=n(9620),_=n(6436),R=n(28261),T=n(30404),P=n(8187),L=n(80869),I=n(1348);let F=e=>{let{isLoading:t,loadFullValue:n}=e;return(0,a.jsxs)("div",{className:(0,m.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-xs w-full h-full px-3 text-center","bg-default/80 backdrop-blur-[1.5px]"),"data-sentry-component":"TruncatedWarningOverlay","data-sentry-source-file":"TruncatedWarningOverlay.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsxs)("p",{children:["Value is larger than ",I.SF.toLocaleString()," characters"]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire value, but your browser may run into performance issues"})]}),(0,a.jsx)(x.$,{type:"default",loading:t,onClick:n,"data-sentry-element":"Button","data-sentry-source-file":"TruncatedWarningOverlay.tsx",children:"Load full value"})]})},D=e=>{let{row:t,column:n,isEditable:l=!0,onRowChange:s,onExpandEditor:r}=e,{id:i}=(0,w.g)(),o=i?Number(i):void 0,{data:c}=(0,E.YA)(),{data:u}=(0,S.Pk)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:o}),m=t[n.key],x=null==m||"string"==typeof m?m:JSON.stringify(m),h=(0,_.G1)(x?(e=>{try{let t=JSON.parse(e);return JSON.stringify(t)}catch(t){if("string"==typeof e)return e.replaceAll('"','"');return JSON.stringify(e)}})(x):""),p=(0,C.Mr)(x),[f,g]=(0,d.useState)(!0),[v,j]=(0,d.useState)(h),{mutate:I,isPending:D,isSuccess:O}=(0,k.c2)(),z=(0,d.useCallback)(()=>{l&&s(t,!0),g(!1)},[]),K=(0,d.useCallback)(e=>{(null!==e?(0,_.Cf)(e):e)!==v?M(e):g(!1)},[O]),M=e=>{if(l)if(e)if((e=>{try{return JSON.parse(e),!0}catch(e){return!1}})(e)){let a=JSON.parse(e);s({...t,[n.key]:a},!0),g(!1)}else N.oR.error("Please enter a valid JSON");else s({...t,[n.key]:null},!0),g(!1)};return(0,a.jsx)(R.A,{open:f,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:p&&!O?(0,a.jsxs)("div",{style:{width:"".concat(n.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,a.jsx)(P.T,{readOnly:!0,onChange:()=>{},width:"".concat(n.width,"px"),value:null!=v?v:"",language:"markdown"}),(0,a.jsx)(F,{isLoading:D,loadFullValue:()=>{if(void 0===u||void 0===c||!(0,A.KO)(u))return;if(0===u.primary_keys.length)return(0,N.oR)("Unable to load value as table has no primary keys");let e=u.primary_keys.reduce((e,n)=>({...e,[n.name]:t[n.name]}),{});I({table:{schema:u.schema,name:u.name},column:n.name,pkMatch:e,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString},{onSuccess:e=>{j(JSON.stringify(e))}})}})]}):(0,a.jsxs)(y,{value:v,onEscape:z,onEnter:K,children:[(0,a.jsx)(P.T,{width:"".concat(n.width,"px"),value:null!=v?v:"",language:"json",readOnly:!l,onChange:e=>{l&&(e&&""!=e?j(e):j(null))}}),(0,a.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 gap-x-2",children:[l&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"border border-strong rounded p-1 flex items-center justify-center transition cursor-pointer bg-selection hover:bg-border-strong",onClick:()=>void(z(),r(n.key,{...t,[n.key]:(0,_.Bl)(v)||t[n.key]})),children:(0,a.jsx)(b.A,{size:12,strokeWidth:2})})}),(0,a.jsx)(T.ZI,{side:"bottom",align:"center",children:(0,a.jsx)("span",{children:"Expand editor"})})]})]})]}),"data-sentry-element":"Popover","data-sentry-component":"JsonEditor","data-sentry-source-file":"JsonEditor.tsx",children:(0,a.jsx)("div",{className:"".concat(v&&0==h.trim().length?"sb-grid-fill-container":""," sb-grid-json-editor__trigger"),onClick:()=>g(!f),children:null===v||""===v?(0,a.jsx)(L.X,{}):h})})};function O(e){null==e||e.focus(),null==e||e.select()}function z(e){let{row:t,column:n,onRowChange:l,onClose:s}=e,r=t[n.key];return(0,a.jsx)("input",{className:"sb-grid-number-editor",ref:O,value:null!=r?r:"",onChange:function(e){let a=e.target.value;""===a?l({...t,[n.key]:null}):l({...t,[n.key]:a})},onBlur:function(){s(!0)},type:"number","data-sentry-component":"NumberEditor","data-sentry-source-file":"NumberEditor.tsx"})}function K(e){let{row:t,column:n,onRowChange:l,onClose:r,options:i,isNullable:o}=e,c=t[n.key];return(0,a.jsxs)(s.Ay,{autoFocus:!0,id:"select-editor",name:"select-editor",size:"small",defaultValue:null!=c?c:"",className:"sb-grid-select-editor !gap-2",style:{width:"".concat(n.width,"px")},onChange:function(e){e.target.value&&""!=e.target.value?l({...t,[n.key]:e.target.value},!0):l({...t,[n.key]:null},!0)},onBlur:function(){r(!1)},"data-sentry-element":"Select","data-sentry-component":"SelectEditor","data-sentry-source-file":"SelectEditor.tsx",children:[o&&(0,a.jsx)(s.Ay.Option,{value:"",children:"NULL"}),i.map(e=>{let{label:t,_value:n}=e;return(0,a.jsx)(s.Ay.Option,{value:n,selected:n===c,children:t},n)})]})}var M=n(68421);let q=()=>(0,a.jsx)("span",{className:"sb-grid-empty-value opacity-50","data-sentry-component":"EmptyValue","data-sentry-source-file":"EmptyValue.tsx",children:"EMPTY"}),B=e=>{let{row:t,column:n,isNullable:l,isEditable:s,onRowChange:r,onExpandEditor:i}=e,{id:o}=(0,w.g)(),c=o?Number(o):void 0,{data:u}=(0,E.YA)(),{data:h}=(0,S.Pk)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,id:c}),p=t[n.key],f=p||""===p?String(p):null,[g,v]=(0,d.useState)(!0),[j,_]=(0,d.useState)(f),[I,D]=(0,d.useState)(!1),{mutate:O,isPending:z,isSuccess:K}=(0,k.c2)(),B=(0,C.Mr)(f),U=(0,d.useCallback)(()=>{s&&r(t,!0),v(!1)},[]),Y=(0,d.useCallback)(e=>{s&&e!==j&&r({...t,[n.key]:e},!0),v(!1)},[K]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{open:g,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:B&&!K?(0,a.jsxs)("div",{style:{width:"".concat(n.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,a.jsx)(P.T,{readOnly:!0,onChange:()=>{},width:"".concat(n.width,"px"),value:null!=j?j:"",language:"markdown"}),(0,a.jsx)(F,{isLoading:z,loadFullValue:()=>{if(void 0===h||void 0===u||!(0,A.KO)(h))return;if(0===h.primary_keys.length)return(0,N.oR)("Unable to load value as table has no primary keys");let e=h.primary_keys.reduce((e,n)=>({...e,[n.name]:t[n.name]}),{});O({table:{schema:h.schema,name:h.name},column:n.name,pkMatch:e,projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{onSuccess:e=>_(e)})}})]}):(0,a.jsxs)(y,{value:j,onEscape:U,onEnter:Y,ignoreOutsideClicks:I,children:[(0,a.jsx)(P.T,{width:"".concat(n.width,"px"),value:null!=j?j:"",readOnly:!s,onChange:e=>{s&&(e?_(e):_(""))}}),s&&(0,a.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-y-1",children:[(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{asChild:!0,children:(0,a.jsx)(x.$,{type:"default",className:"px-1",onClick:()=>void(U(),i(n.key,{...t,[n.key]:j||t[n.key]})),icon:(0,a.jsx)(b.A,{size:12,strokeWidth:2})})}),(0,a.jsx)(T.ZI,{side:"bottom",children:"Expand editor"})]}),l&&(0,a.jsx)(x.$,{size:"tiny",type:"default",htmlType:"button",onClick:()=>D(!0),children:"Set to NULL"})]})]})]}),"data-sentry-element":"Popover","data-sentry-source-file":"TextEditor.tsx",children:(0,a.jsx)("div",{className:(0,m.cn)(!!j&&0===j.toString().trim().length&&"sb-grid-fill-container","sb-grid-text-editor__trigger"),onClick:()=>v(!g),children:null===j?(0,a.jsx)(L.X,{}):""===j?(0,a.jsx)(q,{}):j})}),(0,a.jsx)(M.A,{visible:I,title:"Confirm setting value to NULL",confirmLabel:"Confirm",onCancel:()=>D(!1),onConfirm:()=>{Y(null)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"TextEditor.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you wish to set this value to NULL? This action cannot be undone."})})]})};var U=n(79054),Y=n.n(U);function W(e){null==e||e.focus(),null==e||e.select()}o().extend(Y());let V="HH:mm:ss";function H(e){let{row:t,column:n,format:l,onRowChange:s,onClose:r}=e,i=t[n.key],c=i?o()(i,l).format(V):i;return(0,a.jsx)("input",{className:"sb-grid-time-editor",ref:W,value:null!=c?c:"",onChange:function(e){let a=e.target.value;if(""==a)s({...t,[n.key]:null});else{let e=o()(a,V).format(l);s({...t,[n.key]:e})}},onBlur:()=>r(!0),type:"time",step:"1","data-sentry-component":"BaseEditor","data-sentry-source-file":"TimeEditor.tsx"})}function $(e){return(0,a.jsx)(H,{...e,format:"HH:mm:ss","data-sentry-element":"BaseEditor","data-sentry-component":"TimeEditor","data-sentry-source-file":"TimeEditor.tsx"})}function J(e){return(0,a.jsx)(H,{...e,format:"HH:mm:ssZZ","data-sentry-element":"BaseEditor","data-sentry-component":"TimeWithTimezoneEditor","data-sentry-source-file":"TimeEditor.tsx"})}let Q=e=>{let t=e.row[e.column.key];if(!t)return(0,a.jsx)(L.X,{});let n=(0,C.ds)(t);return(0,a.jsx)(a.Fragment,{children:n})},G=e=>{let t=e.row[e.column.key];return null===t?(0,a.jsx)(L.X,{}):(0,a.jsx)(a.Fragment,{children:t?"TRUE":"FALSE"})},Z=e=>{let t=e.row[e.column.key];return null===t?(0,a.jsx)(L.X,{}):""===t?(0,a.jsx)(q,{}):(("object"==typeof t||Array.isArray(t))&&(t=JSON.stringify(t)),(0,a.jsx)(a.Fragment,{children:t}))};var X=n(74310),ee=n(23729),et=n(53931),en=n(97904),ea=n(72715),el=n(24560),es=n(71875),er=n(75204);let ei=e=>{var t,n;let{table:s,column:r,value:i}=e,{ref:o}=(0,w.g)(),{data:c}=(0,E.YA)(),{data:d,error:u,isSuccess:h,isError:p,isLoading:f}=(0,er.vs)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,tableId:s.id,filters:[{column:r,operator:"=",value:i}],page:1,limit:10},{keepPreviousData:!0}),y=s.primary_keys.map(e=>e.name),g=(null!=(t=null==s?void 0:s.columns)?t:[]).map(e=>{let t=eO({dataType:e.data_type,format:e.format}),n=(e.name.length+e.format.length)*eF,s=y.includes(e.name);return{key:e.name,name:e.name,resizable:!1,draggable:!1,sortable:!1,width:t<n?n:t,minWidth:l.T_,headerCellClass:"outline-none !shadow-none",renderHeaderCell:()=>(0,a.jsxs)("div",{className:"flex h-full items-center justify-center gap-x-2",children:[s&&(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{children:(0,a.jsx)(ea.A,{size:14,strokeWidth:2,className:"text-brand rotate-45"})}),(0,a.jsx)(T.ZI,{side:"bottom",children:"Primary key"})]}),(0,a.jsx)("span",{className:"text-xs truncate",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-foreground-light font-normal",children:e.format})]}),renderCell:t=>{let{column:n,row:l}=t,s=l[n.name],r="bytea"===e.format?(0,C.ds)(s):s;return(0,a.jsx)("div",{className:(0,m.cn)("flex items-center h-full w-full whitespace-pre",null===r&&"text-foreground-lighter"),children:null===r?"NULL":r})}}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"px-2 py-2 text-xs text-foreground-light border-b",children:["Referencing record from"," ",(0,a.jsxs)("span",{className:"text-foreground",children:[s.schema,".",s.name]}),":"]}),(0,a.jsx)(el.Ay,{className:"h-32 rounded-b border-0",columns:g,rows:null!=(n=null==d?void 0:d.rows)?n:[],onCellDoubleClick:(e,t)=>{t.preventDefault(),t.stopPropagation()},renderers:{noRowsFallback:(0,a.jsxs)("div",{className:"w-96 px-2",children:[f&&(0,a.jsx)("div",{className:"py-2",children:(0,a.jsx)(et.Ay,{})}),p&&(0,a.jsxs)("p",{className:"text-foreground-light",children:["Failed to find referencing row: ",u.message]}),h&&(0,a.jsx)("p",{className:"text-foreground-light",children:"No results were returned"})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"ReferenceRecordPeek.tsx"}),(0,a.jsx)("div",{className:"flex items-center justify-end px-2 py-1",children:(0,a.jsx)(es.tv,{href:"/project/".concat(o,"/editor/").concat(s.id,"?schema=").concat(s.schema,"&filter=").concat(r,"%3Aeq%3A").concat(i),projectRef:o,id:String(s.id),filters:[{column:r,operator:"=",value:String(i)}],"data-sentry-element":"EditorTablePageLink","data-sentry-source-file":"ReferenceRecordPeek.tsx",children:(0,a.jsx)(x.$,{type:"default","data-sentry-element":"Button","data-sentry-source-file":"ReferenceRecordPeek.tsx",children:"Open table"})})})]})},eo=e=>{var t,n,l;let{tableId:s,row:r,column:i}=e,{data:o}=(0,E.YA)(),{data:c,isLoading:d}=(0,S.Pk)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,id:s}),m=null==c?void 0:c.columns.find(e=>e.name===i.key),x=(0,A.KO)(c)?c:void 0,h=(null!=(t=null==x?void 0:x.relationships)?t:[]).find(e=>e.source_schema===(null==x?void 0:x.schema)&&e.source_table_name===(null==x?void 0:x.name)&&e.source_column_name===i.name),{data:p,isLoading:f}=(0,en.L)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,schema:null!=(n=null==h?void 0:h.target_table_schema)?n:"",name:null!=(l=null==h?void 0:h.target_table_name)?l:""},{enabled:!!(null==o?void 0:o.ref)&&!!(null==h?void 0:h.target_table_schema)&&!!(null==h?void 0:h.target_table_name)}),y=r[i.key],g=(null==m?void 0:m.format)==="bytea"&&y?(0,C.ds)(y):y;return(0,a.jsxs)("div",{className:"sb-grid-foreign-key-formatter flex justify-between","data-sentry-component":"ForeignKeyFormatter","data-sentry-source-file":"ForeignKeyFormatter.tsx",children:[(0,a.jsx)("span",{className:"sb-grid-foreign-key-formatter__text",children:null===g?(0,a.jsx)(L.X,{}):g}),d&&null!==g&&(0,a.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:(0,a.jsx)(et.Ay,{className:"w-4 h-4"})}),!d&&void 0!==h&&null!==g&&(0,a.jsxs)(a.Fragment,{children:[f&&(0,a.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:(0,a.jsx)(et.Ay,{className:"w-4 h-4"})}),!f&&void 0!==p&&(0,a.jsxs)(u.AM,{children:[(0,a.jsx)(u.Wv,{asChild:!0,children:(0,a.jsx)(ee.G,{type:"default",className:"w-6 h-6",icon:(0,a.jsx)(X.A,{}),onClick:e=>e.stopPropagation(),tooltip:{content:{side:"bottom",text:"View referencing record"}}})}),(0,a.jsx)(u.hl,{portal:!0,align:"end",className:"p-0 w-96",children:(0,a.jsx)(ei,{table:p,column:h.target_column_name,value:g})})]})]})]})},ec=e=>{let t=e.row[e.column.key];if(null===t)return(0,a.jsx)(L.X,{});if(""===t)return(0,a.jsx)(q,{});if("string"==typeof t&&t.endsWith("..."))return(0,a.jsx)(a.Fragment,{children:t});try{let e=JSON.parse(t);return(0,a.jsx)(a.Fragment,{children:JSON.stringify(e)})}catch(e){return(0,a.jsx)(a.Fragment,{children:JSON.stringify(t)})}};var ed=n(90376),eu=n(71344);let em={key:l.Hy,name:"",idx:999,width:100,maxWidth:100,resizable:!1,sortable:!1,frozen:!1,isLastFrozenColumn:!1,renderHeaderCell:()=>(0,a.jsx)(ex,{"aria-label":"Add New Row"}),renderCell:Z,parent:void 0,level:0,minWidth:0,draggable:!1},ex=()=>{let e=(0,eu.ap)();return(0,a.jsx)("div",{className:"flex h-full w-full py-1.5 flex items-center","data-sentry-component":"AddColumnHeader","data-sentry-source-file":"AddColumn.tsx",children:(0,a.jsx)(x.$,{block:!0,type:"text",onClick:e.onAddColumn,icon:(0,a.jsx)(ed.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"AddColumn.tsx"})})};var eh=n(11743),ep=n(85388),ef=n(25212),ey=n(30068),eg=n(52160),ev=n(96962),ej=n(10247),eb=n(54941),eN=n(21480),ew=n(3225),eC=n(41258),eS=n(33922),eA=n(53005);let ek=e=>{let{column:t,isEncrypted:n}=e,l=(0,eu.ap)(),s=(0,ej.Ir)(),{sorts:r,addOrUpdateSort:i,removeSort:o}=(0,eA.G)(),d=t.key;function u(){s.freezeColumn(d)}function p(){s.unfreezeColumn(d)}function f(){let e=s.originalTable.columns.find(e=>e.name===t.name);e&&l.onEditColumn(e)}function y(){let e=s.originalTable.columns.find(e=>e.name===t.name);e&&l.onDeleteColumn(e)}function g(e){if(!d)return;let t=r.find(e=>e.column===d);t&&t.ascending===e?o(d):i(d,e)}return t.name,(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(h.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"ColumnMenu.tsx",children:[(0,a.jsx)(h.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"ColumnMenu.tsx",children:(0,a.jsx)(x.$,{className:"opacity-50 flex",type:"text",style:{padding:"3px"},onClick:e=>{e.stopPropagation()},icon:(0,a.jsx)(c.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"ColumnMenu.tsx"})}),(0,a.jsx)(h.SQ,{align:"end",side:"bottom","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"ColumnMenu.tsx",children:function(){let e=r.find(e=>e.column===d);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h._2,{className:(0,m.cn)("space-x-2",(null==e?void 0:e.ascending)&&"bg-surface-200 dark:bg-surface-400 text-foreground"),onClick:()=>g(!0),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ColumnMenu.tsx",children:[(0,a.jsx)(eb.A,{size:14,strokeWidth:(null==e?void 0:e.ascending)?3:1.5,"data-sentry-element":"ArrowUp","data-sentry-source-file":"ColumnMenu.tsx"}),(0,a.jsx)("span",{children:"Sort Ascending"})]}),(0,a.jsxs)(h._2,{className:(0,m.cn)("space-x-2",e&&!e.ascending&&"bg-surface-200 dark:bg-surface-400 text-foreground"),onClick:()=>g(!1),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ColumnMenu.tsx",children:[(0,a.jsx)(eN.A,{size:14,strokeWidth:e&&!e.ascending?3:1.5,"data-sentry-element":"ArrowDown","data-sentry-source-file":"ColumnMenu.tsx"}),(0,a.jsx)("span",{children:"Sort Descending"})]}),s.editable&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.mB,{}),(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{asChild:!0,className:"".concat(n?"opacity-50":""),children:(0,a.jsxs)(h._2,{className:"space-x-2",onClick:f,disabled:n,children:[(0,a.jsx)(ew.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("span",{children:"Edit column"})]})}),n&&(0,a.jsx)(T.ZI,{side:"bottom",children:"Encrypted columns cannot be edited"})]})]}),(0,a.jsx)(h._2,{className:"space-x-2",onClick:t.frozen?p:u,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ColumnMenu.tsx",children:t.frozen?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eC.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("span",{children:"Unfreeze column"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eh.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("span",{children:"Freeze column"})]})}),s.editable&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.mB,{}),(0,a.jsxs)(h._2,{className:"space-x-2",onClick:y,children:[(0,a.jsx)(eS.A,{size:14,className:"text-destructive"}),(0,a.jsx)("span",{children:"Delete column"})]})]})]})}()})]})})};function eE(e){var t,n;let{column:l,columnType:s,isPrimaryKey:r,isEncrypted:i,format:o,foreignKey:c}=e,u=(0,d.useRef)(null),m=l.idx,x=l.key,h=(t=s,n=o,"array"==t?"".concat(n.replace("_",""),"[]"):n),p=(0,ej.Ir)(),f=l.name;(0,d.useEffect)(()=>{p.gridColumns[m].key!=x&&p.updateColumnIdx(x,m)},[x,m,p.gridColumns]);let[{isDragging:y},g]=(0,ef.i)({type:"column-header",item:()=>({key:x,index:m}),canDrag:()=>!l.frozen,collect:e=>({isDragging:e.isDragging()})}),[{handlerId:v},j]=(0,ey.H)({accept:"column-header",collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){var n;if(!u.current||l.frozen)return;let a=e.index,s=e.key;if(a===m)return;let r=null==(n=u.current)?void 0:n.getBoundingClientRect(),i=(r.right-r.left)/2,o=t.getClientOffset().x-r.left;(!(a<m)||!(o<i))&&(a>m&&o>i||(p.moveColumn(s,x),e.index=m))}}),b=l.frozen?"sb-grid-column-header--cursor":"";return g(j(u)),(0,a.jsx)("div",{ref:u,"data-handler-id":v,style:{opacity:+!y},className:"w-full","data-sentry-component":"ColumnHeader","data-sentry-source-file":"ColumnHeader.tsx",children:(0,a.jsxs)("div",{className:"sb-grid-column-header ".concat(b),children:[(0,a.jsxs)("div",{className:"sb-grid-column-header__inner",children:[function(e,t){let{name:n,foreignKey:l}=t;return"foreign_key"===e?(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{children:(0,a.jsx)(ep.A,{size:14,strokeWidth:2})}),(0,a.jsx)(T.ZI,{side:"bottom",children:(0,a.jsxs)("div",{className:"font-normal",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("p",{className:"text-xs !text-foreground",children:n}),(0,a.jsx)(X.A,{size:14,strokeWidth:1.5,className:"!text-foreground-light"}),(0,a.jsxs)("p",{className:"text-xs !text-foreground",children:[null==l?void 0:l.targetTableSchema,".",null==l?void 0:l.targetTableName,".",null==l?void 0:l.targetColumnName]})]}),(null==l?void 0:l.updateAction)!==ev.P.NO_ACTION&&(0,a.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On update: ",(0,eg.Er)(null==l?void 0:l.updateAction)]}),(null==l?void 0:l.deletionAction)!==ev.P.NO_ACTION&&(0,a.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On delete: ",(0,eg.Er)(null==l?void 0:l.deletionAction)]})]})})]}):null}(s,{name:l.name,foreignKey:c}),r&&(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{children:(0,a.jsx)("div",{className:"sb-grid-column-header__inner__primary-key",children:(0,a.jsx)(ea.A,{size:14,strokeWidth:2})})}),(0,a.jsx)(T.ZI,{side:"bottom",className:"font-normal",children:"Primary key"})]}),(0,a.jsx)("span",{className:"sb-grid-column-header__inner__name",title:f,children:l.name}),(0,a.jsxs)("span",{className:"sb-grid-column-header__inner__format",children:[h,"bytea"===h?" (hex)":""]}),i&&(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{children:(0,a.jsx)(eh.A,{size:14,strokeWidth:2})}),(0,a.jsx)(T.ZI,{side:"bottom",className:"font-normal",children:"Encrypted column"})]})]}),(0,a.jsx)(ek,{column:l,isEncrypted:i,"data-sentry-element":"ColumnMenu","data-sentry-source-file":"ColumnHeader.tsx"})]})})}var e_=n(61113);let eR={key:l.od,name:"",idx:0,width:65,maxWidth:65,resizable:!1,sortable:!1,frozen:!0,isLastFrozenColumn:!1,renderHeaderCell:e=>{let[t,n]=(0,el.Uk)();return(0,a.jsx)(eL,{"aria-label":"Select All",tabIndex:e.tabIndex,value:t,onChange:e=>n({type:"HEADER",checked:e})})},renderCell:e=>{let[t,n]=(0,el.Uk)();return(0,a.jsx)(eP,{"aria-label":"Select",tabIndex:e.tabIndex,value:t,row:e.row,onChange:(t,a)=>{n({type:"ROW",row:e.row,checked:t,isShiftClick:a})},onClick:eT})},renderGroupCell:e=>{let[t,n]=(0,el.Uk)();return(0,a.jsx)(eP,{"aria-label":"Select Group",tabIndex:e.tabIndex,value:t,onChange:t=>{n({type:"ROW",row:e.row,checked:t,isShiftClick:!1})},onClick:eT})},parent:void 0,level:0,minWidth:0,draggable:!1};function eT(e){e.stopPropagation()}function eP(e){let{row:t,value:n,tabIndex:l,disabled:s,onClick:r,onChange:i,"aria-label":o,"aria-labelledby":c}=e,d=(0,eu.ap)();return(0,a.jsxs)("div",{className:"sb-grid-select-cell__formatter","data-sentry-component":"SelectCellFormatter","data-sentry-source-file":"SelectColumn.tsx",children:[(0,a.jsx)("input",{"aria-label":o,"aria-labelledby":c,tabIndex:l,type:"checkbox",className:"rdg-row__select-column__select-action",disabled:s,checked:n,onChange:function(e){i(e.target.checked,e.nativeEvent.shiftKey)},onClick:r}),t&&(0,a.jsx)(ee.G,{type:"text",size:"tiny",className:"px-1 rdg-row__select-column__edit-action",icon:(0,a.jsx)(e_.A,{}),onClick:function(e){e.stopPropagation(),t&&d.onEditRow(t)},tooltip:{content:{side:"bottom",text:"Expand row"}}})]})}function eL(e){let{disabled:t,tabIndex:n,value:l,onChange:s,onClick:r,"aria-label":i,"aria-labelledby":o}=e,c=(0,ej.Ir)(),u=(0,d.useRef)(null),m=c.selectedRows.size>0&&!c.allRowsSelected;return(0,d.useEffect)(()=>{u.current&&(u.current.indeterminate=m)},[m]),(0,a.jsx)("div",{className:"sb-grid-select-cell__header","data-sentry-component":"SelectCellHeader","data-sentry-source-file":"SelectColumn.tsx",children:(0,a.jsx)("input",{ref:u,"aria-label":i,"aria-labelledby":o,tabIndex:n,type:"checkbox",className:"sb-grid-select-cell__header__input",disabled:t,checked:l,onChange:function(e){s(e.target.checked,e.nativeEvent.shiftKey)},onClick:r})})}var eI=n(28436);let eF=9;function eD(e,t){let n=[eR,...e.columns.map((e,n)=>{var s;let i=function(e){if((0,eI.e2)(e))return"foreign_key";if((0,eI.n0)(e.dataType))return"number";if((0,eI.ao)(e.dataType))return"array";if((0,eI.Lj)(e.dataType))return"json";if((0,eI.cx)(e.dataType))return"text";else if((0,eI._c)(e.format))return"citext";else if((0,eI.hB)(e.format))return"date";else if((0,eI.I)(e.format))return"time";else if((0,eI.KV)(e.format))return"datetime";else if((0,eI.th)(e.dataType))return"boolean";else if((0,eI.AM)(e.dataType))return"enum";else if((0,eI.yB)(e.dataType))return"binary";else return"unknown"}(e),o=eO(e),c=(e.name.length+e.format.length)*eF,d=(null==t?void 0:t.defaultWidth)?t.defaultWidth:o<c?c:o;return{key:e.name,name:e.name,idx:n+1,resizable:!0,sortable:!0,width:d,minWidth:l.T_,frozen:e.isPrimaryKey||!1,isLastFrozenColumn:!1,renderHeaderCell:t=>(0,a.jsx)(eE,{...t,columnType:i,isPrimaryKey:e.isPrimaryKey,isEncrypted:e.isEncrypted,format:e.format,foreignKey:e.foreignKey}),renderEditCell:t?function(e,t,n,l,s){if(!n)if(["array","json"].includes(t))return e=>(0,a.jsx)(D,{...e,isEditable:n,onExpandEditor:l});else if(!["number","boolean"].includes(t))return e=>(0,a.jsx)(B,{...e,isEditable:n,onExpandEditor:s});else return;if(!e.isPrimaryKey&&e.isUpdatable)switch(t){case"boolean":return t=>(0,a.jsx)(r,{...t,isNullable:e.isNullable});case"date":return j("date",e.isNullable||!1);case"datetime":return e.format.endsWith("z")?j("datetimetz",e.isNullable||!1):j("datetime",e.isNullable||!1);case"time":return e.format.endsWith("z")?J:$;case"enum":{let t=e.enum.map(e=>({label:e,value:e}));return n=>(0,a.jsx)(K,{...n,options:t,isNullable:e.isNullable})}case"array":case"json":return e=>(0,a.jsx)(D,{...e,onExpandEditor:l});case"number":return z;case"citext":case"text":return t=>(0,a.jsx)(B,{...t,isEditable:n,isNullable:e.isNullable,onExpandEditor:s});default:return}}(e,i,null!=(s=null==t?void 0:t.editable)&&s,t.onExpandJSONEditor,t.onExpandTextEditor):void 0,renderCell:function(e,t,n){switch(t){case"boolean":return G;case"foreign_key":if(!e.isUpdatable)return Z;return e=>(0,a.jsx)(eo,{...e,tableId:n.tableId});case"binary":return Q;case"json":return ec;default:return Z}}(e,i,{tableId:null==t?void 0:t.tableId}),parent:void 0,level:0,maxWidth:void 0,draggable:!1}})];return(null==t?void 0:t.onAddColumn)&&n.push(em),n}function eO(e){return(0,eI.n0)(e.dataType)?120:(0,eI.KV)(e.format)||(0,eI.hB)(e.format)||(0,eI.I)(e.format)?150:(0,eI.th)(e.dataType)?120:(0,eI.AM)(e.dataType)?150:250}},30881:(e,t,n)=>{n.d(t,{C:()=>o,e:()=>c});var a=n(80263),l=n(96962),s=n(62284),r=n(30404),i=n(52160);let o=e=>e.map(e=>({id:e.id,name:e.constraint_name,tableId:e.target_id,schema:e.target_schema,table:e.target_table,columns:e.source_columns.map((t,n)=>({source:t,target:e.target_columns[n]})),deletionAction:e.deletion_action,updateAction:e.update_action})),c=(e,t,n)=>{var o;let c="update"===e?"Updating":"Deleting",d=null!=(o=(0,i.Er)(t))?o:"No action";switch(t){case l.P.NO_ACTION:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,a.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case l.P.CASCADE:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,a.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case l.P.RESTRICT:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),(0,a.jsxs)(r.m_,{children:[(0,a.jsx)(r.k$,{className:"translate-y-[3px] mx-1",children:(0,a.jsx)(s.A,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,a.jsx)(r.ZI,{side:"bottom",className:"w-80",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})]}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,a.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",c.toLowerCase()]})," ","existing referencing rows from this table."]});case l.P.SET_DEFAULT:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it to their"," ",(0,a.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case l.P.SET_NULL:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it"," ",(0,a.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}}},31582:(e,t,n)=>{n.d(t,{A:()=>x,k:()=>m});var a=n(72391),l=n(51355),s=n(80210),r=n(73969),i=n(66832),o=n(59356),c=n(88403),d=n(78155),u=n(31958);async function m(e){let{projectRef:t,connectionString:n,id:l,name:s,schema:r,cascade:i=!1}=e,{sql:c}=a.A.tables.remove({name:s,schema:r},{cascade:i}),{result:d}=await (0,o.E)({projectRef:t,connectionString:n,sql:c,queryKey:["table","delete",l]});return d}let x=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)({mutationFn:e=>m(e),async onSuccess(t,n,l){let{id:s,projectRef:r,schema:o}=n;await Promise.all([a.invalidateQueries({queryKey:c.i.tableEditor(r,s)}),a.invalidateQueries({queryKey:u.v.list(r,o)}),a.invalidateQueries({queryKey:i.C.list(r)}),a.invalidateQueries({queryKey:d.k.listBySchema(r,o)})]),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to delete database table: ".concat(e.message)):t(e,n,a)},...n})}},34230:(e,t,n)=>{n.d(t,{_:()=>o});var a=n(78510),l=n(67850),s=n(24523),r=n(4328);async function i(e,t){let{projectRef:n,connectionString:l}=e;if(!n)throw Error("projectRef is required");let r=new Headers;l&&r.set("x-connection-encrypted",l);let{data:i,error:o}=await (0,s.Jt)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":l,"x-pg-application-name":a.r},path:{ref:n}},headers:r,signal:t});return o&&(0,s.H4)(o),i}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.I)({queryKey:r.b.list(t),queryFn:e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},enabled:a&&void 0!==t,...s})}},40314:(e,t,n)=>{n.d(t,{A:()=>y});var a=n(80263),l=n(47023),s=n(11203),r=n.n(s),i=n(53239),o=n(23157),c=n(15471),d=n(50298),u=n(7981),m=n(80100),x=n(7760);let h=(0,i.createContext)({onChange:e=>{},selected:void 0});var p=n(23892);function f(e){let{children:t,className:n,buttonClassName:s,descriptionText:p,error:f,icon:y,id:g="",name:v="",label:j,labelOptional:b,layout:N,value:w,onChange:C,onFocus:S,onBlur:A,style:k,size:E="medium",defaultValue:_,validation:R,disabled:T,optionsWidth:P}=e,[L,I]=(0,i.useState)(void 0),[F,D]=(0,i.useState)({}),O=(0,u.A)("listbox"),z=(0,i.useRef)(null),{formContextOnChange:K,values:M,errors:q,handleBlur:B,touched:U,fieldLevelValidation:Y}=(0,x.x)();M&&!w&&(w=M[g||v],_=M[g||v]),f||(q&&!f&&(f=q[g||v]),f=U&&U[g||v]?f:void 0),(0,i.useEffect)(()=>{void 0!==w&&I(w)},[w]),(0,i.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(P||(null==(e=z.current)?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,i.useEffect)(()=>{var e;let n=r()(t);function a(e){return n.find(t=>t.props.value===e)}if(w){I(w);let e=a(w);D((null==e?void 0:e.props)?e.props:void 0);return}if(L){let e=a(L);D((null==e?void 0:e.props)?e.props:void 0);return}if(_){I(_);let e=a(L);D((null==e?void 0:e.props)?e.props:void 0);return}D(null==(e=n[0])?void 0:e.props)},[L]);let W=[O.container,O.base,s],V=[O.addOnBefore];return f&&W.push(O.variants.error),f||W.push(O.variants.standard),y&&V.push(O.with_icon),E&&W.push(O.size[E]),T&&W.push(O.disabled),(0,a.jsx)(o.H,{label:j,labelOptional:b,layout:N,id:g,error:f,descriptionText:p,className:n,style:k,size:E,"data-sentry-element":"FormLayout","data-sentry-component":"Listbox","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsxs)(l.bL,{"data-sentry-element":"DropdownMenuPrimitive.Root","data-sentry-source-file":"Listbox2.tsx",children:[(0,a.jsx)(l.l9,{asChild:!0,disabled:T,"data-sentry-element":"DropdownMenuPrimitive.Trigger","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsxs)("button",{"data-size":E,ref:z,className:(0,m.cn)(W),onBlur:function(e){B&&B(e),A&&A(e)},onFocus:S,name:v,id:g,children:[(0,a.jsxs)("span",{className:(0,m.cn)(V),children:[y&&(0,a.jsx)(d.A,{size:E,icon:y}),(null==F?void 0:F.addOnBefore)&&(0,a.jsx)(F.addOnBefore,{}),(0,a.jsx)("span",{className:O.label,children:null==F?void 0:F.label})]}),(0,a.jsx)("span",{className:O.chevron_container,children:(0,a.jsx)("svg",{className:O.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-sentry-element":"svg","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd","data-sentry-element":"path","data-sentry-source-file":"Listbox2.tsx"})})}),f&&(0,a.jsx)("div",{className:O.actions_container,children:f&&(0,a.jsx)(c.A,{size:E})})]})}),(0,a.jsx)(l.UC,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:O.options_container,"data-sentry-element":"DropdownMenuPrimitive.Content","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsx)("div",{children:(0,a.jsx)(h.Provider,{value:{onChange:function(e){C&&C(e),I(e);let t={};t.target={type:"select",name:v,id:g,value:e,checked:void 0},K&&K(t),R&&Y(g,R(e))},selected:L},"data-sentry-element":"SelectContext.Provider","data-sentry-source-file":"Listbox2.tsx",children:t})})})]})})}f.Option=function(e){let{id:t,value:n,label:s,disabled:r=!1,children:i,className:o="",addOnBefore:c}=e,d=(0,u.A)("listbox");return(0,a.jsx)(h.Consumer,{"data-sentry-element":"SelectContext.Consumer","data-sentry-component":"SelectOption","data-sentry-source-file":"Listbox2.tsx",children:e=>{let{onChange:s,selected:u}=e,x=u===n;return(0,a.jsxs)(l.q7,{className:(0,m.cn)(d.option,x?d.option_active:" ",r?d.option_disabled:" ",o),onSelect:()=>r?{}:s(n),children:[(0,a.jsxs)("div",{className:d.option_inner,children:[c&&c({active:x,selected:u}),(0,a.jsx)("span",{children:"function"==typeof i?i({active:x,selected:u}):i})]}),x?(0,a.jsx)("span",{className:(0,m.cn)(d.option_check,x?d.option_check_active:""),children:(0,a.jsx)(p.A,{className:d.option_check_icon,"aria-hidden":"true"})}):null]},t)}})};let y=f},41578:(e,t,n)=>{n.d(t,{b:()=>g});var a=n(80263),l=n(84305),s=n.n(l),r=n(75590),i=n(90376),o=n(53239),c=n(10247),d=n(61548),u=n(99779),m=n(76174),x=n(68152),h=n(47773),p=n(80421),f=n(71526);let y=(0,o.memo)(e=>{var t,n;let{filter:l,filterIdx:s,onChange:r,onDelete:i,onKeyDown:o}=e,d=(0,c.Ir)(),y=d.table.columns.find(e=>e.name===l.column),g=(null==(t=d.table.columns)?void 0:t.map(e=>({value:e.name,label:e.name,postLabel:e.dataType})))||[],v=(null==y?void 0:y.format)==="timestamptz"?"yyyy-mm-dd hh:mm:ss+zz":(null==y?void 0:y.format)==="timestamp"?"yyyy-mm-dd hh:mm:ss":"Enter a value";return(0,a.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-1 px-3","data-sentry-component":"FilterRow","data-sentry-source-file":"FilterRow.tsx",children:[(0,a.jsx)(h.X,{align:"start",options:g,onSelect:e=>r(s,{...l,column:e}),"data-sentry-element":"DropdownControl","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)(u.$,{asChild:!0,type:"outline",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(m.A,{strokeWidth:1.5})}),className:"w-32 justify-start","data-sentry-element":"Button","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)("span",{children:null!=(n=null==y?void 0:y.name)?n:""})})}),(0,a.jsx)(h.X,{align:"start",options:f.D,onSelect:e=>r(s,{...l,operator:e}),"data-sentry-element":"DropdownControl","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)(u.$,{asChild:!0,type:"outline",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(m.A,{strokeWidth:1.5})}),"data-sentry-element":"Button","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)("span",{children:l.operator})})}),(0,a.jsx)(p.A,{size:"tiny",className:"w-full",placeholder:v,value:l.value,onChange:e=>r(s,{...l,value:e.target.value}),onKeyDown:o,"data-sentry-element":"Input","data-sentry-source-file":"FilterRow.tsx"}),(0,a.jsx)(u.$,{type:"text",className:"px-1",icon:(0,a.jsx)(x.A,{strokeWidth:1.5}),onClick:()=>i(s),"data-sentry-element":"Button","data-sentry-source-file":"FilterRow.tsx"})]})}),g=e=>{let{buttonText:t,filters:n,onApplyFilters:l,portal:m=!0}=e,[x,h]=(0,o.useState)(!1),p=(0,c.Ir)(),[f,g]=(0,o.useState)(n);(0,o.useMemo)(()=>{g(n)},[n]);let v=null!=t?t:n.length>0?"Filtered by ".concat(n.length," rule").concat(n.length>1?"s":""):"Filter",j=(0,o.useCallback)((e,t)=>{g(n=>[...n.slice(0,e),t,...n.slice(e+1)])},[]),b=(0,o.useCallback)(e=>{g(t=>[...t.slice(0,e),...t.slice(e+1)])},[]),N=()=>{let e=f.map(e=>{let t=p.table.columns.find(t=>t.name===e.column);return(null==t?void 0:t.format)==="uuid"?{...e,value:e.value.trim()}:e});g(e),l(e)};function w(e){"Enter"===e.key&&N()}return(0,a.jsxs)(d.AM,{open:x,onOpenChange:h,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"FilterPopoverPrimitive","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:[(0,a.jsx)(d.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:(0,a.jsx)(u.$,{type:n.length>0?"link":"text",icon:(0,a.jsx)(r.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:v})}),(0,a.jsx)(d.hl,{className:"p-0 w-96",side:"bottom",align:"start",portal:m,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:(0,a.jsxs)("div",{className:"space-y-2 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[f.map((e,t)=>(0,a.jsx)(y,{filter:e,filterIdx:t,onChange:j,onDelete:b,onKeyDown:w},"filter-".concat(e.column,"-").concat([t]))),0==f.length&&(0,a.jsxs)("div",{className:"space-y-1 px-3",children:[(0,a.jsx)("h5",{className:"text-xs text-foreground-light",children:"No filters applied to this view"}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to filter the view"})]})]}),(0,a.jsx)(d.zT,{"data-sentry-element":"PopoverSeparator_Shadcn_","data-sentry-source-file":"FilterPopoverPrimitive.tsx"}),(0,a.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[(0,a.jsx)(u.$,{icon:(0,a.jsx)(i.A,{}),type:"dashed",onClick:()=>{var e;let t=null==(e=p.table.columns[0])?void 0:e.name;t&&g([...f,{column:t,operator:"=",value:""}])},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:"Add filter"}),(0,a.jsx)(u.$,{disabled:s()(f,n),type:"default",onClick:()=>N(),"data-sentry-element":"Button","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:"Apply filter"})]})]})})]})}},41591:(e,t,n)=>{n.d(t,{M:()=>r});var a=n(53239),l=n(89388),s=n(11078);function r(){let{filters:e,setParams:t}=(0,s.o)();return{filters:(0,l.hl)(e),urlFilters:e,onApplyFilters:(0,a.useCallback)(e=>{let n=(0,l.E9)(e);t(e=>({...e,filter:n}))},[t])}}},45027:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(80263),l=n(53239),s=n(73969),r=n(79861),i=n(80421),o=n(53404),c=n(9620);let d=e=>{let{visible:t,onSuccess:n,closePanel:d}=e,{data:u}=(0,c.YA)(),[m,x]=(0,l.useState)({name:void 0}),[h,p]=(0,l.useState)(""),{mutateAsync:f,isPending:y}=(0,o.C)();(0,l.useEffect)(()=>{t&&(p(""),x({name:void 0}))},[t]);let g=async()=>{let e={};if(0===h.length&&(e.name="Please provide a name for your schema"),Object.keys(e).length>0)return x(e);if(void 0===u)return console.error("Project is required");try{await f({projectRef:u.ref,connectionString:u.connectionString,name:h}),n(h),s.oR.success('Successfully created schema "'.concat(h,'"'))}catch(e){s.oR.error("Failed to create schema: ".concat(e))}};return(0,a.jsx)(r.Ay,{size:"medium",visible:t,header:"Create a new schema",className:"transition-all duration-100 ease-in",onCancel:d,onConfirm:g,loading:y,cancelText:"Cancel",confirmText:"Save","data-sentry-element":"SidePanel","data-sentry-component":"SchemaEditor","data-sentry-source-file":"SchemaEditor.tsx",children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(r.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SchemaEditor.tsx",children:(0,a.jsx)("div",{className:"space-y-10 py-6",children:(0,a.jsx)(i.A,{label:"Schema name",layout:"vertical",type:"text",error:null==m?void 0:m.name,value:h,onChange:e=>p(e.target.value),"data-sentry-element":"Input","data-sentry-source-file":"SchemaEditor.tsx"})})})})},"SchemaEditor")}},46548:(e,t,n)=>{n.d(t,{c2:()=>o});var a=n(80210),l=n(73969),s=n(76984),r=n(59356);async function i(e){let{projectRef:t,connectionString:n,table:a,column:l,pkMatch:i}=e,o=function(e){var t;let{table:n,column:a,pkMatch:l}=e;return new s.Query().from(n.name,null!=(t=n.schema)?t:void 0).select('"'.concat(a,'"')).match(l).toSql()}({table:a,column:l,pkMatch:i}),{result:c}=await (0,r.E)({projectRef:t,connectionString:n,sql:o});return null==c?void 0:c[0][l]}let o=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.n)({mutationFn:e=>i(e),async onSuccess(t,n,a){await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.oR.error(e.message):t(e,n,a)},...n})}},47773:(e,t,n)=>{n.d(t,{X:()=>r});var a=n(80263),l=n(13916),s=n(21162);let r=e=>{let{children:t,side:n,align:r,options:i,onSelect:o,className:c}=e;return(0,a.jsxs)(s.rI,{"data-sentry-element":"DropdownMenu","data-sentry-component":"DropdownControl","data-sentry-source-file":"DropdownControl.tsx",children:[(0,a.jsx)(s.ty,{className:c,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DropdownControl.tsx",children:t}),(0,a.jsx)(s.SQ,{side:n,align:r,"data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DropdownControl.tsx",children:(0,a.jsxs)("div",{className:"dropdown-control",style:{maxHeight:"30vh"},children:[0===i.length&&(0,a.jsx)("p",{className:"dropdown-control__empty-text",children:"No more items"}),i.map(e=>(0,a.jsx)(l.x,{disabled:e.disabled,tooltip:{content:{side:"right",text:e.tooltip}},onClick:()=>o(e.value),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.preLabel&&(0,a.jsx)("span",{className:"grow text-foreground-lighter",children:e.preLabel}),(0,a.jsx)("span",{children:e.label}),e.postLabel&&(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.postLabel})]})},e.value))]})})]})}},48564:(e,t,n)=>{n.d(t,{Hw:()=>i});var a=n(67850),l=n(59356),s=n(32510);async function r(e,t){let{projectRef:n,connectionString:a,schema:s}=e,r=(e=>{let{schema:t}=e;if(!t)throw Error("schema is required");return"\nSELECT \n  con.oid as id, \n  con.conname as constraint_name, \n  con.confdeltype as deletion_action,\n  con.confupdtype as update_action,\n  rel.oid as source_id,\n  nsp.nspname as source_schema, \n  rel.relname as source_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.conkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = rel.oid\n  ) source_columns, \n  frel.oid as target_id,\n  fnsp.nspname as target_schema, \n  frel.relname as target_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.confkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = frel.oid\n  ) target_columns \nFROM \n  pg_constraint con \n  INNER JOIN pg_class rel ON rel.oid = con.conrelid \n  INNER JOIN pg_namespace nsp ON nsp.oid = rel.relnamespace \n  INNER JOIN pg_class frel ON frel.oid = con.confrelid \n  INNER JOIN pg_namespace fnsp ON fnsp.oid = frel.relnamespace \nWHERE \n  con.contype = 'f'\n  AND nsp.nspname = '".concat(t,"'\n").trim()})({schema:s}),{result:i}=await (0,l.E)({projectRef:n,connectionString:a,sql:r,queryKey:["foreign-key-constraints",s]},t);return(null!=i?i:[]).map(e=>({...e,source_columns:e.source_columns.replace("{","").replace("}","").split(","),target_columns:e.target_columns.replace("{","").replace("}","").split(",")}))}let i=function(e){let{projectRef:t,connectionString:n,schema:l}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:s.c.foreignKeyConstraints(t,l),queryFn:e=>{let{signal:a}=e;return r({projectRef:t,connectionString:n,schema:l},a)},enabled:i&&void 0!==t&&void 0!==l,...o})}},49523:(e,t,n)=>{n.d(t,{Ay:()=>u});var a=n(80263),l=n(53239),s=n(23157),r=n(15471),i=n(50298),o=n(7981),c=n(7760);function d(e){let{autoComplete:t,autofocus:n,children:d,className:u,descriptionText:m,disabled:x,error:h,icon:p,id:f="",inputRef:y,label:g,afterLabel:v,beforeLabel:j,labelOptional:b,layout:N,name:w="",onChange:C,onBlur:S,placeholder:A,required:k,value:E,defaultValue:_,style:R,size:T="medium",borderless:P=!1,validation:L,...I}=e,{formContextOnChange:F,values:D,errors:O,handleBlur:z,touched:K,fieldLevelValidation:M}=(0,c.x)();D&&!E&&(E=D[f]),h||(O&&!h&&(h=O[f||w]),h=K&&K[f||w]?h:void 0),(0,l.useEffect)(()=>{L&&M(f,L(E))},[]);let q=(0,o.A)("select"),B=[q.container];u&&B.push(u);let U=[q.base];return h&&U.push(q.variants.error),h||U.push(q.variants.standard),p&&U.push(q.with_icon),T&&U.push(q.size[T]),x&&U.push(q.disabled),(0,a.jsx)(s.H,{label:g,afterLabel:v,beforeLabel:j,labelOptional:b,layout:N,id:f,error:h,descriptionText:m,className:u,style:R,size:T,"data-sentry-element":"FormLayout","data-sentry-component":"Select","data-sentry-source-file":"Select.tsx",children:(0,a.jsxs)("div",{className:q.container,children:[(0,a.jsx)("select",{id:f,name:w,"data-size":T,defaultValue:_,autoComplete:t,autoFocus:n,className:U.join(" "),onChange:function(e){C&&C(e),F&&F(e),L&&M(f,L(e.target.value))},onBlur:function(e){z&&z(e),S&&S(e)},ref:y,value:E,disabled:x,required:k,placeholder:A,...I,children:d}),p&&(0,a.jsx)(i.A,{size:T,icon:p}),h&&(0,a.jsx)("div",{className:q.actions_container,children:h&&(0,a.jsx)(r.A,{size:T})}),(0,a.jsx)("span",{className:q.chevron_container,children:(0,a.jsx)("svg",{className:q.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-sentry-element":"svg","data-sentry-source-file":"Select.tsx",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd","data-sentry-element":"path","data-sentry-source-file":"Select.tsx"})})})]})})}d.Option=function(e){let{value:t,children:n,selected:l}=e;return(0,a.jsx)("option",{value:t,selected:l,"data-sentry-component":"Option","data-sentry-source-file":"Select.tsx",children:n})},d.OptGroup=function(e){let{label:t,children:n}=e;return(0,a.jsx)("optgroup",{label:t,"data-sentry-component":"OptGroup","data-sentry-source-file":"Select.tsx",children:n})};let u=d},50523:(e,t,n)=>{n.d(t,{Pz:()=>w,d2:()=>j,wg:()=>b});var a=n(80263),l=n(53434),s=n.n(l),r=n(14685),i=n.n(r),o=n(86926),c=n.n(o),d=n(86510),u=n(52555),m=n.n(u),x=n(77191),h=n.n(x),p=n(73969),f=n(85039),y=n(6436),g=n(99779),v=n(62288);let j=e=>{let t={};return new Promise(n=>{h().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:e=>{let a=e.meta.fields||[],l=e.data,s=e.errors;a.forEach(n=>{let a=N(n,e.data);i()(t,n)?t[n]!==a&&(t[n]="text"):t[n]=a}),n({headers:a,rows:l,previewRows:e.data.slice(0,20),columnTypeMap:t,errors:s})}})})},b=(e,t)=>{let n=[],a=0,l=0,s=[],r={},o=[];return new Promise(c=>{h().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:262144,chunk:c=>{if((n=c.meta.fields).forEach(e=>{let t=N(e,c.data);i()(r,e)?r[e]!==t&&(r[e]="text"):r[e]=t}),l+=c.data.length,s=c.data.slice(0,20),c.errors.length>0){let e=c.errors.map(e=>{if(e)return{...e,data:c.data[e.row]}});o.push(...e)}let d=262144*(a+=1)/e.size;t(d>1?100:Number((100*d).toFixed(2)))},complete:()=>{c({headers:n,rowCount:l,previewRows:s,columnTypeMap:r,errors:o})}})})},N=(e,t)=>{if(0===t.length)return"text";let n=t[0][e],a=t.map(t=>t[e]);if(null==n)return"text";if(Number(n)){let n=t.map(t=>Number(t[e]));return n.includes(NaN)?"text":n.map(e=>e%1).every(e=>0===e)?"int8":"float8"}return c()(["true","false"],n.toString().toLowerCase())&&a.every(e=>null==e||c()(["true","false"],e.toString().toLowerCase()))?"bool":(0,y.Bl)(n)&&a.every(e=>(0,y.Bl)(n))?"jsonb":Date.parse(n)&&a.every(e=>s()(e,"YYYY-MM-DD hh:mm:ss").isValid())?"timestamptz":"text"};function w(e){return e&&v.Fg.includes(e.type)&&(e=>{let t=null==e?void 0:e.name.split(".").pop().toLowerCase();return v.M0.includes(t)})(e)?e.size>v.h$&&(p.oR.error((0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{children:"The dashboard currently only supports importing of CSVs below 100MB."}),(0,a.jsx)("p",{children:"For bulk data loading, we recommend doing so directly through the database."}),(0,a.jsx)(g.$,{asChild:!0,type:"default",icon:(0,a.jsx)(d.A,{}),className:"!mt-2",children:(0,a.jsx)(m(),{href:"".concat(f.aq,"/guides/database/tables#bulk-data-loading"),target:"_blank",rel:"noreferrer",children:"Learn more"})})]}),{duration:1/0}),!0):(p.oR.error("Couldn't import file: only CSV files are accepted"),!0)}},52160:(e,t,n)=>{n.d(t,{Eb:()=>c,Er:()=>f,MG:()=>x,Oj:()=>u,Pe:()=>y,f9:()=>m,h6:()=>d});var a=n(70350),l=n.n(a),s=n(96962),r=n(6436),i=n(73969);let o=e=>{if(["CURRENT_DATE"].includes(e)||"("===e[0]&&")"===e[e.length-1])return!0;let t=e.indexOf("("),n=e.indexOf(")");return!(e.indexOf(" ")>=0)&&!!(t>=0)&&!!(n>t)},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{name:t,table:n,schema:a,format:l}=e;return{id:(0,r.gZ)(),name:t||"",table:n||"",schema:a||"",comment:"",format:l||"",defaultValue:null,foreignKey:void 0,check:null,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}},d=(e,t,n)=>{var a;let{primary_keys:l}=t,s=l.map(e=>e.name),i=h(e,t,n),o=(null==e?void 0:e.data_type)==="ARRAY";return{foreignKey:i,id:null!=(a=null==e?void 0:e.id)?a:(0,r.gZ)(),table:e.table,schema:e.schema,name:e.name,comment:null==e?void 0:e.comment,format:o?e.format.slice(1):e.format,defaultValue:null==e?void 0:e.default_value,check:e.check,isArray:o,isNullable:e.is_nullable,isIdentity:e.is_identity,isUnique:e.is_unique,isNewColumn:!1,isEncrypted:!1,isPrimaryKey:s.includes(e.name)}},u=(e,t)=>{var n,a;let s=!!t.format.includes("int")&&t.isIdentity,r=t.defaultValue;return{schema:e.schema,table:e.name,isIdentity:s,name:t.name.trim(),comment:null==(n=t.comment)?void 0:n.trim(),type:t.isArray?"".concat(t.format,"[]"):t.format,check:(null==(a=t.check)?void 0:a.trim())||void 0,isUnique:t.isUnique,isPrimaryKey:t.isPrimaryKey,...!t.isPrimaryKey&&!s&&{isNullable:t.isNullable},...!s&&{defaultValue:t.isArray&&r?p(r):r},...!s&&r&&{defaultValueFormat:l()(r)||o(r)?"expression":"literal"}}},m=(e,t,n)=>{var a,s,r,i;let c=t.primary_keys.map(e=>e.name).includes(e.name),d=n.name.trim(),u=n.isArray?"".concat(n.format,"[]"):n.format,m=null==(a=n.comment)?void 0:a.trim(),x=null==(s=n.check)?void 0:s.trim(),h={};if(e.name.trim()!==d&&(h.name=d),(null==(r=e.comment)?void 0:r.trim())!==m&&(h.comment=m),(null==(i=e.check)?void 0:i.trim())!==x&&(h.check=x),("ARRAY"===e.data_type?"".concat(e.format.replace(/^_/,""),"[]"):e.format)!==u&&(h.type=u),e.default_value!==n.defaultValue){let e=n.defaultValue;h.defaultValue=e,h.defaultValueFormat=l()(e)||o(e)?"expression":"literal"}return e.is_identity!==n.isIdentity&&(h.isIdentity=n.isIdentity),e.is_nullable!==n.isNullable&&(h.isNullable=n.isNullable),e.is_unique!==n.isUnique&&(h.isUnique=n.isUnique),c!==n.isPrimaryKey&&(h.isPrimaryKey=n.isPrimaryKey),h},x=e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your column",i.oR.error(t.name)),0===e.format.length&&(t.format="Please select a type for your column",i.oR.error(t.format)),t},h=(e,t,n)=>{let{relationships:a}=t,l=a.find(t=>t.source_schema===e.schema&&t.source_table_name===e.table&&t.source_column_name===e.name);if(void 0===l)return l;{var r,i;let e=n.find(e=>e.id===l.id);return{...l,deletion_action:null!=(r=null==e?void 0:e.deletion_action)?r:s.P.NO_ACTION,update_action:null!=(i=null==e?void 0:e.update_action)?i:s.P.NO_ACTION}}},p=e=>e?e.replaceAll("[","{").replaceAll("]","}"):null,f=e=>{switch(e){case s.P.CASCADE:return"Cascade";case s.P.RESTRICT:return"Restrict";case s.P.SET_DEFAULT:return"Set default";case s.P.SET_NULL:return"Set NULL";default:return}},y=(e,t)=>{let n=t||"column_name";switch(e){case"int2":case"int4":case"int8":case"numeric":return'"'.concat(n,'" > 0');case"float4":case"float8":return'"'.concat(n,'" > 0.0');case"text":case"varchar":return'length("'.concat(n,'") <= 50');case"json":case"jsonb":return'jsonb_typeof("'.concat(n,"\"->'active') = 'boolean'");case"bool":return'"'.concat(n,'" in (true, false)');case"date":return'"'.concat(n,"\" > '2024-01-01'");case"time":return'"'.concat(n,"\" between '09:00:00' and '12:00:00'");case"timetz":return'"'.concat(n,"\" at time zone 'UTC' between '09:00:00+00' and '17:00:00+00'");case"uuid":return'"'.concat(n,"\" '00000000-0000-0000-0000-000000000000'");case"timestamp":return'"'.concat(n,"\" > '2023-01-01 00:00' and \"").concat(n,"\" < '2025-01-01 00:00'");case"timestamptz":return'"'.concat(n,"\" > '2023-01-01 00:00:00+00' and \"").concat(n,"\" < '2025-01-01 00:00:00+00'");default:return'length("'.concat(n,'") < 500')}}},53005:(e,t,n)=>{n.d(t,{G:()=>i});var a=n(53239),l=n(89388),s=n(11078),r=n(10247);function i(){let{sorts:e,setParams:t}=(0,s.o)(),n=(0,r.Ir)(),i=(0,a.useMemo)(()=>{var e;return(null==(e=n.table)?void 0:e.name)||""},[n]),o=(0,a.useMemo)(()=>(0,l.FU)(i,e),[i,e]),c=(0,a.useCallback)(e=>{if(!i)return console.warn("[useTableSort] Table name missing in callback, cannot apply sort correctly.");let n=e.map(e=>({...e,table:i})),a=(0,l.Aw)(n);t(e=>({...e,sort:a}))},[n,t]),d=(0,a.useCallback)((e,t)=>{if(!i||!e)return;let n=o.findIndex(t=>t.column===e),a=[...o];-1!==n?a[n]={...a[n],ascending:t}:a.unshift({table:i,column:e,ascending:t}),c(a)},[i,o,c]),u=(0,a.useCallback)(e=>{i&&e&&c(o.filter(t=>t.column!==e))},[i,o,c]);return{sorts:o,urlSorts:e,onApplySorts:c,addOrUpdateSort:d,removeSort:u}}},53404:(e,t,n)=>{n.d(t,{C:()=>d});var a=n(72391),l=n(51355),s=n(80210),r=n(73969),i=n(59356),o=n(32775);async function c(e){let{name:t,projectRef:n,connectionString:l}=e,s=a.A.schemas.create({name:t,owner:"postgres"}).sql,{result:r}=await (0,i.E)({projectRef:n,connectionString:l,sql:s,queryKey:["schema","create"]});return r}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)({mutationFn:e=>c(e),async onSuccess(t,n,l){let{projectRef:s}=n;await (0,o.Uj)(a,s),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to create schema: ".concat(e.message)):t(e,n,a)},...n})}},55108:(e,t,n)=>{n.d(t,{F2:()=>A,Gk:()=>S,MG:()=>j,Mr:()=>k,ds:()=>E,jm:()=>v});var a=n(53434),l=n.n(a),s=n(93896),r=n.n(s),i=n(84305),o=n.n(i),c=n(70350),d=n.n(c),u=n(22442),m=n.n(u),x=n(31043),h=n.n(x),p=n(1348),f=n(6436),y=n(19197),g=n(15599).Buffer;let v=(e,t,n)=>{var a;let{primary_keys:l=[]}=t,s=l.map(e=>e.name);return(null!=(a=t.columns)?a:[]).map(t=>{var a,l;let r=(e=>{let{column:t,row:n}=e;if(void 0===n)if(y.AL.includes(t.format))return null;else if("bool"!==t.format)return"";else if(t.default_value)return t.default_value;else if(t.is_nullable)return"null";else return null;return"bool"===t.format&&null===n[t.name]?"null":y.mN.includes(t.format)?w(t.format,n[t.name]):b(n[t.name],t.format)})({column:t,row:e}),i=n.find(e=>e.columns.map(e=>e.source).includes(t.name));return{value:r,foreignKey:void 0!==i?{id:i.id,constraint_name:i.name,source_schema:t.schema,source_table_name:t.table,source_column_name:t.name,target_table_schema:i.schema,target_table_name:i.table,target_column_name:null!=(l=null==(a=i.columns.find(e=>e.source===t.name))?void 0:a.target)?l:""}:void 0,id:t.id,name:t.name,comment:N(t.comment),format:t.format,enums:t.enums,defaultValue:null==t?void 0:t.default_value,isNullable:t.is_nullable,isIdentity:t.is_identity,isPrimaryKey:s.includes(t.name)}})},j=e=>{let t={};return e.forEach(e=>{var n,a,l;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(n){t[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!=(a=null==(n=e.value)?void 0:n.length)?a:0)>0){if(k(e.value))return;try{(0,f.hC)(null!=(l=e.value)?l:"")}catch(n){t[e.name]="Value is invalid JSON"}}if(e.isIdentity||e.defaultValue)return}),t},b=(e,t)=>{try{if(null===e||"string"==typeof e&&0===e.length)return e;if("number"==typeof e||!t)return e;if("bytea"===t)return E(e);else if("object"==typeof e)return JSON.stringify(e);else if("boolean"==typeof e)return e.toString();else return e}catch(t){return e}},N=e=>{var t,n;if(!e)return"";let a=r()(e.split("\n"));return 1==a.length?e:2==a.length?"".concat(a[0]," ").concat(null==(t=a[1])?void 0:t.split(".<")[0]):a.length>2?"".concat(a[0]," (").concat(a[1]," ").concat(null==(n=a[2])?void 0:n.split(".<")[0],")"):""},w=(e,t)=>{if(!t||0==t.length)return"";if(y.aw.includes(e))return l()(t).format("YYYY-MM-DDTHH:mm:ss");if(!y.mL.includes(e))return t;{let e=t&&t.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return l()(t,e).format("HH:mm:ss")}},C=(e,t)=>{if(!t||0==t.length)return null;switch(e){case"timestamptz":return l()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return l()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return l()(t,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return l()(t,"HH:mm:ss").format("HH:mm:ss");default:return t}},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return e.forEach(e=>{var t;let a=e.format.startsWith("_"),l=y.AL.includes(e.format)?e.value:0===(null!=(t=null==e?void 0:e.value)?t:"").length?null:e.value;if(a&&null!==l)n[e.name]=(0,f.Bl)(l);else if(e.format.includes("json"))"object"==typeof e.value?n[e.name]=l:m()(l)&&(n[e.name]=(0,f.Bl)(l));else if("bool"===e.format&&l)"null"===l?n[e.name]=null:n[e.name]="true"===l;else if(y.mN.includes(e.format)){let t=2===(l||"").split(":").length?"".concat(l,":00"):l;n[e.name]=C(e.format,t)}else n[e.name]=l}),t?n:h()(n,d())},A=(e,t)=>{let n=S(t,!0),a={};return Object.keys(n).forEach(l=>{let s=t.find(e=>e.name===l),r=null==s?void 0:s.format;if(void 0!==r&&y.mN.includes(r)){let t=w(r,e[l]);C(r,t)!==n[l]&&(a[l]=n[l])}else void 0!==r&&y.J_.includes(r)?k(null==s?void 0:s.value)||(a[l]=n[l]):o()(e[l],n[l])||(a[l]=n[l])}),a},k=e=>"string"==typeof e&&e.endsWith("...")&&e.length>p.SF||"string"==typeof e&&e.startsWith('["')&&e.endsWith(',"..."]')&&(e.match(/","/g)||[]).length===p.BA||"string"==typeof e&&e.startsWith('[["')||"string"==typeof e&&e.endsWith(',{"truncated":true}]'),E=e=>{try{return"\\x".concat(g.from(e.data).toString("hex"))}catch(t){return e}}},57125:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(80263),l=n(98103),s=n(61113),r=n(86510),i=n(52555),o=n.n(i),c=n(53239),d=n(99779);let u=(0,c.forwardRef)((e,t)=>{let{icon:n,title:i,description:u,url:m,urlLabel:x="Read more",defaultVisibility:h=!1,hideCollapse:p=!1,button:f,className:y="",block:g=!1}=e,[v,j]=(0,c.useState)(h);return(0,a.jsx)("div",{ref:t,role:"alert",className:"".concat(g?"block w-full":"","\n      block w-full rounded-md border bg-surface-300/25 py-3 ").concat(y),children:(0,a.jsxs)("div",{className:"flex flex-col px-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex w-full space-x-3 items-center",children:[n&&(0,a.jsx)("span",{className:"text-foreground-lighter",children:n}),(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsx)("h5",{className:"text-foreground",children:i})})]}),u&&!p?(0,a.jsx)("div",{className:"cursor-pointer text-foreground-lighter",onClick:()=>j(!v),children:v?(0,a.jsx)(l.A,{size:14,strokeWidth:1.5}):(0,a.jsx)(s.A,{size:14,strokeWidth:1.5})}):null]}),(u||m||f)&&(0,a.jsxs)("div",{className:"flex flex-col space-y-3 overflow-hidden transition-all ".concat(v?"mt-3":""),style:{maxHeight:500*!!v},children:[(0,a.jsx)("div",{className:"text-foreground-light text-sm",children:u}),m&&(0,a.jsx)("div",{children:(0,a.jsx)(d.$,{asChild:!0,type:"default",icon:(0,a.jsx)(r.A,{}),children:(0,a.jsx)(o(),{href:m,target:"_blank",rel:"noreferrer",children:x})})}),f&&(0,a.jsx)("div",{children:f})]})]})})});u.displayName="InformationBox";let m=u},60468:(e,t,n)=>{n.d(t,{Lj:()=>u,gI:()=>m});var a=n(53434),l=n.n(a),s=n(37361),r=n.n(s),i=n(53239),o=n(67267),c=n(85039),d=n(51982);l().extend(r());var u=function(e){return e.CONTROL="control",e.HIDE_BUTTON="hide-button",e.TRIGGERS="triggers",e}({});function m(e){let{projectInsertedAt:t,isTable:n=!1,isRealtimeEnabled:a=!1}=e,s=(0,d.n)(),r=(0,o.I)("realtimeButtonVariant"),u=(0,i.useRef)(!1),m=(0,i.useMemo)(()=>{if(!t)return!1;let e=l().utc(t);return!!e.isValid()&&7>l().utc().diff(e,"day")},[t]),x=(0,i.useMemo)(()=>c.pe&&n&&m&&r&&"control"!==r?r:null,[n,m,r]);return(0,i.useEffect)(()=>{if(c.pe&&!u.current&&n&&m&&t&&r){u.current=!0;try{let e=l().utc(t);if(!e.isValid())return;let n=l().utc().diff(e,"day");s("realtime_experiment_exposed",{variant:r,table_has_realtime_enabled:a,days_since_project_creation:n})}catch(e){u.current=!1}}},[n,m,r,t,a,s]),{activeVariant:x,isNewProject:m}}},62288:(e,t,n)=>{n.d(t,{Fg:()=>a,M0:()=>l,gh:()=>r,h$:()=>s});let a=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],l=["csv","tsv"],s=0x6400000,r={headers:[],rows:[],rowCount:0,columnTypeMap:{}}},76422:(e,t,n)=>{n.d(t,{oG:()=>m});var a=n(51355),l=n(80210),s=n(73969),r=n(76984),i=n(59356),o=n(99842),c=n(13693),d=n(6843);async function u(e){let{projectRef:t,connectionString:n,table:a,payload:l,configuration:s,enumArrayColumns:d,returning:u,roleImpersonationState:m}=e,x=(0,o.Nf)(function(e){var t;let{table:n,configuration:a,payload:l,returning:s=!1,enumArrayColumns:i}=e;return new r.Query().from(n.name,null!=(t=n.schema)?t:void 0).update(l,{returning:s,enumArrayColumns:i}).match(a.identifiers).toSql()}({table:a,configuration:s,payload:l,enumArrayColumns:d,returning:u}),m),{result:h}=await (0,i.E)({projectRef:t,connectionString:n,sql:x,isRoleImpersonationEnabled:(0,c._c)(null==m?void 0:m.role),queryKey:["table-row-update",a.id]});return h}let m=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,a.jE)();return(0,l.n)({mutationFn:e=>u(e),async onSuccess(t,n,a){let{projectRef:l,table:s}=n;await r.invalidateQueries({queryKey:d.j.tableRows(l,{table:{id:s.id}})}),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?s.oR.error("Failed to update table row: ".concat(e.message)):t(e,n,a)},...n})}},78155:(e,t,n)=>{n.d(t,{k:()=>a});let a={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...a.list(e),t]}},78486:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(80263),l=n(83927),s=n.n(l),r=n(53239),i=n(99779);let o=e=>{let{loading:t=!1,disableApply:n=!1,hideApply:l=!1,children:o,applyButtonLabel:c="Apply",backButtonLabel:d="Back",applyFunction:u,closePanel:m=s(),formId:x}=e,[h,p]=(0,r.useState)(!1),f=async()=>{p(!0),await new Promise(e=>u(e)),p(!1)};return(0,a.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4","data-sentry-component":"ActionBar","data-sentry-source-file":"ActionBar.tsx",children:[(0,a.jsx)(i.$,{type:"default",htmlType:"button",onClick:m,disabled:h||t,"data-sentry-element":"Button","data-sentry-source-file":"ActionBar.tsx",children:d}),o,void 0!==u?(0,a.jsx)(i.$,{onClick:f,disabled:n||h||t,loading:h||t,children:c}):l?(0,a.jsx)("div",{}):(0,a.jsx)(i.$,{disabled:t||n,loading:t,"data-testid":"action-bar-save-row",htmlType:"submit",form:x,children:c})]})}},79775:(e,t,n)=>{n.d(t,{DE:()=>c,sj:()=>i,y9:()=>r});var a=n(80263),l=n(53239),s=n(80100);let r=e=>{let{children:t,id:n,header:l,disabled:s,className:r}=e;return(0,a.jsxs)("div",{id:n,className:["grid grid-cols-12 gap-6 px-4 md:px-8 py-4 md:py-8","".concat(s?" opacity-30":" opacity-100"),"".concat(r)].join(" "),"data-sentry-component":"FormSection","data-sentry-source-file":"FormSection.tsx",children:[l,t]})},i=e=>{let{children:t,className:n="",description:l}=e;return void 0!==l?(0,a.jsxs)("div",{className:(0,s.cn)("flex flex-col space-y-2 col-span-12 lg:col-span-5",n),children:[(0,a.jsx)("label",{className:"text-foreground text-sm",children:t}),l]}):(0,a.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(n),children:t})},o=()=>(0,a.jsxs)("div",{className:"flex w-full flex-col gap-2","data-sentry-component":"Shimmer","data-sentry-source-file":"FormSection.tsx",children:[(0,a.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,a.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,a.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]}),c=e=>{let{children:t,loading:n=!0,loaders:s,fullWidth:r,className:i}=e;return(0,a.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 @lg:col-span-7\n        ".concat(r&&"!col-span-12","\n        ").concat(i,"\n      "),"data-sentry-component":"FormSectionContent","data-sentry-source-file":"FormSection.tsx",children:n?s?Array(s).fill(0).map((e,t)=>(0,a.jsx)(o,{},t)):l.Children.map(t,(e,t)=>(0,a.jsx)(o,{},t)):t})}},80869:(e,t,n)=>{n.d(t,{X:()=>l});var a=n(80263);let l=()=>(0,a.jsx)("span",{className:"null-value opacity-50","data-sentry-component":"NullValue","data-sentry-source-file":"NullValue.tsx",children:"NULL"})},81536:(e,t,n)=>{n.d(t,{p:()=>o});var a=n(67850),l=n(78510),s=n(24523),r=n(99423);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;a&&r.set("x-connection-encrypted",a);let{data:i,error:o}=await (0,s.Jt)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":a,"x-pg-application-name":l.r},path:{ref:n}},headers:Object.fromEntries(r),signal:t});return o&&(0,s.H4)(o),i}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:l=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.K.list(t),queryFn:e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},enabled:l&&void 0!==t,...s})}},83994:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(80263),l=n(80100);let s=e=>{let{max:t=100,value:n=0,barClass:s="bg-foreground",bgClass:r="",type:i="vertical",borderClass:o="",labelBottom:c="",labelBottomClass:d="tabular-nums",labelTop:u="",labelTopClass:m=""}=e;if("horizontal"===i){let e=Number(n/t*100),i=c||u;return(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[i&&(0,a.jsxs)("div",{className:"flex align-baseline justify-between pb-1 space-x-8",children:[(0,a.jsx)("p",{className:(0,l.cn)("text-foreground text-sm truncate capitalize-sentence",u.length>0&&"max-w-[75%]",d),children:c}),(0,a.jsx)("p",{className:(0,l.cn)("text-foreground-light text-sm",m),children:u})]}),(0,a.jsx)("div",{className:"relative rounded h-1 overflow-hidden w-full border p-0 ".concat(r||"bg-surface-400"," ").concat(o||"border-none"),children:(0,a.jsx)("div",{className:"absolute rounded inset-x-0 bottom-0 h-1 ".concat(s," transition-all"),style:{width:"".concat(e,"%")}})})]})}{let e=Number(n/t*35);return e<2&&(e=2),(0,a.jsx)("div",{className:"relative rounded w-5 overflow-hidden border p-1 ".concat(r||"bg-gray-400"," ").concat(o||"border-none"),style:{height:35},children:(0,a.jsx)("div",{className:"absolute inset-x-0 bottom-0 w-5 ".concat(s),style:{height:e}})})}}},88845:(e,t,n)=>{n.d(t,{F:()=>m});var a=n(80263),l=n(53239),s=n(7981),r=n(8e3),i=n(31626),o=n(60656),c=n(80356),d=n(68152);let u={danger:(0,a.jsx)(r.A,{strokeWidth:1.5,size:18}),success:(0,a.jsx)(i.A,{strokeWidth:1.5,size:18}),warning:(0,a.jsx)(o.A,{strokeWidth:1.5,size:18}),info:(0,a.jsx)(c.A,{strokeWidth:1.5,size:18}),neutral:(0,a.jsx)(a.Fragment,{})};function m(e){let{variant:t="neutral",className:n,title:r,withIcon:i,closable:o,children:c,icon:m,actions:x}=e,h=(0,s.A)("alert"),[p,f]=(0,l.useState)(!0),y=[h.base];y.push(h.variant[t].base),n&&y.push(n);let g=[h.description,h.variant[t].description],v=[h.close];return(0,a.jsx)(a.Fragment,{children:p&&(0,a.jsxs)("div",{className:y.join(" "),children:[i?(0,a.jsx)("div",{className:h.variant[t].icon,children:i&&u[t]}):null,m&&m,(0,a.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:[h.variant[t].header,h.header].join(" "),children:r}),(0,a.jsx)("div",{className:g.join(" "),children:c})]}),x]}),o&&(0,a.jsx)("button",{"aria-label":"Close alert",onClick:()=>f(!1),className:v.join(" "),children:(0,a.jsx)(d.A,{strokeWidth:2,size:16})})]})})}},90065:(e,t,n)=>{n.d(t,{H:()=>n9});var a=n(80263),l=n(51355),s=n(97344),r=n.n(s),i=n(11021),o=n.n(i),c=n(83927),d=n.n(c),u=n(53239),m=n(73969),x=n(22891),h=n(72391),p=n(80210),f=n(59356),y=n(4328);async function g(e){let{projectRef:t,connectionString:n,name:a,tables:l=[],publish_insert:s=!1,publish_update:r=!1,publish_delete:i=!1,publish_truncate:o=!1}=e,{sql:c}=h.A.publications.create({name:a,tables:l,publish_insert:s,publish_update:r,publish_delete:i,publish_truncate:o}),{result:d}=await (0,f.E)({projectRef:t,connectionString:n,sql:c,queryKey:["publication","create"]});return d}let v=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,p.n)({mutationFn:e=>g(e),async onSuccess(t,n,l){let{projectRef:s}=n;await a.invalidateQueries({queryKey:y.b.list(s)}),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?m.oR.error("Failed to create database publication: ".concat(e.message)):t(e,n,a)},...n})};var j=n(34230),b=n(15553),N=n(32510),w=n(11018),C=n(66832),S=n(88403),A=n(52641),k=n(6843),E=n(76984),_=n(36261),R=n(84512),T=n(99842),P=n(13693);async function L(e){let{projectRef:t,connectionString:n,table:a,payload:l,enumArrayColumns:s,returning:r,roleImpersonationState:i}=e,o=(0,T.Nf)(function(e){var t;let{table:n,payload:a,returning:l=!1,enumArrayColumns:s}=e;return new E.Query().from(n.name,null!=(t=n.schema)?t:void 0).insert([a],{returning:l,enumArrayColumns:s}).toSql()}({table:a,payload:l,enumArrayColumns:s,returning:r}),i),{result:c}=await (0,f.E)({projectRef:t,connectionString:n,sql:o,isRoleImpersonationEnabled:(0,P._c)(null==i?void 0:i.role)});return c}let I=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)(),{mutate:s}=(0,_.h)(),{data:r}=(0,R.s)();return(0,p.n)({mutationFn:e=>L(e),async onSuccess(t,n,l){let{projectRef:i,table:o}=n;try{s({action:"table_data_added",properties:{method:"table_editor",schema_name:o.schema,table_name:o.name},groups:{project:i,...(null==r?void 0:r.slug)&&{organization:r.slug}}})}catch(e){console.error("Failed to track table data insertion event:",e)}await a.invalidateQueries({queryKey:k.j.tableRowsAndCount(i,o.id)}),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?m.oR.error(e.message):t(e,n,a)},...n})};var F=n(76422),D=n(31958),O=n(49810),z=n(9620),K=n(73036),M=n(79918),q=n(51982),B=n(71344),U=n(45550),Y=n(92246),W=n(68421),V=n(90376),H=n(86510),$=n(52555),J=n.n($),Q=n(79775),G=n(67850),Z=function(e){return e.CHECK_CONSTRAINT="c",e.FOREIGN_KEY_CONSTRAINT="f",e.PRIMARY_KEY_CONSTRAINT="p",e.UNIQUE_CONSTRAINT="u",e.CONSTRAINT_TRIGGER="t",e.EXCLUSION_CONSTRAINT="x",e}({});async function X(e,t){let{projectRef:n,connectionString:a,id:l}=e,s=(e=>{let{id:t}=e;return"\n  with table_info as (\n    select \n      n.nspname::text as schema,\n      c.relname::text as name,\n      to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n    from pg_class c\n    join pg_namespace n on n.oid = c.relnamespace\n    where c.oid = ".concat(t,"\n)\nselect \n    con.oid as id,\n    con.conname as name,\n    con.contype as type\nfrom pg_catalog.pg_constraint con\ninner join pg_catalog.pg_class rel\n        on rel.oid = con.conrelid\ninner join pg_catalog.pg_namespace nsp\n        on nsp.oid = connamespace\ninner join table_info ti\n        on ti.schema = nsp.nspname \n        and ti.name = rel.relname;\n").trim()})({id:l}),{result:r}=await (0,f.E)({projectRef:n,connectionString:a,sql:s,queryKey:["table-constraints",l]},t);return null!=r?r:[]}let ee=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:l=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,G.I)({queryKey:N.c.tableConstraints(t,a),queryFn:e=>{let{signal:l}=e;return X({projectRef:t,connectionString:n,id:a},l)},enabled:l&&void 0!==t&&void 0!==a,...s})};var et=n(48564),en=n(81536),ea=n(63335),el=n(85039),es=n(79861),er=n(80421),ei=n(99779),eo=n(98357),ec=n(21527),ed=n(78486),eu=n(30881),em=n(19197),ex=n(49523);let eh=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],ep=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],ef={uuid:[{name:"auth.uid()",value:"auth.uid()",description:"Returns the user's ID when rows are added or updated through the API"},{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[...eh],timetz:[...eh],timestamp:[...eh],timestamptz:[...eh],text:[...ep],varchar:[...ep]};var ey=n(19616),eg=n(23729),ev=n(21162);let ej=e=>{let{label:t,description:n,placeholder:l,size:s,layout:r,disabled:i=!1,className:o="",value:c="",suggestions:m=[],suggestionsTooltip:x,suggestionsHeader:h,onChange:p=d(),onSelectSuggestion:f=d(),"data-testid":y}=e,g=(0,u.useRef)(null),[v,j]=(0,u.useState)(m),b=v.length>0;return(0,u.useEffect)(()=>{j(m.slice(0,3))},[m]),(0,a.jsx)("div",{ref:g,className:"relative","data-sentry-component":"InputWithSuggestions","data-sentry-source-file":"InputWithSuggestions.tsx",children:(0,a.jsx)(er.A,{label:t,descriptionText:n,placeholder:l,size:s,layout:r,disabled:i,className:o,inputClassName:"pr-10",type:"text",value:c,onChange:e=>{p(e);let t=e.target.value;m.length>3&&j((t?m.filter(e=>-1!==e.name.indexOf(t)):m).slice(0,3))},"data-testid":y,actions:b&&(0,a.jsxs)(ev.rI,{children:[(0,a.jsx)(ev.ty,{asChild:!0,children:(0,a.jsx)(eg.G,{type:"default",className:"!px-1 mr-0.5",tooltip:{content:{text:x||"Suggestions",side:"bottom"}},children:(0,a.jsx)(ey.A,{strokeWidth:1.5,size:14})})}),(0,a.jsxs)(ev.SQ,{align:"end",side:"bottom",children:[(0,a.jsx)(ev.lp,{children:h||"Suggestions"}),(0,a.jsx)(ev.mB,{}),v.map(e=>(0,a.jsxs)(ev._2,{className:"space-x-2",onClick:()=>f(e),children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsx)("div",{className:"text-foreground-lighter",children:e.description})]},e.name))]})]}),"data-sentry-element":"Input","data-sentry-source-file":"InputWithSuggestions.tsx"})})},eb=e=>{var t,n,l,s;let{columnFields:r,enumTypes:i=[],onUpdateField:o=d()}=e,c=null!=(t=null==ef?void 0:ef[r.format])?t:[];if(!em.x0.includes(r.format)&&i.some(e=>e.name===r.format)){let e=i.find(e=>e.name===r.format),t=null!=(n=null==e?void 0:e.enums)?n:[],s=null!=(l=null==r?void 0:r.defaultValue)?l:"",c=s.includes("::")?s.split("::")[0].slice(1,-1):s;if(void 0!==e)return(0,a.jsxs)(ex.Ay,{label:"Default Value",layout:"vertical",value:c,onChange:e=>o({defaultValue:e.target.value}),children:[(0,a.jsx)(ex.Ay.Option,{value:"",children:"NULL"},"empty-enum"),t.map(e=>(0,a.jsx)(ex.Ay.Option,{value:e,children:e},e))]})}return(0,a.jsx)(ej,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"==typeof r.defaultValue&&0===r.defaultValue.length?"EMPTY":"NULL",value:null!=(s=null==r?void 0:r.defaultValue)?s:"",suggestions:c,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>o({defaultValue:e.target.value}),onSelectSuggestion:e=>o({defaultValue:e.value}),"data-sentry-element":"InputWithSuggestions","data-sentry-component":"ColumnDefaultValue","data-sentry-source-file":"ColumnDefaultValue.tsx"})};var eN=n(52160),ew=n(57648),eC=n(14506),eS=n.n(eC),eA=n(62284),ek=n(38985),eE=n(31160),e_=n(73886),eR=n(74310),eT=n(68152),eP=n(40314),eL=n(20033),eI=n(41273),eF=n(57125),eD=n(96962),eO=n(32775),ez=n(97904),eK=n(57384),eM=n(6436);let eq=[{key:"no-action",label:"No action",value:eD.P.NO_ACTION},{key:"cascade",label:"Cascade",value:eD.P.CASCADE},{key:"restrict",label:"Restrict",value:eD.P.RESTRICT},{key:"set-default",label:"Set default",value:eD.P.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:eD.P.SET_NULL}],eB={id:void 0,schema:"public",table:"",columns:[],deletionAction:eD.P.NO_ACTION,updateAction:eD.P.NO_ACTION},eU=e=>{var t,n,l,s,r;let{visible:i,table:o,column:c,foreignKey:d,onClose:m,onSaveRelation:x}=e,{data:h}=(0,z.YA)(),{selectedSchema:p}=(0,eK.k)(),[f,y]=(0,u.useState)(eB),[g,v]=(0,u.useState)({}),j=(null!=(t=null==g?void 0:g.types)?t:[]).filter(e=>void 0!==e).length>0,b=(null!=(n=null==g?void 0:g.typeNotice)?n:[]).filter(e=>void 0!==e).length>0,{data:N}=(0,eO.w$)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),{data:w}=(0,O.LW)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,schema:f.schema,includeColumns:!1}),{data:C,isLoading:S}=(0,ez.L)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,schema:f.schema,name:f.table},{enabled:!!(null==h?void 0:h.ref)&&!!f.schema&&!!f.table}),A=S||void 0===C||j,k=(e,t,n)=>{let a=f.columns.map((a,l)=>{var s,r,i;if(l!==e)return a;if("target"===t){let e=null==C||null==(r=C.columns)||null==(s=r.find(e=>e.name===n))?void 0:s.format;return{...a,[t]:n,targetType:e}}{let e=null==(i=o.columns.find(e=>e.name===n))?void 0:i.format;return{...a,[t]:n,sourceType:e}}});y({...f,columns:a})},E=(e,t)=>{v({}),y({...f,[e]:t})};return(0,u.useEffect)(()=>{i&&(void 0!==d?y(d):y({...eB,id:(0,eM.gZ)()}))},[i]),(0,u.useEffect)(()=>{i&&(()=>{let e=[],t=[];f.columns.forEach(n=>{var a,l,s,r;let{source:i,target:c,sourceType:d,targetType:u}=n,m=o.columns.find(e=>e.name===i),x=null!=(s=null!=d?d:null==m?void 0:m.format)?s:"",h=null!=(r=null!=u?u:null==C||null==(l=C.columns)||null==(a=l.find(e=>e.name===c))?void 0:a.format)?r:"";if(!(""===i||""===c||em.N1.includes(x)&&em.N1.includes(h)||em.AL.includes(x)&&em.AL.includes(h)||em.AL.includes(x)&&em.AL.includes(h)||"uuid"===x&&"uuid"===h)&&x!==h){if((null==m?void 0:m.isNewColumn)&&""!==h)return e.push({sourceType:x,targetType:h});t.push({sourceType:x,targetType:h})}}),v({types:t,typeNotice:e})})()},[f]),(0,a.jsx)(es.Ay,{visible:i,onCancel:m,className:"max-w-[480px]",header:"".concat(void 0===d?"Add":"Manage"," foreign key relationship").concat(void 0===d?" to":"s for"," ").concat(o.name.length>0?o.name:"new table"),customFooter:(0,a.jsx)(ed.A,{backButtonLabel:"Cancel",disableApply:A,applyButtonLabel:"Save",closePanel:m,applyFunction:e=>(e=>{let t={};if(f.columns.filter(e=>""===e.source||""===e.target).length>0&&(t.columns="Please ensure that columns are selected"),Object.keys(t).length>0){v(t),e();return}""!==f.table&&x(f),m(),e()})(e)}),"data-sentry-element":"SidePanel","data-sentry-component":"ForeignKeySelector","data-sentry-source-file":"ForeignKeySelector.tsx",children:(0,a.jsx)(es.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"ForeignKeySelector.tsx",children:(0,a.jsxs)("div",{className:"py-6 space-y-6",children:[(0,a.jsx)(eF.A,{icon:(0,a.jsx)(eA.A,{size:20,strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation","data-sentry-element":"InformationBox","data-sentry-source-file":"ForeignKeySelector.tsx"}),(0,a.jsx)(eP.A,{id:"schema",label:"Select a schema",value:f.schema,onChange:e=>{y({...eB,id:f.id,schema:e})},"data-sentry-element":"Listbox","data-sentry-source-file":"ForeignKeySelector.tsx",children:null==N?void 0:N.map(e=>(0,a.jsx)(eP.A.Option,{value:e.name,label:e.name,className:"min-w-96",addOnBefore:()=>(0,a.jsx)(ek.A,{size:16,strokeWidth:1.5}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"hidden",children:e.name}),(0,a.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))}),(0,a.jsxs)(eP.A,{id:"table",label:"Select a table to reference to",value:null!=(l=null==C?void 0:C.id)?l:1,onChange:e=>(e=>{v({});let t=(null!=w?w:[]).find(t=>t.id===e);t&&y({...eB,id:f.id,name:f.name,tableId:t.id,schema:t.schema,table:t.name,columns:void 0!==c?[{source:c.name,target:""}]:[{source:"",target:""}]})})(Number(e)),disabled:S,"data-sentry-element":"Listbox","data-sentry-source-file":"ForeignKeySelector.tsx",children:[(0,a.jsx)(eP.A.Option,{className:"min-w-96",value:1,label:"---","data-sentry-element":"Listbox.Option","data-sentry-source-file":"ForeignKeySelector.tsx",children:"---"},"empty"),eS()(w,["schema"]).map(e=>(0,a.jsx)(eP.A.Option,{value:e.id,label:e.name,className:"min-w-96",addOnBefore:()=>(0,a.jsx)(eE.A,{size:16,strokeWidth:1.5}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"hidden",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.schema}),(0,a.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))]}),f.schema&&f.table&&(0,a.jsxs)(a.Fragment,{children:[S?(0,a.jsxs)("div",{className:"flex py-6 flex-col items-center justify-center space-y-2",children:[(0,a.jsx)(e_.A,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading table columns"})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,a.jsxs)("label",{className:"text-foreground-light text-sm",children:["Select columns from"," ",(0,a.jsxs)("code",{className:"text-xs",children:[f.schema,".",f.table]})," ","to reference to"]}),(0,a.jsxs)("div",{className:"grid grid-cols-10 gap-y-2",children:[(0,a.jsxs)("div",{className:"col-span-5 text-xs text-foreground-lighter",children:[p,".",o.name.length>0?o.name:"[unnamed table]"]}),(0,a.jsxs)("div",{className:"col-span-4 text-xs text-foreground-lighter text-right",children:[f.schema,".",f.table]}),0===f.columns.length&&(0,a.jsx)(eL.Fc,{className:"col-span-10 py-2 px-3",children:(0,a.jsx)(eL.TN,{children:"There are no foreign key relations between the tables"})}),f.columns.map((e,t)=>{var n,l;return(0,a.jsxs)(u.Fragment,{children:[(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsxs)(eP.A,{id:"column",value:f.columns[t].source,onChange:e=>k(t,"source",e),children:[(0,a.jsx)(eP.A.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!=(n=null==o?void 0:o.columns)?n:[]).filter(e=>0!==e.name.length).map(e=>(0,a.jsx)(eP.A.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:""===e.format?"-":e.format})]})},e.id))]})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center items-center",children:(0,a.jsx)(eR.A,{})}),(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsxs)(eP.A,{id:"column",value:f.columns[t].target,onChange:e=>k(t,"target",e),children:[(0,a.jsx)(eP.A.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!=(l=null==C?void 0:C.columns)?l:[]).map(e=>(0,a.jsx)(eP.A.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.format})]})},e.id))]})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-end items-center",children:(0,a.jsx)(ei.$,{type:"default",className:"px-1",icon:(0,a.jsx)(eT.A,{}),disabled:1===f.columns.length,onClick:()=>{y({...f,columns:f.columns.filter((e,n)=>n!==t)})}})})]},"".concat(f.schema,"-").concat(f.table,"-").concat(t))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ei.$,{type:"default",onClick:()=>{y({...f,columns:f.columns.concat([{source:"",target:""}])})},children:"Add another column"}),g.columns&&(0,a.jsx)("p",{className:"text-red-900 text-sm",children:g.columns}),j&&(0,a.jsxs)(eL.Fc,{variant:"warning",children:[(0,a.jsx)(eL.XL,{children:"Column types do not match"}),(0,a.jsx)(eL.TN,{children:"The following columns cannot be referenced as they are not of the same type:"}),(0,a.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!=(s=null==g?void 0:g.types)?s:[]).map((e,t)=>{var n,l;return void 0===e?null:(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:null==(n=f.columns[t])?void 0:n.source})," (",e.sourceType,") and"," ",(0,a.jsx)("code",{className:"text-xs",children:null==(l=f.columns[t])?void 0:l.target}),"(",e.targetType,")"]},"type-error-".concat(t))})})]}),b&&(0,a.jsxs)(eL.Fc,{children:[(0,a.jsx)(eL.XL,{children:"Column types will be updated"}),(0,a.jsx)(eL.TN,{children:"The following columns will have their types updated to match their referenced column"}),(0,a.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!=(r=null==g?void 0:g.typeNotice)?r:[]).map((e,t)=>{var n;return void 0===e?null:(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("code",{className:"text-xs",children:null==(n=f.columns[t])?void 0:n.source})," ",(0,a.jsx)(eR.A,{size:14})," ",e.targetType]})},"type-error-".concat(t))})})]})]})]}),!S&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(es.Ay.Separator,{}),(0,a.jsx)(eF.A,{icon:(0,a.jsx)(eA.A,{size:"20",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,a.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:"Restrict"})," or"," ",(0,a.jsx)("code",{className:"text-xs",children:"No action"}),": if the two tables represent independent objects"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:"Set NULL"})," or"," ",(0,a.jsx)("code",{className:"text-xs",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,a.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,a.jsx)(eP.A,{id:"updateAction",value:f.updateAction,label:"Action if referenced row is updated",descriptionText:(0,a.jsx)("p",{children:(0,eu.e)("update",f.updateAction,"".concat(f.schema,".").concat(f.table))}),onChange:e=>E("updateAction",e),children:eq.filter(e=>["no-action","cascade","restrict"].includes(e.key)).map(e=>(0,a.jsx)(eP.A.Option,{value:e.value,label:e.label,children:(0,a.jsx)("p",{className:"text-foreground",children:e.label})},e.key))}),(0,a.jsx)(eP.A,{id:"deletionAction",value:f.deletionAction,className:"[&>div>label]:flex [&>div>label]:items-center",label:"Action if referenced row is removed",labelOptional:(0,a.jsx)(eI.A,{href:"".concat(el.aq,"/guides/database/postgres/cascade-deletes")}),descriptionText:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:(0,eu.e)("delete",f.deletionAction,"".concat(f.schema,".").concat(f.table))})}),onChange:e=>E("deletionAction",e),children:eq.map(e=>(0,a.jsx)(eP.A.Option,{value:e.value,label:e.label,children:(0,a.jsx)("p",{className:"text-foreground",children:e.label})},e.key))})]})]})]})})})};var eY=n(16110),eW=n(80100),eV=n(21650);let eH=e=>{let{foreignKey:t,disabled:n=!1,status:l,layout:s="horizontal",closePanel:r,onSelectEdit:i,onSelectRemove:o,onSelectUndoRemove:c}=e,{ref:d}=(0,x.g)();return(0,a.jsxs)("div",{className:(0,eW.cn)("horizontal"===s?"items-center justify-between gap-x-2":"flex-col gap-y-3","flex border border-strong px-4 py-4","border-b-0 last:border-b first:rounded-t-md last:rounded-b-md"),"data-sentry-component":"ForeignKeyRow","data-sentry-source-file":"ForeignKeyRow.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[t.name&&(0,a.jsx)("p",{title:t.name,className:"text-xs text-foreground font-mono",children:t.name}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==l&&(0,a.jsx)(eV.E,{variant:"ADD"===l?"brand":"UPDATE"===l?"warning":"destructive",children:l}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:[t.columns.length>1?"Composite foreign":"Foreign"," key relation to:"]}),(0,a.jsx)(ei.$,{asChild:!0,type:"default",title:"".concat(t.schema,".").concat(t.table),className:"py-0.5 px-1.5 font-mono",icon:(0,a.jsx)(eY.A,{className:"table-icon",src:"".concat(el.o2,"/img/icons/table-icon.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"'),loader:(0,a.jsx)("span",{className:"block w-4 h-4 bg-[#133929] rounded-sm"}),cacheRequests:!0}),"data-sentry-element":"Button","data-sentry-source-file":"ForeignKeyRow.tsx",children:(0,a.jsxs)(J(),{target:"_blank",rel:"norefererer",href:"/project/".concat(d,"/editor/").concat(t.tableId),"data-sentry-element":"Link","data-sentry-source-file":"ForeignKeyRow.tsx",children:[t.schema,".",t.table]})})]})]}),(0,a.jsx)("div",{className:"flex flex-col gap-y-1",children:t.columns.map((e,n)=>{var l;return(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("code",{className:(0,eW.cn)("text-xs",0===(null!=(l=null==e?void 0:e.source)?l:"").length&&"text-foreground-light"),children:e.source||"[column_name]"}),(0,a.jsx)(eR.A,{size:16}),(0,a.jsxs)("code",{className:"text-xs",children:[t.schema,".",t.table,".",e.target]})]},"relation-".concat(n,"}"))})})]}),!n&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ei.$,{type:"default",onClick:i,children:"Edit"}),t.toRemove?(0,a.jsx)(ei.$,{type:"default",onClick:c,children:"Cancel remove"}):(0,a.jsx)(ei.$,{type:"default",onClick:o,children:"Remove"})]})]})};var e$=n(84305),eJ=n.n(e$);let eQ=(e,t)=>{let n=t.columns.map(e=>e.source),a=t.columns.map(e=>e.target);return e.deletion_action!==t.deletionAction||e.update_action!==t.updateAction||e.target_schema!==t.schema||e.target_table!==t.table||!eJ()(e.source_columns,n)||!eJ()(e.target_columns,a)},eG=e=>{var t;let{column:n,relations:l,closePanel:s,onUpdateColumnType:r,onUpdateFkRelations:i}=e,{id:o}=(0,x.g)(),[c,d]=(0,u.useState)(!1),[m,h]=(0,u.useState)(),{data:p}=(0,z.YA)(),{data:f}=(0,et.Hw)({projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString,schema:n.schema}),y=o?Number(o):void 0,{data:g}=(0,ew.Pk)({projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString,id:y}),v=(null!=(t=null==g?void 0:g.columns)?t:[]).map(e=>({id:e.id,name:e.name,format:e.format||n.format,isNewColumn:!1}));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[l.length>0&&(0,a.jsx)("div",{children:l.map(e=>{let t=(e=>{let t=(null!=f?f:[]).find(t=>t.id===e.id),n=l.find(t=>t.id===e.id);return(null==n?void 0:n.toRemove)?"REMOVE":void 0===t&&void 0!==n?"ADD":void 0!==t&&void 0!==n?eQ(t,n)?"UPDATE":void 0:void 0})(e);return(0,a.jsx)(eH,{layout:"vertical",status:t,foreignKey:e,closePanel:s,onSelectEdit:()=>{d(!0),h(e)},onSelectRemove:()=>{"ADD"===t?i(l.filter(t=>t.id!==e.id)):i(l.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{i(l.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,a.jsx)(ei.$,{type:"default",className:"w-min",onClick:()=>d(!0),"data-sentry-element":"Button","data-sentry-source-file":"ColumnForeignKey.tsx",children:"Add foreign key"})]}),void 0!=g&&(0,a.jsx)(eU,{visible:c,column:n,table:{id:g.id,name:g.name,columns:n.isNewColumn&&n.name?v.concat(n):v.map(e=>e.id===n.id?{...e,name:n.name}:e)},foreignKey:m,onClose:()=>{d(!1),h(void 0)},onSaveRelation:e=>{var t;let a=l.map(e=>e.id);void 0!==e.id&&a.includes(e.id)?i(l.map(t=>t.id===e.id?e:t)):i(l.concat([e]));let s=null==(t=e.columns.find(e=>e.source===n.name))?void 0:t.targetType;s&&r(s)}})]})};var eZ=n(95942);let eX=e=>{let{table:t,column:n}=e;return n?(0,a.jsxs)(a.Fragment,{children:["Update column ",(0,a.jsx)("code",{children:n.name})," from ",(0,a.jsx)("code",{children:n.table})]}):(0,a.jsxs)(a.Fragment,{children:["Add new column to ",(0,a.jsx)("code",{children:t.name})]})},e0=e=>{var t,n,l,s,i;let{column:o,selectedTable:c,visible:m=!1,closePanel:h=d(),saveChanges:p=d(),updateEditorDirty:f=d()}=e,{ref:y}=(0,x.g)(),{data:g}=(0,z.YA)(),[v,j]=(0,u.useState)({}),[b,N]=(0,u.useState)(),[w,C]=(0,u.useState)([]),[S,A]=(0,u.useState)((0,eN.Pe)(null==b?void 0:b.format,null==b?void 0:b.name)),{data:k}=(0,en.p)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),{data:E}=(0,ea.Uu)({excludeSchemas:["extensions"]}),_=(null!=k?k:[]).filter(e=>!E.find(t=>t.name===e.schema)),{data:R}=ee({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,id:null==c?void 0:c.id}),T=(null!=R?R:[]).find(e=>e.type===Z.PRIMARY_KEY_CONSTRAINT),{data:P}=(0,et.Hw)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:null==c?void 0:c.schema}),L=void 0===o,I=P||[],F=I.filter(e=>e.source_id===(null==o?void 0:o.table_id)&&e.source_columns.includes(o.name)),D=void 0!==w.find(e=>void 0!==e.columns.find(e=>e.source===(null==b?void 0:b.name))&&!e.toRemove);if((0,u.useEffect)(()=>{m&&(j({}),N(L?(0,eN.Eb)({schema:c.schema,table:c.name}):(0,eN.h6)(o,c,I)),C((0,eu.C)(F)))},[m]),!b)return null;let O=e=>{em.AL.includes(b.format)||""!==e.defaultValue||(e.defaultValue=null);let t="name"in e&&e.name!==b.name,n="format"in e&&e.format!==b.format;t&&w.find(e=>e.columns.find(e=>{let{source:t}=e;return t===(null==b?void 0:b.name)}))&&C(w.map(t=>({...t,columns:t.columns.map(t=>t.source===(null==b?void 0:b.name)?{...t,source:e.name}:t)}))),(t||n)&&A((0,eN.Pe)(e.format||b.format,e.name||b.name)),N({...b,...e}),f();let a={...v};for(let t of Object.keys(e))delete a[t];j(a)},K=e=>{if(b){let t=(0,eN.MG)(b);(j(t),r()(t))?p(L?(0,eN.Oj)(c,b):(0,eN.f9)(o,c,b),L,{columnId:null==o?void 0:o.id,primaryKey:T,foreignKeyRelations:w,existingForeignKeyRelations:F},e):e()}};return(0,a.jsxs)(es.Ay,{size:"xlarge",visible:m,onConfirm:e=>K(e),header:(0,a.jsx)(eX,{table:c,column:o}),onCancel:h,customFooter:(0,a.jsx)(ed.A,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:h,applyFunction:e=>K(e)}),"data-sentry-element":"SidePanel","data-sentry-component":"ColumnEditor","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(Q.y9,{header:(0,a.jsx)(Q.sj,{className:"lg:!col-span-4",children:"General"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsxs)(Q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(er.A,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:v.name,value:null!=(t=null==b?void 0:b.name)?t:"",onChange:e=>O({name:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(er.A,{label:"Description",labelOptional:"Optional",type:"text",value:null!=(n=null==b?void 0:b.comment)?n:"",onChange:e=>O({comment:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"ColumnEditor.tsx"})]})}),(0,a.jsx)(es.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(Q.y9,{header:(0,a.jsx)(Q.sj,{className:"lg:!col-span-4",description:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ei.$,{asChild:!0,type:"default",size:"tiny",icon:(0,a.jsx)(V.A,{strokeWidth:2}),children:(0,a.jsx)(J(),{href:"/project/".concat(y,"/database/types"),target:"_blank",rel:"noreferrer",children:"Create enum types"})}),(0,a.jsx)(ei.$,{asChild:!0,type:"default",size:"tiny",icon:(0,a.jsx)(H.A,{size:14,strokeWidth:2}),children:(0,a.jsx)(J(),{href:"".concat(el.aq,"/guides/database/tables#data-types"),target:"_blank",rel:"noreferrer",children:"About data types"})})]}),children:"Data Type"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsxs)(Q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(eZ.A,{showRecommendation:!0,value:null!=(l=null==b?void 0:b.format)?l:"",layout:"vertical",enumTypes:_,error:v.format,description:D?"Column type cannot be changed as it has a foreign key relation":"",disabled:D,onOptionSelect:e=>O({format:e,defaultValue:null}),"data-sentry-element":"ColumnType","data-sentry-source-file":"ColumnEditor.tsx"}),void 0===b.foreignKey&&(0,a.jsxs)("div",{className:"space-y-4",children:[b.format.includes("int")&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(eo.A,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:b.isIdentity,onChange:()=>{let e=!b.isIdentity,t=!e&&b.isArray;O({isIdentity:e,isArray:t})}})}),!b.isPrimaryKey&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(eo.A,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:b.isArray,onChange:()=>{let e=!b.isArray,t=!e&&b.isIdentity;O({isArray:e,isIdentity:t})}})})]}),(0,a.jsx)(eb,{columnFields:b,enumTypes:_,onUpdateField:O,"data-sentry-element":"ColumnDefaultValue","data-sentry-source-file":"ColumnEditor.tsx"})]})}),(0,a.jsx)(es.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(Q.y9,{header:(0,a.jsx)(Q.sj,{className:"lg:!col-span-4",children:"Foreign Keys"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsx)(Q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsx)(eG,{column:b,relations:w,closePanel:h,onUpdateColumnType:e=>{"_"===e[0]?O({format:e.slice(1),isArray:!0,isIdentity:!1}):O({format:e})},onUpdateFkRelations:C,"data-sentry-element":"ColumnForeignKey","data-sentry-source-file":"ColumnEditor.tsx"})})}),(0,a.jsx)(es.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(Q.y9,{header:(0,a.jsx)(Q.sj,{className:"lg:!col-span-4",children:"Constraints"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsxs)(Q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(ec.A,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!=(s=null==b?void 0:b.isPrimaryKey)&&s,onChange:()=>O({isPrimaryKey:!(null==b?void 0:b.isPrimaryKey)}),"data-sentry-element":"Toggle","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(ec.A,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:b.isNullable,onChange:()=>O({isNullable:!b.isNullable}),"data-sentry-element":"Toggle","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(ec.A,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:b.isUnique,onChange:()=>O({isUnique:!b.isUnique}),"data-sentry-element":"Toggle","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(er.A,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:S,type:"text",value:null!=(i=null==b?void 0:b.check)?i:"",onChange:e=>O({check:e.target.value}),className:"[&_input]:font-mono","data-sentry-element":"Input","data-sentry-source-file":"ColumnEditor.tsx"})]})})]},"ColumnEditor")};var e1=n(77395),e2=n(22745),e3=n(89388),e5=n(24558),e4=n(41578),e8=n(24116),e6=n(75204),e9=n(10247),e7=n(55108),te=n(54831),tt=n(47165);let tn=e=>{let{page:t,setPage:n,rowsPerPage:l,currentPageRowsCount:s=0,isLoading:r=!1}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2","data-sentry-component":"Pagination","data-sentry-source-file":"Pagination.tsx",children:[r&&(0,a.jsx)(te.A,{size:14,className:"animate-spin"}),(0,a.jsx)(ei.$,{icon:(0,a.jsx)(tt.A,{}),type:"outline",disabled:t<=1||r,onClick:()=>{n(e=>e-1)},title:"Previous Page",style:{padding:"3px 10px"},"data-sentry-element":"Button","data-sentry-source-file":"Pagination.tsx"}),(0,a.jsx)(ei.$,{icon:(0,a.jsx)(eR.A,{}),type:"outline",disabled:s<l||r,onClick:()=>{n(e=>e+1)},title:"Next Page",style:{padding:"3px 10px"},"data-sentry-element":"Button","data-sentry-source-file":"Pagination.tsx"})]})};var ta=n(72715),tl=n(24560),ts=n(80869),tr=n(89034),ti=n(24681),to=n(30404);let tc=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.jsxs)("div",{className:"flex h-full items-center justify-center gap-2","data-sentry-component":"columnRender","data-sentry-source-file":"SelectorGrid.tsx",children:[t&&(0,a.jsxs)(to.m_,{children:[(0,a.jsx)(to.k$,{children:(0,a.jsx)("div",{className:"text-brand",children:(0,a.jsx)(ta.A,{size:14,strokeWidth:2})})}),(0,a.jsx)(to.ZI,{side:"bottom",children:"Primary key"})]}),(0,a.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]})},td=e=>{let{rows:t,onRowSelect:n}=e,l=(0,e9.Ir)().table.columns.map(e=>{let t=(0,ti.AM)(e),n=(e.name.length+e.format.length)*ti.lu;return{key:e.name,name:e.name,renderCell:t=>(e=>{let{column:t,format:n,row:l}=e,s="bytea"===n?(0,e7.ds)(l[t]):null===l[t]?null:"object"==typeof l[t]?JSON.stringify(l[t]):l[t];return(0,a.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden","data-sentry-component":"formatter","data-sentry-source-file":"SelectorGrid.tsx",children:null===s?(0,a.jsx)(ts.X,{}):(0,a.jsx)("span",{className:"text-sm truncate",children:s})})})({column:e.name,format:e.format,row:t.row}),renderHeaderCell:()=>tc(e.name,e.isPrimaryKey),resizable:!0,width:t<n?n:t,minWidth:tr.T_}});return(0,a.jsx)(tl.Ay,{columns:l,rows:t,style:{height:"100%"},onCellClick:e=>n(e.row),rowClass:()=>"cursor-pointer","data-sentry-element":"DataGrid","data-sentry-component":"SelectorGrid","data-sentry-source-file":"SelectorGrid.tsx"})},tu="__frselector",tm=e=>{var t,n;let{visible:l,foreignKey:s,onSelect:r,closePanel:i}=e,{id:o}=(0,x.g)(),{data:c}=(0,z.YA)(),{data:d}=(0,ew.Pk)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:o?Number(o):void 0}),{tableId:m,schema:h,table:p,columns:f}=null!=s?s:{},y=m?Number(m):void 0,g=(null!=(t=null==d?void 0:d.columns)?t:[]).find(e=>e.name===(null==f?void 0:f[0].source)),v=1===(null!=f?f:[]).length&&(null==g?void 0:g.is_nullable),{data:j}=(0,ew.Pk)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:y}),[{sort:b,filter:N},w]=(0,u.useState)({filter:[],sort:[]}),[C,S]=(0,u.useState)(1),A=(0,P.RY)(),{data:k,isLoading:E,isSuccess:_,isError:R,isRefetching:T}=(0,e6.vs)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,tableId:null==j?void 0:j.id,sorts:b,filters:N,page:C,limit:100,roleImpersonationState:A},{keepPreviousData:!0}),[L,I]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{if((null==c?void 0:c.ref)&&(null==j?void 0:j.name)&&(null==j?void 0:j.schema))try{var e;let t=j.name+tu,n=(0,e3.Tk)(c.ref,t,j.schema),a=null!=(e=null==n?void 0:n.sorts)?e:[],l=(0,e3.FU)(j.name,a);l.length>0&&w(e=>({...e,sort:l}))}catch(e){console.error(e)}finally{I(!0)}},[null==c?void 0:c.ref,null==j?void 0:j.schema,null==j?void 0:j.name]),(0,u.useEffect)(()=>{if((null==c?void 0:c.ref)&&(null==j?void 0:j.name)&&(null==j?void 0:j.schema)&&L)try{let e=(0,e3.Aw)(b),t=j.name+tu;(0,e3.$S)({projectRef:c.ref,tableName:t,schema:j.schema,sorts:e})}catch(e){console.error(e)}},[L,b,null==c?void 0:c.ref,null==j?void 0:j.schema,null==j?void 0:j.name]),(0,a.jsx)(es.Ay,{visible:l,size:"large",header:(0,a.jsxs)("div",{children:["Select a record to reference from"," ",(0,a.jsxs)("code",{className:"font-mono text-sm",children:[h,".",p]})]}),onCancel:i,customFooter:(0,a.jsx)(ed.A,{hideApply:!0,backButtonLabel:"Cancel",closePanel:i}),"data-sentry-element":"SidePanel","data-sentry-component":"ForeignRowSelector","data-sentry-source-file":"ForeignRowSelector.tsx",children:(0,a.jsx)(es.Ay.Content,{className:"h-full !px-0","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"ForeignRowSelector.tsx",children:(0,a.jsxs)("div",{className:"h-full",children:[E&&(0,a.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,a.jsx)(e_.A,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading rows"})]}),R&&(0,a.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Unable to load rows from"," ",(0,a.jsxs)("code",{children:[h,".",p]}),". Please try again or contact support."]})}),(null==c?void 0:c.ref)&&j&&_&&(0,a.jsx)(e9.HQ,{projectRef:c.ref,table:j,editable:!1,children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(e5.s,{tableId:null==j?void 0:j.id,isRefetching:T}),(0,a.jsx)(e4.b,{portal:!1,filters:N,onApplyFilters:e=>{C>1&&S(1),w(t=>({...t,filter:e}))}}),(0,a.jsx)(e1.Q,{backend:e2.t2,context:window,children:(0,a.jsx)(e8.l,{portal:!1,sorts:b,onApplySorts:e=>{w(t=>({...t,sort:e}))}})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-3 divide-x",children:[(0,a.jsx)(tn,{page:C,setPage:S,rowsPerPage:100,currentPageRowsCount:null!=(n=null==k?void 0:k.rows.length)?n:0,isLoading:T}),v&&(0,a.jsx)("div",{className:"pl-3",children:(0,a.jsx)(ei.$,{type:"default",onClick:()=>{(null==f?void 0:f.length)===1&&r({[f[0].source]:null})},children:"Set NULL"})})]})]}),k.rows.length>0?(0,a.jsx)(td,{rows:k.rows,onRowSelect:e=>{r(null==f?void 0:f.reduce((t,n)=>{let a=null==d?void 0:d.columns.find(e=>e.name===n.target),l=(null==a?void 0:a.format)==="bytea"?(0,e7.ds)(e[n.target]):e[n.target];return{...t,[n.source]:l}},{}))}}):(0,a.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-default",children:(0,a.jsx)("span",{className:"text-foreground-light text-sm",children:"No Rows Found"})})]})})]})})})};var tx=n(1348),th=n(4281),tp=n(44705),tf=n(46548),ty=n(88491),tg=n.n(ty),tv=n(88868),tj=n(76196);let tb=e=>{let{breadcrumbs:t=[],resetBreadcrumbs:n,onSelectBreadcrumb:l}=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-2","data-sentry-component":"DrilldownBreadCrumbs","data-sentry-source-file":"DrilldownBreadCrumbs.tsx",children:[(0,a.jsx)(tv.A,{size:16,strokeWidth:2,onClick:()=>n(),className:"cursor-pointer","data-sentry-element":"Home","data-sentry-source-file":"DrilldownBreadCrumbs.tsx"}),t.length>0&&t.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(tj.A,{size:16,strokeWidth:2}),e===tg()(t)?(0,a.jsx)("p",{className:"font-mono text-xs",children:e}):(0,a.jsx)("p",{className:"font-mono text-xs",children:(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>l(t.slice(0,t.indexOf(e)+1)),children:e})})]},e))]})};var tN=n(70350),tw=n.n(tN);let tC=e=>{let{pane:t,jsonData:n,activeKey:l,onSelectKey:s=d()}=e;if(!n)return(0,a.jsx)("div",{className:"flex-1 ".concat(2===t?"border-l border-default":""),children:(0,a.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,a.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(n).length)return(0,a.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),children:(0,a.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,a.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});let r=Object.keys(n).filter(e=>"object"==typeof n[e]&&!tw()(n[e])),i=Object.keys(n).filter(e=>tw()(n[e])||"object"!=typeof n[e]);return(0,a.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),"data-sentry-component":"DrilldownPane","data-sentry-source-file":"DrilldownPane.tsx",children:[r.map(e=>(0,a.jsxs)("div",{className:"\n              ".concat(e===l?"bg-surface-300":"","\n              group flex cursor-pointer items-center transition\n              justify-between py-2 px-5 hover:bg-surface-200\n            "),onClick:()=>s(e,t),children:[(0,a.jsx)("p",{className:"font-mono text-xs !text-blue-900",children:e}),(0,a.jsx)("div",{className:"".concat(e===l?"opacity-100":"opacity-50"," group-hover:opacity-100 transition"),children:(0,a.jsx)(tj.A,{strokeWidth:2,size:16})})]},e)),i.map(e=>(0,a.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,a.jsxs)("p",{className:"font-mono text-xs !text-blue-900",children:[e,":"]}),(0,a.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!=typeof n[e]?"!text-green-900":"!text-yellow-900"),children:tw()(n[e])?"null":"string"==typeof n[e]?'"'.concat(n[e],'"'):n[e].toString()})]},e))]})},tS=e=>{let{jsonData:t={}}=e,[n,l]=(0,u.useState)(),[s,i]=(0,u.useState)([]),[o,c]=(0,u.useState)(t),[d,m]=(0,u.useState)({}),x=(e,t)=>{l(e);let n=s.slice();1===t&&(m(o[e]),r()(d)||n.pop(),n.push(e),i(n)),2===t&&(c(d),m(d[e]),n.push(e),i(n))};return(0,a.jsxs)("div",{className:"border border-x-0 border-t-0 border-muted","data-sentry-component":"DrilldownViewer","data-sentry-source-file":"DrilldownViewer.tsx",children:[(0,a.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,a.jsx)(tb,{breadcrumbs:s,onSelectBreadcrumb:e=>{let n=tg()(e)||"";l(n);let a={...t};if(i(s.slice(0,s.indexOf(n)+1)),null===e)c(a),m({});else if(1===e.length)c(a),m(t[s[0]]);else{for(let t of e)a=a[t],e.indexOf(t)===e.length-2&&c(a);m(a)}},resetBreadcrumbs:()=>{l(void 0),i([]),c(t),m({})},"data-sentry-element":"DrilldownBreadCrumbs","data-sentry-source-file":"DrilldownViewer.tsx"})}),(0,a.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-muted",children:[(0,a.jsx)(tC,{pane:1,jsonData:o,onSelectKey:x,activeKey:n,"data-sentry-element":"DrilldownPane","data-sentry-source-file":"DrilldownViewer.tsx"}),(0,a.jsx)(tC,{pane:2,jsonData:d,onSelectKey:x,"data-sentry-element":"DrilldownPane","data-sentry-source-file":"DrilldownViewer.tsx"})]})]})};var tA=n(14360);let tk=e=>{let{value:t="",readOnly:n=!1,onInputChange:l=d()}=e;return(0,a.jsx)(tA.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:"json",value:t,loading:(0,a.jsx)("h4",{children:"Loading"}),options:{readOnly:n,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:l,"data-sentry-element":"Editor","data-sentry-component":"JsonCodeEditor","data-sentry-source-file":"JsonCodeEditor.tsx"})},tE=e=>{let{row:t,column:n,visible:l,backButtonLabel:s,applyButtonLabel:r,readOnly:i=!1,closePanel:o,onSaveJSON:c}=e,{id:d}=(0,x.g)(),h=d?Number(d):void 0,{data:p}=(0,z.YA)(),{data:f}=(0,ew.Pk)({projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString,id:h}),[y,g]=(0,u.useState)("edit"),[v,j]=(0,u.useState)(""),b=null==t?void 0:t[n],N="object"==typeof b?JSON.stringify(b):b,w=(0,e7.Mr)(N),{mutate:C,isPending:S,isSuccess:k,reset:E}=(0,tf.c2)(),_=async e=>{try{let t=(0,eM.Cf)(v),n=(0,eM.hC)(t);c&&c(n,e)}catch(t){e(),m.oR.error("JSON seems to have an invalid structure.")}};(0,u.useEffect)(()=>{l&&j((0,eM.G1)(N))},[l]);let R=(0,u.useCallback)(()=>{E(),o()},[E]);return(0,a.jsx)(es.Ay,{size:"large",header:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===y?(0,a.jsxs)("p",{children:[i?"Viewing":"Editing"," value of: ",(0,a.jsx)("code",{children:n})]}):(0,a.jsxs)("p",{children:["Viewing value of: ",(0,a.jsx)("code",{children:n})]}),(!w||w&&k)&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:["edit"===y&&(0,a.jsx)(eg.G,{type:"default",icon:(0,a.jsx)(th.A,{}),className:"px-1",onClick:()=>void j((0,eM.G1)(v)),tooltip:{content:{side:"bottom",text:"Prettify JSON"}}}),(0,a.jsx)(tp.A,{options:["view","edit"],activeOption:y,borderOverride:"border-muted",onClickOption:g})]})]}),visible:l,onCancel:R,customFooter:(0,a.jsx)(ed.A,{hideApply:i,closePanel:R,backButtonLabel:s,applyButtonLabel:r,applyFunction:i?void 0:_}),"data-sentry-element":"SidePanel","data-sentry-component":"JsonEditor","data-sentry-source-file":"index.tsx",children:(0,a.jsxs)("div",{className:"flex flex-auto h-full flex-col gap-y-4 relative",children:["edit"===y?(0,a.jsx)("div",{className:"w-full h-full flex-grow",children:(0,a.jsx)(tk,{readOnly:i,onInputChange:e=>j(null!=e?e:""),value:v.toString()},N)}):(0,a.jsx)(tS,{jsonData:(0,eM.Bl)(v)}),w&&!k&&(0,a.jsxs)("div",{className:(0,eW.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,a.jsxs)("p",{children:["JSON value is larger than ",tx.SF.toLocaleString()," characters"]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire JSON value, but your browser may run into performance issues"})]}),(0,a.jsx)(ei.$,{type:"default",loading:S,onClick:()=>{if(void 0===f||void 0===p||void 0===t||!(0,A.KO)(f))return;if(0===f.primary_keys.length)return(0,m.oR)("Unable to load value as table has no primary keys");let e=f.primary_keys.reduce((e,n)=>({...e,[n.name]:t[n.name]}),{});C({table:{schema:f.schema,name:f.name},column:n,pkMatch:e,projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString},{onSuccess:e=>{j(JSON.stringify(e))}})},children:"Load full JSON data"})]})]})})};var t_=n(53667),tR=n.n(t_);let tT=e=>{let{isNewRecord:t,tableName:n}=e,l="".concat(t?"Add new":"Update"," row ").concat(t?"to":"from"," ");return(0,a.jsxs)(a.Fragment,{children:[l,n&&(0,a.jsx)("span",{className:"text-code font-mono",children:n})]})};var tP=n(86926),tL=n.n(tP),tI=n(3225),tF=n(93901),tD=n(66329),tO=n(44053),tz=n(53434),tK=n.n(tz);let tM=e=>{let{value:t,onChange:n,name:l,isNullable:s,format:r,description:i,disabled:o=!1}=e,c=function(e){var t,n,a;if(t=e,em.J5.indexOf(t.toLowerCase())>-1)return"date";if(n=e,em.mL.indexOf(n.toLowerCase())>-1)return"time";return(a=e,em.aw.indexOf(a.toLowerCase())>-1)?"datetime-local":"text"}(r);return(0,a.jsx)(er.A,{layout:"horizontal",className:(0,eW.cn)("w-full [&>div>div>div>input]:pr-10"),label:l,descriptionText:(0,a.jsxs)("div",{className:"space-y-1",children:[i,r.includes("tz")&&(0,a.jsxs)("p",{children:["Your local timezone will be automatically applied (",tK()().format("ZZ"),")"]})]}),labelOptional:r,size:"small",value:t,type:c,step:"datetime-local"==c||"time"==c?"1":void 0,actions:!o&&(0,a.jsxs)(ev.rI,{children:[(0,a.jsx)(ev.ty,{asChild:!0,children:(0,a.jsx)(ei.$,{type:"default",icon:(0,a.jsx)(tI.A,{}),className:"px-1.5"})}),(0,a.jsxs)(ev.SQ,{align:"end",className:"w-28 pointer-events-auto",children:[s&&(0,a.jsx)(ev._2,{onClick:()=>n(""),children:"Set to NULL"}),(0,a.jsx)(ev._2,{onClick:()=>n(tK()().format("date"===r?"YYYY-MM-DD":["time","timetz"].includes(r)?"HH:mm:ss":"YYYY-MM-DDTHH:mm:ss")),children:"Set to now"})]})]}),onChange:e=>n(e.target.value),disabled:o,"data-sentry-element":"Input","data-sentry-component":"DateTimeInput","data-sentry-source-file":"index.tsx"})},tq="Note: Value is too large to be rendered in the dashboard. Please expand the editor to edit the value",tB=e=>{var t,n,l,s,r,i,o,c;let{field:u,errors:m,isEditable:x=!0,onUpdateField:h=d(),onEditJson:p=d(),onEditText:f=d(),onSelectForeignKey:y=d()}=e;if(u.enums.length>0)return"_"===u.format[0]?(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(er.A.TextArea,{"data-testid":"".concat(u.name,"-input"),layout:"horizontal",label:u.name,className:"text-sm",descriptionText:u.comment,labelOptional:u.format,disabled:!x,error:m[u.name],rows:5,value:null!=(t=u.value)?t:"",placeholder:null===u.defaultValue?"":"string"==typeof u.defaultValue&&0===u.defaultValue.length?"EMPTY":"Default: ".concat(u.defaultValue),onChange:e=>h({[u.name]:e.target.value})})}):(0,a.jsxs)(ex.Ay,{size:"medium",layout:"horizontal",value:null!=(n=u.value)?n:"",label:u.name,labelOptional:u.format,descriptionText:u.comment,disabled:!x,error:m[u.name],onChange:e=>h({[u.name]:e.target.value}),children:[(0,a.jsx)(ex.Ay.Option,{value:"",children:"---"}),u.enums.map(e=>(0,a.jsx)(ex.Ay.Option,{value:e,children:e},e))]});if(void 0!==u.foreignKey)return(0,a.jsx)(er.A,{"data-testid":"".concat(u.name,"-input"),layout:"horizontal",placeholder:null!==u.defaultValue?"Default: ".concat(u.defaultValue):"NULL",label:u.name,value:null!=(l=u.value)?l:"",descriptionText:(0,a.jsxs)(a.Fragment,{children:[u.comment&&(0,a.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[u.comment," "]}),(0,a.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[u.comment&&"(","Has a foreign key relation to"]}),(0,a.jsxs)("span",{className:"text-code font-mono text-xs text-foreground-lighter",children:[u.foreignKey.target_table_schema,".",u.foreignKey.target_table_name,".",u.foreignKey.target_column_name]}),u.comment&&(0,a.jsx)("span",{className:"text-sm text-foreground-lighter",children:")"})]}),labelOptional:u.format,disabled:!x,error:m[u.name],onChange:e=>h({[u.name]:e.target.value}),actions:x&&(0,a.jsxs)(ev.rI,{children:[(0,a.jsx)(ev.ty,{asChild:!0,children:(0,a.jsx)(ei.$,{type:"default",icon:(0,a.jsx)(tI.A,{}),className:"px-1.5"})}),(0,a.jsxs)(ev.SQ,{align:"end",className:"w-28",children:[u.isNullable&&(0,a.jsx)(ev._2,{onClick:()=>h({[u.name]:null}),children:"Set to NULL"}),(0,a.jsx)(ev._2,{onClick:y,children:"Select record"})]})]})});if(tL()(em.AL,u.format)){let e=(0,e7.Mr)(u.value);return(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(er.A.TextArea,{"data-testid":"".concat(u.name,"-input"),layout:"horizontal",label:u.name,className:"input-sm",descriptionText:(0,a.jsxs)(a.Fragment,{children:[u.comment&&(0,a.jsx)("p",{children:u.comment}),e&&(0,a.jsx)("p",{children:tq})]}),textAreaClassName:"pr-8",labelOptional:u.format,disabled:!x||e,error:m[u.name],rows:5,value:null!=(s=u.value)?s:"",placeholder:null===u.value&&null===u.defaultValue?"NULL":""===u.value||"string"==typeof u.defaultValue&&0===u.defaultValue.length?"EMPTY":"Default: ".concat(u.defaultValue),actions:(0,a.jsxs)(ev.rI,{children:[(0,a.jsx)(ev.ty,{asChild:!0,children:(0,a.jsx)(ei.$,{type:"default",icon:(0,a.jsx)(tI.A,{}),className:"px-1.5"})}),(0,a.jsxs)(ev.SQ,{align:"end",className:"w-28",children:[x&&(0,a.jsx)(ev._2,{onClick:()=>h({[u.name]:null}),children:"Set to NULL"}),(0,a.jsx)(ev._2,{onClick:()=>f({column:u.name,value:u.value||""}),children:"Expand editor"})]})]}),onChange:e=>h({[u.name]:e.target.value})})})}if(tL()(em.J_,u.format)){let e=(0,e7.Mr)(u.value);return(0,a.jsx)(er.A,{"data-testid":"".concat(u.name,"-input"),layout:"horizontal",value:null!=(r=u.value)?r:"",label:u.name,descriptionText:(0,a.jsxs)(a.Fragment,{children:[u.comment&&(0,a.jsx)("p",{children:u.comment}),e&&(0,a.jsx)("p",{children:tq})]}),labelOptional:u.format,disabled:!x||e,placeholder:(null==u?void 0:u.defaultValue)?"Default: ".concat(u.defaultValue):"NULL",error:m[u.name],onChange:e=>h({[u.name]:e.target.value}),actions:(0,a.jsx)(ei.$,{type:"default",htmlType:"button",onClick:()=>p({column:u.name,value:u.value}),icon:x?(0,a.jsx)(tI.A,{}):(0,a.jsx)(tF.A,{}),children:x?"Edit":"View JSON"})})}if(tL()(em.mN,u.format))return(0,a.jsx)(tM,{name:u.name,format:u.format,value:null!=(i=u.value)?i:"",isNullable:u.isNullable,description:(0,a.jsxs)(a.Fragment,{children:[u.defaultValue&&(0,a.jsxs)("p",{children:["Default: ",u.defaultValue]}),u.comment&&(0,a.jsx)("p",{children:u.comment})]}),onChange:e=>h({[u.name]:e}),disabled:!x});if("bool"===u.format){let e=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"},...u.isNullable?[{value:"null",label:"NULL"}]:[]],t=null===u.value?void 0:u.value;return(0,a.jsx)(tO.M,{isReactForm:!1,layout:"horizontal",label:u.name,labelOptional:u.format,description:u.comment,className:"[&>div:first-child>span]:text-foreground-lighter",children:(0,a.jsxs)(tD.l6,{value:null===t?"null":t,onValueChange:e=>h({[u.name]:e}),disabled:!x,children:[(0,a.jsx)(tD.bq,{children:(0,a.jsx)(tD.yv,{placeholder:"Select a value"})}),(0,a.jsx)(tD.gC,{children:(0,a.jsx)(tD.s3,{children:e.map(e=>(0,a.jsx)(tD.eb,{value:e.value,children:e.label},e.value))})})]})})}if("bytea"===u.format)return(0,a.jsx)(er.A,{"data-testid":"".concat(u.name,"-input"),layout:"horizontal",label:u.name,descriptionText:(0,a.jsxs)(a.Fragment,{children:[u.comment&&(0,a.jsx)("p",{children:u.comment}),(0,a.jsx)("p",{children:"Bytea columns are edited and displayed as hex in the dashboard"})]}),labelOptional:u.format,error:m[u.name],value:null!=(o=u.value)?o:"",placeholder:"\\x",disabled:!x,onChange:e=>h({[u.name]:e.target.value})});let g=(0,e7.Mr)(u.value);return(0,a.jsx)(er.A,{"data-testid":"".concat(u.name,"-input"),layout:"horizontal",label:u.name,descriptionText:(0,a.jsxs)(a.Fragment,{children:[u.comment&&(0,a.jsx)("p",{children:u.comment}),g&&(0,a.jsx)("p",{children:tq})]}),labelOptional:u.format,error:m[u.name],value:null!=(c=u.value)?c:"",placeholder:u.isIdentity?"Automatically generated as identity":null!==u.defaultValue?"Default: ".concat(u.defaultValue):"NULL",disabled:!x||g,onChange:e=>h({[u.name]:e.target.value}),actions:g?(0,a.jsx)(ei.$,{type:"default",htmlType:"button",onClick:()=>p({column:u.name,value:u.value}),icon:x?(0,a.jsx)(tI.A,{}):(0,a.jsx)(tF.A,{}),children:x?"Edit":"View"}):void 0,"data-sentry-element":"Input","data-sentry-component":"InputField","data-sentry-source-file":"InputField.tsx"})};var tU=n(60417),tY=n(29445);let tW=e=>{let{visible:t,readOnly:n=!1,row:l,column:s,closePanel:r,onSaveField:i}=e,{id:o}=(0,x.g)(),c=o?Number(o):void 0,{data:d}=(0,z.YA)(),{data:h}=(0,ew.Pk)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,id:c}),[p,f]=(0,u.useState)(""),[y,g]=(0,u.useState)("edit"),v=null==l?void 0:l[s],j=(0,e7.Mr)(v),{mutate:b,isPending:N,isSuccess:w,reset:C}=(0,tf.c2)();(0,u.useEffect)(()=>{t&&(g("edit"),f(v))},[t]);let S=(0,u.useCallback)(()=>{C(),r()},[C]);return(0,a.jsx)(es.Ay,{size:"large",visible:t,onCancel:S,header:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{children:[n?"Viewing":"Editing"," value of: ",(0,a.jsx)("code",{children:s})]}),(!j||j&&w)&&(0,a.jsx)(tp.A,{options:["view","edit"],activeOption:y,borderOverride:"border-muted",onClickOption:g})]}),customFooter:(0,a.jsx)(ed.A,{hideApply:n,closePanel:S,backButtonLabel:"Cancel",applyButtonLabel:"Save value",applyFunction:n?void 0:e=>{i&&i(p,e)}}),"data-sentry-element":"SidePanel","data-sentry-component":"TextEditor","data-sentry-source-file":"TextEditor.tsx",children:(0,a.jsxs)("div",{className:"relative flex flex-auto h-full flex-col gap-y-4",children:["edit"===y?(0,a.jsx)("div",{className:"w-full h-full flex-grow",children:(0,a.jsx)(tA.Editor,{theme:"supabase",className:"monaco-editor",defaultLanguage:"markdown",value:p,loading:(0,a.jsx)(te.A,{className:"animate-spin",strokeWidth:2,size:20}),options:{readOnly:n,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:e=>f(null!=e?e:"")},v)}):(0,a.jsx)(es.Ay.Content,{className:"py-4 bg-default flex-grow",children:(0,a.jsx)(tY.o,{remarkPlugins:[tU.A],className:"bg-default markdown-body",content:p})}),j&&!w&&(0,a.jsxs)("div",{className:(0,eW.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,a.jsxs)("p",{children:["Text value is larger than ",tx.SF.toLocaleString()," characters"]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire text value, but your browser may run into performance issues"})]}),(0,a.jsx)(ei.$,{type:"default",loading:N,onClick:()=>{if(void 0===h||void 0===d||void 0===l||!(0,A.KO)(h))return;if(0===h.primary_keys.length)return(0,m.oR)("Unable to load value as table has no primary keys");let e=h.primary_keys.reduce((e,t)=>({...e,[t.name]:l[t.name]}),{});b({table:{schema:h.schema,name:h.name},column:s,pkMatch:e,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString},{onSuccess:e=>f(e)})},children:"Load full text data"})]})]})})},tV=e=>{var t,n,l,s;let{row:i,selectedTable:o,visible:c=!1,editable:m=!0,closePanel:x=d(),saveChanges:h=d(),updateEditorDirty:p=d()}=e,[f,y]=(0,u.useState)({}),[g,v]=(0,u.useState)([]),[j,b]=(0,u.useState)(),[N,w]=(0,u.useState)(),[C,S]=(0,u.useState)(!1),[A,k]=(0,u.useState)(),E=void 0===i,_=void 0!==j,R=void 0!==N,[T,P]=(0,u.useState)(!1),[L,I]=tR()(g,e=>!e.isNullable),{data:F}=(0,z.YA)(),{data:D}=(0,et.Hw)({projectRef:null==F?void 0:F.ref,connectionString:null==F?void 0:F.connectionString,schema:o.schema}),O=(0,eu.C)((null!=D?D:[]).filter(e=>e.source_schema===(null==o?void 0:o.schema)&&e.source_table===(null==o?void 0:o.name))),K=(0,u.useMemo)(()=>{var e;return O&&(null==A||null==(e=A.foreignKey)?void 0:e.id)?O.find(e=>{var t;return e.id===(null==(t=A.foreignKey)?void 0:t.id)}):void 0},[O,null==A||null==(t=A.foreignKey)?void 0:t.id]);(0,u.useEffect)(()=>{c&&(y({}),v((0,e7.jm)(i,o,O)))},[c]);let M=e=>{let t=Object.keys(e);v(g.map(n=>t.includes(n.name)?{...n,value:e[n.name]}:n)),p()},q=async e=>{S(!0),k(e)},B=(0,u.useMemo)(()=>g.reduce((e,t)=>(e[t.name]=t.value,e),{}),[g]);return(0,a.jsxs)(es.Ay,{"data-testid":"side-panel-row-editor",hideFooter:!0,size:"large",visible:c,header:(0,a.jsx)(tT,{isNewRecord:E,tableName:o.name}),className:"transition-all duration-100 ease-in ".concat(_||R||C?" mr-32":""),onCancel:x,"data-sentry-element":"SidePanel","data-sentry-component":"RowEditor","data-sentry-source-file":"RowEditor.tsx",children:[(0,a.jsx)("form",{onSubmit:e=>(e=>{e.preventDefault();let t=(0,e7.MG)(g);if(y(t),P(!0),r()(t)){p();let e=E?(0,e7.Gk)(g):(0,e7.F2)(i,g),t={identifiers:{},rowIdx:-1};if(!E){let e=g.filter(e=>e.isPrimaryKey),n={};e.forEach(e=>{n[e.name]="bytea"===e.format?(0,e7.ds)(i[e.name]):i[e.name]}),t.identifiers=n,t.rowIdx=i.idx}h(e,E,t,()=>P(!1))}else P(!1)})(e),className:"h-full",children:(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-grow flex-col",children:[L.length>0&&(0,a.jsx)(es.Ay.Content,{children:(0,a.jsx)("div",{className:"space-y-10 py-6",children:L.map(e=>(0,a.jsx)(tB,{field:e,errors:f,onUpdateField:M,onEditJson:w,onEditText:b,onSelectForeignKey:()=>q(e),isEditable:m},e.id))})}),I.length>0&&(0,a.jsxs)(a.Fragment,{children:[L.length>0&&(0,a.jsx)(es.Ay.Separator,{}),(0,a.jsx)(es.Ay.Content,{children:(0,a.jsxs)("div",{className:"space-y-10 py-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base text-foreground",children:"Optional Fields"}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"These are columns that do not need any value"})]}),I.map(e=>(0,a.jsx)(tB,{field:e,errors:f,onUpdateField:M,onEditText:b,onEditJson:w,onSelectForeignKey:()=>q(e),isEditable:m},e.id))]})})]}),(0,a.jsx)(tW,{visible:_,row:B,column:null!=(n=null==j?void 0:j.column)?n:"",closePanel:()=>b(void 0),onSaveField:e=>{var t;M({[null!=(t=null==j?void 0:j.column)?t:""]:e}),b(void 0)},readOnly:!m,"data-sentry-element":"TextEditor","data-sentry-source-file":"RowEditor.tsx"}),(0,a.jsx)(tE,{visible:R,row:B,column:null!=(l=null==N?void 0:N.column)?l:"",closePanel:()=>w(void 0),onSaveJSON:e=>{var t;M({[null!=(t=null==N?void 0:N.column)?t:""]:e}),w(void 0)},readOnly:!m,"data-sentry-element":"JsonEditor","data-sentry-source-file":"RowEditor.tsx"})]}),(0,a.jsx)("div",{className:"flex-shrink",children:(0,a.jsx)(ed.A,{loading:T,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:x,hideApply:!m,"data-sentry-element":"ActionBar","data-sentry-source-file":"RowEditor.tsx"})})]})}),(0,a.jsx)(tm,{visible:C,foreignKey:K,onSelect:e=>{void 0!==A&&void 0!==e&&M(e),S(!1),k(void 0)},closePanel:()=>{S(!1),k(void 0)},"data-sentry-element":"ForeignRowSelector","data-sentry-source-file":"RowEditor.tsx"},"foreign-row-selector-".concat(null!=(s=null==K?void 0:K.id)?s:"null"))]},"RowEditor")};var tH=n(45027),t$=n(62140),tJ=n.n(t$),tQ=n(48388),tG=n.n(tQ),tZ=n(77191),tX=n.n(tZ),t0=n(83994);async function t1(e){let{projectRef:t,connectionString:n,payload:a}=e,{sql:l}=h.A.columns.create({schema:a.schema,table:a.table,name:a.name,type:a.type,default_value:a.defaultValue,default_value_format:a.defaultValueFormat,is_identity:a.isIdentity,identity_generation:a.identityGeneration,is_nullable:a.isNullable,is_primary_key:a.isPrimaryKey,is_unique:a.isUnique,comment:a.comment,check:a.check}),{result:s}=await (0,f.E)({projectRef:t,connectionString:n,sql:l,queryKey:["column","create"]});return s}var t2=n(20426);async function t3(e){let{projectRef:t,connectionString:n,originalColumn:a,payload:l}=e,{sql:s}=h.A.columns.update(a,{name:l.name,type:l.type,drop_default:l.dropDefault,default_value:l.defaultValue,default_value_format:l.defaultValueFormat,is_identity:l.isIdentity,identity_generation:l.identityGeneration,is_nullable:l.isNullable,is_unique:l.isUnique,comment:l.comment,check:l.check}),{result:r}=await (0,f.E)({projectRef:t,connectionString:n,sql:s,queryKey:["column","update",a.id]});return r}var t5=n(89790),t4=n(71875),t8=n(75211);async function t6(e){let{projectRef:t,connectionString:n,payload:a}=e,{sql:l}=h.A.tables.create(a),{result:s}=await (0,f.E)({projectRef:t,connectionString:n,sql:l,queryKey:["table","create"]});return s}var t9=n(31582),t7=n(93424);let ne=async(e,t,n,a,l)=>{let s=l.join('","'),r='ALTER TABLE "'.concat(n,'"."').concat(a,'" ADD PRIMARY KEY ("').concat(s,'")');return await (0,f.E)({projectRef:e,connectionString:t,sql:r,queryKey:["primary-keys"]})},nt=async(e,t,n,a,l)=>{let s='ALTER TABLE "'.concat(n,'"."').concat(a,'" DROP CONSTRAINT "').concat(l,'"');return await (0,f.E)({projectRef:e,connectionString:t,sql:s,queryKey:["drop-constraint"]})},nn=e=>{let{table:t,foreignKeys:n}=e;return n.map(e=>{let{deletionAction:n,updateAction:a}=e,l=(e=>e===eD.P.CASCADE?"ON DELETE CASCADE":e===eD.P.RESTRICT?"ON DELETE RESTRICT":e===eD.P.SET_DEFAULT?"ON DELETE SET DEFAULT":e===eD.P.SET_NULL?"ON DELETE SET NULL":"")(n),s=(e=>e===eD.P.CASCADE?"ON UPDATE CASCADE":e===eD.P.RESTRICT?"ON UPDATE RESTRICT":"")(a);return'\n      ALTER TABLE "'.concat(t.schema,'"."').concat(t.name,'"\n      ADD FOREIGN KEY (').concat(e.columns.map(e=>'"'.concat(e.source,'"')).join(","),')\n      REFERENCES "').concat(e.schema,'"."').concat(e.table,'" (').concat(e.columns.map(e=>'"'.concat(e.target,'"')).join(","),")\n      ").concat(s,"\n      ").concat(l,"\n    ").replace(/\s+/g," ").trim()}).join(";")+";"},na=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l}=e,s=nn({table:a,foreignKeys:l});return await (0,f.E)({projectRef:t,connectionString:n,sql:s,queryKey:["foreign-keys"]})},nl=e=>{let{table:t,foreignKeys:n}=e;return n.map(e=>'\nALTER TABLE IF EXISTS "'.concat(t.schema,'"."').concat(t.name,'"\nDROP CONSTRAINT IF EXISTS "').concat(e.name,'"\n').replace(/\s+/g," ").trim()).join(";")+";"},ns=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l}=e,s=nl({table:a,foreignKeys:l});return await (0,f.E)({projectRef:t,connectionString:n,sql:s,queryKey:["foreign-keys"]})},nr=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l}=e,s="\n  ".concat(nl({table:a,foreignKeys:l}),"\n  ").concat(nn({table:a,foreignKeys:l}),"\n  ").replace(/\s+/g," ").trim();return await (0,f.E)({projectRef:t,connectionString:n,sql:s,queryKey:["foreign-keys"]})},ni=async e=>{let{projectRef:t,connectionString:n,payload:a,selectedTable:l,primaryKey:s,foreignKeyRelations:r=[],skipSuccessMessage:i=!1,toastId:o}=e,c=null!=o?o:m.oR.loading('Creating column "'.concat(a.name,'"...'));try{let{isPrimaryKey:e,...o}=a;if(await t1({projectRef:t,connectionString:n,payload:o}),e){m.oR.loading("Assigning primary key to column...",{id:c});let e=l.primary_keys.map(e=>e.name);e.length>0&&void 0!==s&&await nt(t,n,a.schema,a.table,s.name);let r=e.concat([o.name]);await ne(t,n,a.schema,a.table,r)}return r.length>0&&await na({projectRef:t,connectionString:n,table:{schema:a.schema,name:a.table},foreignKeys:r}),i||m.oR.success('Successfully created column "'.concat(o.name,'"'),{id:c}),{error:void 0}}catch(e){return m.oR.error('An error occurred while creating the column "'.concat(a.name,'"'),{id:c}),{error:e}}},no=async e=>{let{projectRef:t,connectionString:n,originalColumn:a,payload:l,selectedTable:s,primaryKey:r,foreignKeyRelations:i=[],existingForeignKeyRelations:o=[],skipPKCreation:c,skipSuccessMessage:d=!1}=e;try{let{isPrimaryKey:e,...x}=l;if(await t3({projectRef:t,connectionString:n,originalColumn:a,payload:x}),!c&&void 0!==e){var u;let l=s.primary_keys.map(e=>e.name);l.length>0&&void 0!==r&&await nt(t,n,a.schema,a.table,r.name);let i=null!=(u=x.name)?u:a.name,o=e?l.concat([i]):l.filter(e=>e!==i);o.length&&await ne(t,n,a.schema,a.table,o)}i.length>0&&await np({projectRef:t,connectionString:n,table:{schema:a.schema,name:a.table},foreignKeys:i,existingForeignKeyRelations:o}),d||m.oR.success('Successfully updated column "'.concat(a.name,'"'))}catch(e){return{error:e}}},nc=async(e,t,n,a)=>{let l=(0,t8.SX)(),{duplicateTable:s,isRLSEnabled:r,isDuplicateRows:i,foreignKeyRelations:o}=a,{name:c,schema:d}=s,u=n.name;if(await (0,f.E)({projectRef:e,connectionString:t,sql:['CREATE TABLE "'.concat(d,'"."').concat(u,'" (LIKE "').concat(d,'"."').concat(c,'" INCLUDING ALL);'),void 0!=n.comment?'comment on table "'.concat(d,'"."').concat(u,"\" is '").concat(n.comment,"';"):""].join("\n")}),await l.invalidateQueries({queryKey:D.v.list(e,d)}),o.length>0&&await na({projectRef:e,connectionString:t,table:{...s,name:n.name},foreignKeys:o}),i){var m;await (0,f.E)({projectRef:e,connectionString:t,sql:'INSERT INTO "'.concat(d,'"."').concat(u,'" SELECT * FROM "').concat(d,'"."').concat(c,'";')}),(null!=(m=s.columns)?m:[]).filter(e=>null!==e.identity_generation).map(async n=>{await (0,f.E)({projectRef:e,connectionString:t,sql:"SELECT setval('\"".concat(d,'"."').concat(u,"_").concat(n.name,'_seq"\', (SELECT MAX("').concat(n.name,'") FROM "').concat(d,'"."').concat(c,'"));')})})}let x=await l.fetchQuery({queryKey:D.v.list(e,d),queryFn:n=>{let{signal:a}=n;return(0,O.oI)({projectRef:e,connectionString:t,schema:d},a)}}),h=tG()(x,{schema:d,name:u});return r&&await (0,t7.a)({projectRef:e,connectionString:t,id:null==h?void 0:h.id,name:null==h?void 0:h.name,schema:null==h?void 0:h.schema,payload:{rls_enabled:r}}),h},nd=async e=>{let{projectRef:t,connectionString:n,toastId:l,payload:s,columns:r=[],foreignKeyRelations:i,isRLSEnabled:o,importContent:c,organizationSlug:d}=e,u=(0,t8.SX)();await t6({projectRef:t,connectionString:n,payload:s});try{await (0,_.B)({event:{action:"table_created",properties:{method:"table_editor",schema_name:s.schema,table_name:s.name},groups:{project:t,...d&&{organization:d}}}})}catch(e){console.error("Failed to track table creation event:",e)}let x=await u.fetchQuery({queryKey:D.v.retrieve(t,s.name,s.schema),queryFn:e=>{let{signal:a}=e;return(0,ez.V)({projectRef:t,connectionString:n,name:s.name,schema:s.schema},a)}});try{if(o){await (0,t7.a)({projectRef:t,connectionString:n,id:x.id,name:x.name,schema:x.schema,payload:{rls_enabled:o}});try{await (0,_.B)({event:{action:"table_rls_enabled",properties:{method:"table_editor",schema_name:x.schema,table_name:x.name},groups:{project:t,...d&&{organization:d}}}})}catch(e){console.error("Failed to track RLS enablement event:",e)}}for(let e of(m.oR.loading("Adding ".concat(r.length," columns to ").concat(x.name,"..."),{id:l}),r)){let a=(0,eN.Oj)(x,{...e,isPrimaryKey:!1});await t1({projectRef:t,connectionString:n,payload:a})}let e=r.filter(e=>e.isPrimaryKey).map(e=>e.name);if(e.length>0&&await ne(t,n,x.schema,x.name,e),i.length>0&&await na({projectRef:t,connectionString:n,table:{schema:x.schema,name:x.name},foreignKeys:i}),void 0!==c)if(c.file&&c.rowCount>0){let{error:e}=await nx(t,n,c.file,x,c.selectedHeaders,e=>{m.oR.loading((0,a.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,a.jsx)(t0.A,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rowCount.toLocaleString()," rows to ").concat(x.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:l})});for(let e of r.filter(e=>e.isIdentity))await (0,f.E)({projectRef:t,connectionString:n,sql:"SELECT setval('".concat(x.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(x.name,'"));')});if(void 0!==e){m.oR.error("Do check your spreadsheet if there are any discrepancies.");let t="Table ".concat(x.name," has been created but we ran into an error while inserting rows: ").concat(e.message);m.oR.error(t),console.error("Error:",{error:e,message:t})}}else for(let e of(await nh(t,n,x,c.rows,c.selectedHeaders,e=>{m.oR.loading((0,a.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,a.jsx)(t0.A,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rows.length.toLocaleString()," rows to ").concat(x.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:l})}),r.filter(e=>e.isIdentity)))await (0,f.E)({projectRef:t,connectionString:n,sql:"SELECT setval('".concat(x.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(x.name,'"));')});return await (0,t4.q3)({queryClient:u,projectRef:t,connectionString:n,id:x.id}),x}catch(e){throw(0,t9.k)({projectRef:t,connectionString:n,id:x.id,name:x.name,schema:x.schema}),e}},nu=async e=>{var t,n,a,l;let{projectRef:s,connectionString:i,toastId:o,table:c,payload:d,columns:u,foreignKeyRelations:x,existingForeignKeyRelations:h,primaryKey:p,organizationSlug:f}=e,y=(0,t8.SX)(),g=u.filter(e=>e.isPrimaryKey).map(e=>e.name),v=c.primary_keys.map(e=>e.name),j=!eJ()(g,v);if(j&&void 0!==p&&await nt(s,i,c.schema,c.name,p.name),Object.keys(d).length>0&&await (0,t7.a)({projectRef:s,connectionString:i,id:c.id,name:c.name,schema:c.schema,payload:d}),!0===d.rls_enabled)try{await (0,_.B)({event:{action:"table_rls_enabled",properties:{method:"table_editor",schema_name:c.schema,table_name:null!=(t=d.name)?t:c.name},groups:{project:s,...f&&{organization:f}}}})}catch(e){console.error("Failed to track RLS enablement event:",e)}let b=await y.fetchQuery({queryKey:D.v.retrieve(s,null!=(n=d.name)?n:c.name,null!=(a=d.schema)?a:c.schema),queryFn:e=>{var t,n;let{signal:a}=e;return(0,ez.V)({projectRef:s,connectionString:i,name:null!=(t=d.name)?t:c.name,schema:null!=(n=d.schema)?n:c.schema},a)}}),w=null!=(l=b.columns)?l:[],A=u.map(e=>e.id);for(let e of w.filter(e=>!A.includes(e.id)))m.oR.loading("Removing column ".concat(e.name," from ").concat(b.name),{id:o}),await (0,t2.z)({projectRef:s,connectionString:i,column:e});let E=!1;for(let e of u)if(e.id.includes(c.id.toString())){let t=tG()(c.columns,{id:e.id});if(t){let n=(0,eN.f9)(t,b,e);if(!r()(n)){m.oR.loading("Updating column ".concat(e.name," from ").concat(b.name),{id:o});let a=await no({projectRef:s,connectionString:i,originalColumn:{...t,table:b.name,schema:b.schema},payload:n,selectedTable:b,skipPKCreation:!0,skipSuccessMessage:!0});(null==a?void 0:a.error)&&(E=!0,m.oR.error('Failed to update column "'.concat(e.name,'": ').concat(a.error.message)))}}}else{m.oR.loading("Adding column ".concat(e.name," to ").concat(b.name),{id:o});let t=(0,eN.Oj)(b,{...e,isPrimaryKey:!1}),{error:n}=await ni({projectRef:s,connectionString:i,payload:t,selectedTable:b,skipSuccessMessage:!0,toastId:o});n&&(E=!0)}return j&&g.length>0&&await ne(s,i,b.schema,b.name,g),await np({projectRef:s,connectionString:i,table:b,foreignKeys:x,existingForeignKeyRelations:h}),await Promise.all([y.invalidateQueries({queryKey:S.i.tableEditor(s,c.id)}),y.invalidateQueries({queryKey:N.c.foreignKeyConstraints(s,c.schema)}),y.invalidateQueries({queryKey:N.c.tableDefinition(s,c.id)}),y.invalidateQueries({queryKey:C.C.list(s)}),y.invalidateQueries({queryKey:D.v.list(s,c.schema,!0)}),y.invalidateQueries({queryKey:t5.O.lint(s)})]),await y.invalidateQueries({queryKey:k.j.tableRowsAndCount(s,c.id)}),{table:await (0,ew.Nj)(y,{projectRef:s,connectionString:i,id:c.id}),hasError:E}},nm=e=>{let{rows:t,headers:n,columns:a=[]}=e;return t.map(e=>{let t={};return n.forEach(n=>{var l,s;let r=null==a?void 0:a.find(e=>e.name===n),i=e[n];if((null!=(l=null==r?void 0:r.format)?l:"").includes("json"))t[n]=(0,eM.Bl)(i);else if((null!=(s=null==r?void 0:r.data_type)?s:"")==="ARRAY")if("string"==typeof i&&i.startsWith("{")&&i.endsWith("}")){let e="[".concat(i.slice(1,i.length-1),"]");t[n]=(0,eM.Bl)(e)}else t[n]=(0,eM.Bl)(i);else""===i?t[n]=(null==r?void 0:r.is_nullable)?null:"":t[n]=i}),t})},nx=async(e,t,n,a,l,s)=>{let r,i=0,o=new Date;return new Promise(c=>{tX().parse(n,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,chunkSize:104857.6,quoteChar:"text/tab-separated-values"===n.type?"":'"',chunk:async(o,c)=>{c.pause();let d=nm({rows:o.data,headers:l,columns:a.columns}),u=new E.Query().from(a.name,a.schema).insert(d).toSql();try{await (0,e6.sE)(()=>(0,f.E)({projectRef:e,connectionString:t,sql:u}))}catch(e){console.warn(e),r=e,c.abort()}let m=104857.6*(i+=1)/n.size;s(m>1?100:100*m),c.resume()},complete:()=>{let e=new Date;console.log("Total time taken for importing spreadsheet: ".concat((e-o)/1e3," seconds")),c({error:r})}})})},nh=async(e,t,n,a,l,s)=>{let r,i=0,o=nm({rows:a,headers:l,columns:n.columns}),c=tJ()(o,1e3).map(l=>()=>Promise.race([new Promise(async(s,o)=>{let c=new E.Query().from(n.name,n.schema).insert(l).toSql();try{await (0,f.E)({projectRef:e,connectionString:t,sql:c})}catch(e){r=e,o(e)}i+=l.length/a.length,s({})}),(0,eM.wR)(3e4)]));for(let e of tJ()(c,10)){let t=await Promise.allSettled(e.map(e=>e()));if(tG()(t,{status:"rejected"}))break;s(100*i)}return{error:r}},np=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l,existingForeignKeyRelations:s}=e,r=l.filter(e=>"string"==typeof e.id);r.length>0&&await na({projectRef:t,connectionString:n,table:a,foreignKeys:r});let i=l.filter(e=>e.toRemove);i.length>0&&await ns({projectRef:t,connectionString:n,table:a,foreignKeys:i});let o=l.filter(e=>"number"==typeof e.id&&!e.toRemove).filter(e=>{let t=s.find(t=>e.id===t.id);return void 0!==t&&eQ(t,e)});o.length>0&&await nr({projectRef:t,connectionString:n,table:a,foreignKeys:o})};var nf=n(77796),ny=n.n(nf),ng=n(99287),nv=n(2534);let nj=e=>{let{parseProgress:t,uploadedFile:n,onFileUpload:l,removeUploadedFile:s}=e,[r,i]=(0,u.useState)(!1),o=(0,u.useRef)(null),c=e=>{"dragover"!==e.type||r?("dragleave"===e.type||"drop"===e.type)&&i(!1):i(!0),e.stopPropagation(),e.preventDefault()};return(0,a.jsxs)("div",{className:"space-y-4","data-sentry-component":"SpreadSheetFileUpload","data-sentry-source-file":"SpreadSheetFileUpload.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,a.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,a.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),n?(0,a.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed border-strong",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(nv.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("p",{className:"text-sm text-foreground",children:n.name})]}),100===t?(0,a.jsx)(ei.$,{type:"outline",onClick:s,children:"Remove File"}):(0,a.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,a.jsx)(te.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)(t0.A,{value:t,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:"".concat(t,"%")})]})]}):(0,a.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed border-strong ".concat(r?"bg-gray-500":""),onDragOver:c,onDragLeave:c,onDrop:e=>{c(e),l(e)},onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},children:(0,a.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,a.jsx)("span",{className:"text-brand",children:"browse"})," your files"]})}),(0,a.jsx)("input",{ref:o,className:"hidden",type:"file",onChange:l})]})};var nb=n(76174),nN=n(12123),nw=n(14561),nC=n(60793);let nS=e=>{let{headers:t=[],rows:n=[],height:l}=e,s=t.slice(0,20),r=n.slice(0,20);return(0,a.jsx)(tl.Ay,{columns:s.map(e=>{let t=Math.max(Math.max(...r.map(t=>{var n,a;return null!=(a=null==(n=t[e])?void 0:n.toString())?a:""}).map(e=>e.length)),e.length);return{key:e,name:e,width:t>20?200:10*t,resizable:!0,renderHeaderCell:()=>(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-xs",children:e})}),renderCell:t=>{let{row:n}=t,l=!n[e];return(0,a.jsx)("span",{className:(0,eW.cn)("text-sm flex items-center",l&&"text-foreground-light"),children:l?"NULL":n[e]})}}}),rows:r,className:"!border-l !border-r",style:{height:l||"".concat(34+34*(r.length||1),"px")},"data-sentry-element":"DataGrid","data-sentry-component":"SpreadsheetPreviewGrid","data-sentry-source-file":"SpreadsheetPreviewGrid.tsx"})},nA=e=>{let{selectedTable:t,spreadsheetData:n,errors:l=[],selectedHeaders:s,incompatibleHeaders:r}=e,[i,o]=(0,u.useState)(!1),[c,d]=(0,u.useState)([]),{headers:m,rows:x}=n,h=m.filter(e=>s.includes(e)).slice(0,20),p=x.slice(0,20),f=void 0===t||0===r.length;(0,u.useEffect)(()=>{o(!0)},[n]);let y=l.filter((e,t,n)=>t===n.findIndex(t=>t.row===e.row&&t.code===e.code));return(0,a.jsxs)(nw.Ay,{open:i,onOpenChange:o,className:"","data-sentry-element":"Collapsible","data-sentry-component":"SpreadsheetImportPreview","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:[(0,a.jsx)(nw.Ay.Trigger,{asChild:!0,"data-sentry-element":"Collapsible.Trigger","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:(0,a.jsx)(es.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:(0,a.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!f&&(0,a.jsx)(eV.E,{variant:"destructive",children:"Data incompatible"}),y.length>0&&(0,a.jsxs)(eV.E,{variant:"warning",children:[y.length," ",1===y.length?"issue":"issues"," found"]})]}),(0,a.jsx)(ei.$,{type:"text",icon:(0,a.jsx)(nb.A,{size:18,strokeWidth:2,className:(0,eW.cn)("text-foreground-light",i&&"rotate-180")}),className:"px-1",onClick:()=>o(!i),"data-sentry-element":"Button","data-sentry-source-file":"SpreadsheetImportPreview.tsx"})]})})}),(0,a.jsx)(nw.Ay.Content,{"data-sentry-element":"Collapsible.Content","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:(0,a.jsxs)(es.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:void 0===t?"Your table will have ".concat(n.rowCount.toLocaleString()," rows and the\n                        following ").concat(n.headers.length," columns."):"A total of ".concat(n.rowCount.toLocaleString(),' rows will be added to the table "').concat(t.name,'"')}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,a.jsx)("div",{className:"mb-4",children:h.length>0&&p.length>0?(0,a.jsx)(nS,{height:350,headers:h,rows:p}):(0,a.jsxs)("div",{className:"flex items-center justify-center py-4 border border-control rounded-md space-x-2",children:[(0,a.jsx)(nN.A,{size:16,strokeWidth:1.5,className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:0===h.length?"No headers have been selected":0===p.length?"Your CSV contains no data":""})]})}),(!f||y.length>0)&&(0,a.jsxs)(eL.Fc,{variant:"warning",className:"my-4",children:[(0,a.jsx)(nC.id,{}),(0,a.jsx)(eL.XL,{children:"Issues found in spreadsheet"}),(0,a.jsx)(eL.TN,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[f?(0,a.jsx)("p",{className:"text-sm",children:void 0!==t?"This CSV can still be imported, but we found ".concat(1===y.length?"an issue":"issues",":"):"You can still create the table, but we found ".concat(1===y.length?"an issue":"issues",":")}):(0,a.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,a.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers."]}),!f&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)("div",{className:"size-[14px] flex items-center justify-center translate-y-[3px]",children:(0,a.jsx)("div",{className:"size-[6px] rounded-full bg-foreground-lighter"})}),(0,a.jsxs)("p",{className:"text-sm",children:["The column",r.length>1?"s":""," ",r.map(e=>'"'.concat(e,'"')).join(", ")," ",r.length>1?"are":"is"," not present in your table"]})]})}),(0,a.jsx)("ul",{className:"space-y-2 list-none",children:y.map((e,t)=>{let l="import-error-".concat(t),s=c.includes(l),r=e.data;return(0,a.jsxs)("li",{className:"space-y-2",children:[void 0!==r?(0,a.jsxs)("button",{type:"button",className:"flex items-center space-x-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary",onClick:()=>(e=>{c.includes(e)?d(c.filter(t=>t!==e)):d(c.concat([e]))})(l),"aria-expanded":s,"aria-controls":"".concat(l,"-panel"),"aria-labelledby":"".concat(l,"-summary"),children:[(0,a.jsx)(tj.A,{size:14,className:(0,eW.cn)("transform transition-transform",{"rotate-90":s}),"aria-hidden":"true"}),(0,a.jsx)("span",{id:"".concat(l,"-summary"),className:"sr-only",children:"Toggle details for row ".concat(e.row)}),(0,a.jsxs)("p",{className:"text-sm",children:["Row ",e.row,":"]}),(0,a.jsx)("p",{className:"text-sm",children:e.message}),(null==r?void 0:r.__parsed_extra)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eR.A,{size:14,"aria-hidden":"true"}),(0,a.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),(0,a.jsx)("ul",{className:"ml-2 list-disc",children:r.__parsed_extra.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)("code",{className:"text-xs",children:e})},t))})]})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"size-[14px] flex items-center justify-center","aria-hidden":"true",children:(0,a.jsx)("div",{className:"size-[6px] rounded-full bg-foreground-lighter"})}),(0,a.jsxs)("p",{className:"text-sm",children:["Row ",e.row,":"]}),(0,a.jsx)("p",{className:"text-sm",children:e.message})]}),void 0!==r&&s&&(0,a.jsx)(nS,{headers:n.headers,rows:[r]})]},l)})})]})})]})]})})]})},nk=e=>{let{spreadsheetData:t,selectedHeaders:n,onToggleHeader:l}=e,[s,r]=(0,u.useState)(!1);return(0,a.jsxs)(nw.Ay,{open:s,onOpenChange:r,className:"","data-sentry-element":"Collapsible","data-sentry-component":"SpreadsheetImportConfiguration","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:[(0,a.jsx)(nw.Ay.Trigger,{asChild:!0,"data-sentry-element":"Collapsible.Trigger","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsx)(es.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,a.jsx)(ei.$,{type:"text",icon:(0,a.jsx)(nb.A,{size:18,strokeWidth:2,className:(0,eW.cn)("text-foreground-light",s&&"rotate-180")}),className:"px-1",onClick:()=>r(!s),"data-sentry-element":"Button","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx"})]})})}),(0,a.jsx)(nw.Ay.Content,{"data-sentry-element":"Collapsible.Content","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsx)(es.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsxs)("div",{className:"py-2 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which columns to import"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,a.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:t.headers.map(e=>{let t=n.includes(e);return(0,a.jsx)(ei.$,{type:t?"primary":"default",className:(0,eW.cn)("transition",t?"opacity-100":"opacity-75"),onClick:()=>l(e),children:e},e)})})]})})})]})},nE=e=>{let{input:t,onInputChange:n}=e;return(0,a.jsxs)("div",{className:"space-y-10","data-sentry-component":"SpreadSheetTextInput","data-sentry-source-file":"SpreadSheetTextInput.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,a.jsx)("code",{children:"-"}),") or underscores (",(0,a.jsx)("code",{children:"_"}),")."]}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,a.jsx)(er.A.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:t,onChange:n,"data-sentry-element":"Input.TextArea","data-sentry-source-file":"SpreadSheetTextInput.tsx"})]})};var n_=n(62288),nR=n(50523),nT=n(56678);let nP="Some issues have been detected. More details below the content preview.",nL=e=>{var t,n;let{visible:l=!1,debounceDuration:s=250,headers:r=[],rows:i=[],selectedTable:o,saveContent:c,closePanel:h,updateEditorDirty:p=d()}=e,{ref:f}=(0,x.g)(),{data:y}=(0,R.s)(),g=(0,B.ap)(),v=(null==(t=g.sidePanel)?void 0:t.type)==="csv-import"?g.sidePanel.file:void 0,j=(0,nT.u)(l),[b,N]=(0,u.useState)("fileUpload"),[w,C]=(0,u.useState)(""),[S,A]=(0,u.useState)(),[k,E]=(0,u.useState)(0),[T,P]=(0,u.useState)({headers:r,rows:i,rowCount:0,columnTypeMap:{}}),[L,I]=(0,u.useState)([]),[F,D]=(0,u.useState)([]),{mutate:O}=(0,_.h)(),z=(null!=(n=null==o?void 0:o.columns)?n:[]).map(e=>e.name),K=F.filter(e=>!z.includes(e)),M=void 0===o||0===K.length,q=e=>{E(e)},U=(0,u.useCallback)(async e=>{p(!0),A(e),E(0);let{headers:t,rowCount:n,columnTypeMap:a,errors:l,previewRows:s}=await (0,nR.wg)(e,q);l.length>0&&m.oR.error(nP),I(l),D(t),P({headers:t,rows:s,rowCount:n,columnTypeMap:a})},[p]),Y=(0,u.useCallback)(async e=>{e.persist();let[t]=e.target.files||e.dataTransfer.files;t&&!(0,nR.Pz)(t)&&await U(t),e.target.value=""},[U]),W=(0,u.useCallback)(()=>{C(""),P(n_.gh),A(void 0),I([]),p(!1)},[p]),V=async e=>{if(e.length>0){let{headers:t,rows:n,columnTypeMap:a,errors:l}=await (0,nR.d2)(e);l.length>0&&m.oR.error(nP),I(l),D(t),P({headers:t,rows:n,rowCount:n.length,columnTypeMap:a})}else P(n_.gh)},H=(0,u.useCallback)(ny()(V,s),[]);return(0,u.useEffect)(()=>{j&&l&&(v?U(v):0===r.length&&W())},[j,l,v,U,r.length,W]),(0,a.jsxs)(es.Ay,{size:"large",visible:l,align:"right",header:void 0!==o?(0,a.jsxs)(a.Fragment,{children:["Add data to"," ",(0,a.jsxs)("code",{className:"text-sm",children:[o.schema,".",o.name]})]}):"Add content to new table",onCancel:()=>h(),customFooter:(0,a.jsx)(ed.A,{backButtonLabel:"Cancel",applyButtonLabel:void 0===o?"Save":"Import data",closePanel:h,applyFunction:e=>{if("fileUpload"===b&&void 0===S)m.oR.error("Please upload a file to import your data with"),e();else if(0===F.length)m.oR.error("Please select at least one header from your CSV"),e();else if(M){var t;c({file:S,...T,selectedHeaders:F,resolve:e}),O({action:"import_data_added",groups:{project:null!=f?f:"Unknown",organization:null!=(t=null==y?void 0:y.slug)?t:"Unknown"}})}else m.oR.error("The data that you are trying to import is incompatible with your table structure"),e()}}),"data-sentry-element":"SidePanel","data-sentry-component":"SpreadsheetImport","data-sentry-source-file":"SpreadsheetImport.tsx",children:[(0,a.jsx)(es.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadsheetImport.tsx",children:(0,a.jsx)("div",{className:"pt-6",children:(0,a.jsxs)(ng.A,{block:!0,type:"pills",onChange:N,"data-sentry-element":"Tabs","data-sentry-source-file":"SpreadsheetImport.tsx",children:[(0,a.jsx)(ng.A.Panel,{id:"fileUpload",label:"Upload CSV","data-sentry-element":"Tabs.Panel","data-sentry-source-file":"SpreadsheetImport.tsx",children:(0,a.jsx)(nj,{parseProgress:k,uploadedFile:S,onFileUpload:Y,removeUploadedFile:W,"data-sentry-element":"SpreadSheetFileUpload","data-sentry-source-file":"SpreadsheetImport.tsx"})}),(0,a.jsx)(ng.A.Panel,{id:"pasteText",label:"Paste text","data-sentry-element":"Tabs.Panel","data-sentry-source-file":"SpreadsheetImport.tsx",children:(0,a.jsx)(nE,{input:w,onInputChange:e=>{C(e.target.value),H(e.target.value)},"data-sentry-element":"SpreadSheetTextInput","data-sentry-source-file":"SpreadsheetImport.tsx"})})]})})}),T.headers.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)(es.Ay.Separator,{})}),(0,a.jsx)(nk,{spreadsheetData:T,selectedHeaders:F,onToggleHeader:e=>{D(F.includes(e)?F.filter(t=>t!==e):F.concat([e]))}}),(0,a.jsx)(es.Ay.Separator,{}),(0,a.jsx)(nA,{selectedTable:o,spreadsheetData:T,errors:L,selectedHeaders:F,incompatibleHeaders:K}),(0,a.jsx)(es.Ay.Separator,{})]})]})};var nI=n(14988),nF=n(2657),nD=n(60468),nO=n(44725),nz=n(33922),nK=n(68889),nM=n(44071),nq=n(85388),nB=n(41121),nU=n(61548),nY=n(29244),nW=n(36289);let nV=e=>{var t,n;let{column:l=nW.MZ,relations:s=nW.Oj,enumTypes:r=nW.Oj,isNewRecord:i=!1,hasForeignKeys:o=!1,hasImportContent:c=!1,dragHandleProps:d=nW.MZ,onUpdateColumn:m,onRemoveColumn:x,onEditForeignKey:h}=e,{data:p}=(0,z.YA)(),[f,y]=(0,u.useState)(!1),g=null!=(t=null==ef?void 0:ef[l.format])?t:[],v=[+!!l.isNullable,+!!l.isIdentity,+!!l.isUnique,+!!l.isArray].reduce((e,t)=>e+t,0),{data:j}=(0,et.Hw)({projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString,schema:l.schema}),b=e=>{let t=(null!=j?j:[]).find(t=>t.id===e.id),n=s.find(t=>t.id===e.id);return(null==n?void 0:n.toRemove)?"REMOVE":void 0===t&&void 0!==n?"ADD":void 0!==t&&void 0!==n?eQ(t,n)?"UPDATE":void 0:void 0},N=s.map(e=>b(e)).some(e=>void 0!==e);return(0,a.jsxs)("div",{className:"flex w-full items-center","data-sentry-component":"Column","data-sentry-source-file":"Column.tsx",children:[(0,a.jsx)("div",{className:"w-[5%] ".concat(i?"":"hidden"),children:(0,a.jsx)("div",{className:"cursor-drag",...d,children:(0,a.jsx)(nM.A,{strokeWidth:1,size:16,"data-sentry-element":"Menu","data-sentry-source-file":"Column.tsx"})})}),(0,a.jsx)("div",{className:"w-[25%]",children:(0,a.jsxs)("div",{className:"flex w-[95%] items-center justify-between",children:[(0,a.jsx)(er.A,{size:"small",value:l.name,title:l.name,disabled:c,placeholder:"column_name",className:(0,eW.cn)("[&>div>div>div>input]:py-1.5 [&>div>div>div>input]:border-r-transparent [&>div>div>div>input]:rounded-r-none",c?"opacity-50":""),onChange:e=>m({name:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"Column.tsx"}),0===s.filter(e=>!e.toRemove).length?(0,a.jsx)(ei.$,{type:"dashed",className:"rounded-l-none h-[30px] py-0 px-2",onClick:()=>h(),children:(0,a.jsx)(nq.A,{size:12})}):(0,a.jsxs)(nU.AM,{open:f,onOpenChange:y,modal:!1,children:[(0,a.jsx)(nU.Wv,{asChild:!0,children:(0,a.jsx)(ei.$,{type:"default",className:"rounded-l-none h-[30px] py-0 px-2",children:(0,a.jsx)(nq.A,{size:12})})}),(0,a.jsxs)(nU.hl,{className:(0,eW.cn)("p-0",N?"w-96":"w-72"),side:"bottom",align:"end",children:[(0,a.jsxs)("div",{className:"text-xs px-2 pt-2",children:["Involved in ",s.length," foreign key",s.length>1?"s":""]}),(0,a.jsx)(nY.uB,{children:(0,a.jsxs)(nY.oI,{children:[(0,a.jsx)(nY.L$,{children:s.map((e,t)=>{var n;let s=String(null!=(n=null==e?void 0:e.id)?n:"".concat(l.id,"-relation-").concat(t)),r=b(e);return"REMOVE"===r?null:(0,a.jsx)(nY.h_,{value:s,className:"cursor-pointer w-full",onSelect:()=>h(e),onClick:()=>h(e),children:void 0===r?(0,a.jsx)("div",{className:"w-full flex items-center justify-between truncate",children:e.name}):(0,a.jsxs)("div",{className:"flex items-center gap-x-2 truncate",children:[(0,a.jsx)(eV.E,{variant:"ADD"===r?"brand":"warning",children:r}),(0,a.jsx)("p",{className:"truncate",children:e.name||(0,a.jsxs)(a.Fragment,{children:["To"," ",e.columns.filter(e=>e.source===l.name).map(t=>(0,a.jsxs)("code",{children:[e.schema,".",e.table,".",t.target]},"".concat(t.source,"-").concat(t.target))),e.columns.length>1&&(0,a.jsxs)(a.Fragment,{children:["and ",e.columns.length-1," other column",e.columns.length>2?"s":""]})]})})]})},s)})}),(0,a.jsx)(nY.fx,{}),(0,a.jsx)(nY.L$,{children:(0,a.jsxs)(nY.h_,{className:"cursor-pointer w-full gap-x-2",onSelect:()=>h(),onClick:()=>h(),children:[(0,a.jsx)(V.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("p",{children:"Add foreign key relation"})]})})]})})]})]})]})}),(0,a.jsx)("div",{className:"w-[25%]",children:(0,a.jsx)("div",{className:"w-[95%]",children:(0,a.jsx)(eZ.A,{value:l.format,enumTypes:r,showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:o,description:o?"Column type cannot be changed as it has a foreign key relation":"",onOptionSelect:e=>{m({format:e,defaultValue:"uuid"===e?"gen_random_uuid()":null})},"data-sentry-element":"ColumnType","data-sentry-source-file":"Column.tsx"})})}),(0,a.jsx)("div",{className:"".concat(i?"w-[25%]":"w-[30%]"),children:(0,a.jsx)("div",{className:"w-[95%]",children:(0,a.jsx)(ej,{"data-testid":"".concat(l.name,"-default-value"),placeholder:"string"==typeof l.defaultValue&&0===l.defaultValue.length?"EMPTY":"NULL",size:"small",value:null!=(n=l.defaultValue)?n:"",disabled:l.format.includes("int")&&l.isIdentity,className:"rounded bg-surface-100 lg:gap-0 ".concat(l.format.includes("int")&&l.isIdentity?"opacity-50":""),suggestions:g,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>m({defaultValue:e.target.value}),onSelectSuggestion:e=>m({defaultValue:e.value}),"data-sentry-element":"InputWithSuggestions","data-sentry-source-file":"Column.tsx"})})}),(0,a.jsx)("div",{className:"w-[10%]",children:(0,a.jsx)(eo.A,{label:"",checked:l.isPrimaryKey,onChange:()=>{let e=!l.isPrimaryKey;m({isPrimaryKey:e,isNullable:!e&&l.isNullable})},"data-sentry-element":"Checkbox","data-sentry-source-file":"Column.tsx"})}),(0,a.jsx)("div",{className:"".concat(c?"w-[10%]":"w-[0%]")}),(0,a.jsx)("div",{className:"flex w-[5%] justify-end",children:(!l.isPrimaryKey||l.format.includes("int"))&&(0,a.jsxs)(nU.AM,{children:[(0,a.jsxs)(nU.Wv,{"data-testid":"".concat(l.name,"-extra-options"),className:"group flex items-center -space-x-1",children:[v>0&&(0,a.jsx)("div",{className:"rounded-full bg-foreground h-4 w-4 flex items-center justify-center text-xs text-background",children:v}),(0,a.jsx)("div",{className:"text-foreground-light transition-colors group-hover:text-foreground",children:(0,a.jsx)(nB.A,{size:16,strokeWidth:1})})]}),(0,a.jsxs)(nU.hl,{align:"end",className:"w-96 p-0",children:[(0,a.jsx)("div",{className:"flex items-center justify-center bg-surface-200 space-y-1 py-1.5 px-3 border-b border-overlay",children:(0,a.jsx)("h5",{className:"text-foreground",children:"Extra options"})}),(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[!l.isPrimaryKey&&(0,a.jsx)(eo.A,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:l.isNullable,className:"p-4",onChange:()=>m({isNullable:!l.isNullable})}),(0,a.jsx)(eo.A,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:l.isUnique,className:"p-4",onChange:()=>m({isUnique:!l.isUnique})}),l.format.includes("int")&&(0,a.jsx)(eo.A,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:l.isIdentity,className:"p-4",onChange:()=>{let e=!l.isIdentity,t=!e&&l.isArray;m({isIdentity:e,isArray:t})}}),!l.isPrimaryKey&&(0,a.jsx)(eo.A,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:l.isArray,className:"p-4",onChange:()=>{let e=!l.isArray,t=!e&&l.isIdentity;m({isArray:e,isIdentity:t})}})]},"".concat(l.id,"_configuration"))]})]})}),!c&&(0,a.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,a.jsx)("button",{className:"cursor-pointer",onClick:()=>x(),children:(0,a.jsx)(eT.A,{size:16,strokeWidth:1})})})]})},nH=e=>{var t;let{table:n,columns:l=[],relations:s,enumTypes:i=[],importContent:o,isNewRecord:c,onColumnsUpdated:m=d(),onSelectImportData:h=d(),onClearImportContent:p=d(),onUpdateFkRelations:f}=e,{ref:y}=(0,x.g)(),{data:g}=(0,R.s)(),[v,j]=(0,u.useState)(!1),[b,N]=(0,u.useState)(),[w,C]=(0,u.useState)(),{mutate:S}=(0,_.h)(),A=!r()(o),[k,E]=tR()(l,e=>e.isPrimaryKey),T=e=>void 0!==s.find(t=>t.columns.find(t=>t.source===e.name)),P=(e,t)=>{m(l.map(n=>{if(n.id!==e.id)return n;if(em.AL.includes(e.format)||""!==t.defaultValue||(t.defaultValue=null),"name"in t&&void 0!==n.foreignKey){var a;let e={...n.foreignKey,source_column_name:null!=(a=null==t?void 0:t.name)?a:""};return{...n,...t,foreignKey:e}}return{...n,...t}}))},L=e=>{m(l.filter(t=>t.id!==e.id))},I=(e,t)=>{if(e.destination){if("pks"===t){let t=k.slice(),[n]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,n),m(t.concat(E))}if("others"===t){let t=E.slice(),[n]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,n),m(k.concat(t))}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("h5",{children:"Columns"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ei.$,{asChild:!0,type:"default",icon:(0,a.jsx)(H.A,{size:12,strokeWidth:2}),"data-sentry-element":"Button","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)("a",{href:"".concat(el.aq,"/guides/database/tables#data-types"),target:"_blank",rel:"noreferrer",children:"About data types"})}),c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"py-3 border-r"}),A?(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ei.$,{type:"default",icon:(0,a.jsx)(tI.A,{}),onClick:h,children:"Edit content"}),(0,a.jsx)(ei.$,{type:"danger",icon:(0,a.jsx)(nz.A,{}),onClick:p,children:"Remove content"})]}):(0,a.jsx)(ei.$,{type:"default",onClick:()=>{var e;h(),S({action:"import_data_button_clicked",properties:{tableType:"New Table"},groups:{project:null!=y?y:"Unknown",organization:null!=(e=null==g?void 0:g.slug)?e:"Unknown"}})},children:"Import data from CSV"})]})]})]}),A&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light my-2",children:["Your table will be created with ",null==o||null==(t=o.rowCount)?void 0:t.toLocaleString()," rows and the following ",l.length," columns."]}),0===k.length&&(0,a.jsxs)(eL.Fc,{variant:"warning",children:[(0,a.jsx)(nC.id,{}),(0,a.jsx)(eL.XL,{children:"Warning: No primary keys selected"}),(0,a.jsx)(eL.TN,{children:"Tables should have at least one column as the primary key to identify each row. Without a primary key, you will not be able to update or delete rows from the table."})]}),k.length>1&&(0,a.jsx)(eF.A,{block:!0,icon:(0,a.jsx)(ta.A,{size:16}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex w-full px-3",children:[c&&(0,a.jsx)("div",{className:"w-[5%]"}),(0,a.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Name"}),(0,a.jsxs)(to.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"ColumnManagement.tsx",children:[(0,a.jsx)(to.k$,{"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)(eA.A,{size:15,strokeWidth:1.5,className:"text-foreground-lighter","data-sentry-element":"HelpCircle","data-sentry-source-file":"ColumnManagement.tsx"})}),(0,a.jsx)(to.ZI,{side:"bottom",className:"w-[300px]","data-sentry-element":"TooltipContent","data-sentry-source-file":"ColumnManagement.tsx",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})]})]}),(0,a.jsx)("div",{className:"w-[25%]",children:(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Type"})}),(0,a.jsxs)("div",{className:"".concat(c?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Default Value"}),(0,a.jsxs)(to.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"ColumnManagement.tsx",children:[(0,a.jsx)(to.k$,{"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)(eA.A,{size:15,strokeWidth:1.5,className:"text-foreground-lighter","data-sentry-element":"HelpCircle","data-sentry-source-file":"ColumnManagement.tsx"})}),(0,a.jsx)(to.ZI,{side:"bottom",className:"w-[300px]","data-sentry-element":"TooltipContent","data-sentry-source-file":"ColumnManagement.tsx",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})]})]}),(0,a.jsx)("div",{className:"w-[10%]",children:(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Primary"})}),(0,a.jsx)("div",{className:"".concat(A?"w-[10%]":"w-0")}),(0,a.jsx)("div",{className:"w-[5%]"}),!A&&(0,a.jsx)("div",{className:"w-[5%]"})]}),k.length>0&&(0,a.jsx)(nK.JY,{onDragEnd:e=>I(e,"pks"),children:(0,a.jsx)(nK.gL,{droppableId:"pk_columns_droppable",children:e=>(0,a.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-surface-200 px-3 py-2 ".concat(c?"":"-mx-3"),children:[k.map((e,t)=>(0,a.jsx)(nK.sx,{draggableId:e.id,index:t,children:t=>(0,a.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,a.jsx)(nV,{column:e,relations:s.filter(t=>t.columns.some(t=>t.source===e.name)),enumTypes:i,hasForeignKeys:T(e),isNewRecord:c,hasImportContent:A,dragHandleProps:t.dragHandleProps,onUpdateColumn:t=>P(e,t),onRemoveColumn:()=>L(e),onEditForeignKey:t=>{j(!0),N(e),t&&C(t)}})})},e.id)),e.placeholder]})})}),(0,a.jsx)(nK.JY,{onDragEnd:e=>I(e,"others"),"data-sentry-element":"DragDropContext","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)(nK.gL,{droppableId:"other_columns_droppable","data-sentry-element":"Droppable","data-sentry-source-file":"ColumnManagement.tsx",children:e=>(0,a.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(c?"px-3 ":""),children:[E.map((e,t)=>(0,a.jsx)(nK.sx,{draggableId:e.id,index:t,children:t=>(0,a.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,a.jsx)(nV,{column:e,relations:s.filter(t=>t.columns.some(t=>t.source===e.name)),enumTypes:i,isNewRecord:c,hasForeignKeys:T(e),hasImportContent:A,dragHandleProps:t.dragHandleProps,onUpdateColumn:t=>P(e,t),onRemoveColumn:()=>L(e),onEditForeignKey:t=>{j(!0),N(e),t&&C(t)}})})},e.id)),e.placeholder]})})})]}),!A&&(0,a.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,a.jsx)(ei.$,{type:"default",onClick:()=>(()=>{let e=(0,eN.Eb)();m(l.concat(e))})(),children:"Add column"})})]}),(0,a.jsx)(eU,{visible:v,column:b,table:{id:n.id,name:n.name,columns:n.columns},foreignKey:w,onClose:()=>{j(!1),C(void 0),N(void 0)},onSaveRelation:e=>{let t=s.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?f(s.map(t=>t.id===e.id?e:t)):f(s.concat([e]))},"data-sentry-element":"ForeignKeySelector","data-sentry-source-file":"ColumnManagement.tsx"})]})};var n$=n(44168),nJ=n(53931);let nQ=e=>{let{table:t,relations:n,closePanel:l,setEditorDirty:s,onUpdateFkRelations:r}=e,{data:i}=(0,z.YA)(),{selectedSchema:o}=(0,eK.k)(),[c,d]=(0,u.useState)(!1),[m,x]=(0,u.useState)(),{data:h,error:p,isLoading:f,isSuccess:y,isError:g}=(0,et.Hw)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,schema:o});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full space-y-4 ",children:[(0,a.jsx)("h5",{children:"Foreign keys"}),f&&(0,a.jsx)(nJ.yV,{}),g&&(0,a.jsx)(n$.A,{error:p,subject:"Failed to retrieve foreign key relationships"}),y&&(0,a.jsx)("div",{children:n.map(e=>{let t=(e=>{let t=(null!=h?h:[]).find(t=>t.id===e.id),a=n.find(t=>t.id===e.id);return(null==a?void 0:a.toRemove)?"REMOVE":void 0===t&&void 0!==a?"ADD":void 0!==t&&void 0!==a?eQ(t,a)?"UPDATE":void 0:void 0})(e);return(0,a.jsx)(eH,{status:t,foreignKey:e,closePanel:l,onSelectEdit:()=>{d(!0),x(e)},onSelectRemove:()=>{s(),"ADD"===t?r(n.filter(t=>t.id!==e.id)):r(n.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{s(),r(n.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,a.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,a.jsx)(ei.$,{type:"default",onClick:()=>d(!0),"data-sentry-element":"Button","data-sentry-source-file":"ForeignKeysManagement.tsx",children:"Add foreign key relation"})})]}),(0,a.jsx)(eU,{visible:c,table:{id:t.id,name:t.name,columns:t.columns},foreignKey:m,onClose:()=>{d(!1),x(void 0)},onSaveRelation:e=>{s();let t=n.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?r(n.map(t=>t.id===e.id?e:t)):r(n.concat([e]))},"data-sentry-element":"ForeignKeySelector","data-sentry-source-file":"ForeignKeysManagement.tsx"})]})},nG=e=>{let{schema:t,table:n,isDuplicating:l}=e;return n?l?(0,a.jsxs)(a.Fragment,{children:["Duplicate table ",(0,a.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,a.jsxs)(a.Fragment,{children:["Update table ",(0,a.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,a.jsxs)(a.Fragment,{children:["Create a new table under ",(0,a.jsx)("code",{className:"text-sm",children:t})]})};var nZ=n(8e3),nX=n(77869),n0=n(11743),n1=n(88845);function n2(){let{docsRowLevelSecurityGuidePath:e}=(0,nI.g)(["docs:row_level_security_guide_path"]);return(0,a.jsxs)("div",{className:"text-sm text-foreground-light grid gap-4","data-sentry-component":"RLSDisableModalContent","data-sentry-source-file":"RLSDisableModal.tsx",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)(n1.F,{variant:"warning",className:"!px-4 !py-3",title:"This table will be publicly readable and writable",withIcon:!0,"data-sentry-element":"Alert","data-sentry-source-file":"RLSDisableModal.tsx",children:(0,a.jsx)("p",{children:"Anyone can edit or delete data in this table."})}),(0,a.jsxs)("ul",{className:"mt-4 space-y-5",children:[(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(nZ.A,{"data-sentry-element":"AlertOctagon","data-sentry-source-file":"RLSDisableModal.tsx"}),(0,a.jsx)("span",{children:"All requests to this table will be accepted."})]}),(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(nX.A,{"data-sentry-element":"ShieldOff","data-sentry-source-file":"RLSDisableModal.tsx"}),(0,a.jsx)("span",{children:"Auth policies will not be enforced."})]}),(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(n0.A,{size:14,className:"flex-shrink-0","data-sentry-element":"Lock","data-sentry-source-file":"RLSDisableModal.tsx"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Before you turn off Row Level Security, consider:"}),(0,a.jsxs)("ul",{className:"space-y-2 mt-2",children:[(0,a.jsx)("li",{className:"list-disc ml-4",children:"Any personal information in this table will be publicly accessible."}),(0,a.jsx)("li",{className:"list-disc ml-4",children:"Anyone will be able to modify, add or delete any row in this table."})]})]})]})]})]}),(0,a.jsx)(eI.A,{abbrev:!1,className:"w-min mt-3",href:"".concat(el.aq).concat(e),"data-sentry-element":"DocsButton","data-sentry-source-file":"RLSDisableModal.tsx"})]})}let n3=[{id:(0,eM.gZ)(),name:"id",schema:"",table:"",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,eM.gZ)(),name:"created_at",schema:"",table:"",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];var n5=n(78779),n4=n.n(n5);let n8=function(e,t){var n;let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{id:e.id,name:a?"".concat(e.name,"_duplicate"):e.name,comment:a?"This is a duplicate of ".concat(e.name):null==e?void 0:e.comment,columns:(null!=(n=e.columns)?n:[]).map(n=>(0,eN.h6)(n,e,t)),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:l}},n6=e=>{var t,n;let{table:l,isDuplicating:s,templateData:i,visible:c=!1,closePanel:x=d(),saveChanges:h=d(),updateEditorDirty:p=d()}=e,f=(0,u.useContext)(B.IS),y=(0,B.ap)(),{data:g}=(0,z.YA)(),{selectedSchema:v}=(0,eK.k)(),b=o()(l),{realtimeAll:N}=(0,nF.x)(["realtime:all"]),w=(0,q.n)(),{docsRowLevelSecurityGuidePath:C}=(0,nI.g)(["docs:row_level_security_guide_path"]),[S,A]=(0,M.W)();(0,u.useEffect)(()=>{"table"===S.create&&"none"===y.ui.open&&(f.onAddTable(),A({...S,create:void 0}))},[f,A,y.ui.open,S]);let{data:k}=(0,en.p)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),{data:E}=(0,ea.Uu)({excludeSchemas:["extensions"]}),_=(null!=k?k:[]).filter(e=>!E.find(t=>t.name===e.schema)),{data:R}=(0,j._)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),T=(null!=R?R:[]).find(e=>"supabase_realtime"===e.name),P=null!=(t=null==T?void 0:T.tables)?t:[],L=!b&&P.some(e=>e.id===(null==l?void 0:l.id)),{activeVariant:I}=(0,nD.gI)({projectInsertedAt:null==g?void 0:g.inserted_at,isTable:!b,isRealtimeEnabled:L}),[F,D]=(0,u.useState)({}),[O,K]=(0,u.useState)(),[U,Y]=(0,u.useState)([]),[V,H]=(0,u.useState)(!1),[$,J]=(0,u.useState)(),[Q,G]=(0,u.useState)(!1),[X,ei]=(0,u.useState)(!1),{data:ec}=ee({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,id:null==l?void 0:l.id}),em=(null!=ec?ec:[]).find(e=>e.type===Z.PRIMARY_KEY_CONSTRAINT),{data:ex,isSuccess:eh}=(0,et.Hw)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:null==l?void 0:l.schema}),ep=(0,u.useMemo)(()=>(null!=ex?ex:[]).filter(e=>e.source_schema===(null==l?void 0:l.schema)&&e.source_table===(null==l?void 0:l.name)),[ex,l]),ef=e=>{K({...O,...e}),p();let t={...F};for(let n of Object.keys(e))delete t[n];D(t)},ey=e=>{if(void 0===O)return;let t=[];e.forEach(e=>{e.columns.forEach(e=>{let n=O.columns.find(t=>t.name===e.source);(null==n?void 0:n.isNewColumn)&&e.targetType&&t.push({...n,format:e.targetType})})}),t.length>0&&K({...O,columns:O.columns.map(e=>{let n=t.find(t=>t.id===e.id);return n||e})}),Y(e)},eg=e=>{if(O){var t,n,a,i,o;let c=(e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your table"),n4()(e.columns,e=>0===e.format.length)&&(t.columns="Ensure that all your columns are assigned a type"),n4()(e.columns,e=>0===e.name.length)&&(t.columns="Ensure that all your columns are named"),t})(O);c.name&&m.oR.error(c.name),c.columns&&m.oR.error(c.columns),D(c);let d=O.name.trim()!==(null==l?void 0:l.name),u=O.comment!==(null==l?void 0:l.comment),x=O.isRLSEnabled!==(null!=(t=null==l?void 0:l.rls_enabled)&&t);if(r()(c)){let t={tableId:null==l?void 0:l.id,importContent:$,isRLSEnabled:O.isRLSEnabled,isRealtimeEnabled:O.isRealtimeEnabled,isDuplicateRows:V,existingForeignKeyRelations:ep,primaryKey:em},r=O.columns.map(e=>({...e,name:e.name.trim()}));b?h({action:"create",payload:{name:O.name.trim(),schema:v,comment:null==(n=O.comment)?void 0:n.trim()},configuration:t,columns:r,foreignKeyRelations:U,resolve:e}):s?h({action:"duplicate",payload:{name:O.name.trim(),comment:null==(a=O.comment)?void 0:a.trim()},configuration:t,columns:r,foreignKeyRelations:U,resolve:e}):h({action:"update",payload:{...d&&{name:O.name.trim()},...u&&{comment:null!=(o=null==(i=O.comment)?void 0:i.trim())?o:""},...x&&{rls_enabled:O.isRLSEnabled}},configuration:t,columns:r,foreignKeyRelations:U,resolve:e})}else e()}},ev=(0,nT.u)(c);return((0,u.useEffect)(()=>{if(ev&&c)if(D({}),J(void 0),H(!1),b){let e={id:0,name:"",comment:"",columns:n3,isRLSEnabled:!0,isRealtimeEnabled:!1};i?K({...e,...i}):K(e),Y([])}else K(n8(l,null!=ex?ex:[],s,L))},[c,i,ex,L,b,s,l,ev]),(0,u.useEffect)(()=>{b||K(n8(l,null!=ex?ex:[],s,L))},[b,l,ex,s,L]),(0,u.useEffect)(()=>{eh&&Y((0,eu.C)(ep))},[eh,ep]),(0,u.useEffect)(()=>{$&&!r()($)&&ef({columns:(e=>{let{headers:t,selectedHeaders:n,columnTypeMap:a}=e;return t.filter(e=>n.includes(e)).map(e=>{let t=a[e];return(0,eN.Eb)({name:e,format:t})})})($)})},[$]),O)?(0,a.jsxs)(es.Ay,{"data-testid":"table-editor-side-panel",size:"large",visible:c,header:(0,a.jsx)(nG,{schema:v,table:l,isDuplicating:s}),className:"transition-all duration-100 ease-in ".concat(Q?" mr-32":""),onCancel:x,onConfirm:()=>e=>eg(e),customFooter:(0,a.jsx)(ed.A,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:x,applyFunction:e=>eg(e)}),"data-sentry-element":"SidePanel","data-sentry-component":"TableEditor","data-sentry-source-file":"TableEditor.tsx",children:[(0,a.jsxs)(es.Ay.Content,{className:"space-y-10 py-6","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"TableEditor.tsx",children:[(0,a.jsx)(er.A,{"data-testid":"table-name-input",label:"Name",layout:"horizontal",type:"text",error:F.name?String(F.name):void 0,value:null==O?void 0:O.name,onChange:e=>ef({name:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsx)(er.A,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!=(n=null==O?void 0:O.comment)?n:"",onChange:e=>ef({comment:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"TableEditor.tsx"})]}),(0,a.jsx)(es.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsxs)(es.Ay.Content,{className:"space-y-10 py-6","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"TableEditor.tsx",children:[(0,a.jsx)(eo.A,{id:"enable-rls",label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,a.jsx)(eV.E,{children:"Recommended"})]}),description:"Restrict access to your table by enabling RLS and writing Postgres policies.",checked:O.isRLSEnabled,onChange:()=>{O.isRLSEnabled?ei(!0):ef({isRLSEnabled:!O.isRLSEnabled})},size:"medium","data-sentry-element":"Checkbox","data-sentry-source-file":"TableEditor.tsx"}),O.isRLSEnabled?(0,a.jsx)(nO.Z,{type:"default",className:"!mt-3",title:"Policies are required to query data",description:(0,a.jsxs)(a.Fragment,{children:["You need to create an access policy before you can query data from this table. Without a policy, querying this table will return an"," ",(0,a.jsx)("u",{className:"text-foreground",children:"empty array"})," of results."," ",b?"You can create policies after saving this table.":""]}),children:(0,a.jsx)(eI.A,{abbrev:!1,className:"mt-2",href:"".concat(el.aq).concat(C)})}):(0,a.jsx)(nO.Z,{type:"warning",className:"!mt-3",title:"You are allowing anonymous access to your table",description:(0,a.jsxs)(a.Fragment,{children:[O.name?"The table ".concat(O.name):"Your table"," will be publicly writable and readable"]}),children:(0,a.jsx)(eI.A,{abbrev:!1,className:"mt-2",href:"".concat(el.aq).concat(C)})}),I!==nD.Lj.HIDE_BUTTON&&N&&(0,a.jsx)(eo.A,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:O.isRealtimeEnabled,onChange:()=>{w("realtime_toggle_table_clicked",{newState:O.isRealtimeEnabled?"disabled":"enabled",origin:"tableSidePanel"}),ef({isRealtimeEnabled:!O.isRealtimeEnabled})},size:"medium"})]}),(0,a.jsx)(es.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsxs)(es.Ay.Content,{className:"space-y-10 py-6","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"TableEditor.tsx",children:[!s&&(0,a.jsx)(nH,{table:O,columns:null==O?void 0:O.columns,relations:U,enumTypes:_,isNewRecord:b,importContent:$,onColumnsUpdated:e=>ef({columns:e}),onSelectImportData:()=>G(!0),onClearImportContent:()=>{ef({columns:n3}),J(void 0)},onUpdateFkRelations:ey}),s&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(eo.A,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:V,onChange:()=>H(!V),size:"medium"})}),(0,a.jsx)(nL,{visible:Q,headers:null==$?void 0:$.headers,rows:null==$?void 0:$.rows,saveContent:e=>{J(e),G(!1)},closePanel:()=>G(!1),"data-sentry-element":"SpreadsheetImport","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsx)(W.A,{visible:X,title:"Turn off Row Level Security",confirmLabel:"Confirm",size:"medium",onCancel:()=>ei(!1),onConfirm:()=>{ef({isRLSEnabled:!O.isRLSEnabled}),ei(!1)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"TableEditor.tsx",children:(0,a.jsx)(n2,{"data-sentry-element":"RLSDisableModalContent","data-sentry-source-file":"TableEditor.tsx"})})]}),!s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(es.Ay.Separator,{}),(0,a.jsx)(es.Ay.Content,{className:"py-6",children:(0,a.jsx)(nQ,{table:O,relations:U,closePanel:x,setEditorDirty:()=>p(),onUpdateFkRelations:ey})})]})]},"TableEditor"):null},n9=e=>{var t,n,s,i,c,h,p,f,y,g,E,_,T,L,W,V,H,$,J,Q,G;let{editable:Z=!0,selectedTable:X,includeColumns:ee=!1,onTableCreated:et=d()}=e,{ref:en}=(0,x.g)(),ea=(0,B.ap)(),el=(0,U.zv)(),[es,er]=(0,M.W)({arrayKeys:["filter","sort"]}),ei=(0,l.jE)(),{data:eo}=(0,z.YA)(),{data:ec}=(0,R.s)(),ed=(0,q.n)(),[eu,em]=(0,u.useState)(!1),{confirmOnClose:ex,modalProps:eh}=(0,K.$)({checkIsDirty:()=>eu,onClose:()=>{em(!1),ea.closeSidePanel()}}),ep=(null!=(G=null==X?void 0:X.columns)?G:[]).filter(e=>{var t;return(null!=(t=null==e?void 0:e.enums)?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),{mutateAsync:ef}=I({onSuccess(){m.oR.success("Successfully created row")}}),{mutateAsync:ey}=(0,F.oG)({onSuccess(){m.oR.success("Successfully updated row")}}),{data:eg}=(0,j._)({projectRef:null==eo?void 0:eo.ref,connectionString:null==eo?void 0:eo.connectionString}),{mutateAsync:ev}=v(),{mutateAsync:ej}=(0,b.H)({onError:()=>{}}),eb=(0,P.Qj)(),eN=(null==(t=ea.sidePanel)?void 0:t.type)==="table"&&"duplicate"===ea.sidePanel.mode,ew=async(e,t,n,a)=>{let l;if(!eo||void 0===X)return console.error("no project or table selected");if(t)try{await ef({projectRef:eo.ref,connectionString:eo.connectionString,table:X,payload:e,enumArrayColumns:ep,roleImpersonationState:eb()})}catch(e){l=e}else if(!r()(e))if(X.primary_keys.length>0)try{await ey({projectRef:eo.ref,connectionString:eo.connectionString,table:X,configuration:n,payload:e,enumArrayColumns:ep,roleImpersonationState:eb()})}catch(e){l=e}else l=Error("No primary key"),m.oR.error("We can't make changes to this table because there is no primary key. Please create a primary key and try again.");a(l),l||(em(!1),ea.closeSidePanel())},eC=async(e,t)=>{var n,a,l,s;let r,i;if(void 0===X)return;let o={};if((null==(n=ea.sidePanel)?void 0:n.type)==="json"){let{row:t,column:n}=ea.sidePanel.jsonValue;r={[n]:null===e?null:JSON.parse(e)},X.primary_keys.forEach(e=>o[e.name]=t[e.name]),i={identifiers:o,rowIdx:t.idx}}else if((null==(a=ea.sidePanel)?void 0:a.type)==="cell"){let t=null==(l=ea.sidePanel.value)?void 0:l.column,n=null==(s=ea.sidePanel.value)?void 0:s.row;if(!t||!n)return;r={[t]:null===e?null:e},X.primary_keys.forEach(e=>o[e.name]=n[e.name]),i={identifiers:o,rowIdx:n.idx}}if(void 0!==r&&void 0!==i)try{await ew(r,!1,i,()=>{})}catch(e){}finally{t()}},eS=async e=>{var t;if(void 0===X||(null==(t=ea.sidePanel)?void 0:t.type)!=="foreign-row-selector")return;let n=ea.sidePanel.foreignKey;try{let{row:t}=n,a={};X.primary_keys.forEach(e=>{var n;let l=null==(n=X.columns)?void 0:n.find(t=>t.name===e.name);a[e.name]=(null==l?void 0:l.format)==="bytea"?(0,e7.ds)(t[e.name]):t[e.name]});let l={identifiers:a,rowIdx:t.idx};ew(e,!1,l,()=>{})}catch(e){}},eA=async(e,t,n,a)=>{var l;let s=(null==(l=ea.sidePanel)?void 0:l.type)==="column"&&ea.sidePanel.column,{primaryKey:r,foreignKeyRelations:i,existingForeignKeyRelations:o}=n;if(!eo||void 0===X)return console.error("no project or table selected");let c=t?await ni({projectRef:null==eo?void 0:eo.ref,connectionString:null==eo?void 0:eo.connectionString,payload:e,selectedTable:X,primaryKey:r,foreignKeyRelations:i}):await no({projectRef:null==eo?void 0:eo.ref,connectionString:null==eo?void 0:eo.connectionString,originalColumn:s,payload:e,selectedTable:X,primaryKey:r,foreignKeyRelations:i,existingForeignKeyRelations:o});(null==c?void 0:c.error)?m.oR.error(c.error.message):(!t&&e.name&&s&&s.name!==e.name&&ek(s.name,e.name),await Promise.all([ei.invalidateQueries({queryKey:S.i.tableEditor(null==eo?void 0:eo.ref,null==X?void 0:X.id)}),ei.invalidateQueries({queryKey:N.c.foreignKeyConstraints(null==eo?void 0:eo.ref,null==X?void 0:X.schema)}),ei.invalidateQueries({queryKey:N.c.tableDefinition(null==eo?void 0:eo.ref,null==X?void 0:X.id)}),ei.invalidateQueries({queryKey:C.C.list(null==eo?void 0:eo.ref)})]),await ei.invalidateQueries({queryKey:k.j.tableRowsAndCount(null==eo?void 0:eo.ref,null==X?void 0:X.id)}),em(!1),ea.closeSidePanel()),a()},ek=(e,t)=>{er(n=>{var a,l;let s=null!=(a=null==n?void 0:n.filter)?a:[],r=null!=(l=null==n?void 0:n.sort)?l:[];return{...n,filter:s.map(n=>{let[a]=n.split(":");return a===e?n.replace(a,t):n}),sort:r.map(n=>{let[a]=n.split(":");return a===e?n.replace(a,t):n})}})},eE=async(e,t)=>{if(!eo)return console.error("Project is required");let n=null==eg?void 0:eg.find(e=>"supabase_realtime"===e.name);try{if(void 0===n){let n=t?["".concat(e.schema,".").concat(e.name)]:[];await ev({projectRef:eo.ref,connectionString:eo.connectionString,name:"supabase_realtime",publish_insert:!0,publish_update:!0,publish_delete:!0,tables:n}),ed(t?"table_realtime_enabled":"table_realtime_disabled",{method:"ui",schema_name:e.schema,table_name:e.name});return}if(null===n.tables){let a=await ei.fetchQuery({queryKey:D.v.list(eo.ref,"public",ee),queryFn:e=>{let{signal:t}=e;return(0,O.oI)({projectRef:eo.ref,connectionString:eo.connectionString,schema:"public"},t)}}),l=t?a.map(e=>"".concat(e.schema,".").concat(e.name)):a.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name));await ej({id:n.id,projectRef:eo.ref,connectionString:eo.connectionString,tables:l}),ed(t?"table_realtime_enabled":"table_realtime_disabled",{method:"ui",schema_name:e.schema,table_name:e.name});return}let a=n.tables.some(t=>t.id==e.id),l=a&&!t?n.tables.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name)):!a&&t?n.tables.map(e=>"".concat(e.schema,".").concat(e.name)).concat(["".concat(e.schema,".").concat(e.name)]):null;if(null===l)return;await ej({id:n.id,projectRef:eo.ref,connectionString:eo.connectionString,tables:l}),ed(t?"table_realtime_enabled":"table_realtime_disabled",{method:"ui",schema_name:e.schema,table_name:e.name})}catch(t){m.oR.error("Failed to update realtime for ".concat(e.name,": ").concat(t.message))}},e_=async e=>{let t,{configuration:n,columns:a,foreignKeyRelations:l,resolve:s}=e,r=!1,{importContent:i,isRLSEnabled:o,isRealtimeEnabled:c,isDuplicateRows:d,existingForeignKeyRelations:u,primaryKey:x}=n;try{if("create"===e.action){t=m.oR.loading("Creating new table: ".concat(e.payload.name,"..."));let n=await nd({projectRef:null==eo?void 0:eo.ref,connectionString:null==eo?void 0:eo.connectionString,toastId:t,payload:e.payload,columns:a,foreignKeyRelations:l,isRLSEnabled:o,importContent:i,organizationSlug:null==ec?void 0:ec.slug});c&&await eE(n,!0),await Promise.all([ei.invalidateQueries({queryKey:D.v.list(null==eo?void 0:eo.ref,n.schema,ee)}),ei.invalidateQueries({queryKey:C.C.list(null==eo?void 0:eo.ref)})]),m.oR.success("Table ".concat(n.name," is good to go!"),{id:t}),et(n)}else if("duplicate"===e.action&&X){t=m.oR.loading("Duplicating table: ".concat(X.name,"..."));let n=await nc(null==eo?void 0:eo.ref,null==eo?void 0:eo.connectionString,e.payload,{isRLSEnabled:o,isDuplicateRows:d,duplicateTable:X,foreignKeyRelations:l});c&&await eE(n,c),await Promise.all([ei.invalidateQueries({queryKey:D.v.list(null==eo?void 0:eo.ref,n.schema,ee)}),ei.invalidateQueries({queryKey:C.C.list(null==eo?void 0:eo.ref)})]),m.oR.success("Table ".concat(X.name," has been successfully duplicated into ").concat(n.name,"!"),{id:t}),et(n)}else if("update"===e.action&&X){t=m.oR.loading("Updating table: ".concat(X.name,"..."));let{table:n,hasError:s}=await nu({projectRef:null==eo?void 0:eo.ref,connectionString:null==eo?void 0:eo.connectionString,toastId:t,table:X,payload:e.payload,columns:a,foreignKeyRelations:l,existingForeignKeyRelations:u,primaryKey:x,organizationSlug:null==ec?void 0:ec.slug});if(void 0===n)return m.oR.error("Failed to update table");if((0,A.KO)(n)&&await eE(n,c),s)m.oR.warning("Table ".concat(n.name," has been updated but there were some errors. Please check these errors separately."));else{if(en&&e.payload.name){let t=(0,U.lW)(w.z.TABLE,{id:X.id});el.updateTab(t,{label:e.payload.name})}m.oR.success("Successfully updated ".concat(n.name,"!"),{id:t})}}}catch(e){r=!0,m.oR.error(e.message,{id:t})}r||(em(!1),ea.closeSidePanel()),s()},eR=async e=>{if(!eo||void 0===X)return console.error("no project or table selected");let{file:t,rowCount:n,selectedHeaders:l,resolve:s}=e,r=m.oR.loading("Adding ".concat(n.toLocaleString()," rows to ").concat(X.name));if(t&&n>0){let e=await nx(eo.ref,eo.connectionString,t,X,l,e=>{m.oR.loading((0,a.jsx)(Y.t,{progress:e,message:"Adding ".concat(n.toLocaleString()," rows to ").concat(X.name)}),{id:r})});if(e.error)return m.oR.error("Failed to import data: ".concat(e.error.message),{id:r}),s()}else{let t=await nh(eo.ref,eo.connectionString,X,e.rows,l,t=>{m.oR.loading((0,a.jsx)(Y.t,{progress:t,message:"Adding ".concat(e.rows.length.toLocaleString()," rows to ").concat(X.name)}),{id:r})});if(t.error)return m.oR.error("Failed to import data: ".concat(t.error.message),{id:r}),s()}await ei.invalidateQueries({queryKey:k.j.tableRowsAndCount(null==eo?void 0:eo.ref,null==X?void 0:X.id)}),m.oR.success("Successfully imported ".concat(n," rows of data into ").concat(X.name),{id:r}),s(),ea.closeSidePanel()};return(0,a.jsxs)(a.Fragment,{children:[!o()(X)&&(0,a.jsx)(tV,{row:(null==(n=ea.sidePanel)?void 0:n.type)==="row"?ea.sidePanel.row:void 0,selectedTable:X,visible:(null==(s=ea.sidePanel)?void 0:s.type)==="row",editable:Z,closePanel:ex,saveChanges:ew,updateEditorDirty:()=>em(!0)}),!o()(X)&&(0,a.jsx)(e0,{column:(null==(i=ea.sidePanel)?void 0:i.type)==="column"?ea.sidePanel.column:void 0,selectedTable:X,visible:(null==(c=ea.sidePanel)?void 0:c.type)==="column",closePanel:ex,saveChanges:eA,updateEditorDirty:()=>em(!0)}),(0,a.jsx)(n6,{table:(null==(h=ea.sidePanel)?void 0:h.type)==="table"&&("edit"===ea.sidePanel.mode||"duplicate"===ea.sidePanel.mode)?X:void 0,isDuplicating:eN,templateData:(null==(p=ea.sidePanel)?void 0:p.type)==="table"&&ea.sidePanel.templateData?{...ea.sidePanel.templateData,columns:ea.sidePanel.templateData.columns?[...ea.sidePanel.templateData.columns]:void 0}:void 0,visible:(null==(f=ea.sidePanel)?void 0:f.type)==="table",closePanel:ex,saveChanges:e_,updateEditorDirty:()=>em(!0),"data-sentry-element":"TableEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tH.A,{visible:(null==(y=ea.sidePanel)?void 0:y.type)==="schema",onSuccess:ex,closePanel:ex,"data-sentry-element":"SchemaEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tE,{visible:(null==(g=ea.sidePanel)?void 0:g.type)==="json",row:(null==(E=ea.sidePanel)?void 0:E.type)==="json"&&ea.sidePanel.jsonValue.row||{},column:(null==(_=ea.sidePanel)?void 0:_.type)==="json"&&ea.sidePanel.jsonValue.column||"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",readOnly:!Z,closePanel:ex,onSaveJSON:eC,"data-sentry-element":"JsonEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tW,{visible:(null==(T=ea.sidePanel)?void 0:T.type)==="cell",column:(null==(L=ea.sidePanel)?void 0:L.type)==="cell"&&(null==(W=ea.sidePanel.value)?void 0:W.column)||"",row:(null==(V=ea.sidePanel)?void 0:V.type)==="cell"&&(null==(H=ea.sidePanel.value)?void 0:H.row)||{},closePanel:ex,onSaveField:eC,"data-sentry-element":"TextEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tm,{visible:(null==($=ea.sidePanel)?void 0:$.type)==="foreign-row-selector",foreignKey:(null==(J=ea.sidePanel)?void 0:J.type)==="foreign-row-selector"?ea.sidePanel.foreignKey.foreignKey:void 0,closePanel:ex,onSelect:eS,"data-sentry-element":"ForeignRowSelector","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(nL,{visible:(null==(Q=ea.sidePanel)?void 0:Q.type)==="csv-import",selectedTable:X,saveContent:eR,closePanel:ex,updateEditorDirty:em,"data-sentry-element":"SpreadsheetImport","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(n7,{...eh,"data-sentry-element":"CloseConfirmationModal","data-sentry-source-file":"SidePanelEditor.tsx"})]})},n7=e=>{let{visible:t,onClose:n,onCancel:l}=e;return(0,a.jsx)(W.A,{visible:t,title:"Discard changes",confirmLabel:"Discard",onCancel:l,onConfirm:n,"data-sentry-element":"ConfirmationModal","data-sentry-component":"CloseConfirmationModal","data-sentry-source-file":"SidePanelEditor.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})}},95942:(e,t,n)=>{n.d(t,{A:()=>E});var a=n(80263),l=n(83927),s=n.n(l),r=n(24328),i=n(79550),o=n(97924),c=n(5551),d=n(97339),u=n(32157),m=n(23892),x=n(86510),h=n(52555),p=n.n(h),f=n(53239),y=n(30404),g=n(80421),v=n(80100),j=n(883),b=n(61548),N=n(99779),w=n(97757),C=n(29244),S=n(20033),A=n(60793),k=n(19197);let E=e=>{var t,n,l,h;let{value:E,className:_,enumTypes:R=[],disabled:T=!1,showLabel:P=!0,layout:L="horizontal",description:I,showRecommendation:F=!1,onOptionSelect:D=s(),error:O}=e,[z,K]=(0,f.useState)(!1),M=k.x0.concat(R.map(e=>e.format.replaceAll('"',""))),q=!E||M.includes(E),B=k.wy[E],U="This column's data type cannot be changed via the Table Editor as it is not supported yet. You can do so through the SQL Editor instead.",Y=e=>{switch(e){case"number":return(0,a.jsx)(r.A,{size:14,className:"text-foreground",strokeWidth:1.5});case"time":return(0,a.jsx)(i.A,{size:14,className:"text-foreground",strokeWidth:1.5});case"text":return(0,a.jsx)(o.A,{size:14,className:"text-foreground",strokeWidth:1.5});case"json":case"jsonb":return(0,a.jsx)("div",{className:"text-foreground",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,a.jsx)(c.A,{size:14,className:"text-foreground",strokeWidth:1.5});default:return(0,a.jsx)(d.A,{size:16,className:"text-foreground",strokeWidth:1.5})}};return q?T&&!P?(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{children:(0,a.jsx)(g.A,{readOnly:!0,disabled:!0,label:P?"Type":"",layout:P?"horizontal":void 0,className:"md:gap-x-0",size:"small",value:E})}),!P&&I&&(0,a.jsx)(y.ZI,{side:"bottom",children:(0,a.jsx)("div",{className:"w-80",children:I})})]}):(0,a.jsxs)("div",{className:(0,v.cn)("flex flex-col gap-y-2",_),"data-sentry-component":"ColumnType","data-sentry-source-file":"ColumnType.tsx",children:[P&&(0,a.jsx)(j.J,{className:"text-foreground-light",children:"Type"}),(0,a.jsxs)(b.AM,{open:z,onOpenChange:K,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:[(0,a.jsx)(b.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:(0,a.jsx)(N.$,{type:O?"danger":"default",role:"combobox",size:"small","aria-expanded":z,className:(0,v.cn)("w-full justify-between",!E&&"text-foreground-lighter"),iconRight:(0,a.jsx)(u.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"}),"data-sentry-element":"Button","data-sentry-source-file":"ColumnType.tsx",children:E?(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("span",{children:Y(null!=(h=null==(t=(e=>{let t=k.fX.find(t=>t.name===e);if(t)return t;let n=R.find(t=>t.format===e);return n?{...n,type:"enum"}:void 0})(E))?void 0:t.type)?h:"")}),E.replaceAll('"',"")]}):"Choose a column type..."})}),(0,a.jsx)(b.hl,{className:"w-[460px] p-0",side:"bottom",align:"center","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:(0,a.jsx)(w.FK,{className:"h-[335px]","data-sentry-element":"ScrollArea","data-sentry-source-file":"ColumnType.tsx",children:(0,a.jsxs)(C.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:[(0,a.jsx)(C.G7,{placeholder:"Search types...",className:"!bg-transparent focus:!shadow-none focus:!ring-0","data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"ColumnType.tsx"}),(0,a.jsx)(C.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:"Type not found."}),(0,a.jsxs)(C.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:[(0,a.jsx)(C.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:k.fX.map(e=>(0,a.jsxs)(C.h_,{value:e.name,className:(0,v.cn)("relative",e.name===E?"bg-surface-200":""),onSelect:e=>{D(e),K(!1)},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 pr-6",children:[(0,a.jsx)("span",{children:Y(e.type)}),(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.description})]}),(0,a.jsx)("span",{className:"absolute right-3 top-2",children:e.name===E?(0,a.jsx)(m.A,{className:"text-brand",size:14}):""})]},e.name))}),R.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.h_,{children:"Other types"}),(0,a.jsx)(C.L$,{children:R.map(e=>{var t;return(0,a.jsx)(C.h_,{value:e.format,className:(0,v.cn)("relative",e.format===E?"bg-surface-200":""),onSelect:t=>{D("public"===e.schema?t.replaceAll('"',""):t),K(!1)},children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)(d.A,{size:16,className:"text-foreground",strokeWidth:1.5})}),(0,a.jsx)("span",{className:"text-foreground",children:e.format.replaceAll('"',"")}),void 0!==e.comment&&(0,a.jsx)("span",{title:null!=(t=e.comment)?t:"",className:"text-foreground-lighter",children:e.comment}),e.format===E&&(0,a.jsx)("span",{className:"absolute right-3 top-2",children:(0,a.jsx)(m.A,{className:"text-brand",size:14})})]})},e.id)})})]})]})]})})})]}),F&&void 0!==B&&(0,a.jsxs)(S.Fc,{variant:"warning",className:"mt-2",children:[(0,a.jsx)(A.HV,{}),(0,a.jsxs)(S.XL,{children:[" ","It is recommended to use ",(0,a.jsx)("code",{className:"text-xs",children:B.alternative})," ","instead"]}),(0,a.jsxs)(S.TN,{children:[(0,a.jsxs)("p",{children:["Postgres recommends against using the data type"," ",(0,a.jsx)("code",{className:"text-xs",children:E})," unless you have a very specific use case."]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,a.jsx)(N.$,{asChild:!0,type:"default",icon:(0,a.jsx)(x.A,{}),children:(0,a.jsx)(p(),{href:B.reference,target:"_blank",rel:"noreferrer",children:"Read more"})}),(0,a.jsxs)(N.$,{type:"primary",onClick:()=>D(B.alternative),children:["Use ",B.alternative]})]})]})]})]}):(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{children:(0,a.jsx)(g.A,{readOnly:!0,disabled:!0,label:P?"Type":"",layout:P?L:void 0,className:"md:gap-x-0 [&>div>div]:text-left",size:"small",icon:Y(null!=(l=null==(n=k.fX.find(e=>e.name===E))?void 0:n.type)?l:""),value:E,descriptionText:P?U:void 0})}),!P&&(0,a.jsx)(y.ZI,{side:"bottom",className:"w-80",children:U})]})}},96962:(e,t,n)=>{n.d(t,{P:()=>a});var a=function(e){return e.NO_ACTION="a",e.RESTRICT="r",e.CASCADE="c",e.SET_NULL="n",e.SET_DEFAULT="d",e}({})},97904:(e,t,n)=>{n.d(t,{L:()=>o,V:()=>i});var a=n(72391),l=n(67850),s=n(59356),r=n(31958);async function i(e,t){let{projectRef:n,connectionString:l,name:i,schema:o}=e,{sql:c,zod:d}=a.A.tables.retrieve({name:i,schema:o}),{result:u}=await (0,s.E)({projectRef:n,connectionString:l,sql:c,queryKey:r.v.retrieve(n,i,o)},t);return d.parse(u[0])}let o=function(e){let{projectRef:t,connectionString:n,name:a,schema:s}=e,{enabled:o=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.I)({queryKey:r.v.retrieve(t,a,s),queryFn:e=>{let{signal:l}=e;return i({projectRef:t,connectionString:n,name:a,schema:s},l)},enabled:o&&void 0!==t,...c})}},98357:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(80263),l=n(53239),s=n(23157),r=n(7981),i=n(7760);let o=(0,l.createContext)({parentCallback:e=>{},parentSize:""});function c(e){let{className:t,id:n="",name:l="",label:s,afterLabel:c,beforeLabel:d,description:u,checked:m,value:x,onChange:h,onBlur:p,size:f="medium",disabled:y=!1,...g}=e,{formContextOnChange:v,values:j,handleBlur:b}=(0,i.x)(),N=(0,r.A)("checkbox");return(0,a.jsx)(o.Consumer,{"data-sentry-element":"CheckboxContext.Consumer","data-sentry-component":"Checkbox","data-sentry-source-file":"Checkbox.tsx",children:e=>{let{parentCallback:r,parentSize:i}=e,o=n||l||(s?s.toLowerCase().replace(/^[^A-Z0-9]+/gi,"").replace(/ /g,"-"):void 0);f=i||f;let w=l||o,C=null!=m?m:void 0,S=[N.container];return t&&S.push(t),j&&void 0===m&&(C=j[n||l]),(0,a.jsxs)("div",{className:S.join(" "),children:[(0,a.jsx)("input",{id:o,name:w,type:"checkbox",className:[N.base,N.size[f]].join(" "),onChange:function(e){r&&r(e),h&&h(e),v&&v(e)},onBlur:function(e){b&&setTimeout(()=>{b(e)},100),p&&p(e)},checked:C,value:x||o,disabled:y,...g}),(0,a.jsxs)("label",{className:[N.label.base,N.label[f]].join(" "),htmlFor:o,children:[(0,a.jsxs)("span",{children:[d&&(0,a.jsx)("span",{className:[N.label_before.base,N.label_before[f]].join(" "),children:d}),s,c&&(0,a.jsx)("span",{className:[N.label_after.base,N.label_after[f]].join(" "),children:c})]}),u&&(0,a.jsx)("p",{className:[N.description.base,N.description[f]].join(" "),children:u})]})]})}})}c.Group=function(e){let{id:t,layout:n="vertical",error:l,descriptionText:i,label:d,afterLabel:u,beforeLabel:m,labelOptional:x,children:h,className:p,options:f,onChange:y,size:g="medium"}=e,v=(0,r.A)("checkbox");return(0,a.jsx)(s.H,{label:d,afterLabel:u,beforeLabel:m,labelOptional:x,layout:n,id:t,error:l,descriptionText:i,className:p,size:g,"data-sentry-element":"FormLayout","data-sentry-component":"Group","data-sentry-source-file":"Checkbox.tsx",children:(0,a.jsx)(o.Provider,{value:{parentCallback:e=>{y&&y(e)},parentSize:g},"data-sentry-element":"CheckboxContext.Provider","data-sentry-source-file":"Checkbox.tsx",children:(0,a.jsx)("div",{className:v.group,children:f?f.map(e=>(0,a.jsx)(c,{id:e.id,value:e.value,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,checked:e.checked,name:e.name,description:e.description,defaultChecked:e.defaultChecked},e.id)):h})})})};let d=c}}]);