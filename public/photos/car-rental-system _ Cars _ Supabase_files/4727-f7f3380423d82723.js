try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f1f3fc50-587f-4d2a-9f71-8bf5aa819fec",e._sentryDebugIdIdentifier="sentry-dbid-f1f3fc50-587f-4d2a-9f71-8bf5aa819fec")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4727],{22730:(e,n,t)=>{t.d(n,{z:()=>d});var a=t(78510),s=t(67850),i=t(24523),r=t(9620),l=t(85039),o=t(87727);async function c(e,n,t){let{projectRef:s,connectionString:r}=e;if(!s)throw Error("projectRef is required");let l=new Headers(t);r&&l.set("x-connection-encrypted",r);let{data:o,error:c}=await (0,i.Jt)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":r,"x-pg-application-name":a.r},path:{ref:s}},headers:l,signal:n});return c&&(0,i.H4)(c),o}let d=function(e){let{projectRef:n,connectionString:t}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:d}=(0,r.YA)(),u=(null==d?void 0:d.status)===l.BU.ACTIVE_HEALTHY;return(0,s.I)({queryKey:o.I.list(n),queryFn:e=>{let{signal:a}=e;return c({projectRef:n,connectionString:t},a)},enabled:a&&void 0!==n&&u,...i})}},40314:(e,n,t)=>{t.d(n,{A:()=>v});var a=t(80263),s=t(47023),i=t(11203),r=t.n(i),l=t(53239),o=t(23157),c=t(15471),d=t(50298),u=t(7981),m=t(80100),h=t(7760);let x=(0,l.createContext)({onChange:e=>{},selected:void 0});var f=t(23892);function p(e){let{children:n,className:t,buttonClassName:i,descriptionText:f,error:p,icon:v,id:b="",name:y="",label:j,labelOptional:g,layout:w,value:A,onChange:S,onFocus:E,onBlur:C,style:_,size:N="medium",defaultValue:F,validation:L,disabled:k,optionsWidth:O}=e,[R,z]=(0,l.useState)(void 0),[B,q]=(0,l.useState)({}),T=(0,u.A)("listbox"),P=(0,l.useRef)(null),{formContextOnChange:V,values:D,errors:I,handleBlur:M,touched:H,fieldLevelValidation:W}=(0,h.x)();D&&!A&&(A=D[b||y],F=D[b||y]),p||(I&&!p&&(p=I[b||y]),p=H&&H[b||y]?p:void 0),(0,l.useEffect)(()=>{void 0!==A&&z(A)},[A]),(0,l.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(O||(null==(e=P.current)?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{var e;let t=r()(n);function a(e){return t.find(n=>n.props.value===e)}if(A){z(A);let e=a(A);q((null==e?void 0:e.props)?e.props:void 0);return}if(R){let e=a(R);q((null==e?void 0:e.props)?e.props:void 0);return}if(F){z(F);let e=a(R);q((null==e?void 0:e.props)?e.props:void 0);return}q(null==(e=t[0])?void 0:e.props)},[R]);let Y=[T.container,T.base,i],K=[T.addOnBefore];return p&&Y.push(T.variants.error),p||Y.push(T.variants.standard),v&&K.push(T.with_icon),N&&Y.push(T.size[N]),k&&Y.push(T.disabled),(0,a.jsx)(o.H,{label:j,labelOptional:g,layout:w,id:b,error:p,descriptionText:f,className:t,style:_,size:N,"data-sentry-element":"FormLayout","data-sentry-component":"Listbox","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsxs)(s.bL,{"data-sentry-element":"DropdownMenuPrimitive.Root","data-sentry-source-file":"Listbox2.tsx",children:[(0,a.jsx)(s.l9,{asChild:!0,disabled:k,"data-sentry-element":"DropdownMenuPrimitive.Trigger","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsxs)("button",{"data-size":N,ref:P,className:(0,m.cn)(Y),onBlur:function(e){M&&M(e),C&&C(e)},onFocus:E,name:y,id:b,children:[(0,a.jsxs)("span",{className:(0,m.cn)(K),children:[v&&(0,a.jsx)(d.A,{size:N,icon:v}),(null==B?void 0:B.addOnBefore)&&(0,a.jsx)(B.addOnBefore,{}),(0,a.jsx)("span",{className:T.label,children:null==B?void 0:B.label})]}),(0,a.jsx)("span",{className:T.chevron_container,children:(0,a.jsx)("svg",{className:T.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-sentry-element":"svg","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd","data-sentry-element":"path","data-sentry-source-file":"Listbox2.tsx"})})}),p&&(0,a.jsx)("div",{className:T.actions_container,children:p&&(0,a.jsx)(c.A,{size:N})})]})}),(0,a.jsx)(s.UC,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:T.options_container,"data-sentry-element":"DropdownMenuPrimitive.Content","data-sentry-source-file":"Listbox2.tsx",children:(0,a.jsx)("div",{children:(0,a.jsx)(x.Provider,{value:{onChange:function(e){S&&S(e),z(e);let n={};n.target={type:"select",name:y,id:b,value:e,checked:void 0},V&&V(n),L&&W(b,L(e))},selected:R},"data-sentry-element":"SelectContext.Provider","data-sentry-source-file":"Listbox2.tsx",children:n})})})]})})}p.Option=function(e){let{id:n,value:t,label:i,disabled:r=!1,children:l,className:o="",addOnBefore:c}=e,d=(0,u.A)("listbox");return(0,a.jsx)(x.Consumer,{"data-sentry-element":"SelectContext.Consumer","data-sentry-component":"SelectOption","data-sentry-source-file":"Listbox2.tsx",children:e=>{let{onChange:i,selected:u}=e,h=u===t;return(0,a.jsxs)(s.q7,{className:(0,m.cn)(d.option,h?d.option_active:" ",r?d.option_disabled:" ",o),onSelect:()=>r?{}:i(t),children:[(0,a.jsxs)("div",{className:d.option_inner,children:[c&&c({active:h,selected:u}),(0,a.jsx)("span",{children:"function"==typeof l?l({active:h,selected:u}):l})]}),h?(0,a.jsx)("span",{className:(0,m.cn)(d.option_check,h?d.option_check_active:""),children:(0,a.jsx)(f.A,{className:d.option_check_icon,"aria-hidden":"true"})}):null]},n)}})};let v=p},42018:(e,n,t)=>{t.d(n,{E:()=>m});var a=t(72391),s=t(29395),i=t(51355),r=t(80210),l=t(73969),o=t(30659),c=t(59356),d=t(87727);async function u(e){let{projectRef:n,connectionString:t,schema:i,name:r,version:l,cascade:o=!1,createSchema:d=!1}=e,u=new Headers;t&&u.set("x-connection-encrypted",t);let{sql:m}=a.A.extensions.create({schema:i,name:r,version:l,cascade:o}),{result:h}=await (0,c.E)({projectRef:n,connectionString:t,sql:d?"create schema if not exists ".concat((0,s.bD)(i),"; ").concat(m):m,queryKey:["extension","create"]});return h}let m=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,i.jE)();return(0,r.n)({mutationFn:e=>u(e),async onSuccess(n,t,s){let{projectRef:i}=t;await Promise.all([a.invalidateQueries({queryKey:d.I.list(i)}),a.invalidateQueries({queryKey:o.n.upgradeEligibility(i)})]),await (null==e?void 0:e(n,t,s))},async onError(e,t,a){void 0===n?l.oR.error("Failed to enable database extension: ".concat(e.message)):n(e,t,a)},...t})}},49151:(e,n,t)=>{t.d(n,{A:()=>o});var a=t(80263),s=t(53239),i=t(57459),r=t(7760);function l(e,n){if(!n.error)return delete e[n.key],e;if(n)return{...e,[n.key]:n.error};throw Error()}function o(e){let{validate:n,...t}=e,[o,c]=(0,s.useReducer)(l,null),d=(0,i.Wx)({validateOnBlur:!0,...t,validationSchema:t.validationSchema,initialValues:t.initialValues,onSubmit:t.onSubmit,validate:n||function(){return o}});return(0,a.jsx)("form",{id:t.id,name:t.name,onSubmit:d.handleSubmit,className:t.className,style:t.style,method:"POST","data-sentry-component":"Form","data-sentry-source-file":"Form.tsx",children:(0,a.jsx)(r.h,{values:d.values,errors:d.errors,formContextOnChange:d.handleChange,handleBlur:d.handleBlur,touched:d.touched,fieldLevelValidation:function(e,n){c({key:e,error:n})},"data-sentry-element":"FormContextProvider","data-sentry-source-file":"Form.tsx",children:t.children({errors:d.errors,touched:d.touched,isSubmitting:d.isSubmitting,isValidating:d.isValidating,submitCount:d.submitCount,initialValues:d.initialValues,values:d.values,handleReset:d.handleReset,resetForm:d.resetForm,setFieldValue:d.setFieldValue})})})}},93042:(e,n,t)=>{t.d(n,{A:()=>C});var a=t(80263),s=t(90376),i=t(38985),r=t(86510),l=t(53239),o=t(73969),c=t(41273),d=t(53931),u=t(42018),m=t(32775),h=t(59356),x=t(9620),f=t(63335),p=t(85039),v=t(6217),b=t(49151),y=t(80421),j=t(40314),g=t(20033),w=t(60793),A=t(99779),S=t(44725);let E=["vector","postgis"],C=e=>{let{visible:n,extension:t,onCancel:C}=e,{data:_}=(0,x.YA)(),N=(0,x.W0)(),[F,L]=(0,l.useState)(),[k,O]=(0,l.useState)(!1),{data:R,isLoading:z}=(0,m.w$)({projectRef:null==_?void 0:_.ref,connectionString:null==_?void 0:_.connectionString},{enabled:n}),{data:B}=(0,f.Uu)({excludeSchemas:["extensions"]}),{mutate:q,isPending:T}=(0,u.E)({onSuccess:()=>{o.oR.success('Extension "'.concat(t.name,'" is now enabled')),C()},onError:e=>{o.oR.error("Failed to enable ".concat(t.name,": ").concat(e.message))}});(0,l.useEffect)(()=>{let e=!1;return n&&(async()=>{e||(O(!0),L(void 0));try{let n=await (0,h.E)({projectRef:null==_?void 0:_.ref,connectionString:null==_?void 0:_.connectionString,sql:"select * from pg_available_extension_versions where name = '".concat(t.name,"'")});e||L(n.result[0].schema)}catch(e){}O(!1)})(),()=>{e=!0}},[n,t.name]);let P=async e=>{if(void 0===_)return console.error("Project is required");let n=null!=F?F:"custom"===e.schema?e.name:e.schema;q({projectRef:_.ref,connectionString:null==_?void 0:_.connectionString,schema:n,name:t.name,version:t.default_version,cascade:!0,createSchema:!n.startsWith("pg_")})};return(0,a.jsx)(v.A,{hideFooter:!0,visible:n,onCancel:C,size:"small",header:(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("h5",{className:"text-foreground",children:"Confirm to enable"}),(0,a.jsx)("code",{className:"text-xs",children:t.name})]}),"data-sentry-element":"Modal","data-sentry-component":"EnableExtensionModal","data-sentry-source-file":"EnableExtensionModal.tsx",children:(0,a.jsx)(b.A,{initialValues:{name:t.name,schema:"extensions"},validate:e=>{let n={};return"custom"!==e.schema||e.name||(n.name="Required field"),n},onSubmit:P,"data-sentry-element":"Form","data-sentry-source-file":"EnableExtensionModal.tsx",children:e=>{let{values:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(v.A.Content,{className:"flex flex-col gap-y-2",children:[N&&E.includes(t.name)&&(0,a.jsxs)(S.Z,{type:"default",title:"Extension is limited by OrioleDB",children:[(0,a.jsxs)("span",{className:"block",children:[t.name," cannot be accelerated by indexes on tables that are using the OrioleDB access method"]}),(0,a.jsx)(c.A,{abbrev:!1,className:"mt-2",href:"".concat(p.aq)})]}),k||z?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.Ay,{}),(0,a.jsx)("div",{className:"w-3/4",children:(0,a.jsx)(d.Ay,{})})]}):F?(0,a.jsx)(y.A,{disabled:!0,id:"schema",name:"schema",value:F,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(F,".")}):(0,a.jsxs)(j.A,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,a.jsxs)(j.A.Option,{id:"custom",label:'Create a new schema "'.concat(t.name,'"'),value:"custom",addOnBefore:()=>(0,a.jsx)(s.A,{size:16,strokeWidth:1.5}),children:['Create a new schema "',t.name,'"']},"custom"),(0,a.jsx)(v.A.Separator,{}),null==R?void 0:R.filter(e=>!B.some(n=>n.name===e.name)).map(e=>(0,a.jsx)(j.A.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,a.jsx)(i.A,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})]}),"custom"===n.schema&&(0,a.jsx)(v.A.Content,{children:(0,a.jsx)(y.A,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===t.name&&(null==_?void 0:_.cloud_provider)==="FLY"&&(0,a.jsx)(v.A.Content,{children:(0,a.jsxs)(g.Fc,{variant:"warning",children:[(0,a.jsx)(w.id,{}),(0,a.jsx)(g.XL,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,a.jsx)(g.TN,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,a.jsx)(g.TN,{className:"mt-3",children:(0,a.jsx)(A.$,{asChild:!0,type:"default",iconRight:(0,a.jsx)(r.A,{width:12,height:12}),children:(0,a.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)("span",{children:"Learn more"})})})})]})}),(0,a.jsx)(v.A.Separator,{}),(0,a.jsxs)(v.A.Content,{className:"flex items-center justify-end space-x-2",children:[(0,a.jsx)(A.$,{type:"default",disabled:T,onClick:()=>C(),children:"Cancel"}),(0,a.jsx)(A.$,{htmlType:"submit",disabled:T,loading:T,children:"Enable extension"})]})]})}})})}}}]);